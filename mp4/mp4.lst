     1                                  ; ECE 291 Fall 2001 MP4    
     2                                  ; -- Paint291 --
     3                                  ;
     4                                  ; Completed By:
     5                                  ;  Terrence Bradley Janas
     6                                  ;  October 31, 2001
     7                                  ;
     8                                  ; Josh Potts
     9                                  ; Guest Author - Ryan Chmiel
    10                                  ; University of Illinois Urbana Champaign
    11                                  ; Dept. of Electrical & Computer Engineering
    12                                  ;
    13                                  ; Ver 1.0
    14                                  
    15                                  
    16                                  %include "lib291.inc"
    17                              <1> ; Main pmodelib include
    18                              <1> ;  By Peter Johnson, 1999-2000
    19                              <1> ;
    20                              <1> ; $Id: lib291.inc,v 1.9 2001/04/03 04:39:34 mu Exp $
    21                              <1> 
    22                              <1> %include "myC32.mac"
    23                              <2> ; NASM macro set to make interfacing to 32-bit programs easier
    24                              <2> ; Also cool little macros to make NASM emulate some MASM things.
    25                              <2> ;
    26                              <2> ; Originally included in NASM.  Modifications by Peter Johnson, 1999.
    27                              <2> ;
    28                              <2> ; $Id: myC32.mac,v 1.4 2000/12/18 07:27:43 pete Exp $
    29                              <2> 
    30                              <2> %imacro proc 1                  ; begin a procedure definition
    31                              <2> %push proc
    32                              <2>           global %1
    33                              <2> %1:       push  ebp
    34                              <2>           mov   ebp, esp
    35                              <2> %assign %$arg 8
    36                              <2> ;%assign %$argnum 0
    37                              <2> %define %$procname %1
    38                              <2> %endmacro
    39                              <2> 
    40                              <2> %imacro arg 0-1 4               ; used with the argument name as a label
    41                              <2> %00       equ %$arg
    42                              <2> ;%assign %$argnum %$argnum+1
    43                              <2> ;.arg%$argnum   equ     %1
    44                              <2> %assign %$arg %1+%$arg
    45                              <2> %endmacro
    46                              <2> 
    47                              <2> %imacro endproc 0
    48                              <2> %ifnctx proc
    49                              <2> %error Mismatched `endproc'/`proc'
    50                              <2> %else
    51                              <2> ;        mov     esp, ebp
    52                              <2> ;        pop     ebp
    53                              <2> %ifdef LEGACY_ENDPROC
    54                              <2>         ret
    55                              <2> %endif
    56                              <2> ;__end_%$procname:               ; useful for calculating function size
    57                              <2> ;          global %{$procname}_arglen
    58                              <2> ;%{$procname}_arglen    equ     %$arg-8
    59                              <2> ;%assign %$i 1
    60                              <2> ;%rep %$argnum
    61                              <2> ;          global %{$procname}_arg%$i
    62                              <2> ;%{$procname}_arg%$i    equ     %{$procname}.arg%$i
    63                              <2> ;%assign %$i %$i+1
    64                              <2> ;%endrep
    65                              <2> %pop
    66                              <2> %endif
    67                              <2> %endmacro
    68                              <2> 
    69                              <2> ; redefine ret instructions for in-proc cases
    70                              <2> %imacro ret 0-1
    71                              <2> %ifnctx proc
    72                              <2> 	ret	%1
    73                              <2> %else
    74                              <2> 	mov	esp, ebp
    75                              <2> 	pop	ebp
    76                              <2> 	ret	%1
    77                              <2> %endif
    78                              <2> %endmacro
    79                              <2> 
    80                              <2> %imacro retf 0-1
    81                              <2> %ifnctx proc
    82                              <2> 	retf	%1
    83                              <2> %else
    84                              <2> 	mov	esp, ebp
    85                              <2> 	pop	ebp
    86                              <2> 	retf	%1
    87                              <2> %endif
    88                              <2> %endmacro
    89                              <2> 
    90                              <2> %imacro retn 0-1
    91                              <2> %ifnctx proc
    92                              <2> 	retn	%1
    93                              <2> %else
    94                              <2> 	mov	esp, ebp
    95                              <2> 	pop	ebp
    96                              <2> 	retn	%1
    97                              <2> %endif
    98                              <2> %endmacro
    99                              <2> 
   100                              <2> ; invoke calls a C function
   101                              <2> ; defaults to word (16 bit) size parameters
   102                              <2> %macro invoke 1-*
   103                              <2> %rotate -1
   104                              <2> ;%define invoketype word
   105                              <2> %rep (%0-1)
   106                              <2> ;       %ifidni %1,dword
   107                              <2> ;               %define invoketype dword
   108                              <2> ;       %elifidni %1,word
   109                              <2> ;               %define invoketype word
   110                              <2> ;       %elifidni %1,byte
   111                              <2> ;               %define invoketype byte
   112                              <2> ;       %else
   113                              <2>         %ifidni %1, cs
   114                              <2>                 o16 push %1
   115                              <2>         %elifidni %1, ds
   116                              <2>                 o16 push %1
   117                              <2>         %elifidni %1, es
   118                              <2>                 o16 push %1
   119                              <2>         %elifidni %1, fs
   120                              <2>                 o16 push %1
   121                              <2>         %elifidni %1, gs
   122                              <2>                 o16 push %1
   123                              <2>         %elifidni %1, word cs
   124                              <2>                 o16 push %1
   125                              <2>         %elifidni %1, word ds
   126                              <2>                 o16 push %1
   127                              <2>         %elifidni %1, word es
   128                              <2>                 o16 push %1
   129                              <2>         %elifidni %1, word fs
   130                              <2>                 o16 push %1
   131                              <2>         %elifidni %1, word gs
   132                              <2>                 o16 push %1
   133                              <2>         %else
   134                              <2>                 push %1
   135                              <2>         %endif
   136                              <2> ;       %endif
   137                              <2>         %rotate -1
   138                              <2> %endrep
   139                              <2> call %1
   140                              <2> %if (%0!=1)
   141                              <2>         add esp, byte %{1}_arglen
   142                              <2> %endif
   143                              <2> %endmacro
   144                              <2> 
   145                              <1> 
   146                              <1> %include "constant.inc"
   147                              <2> ; General constants
   148                              <2> ;  By Peter Johnson, 2001
   149                              <2> ;
   150                              <2> ; $Id: constant.inc,v 1.6 2001/04/07 08:02:14 pete Exp $
   151                              <2> 
   152                              <2> ; Socket constants:
   153                              <2> ;  Addresses:
   154                              <2> INADDR_ANY		equ	0
   155                              <2> INADDR_LOOPBACK		equ	7F000001h
   156                              <2> INADDR_BROADCAST	equ	0FFFFFFFFh
   157                              <2> INADDR_NONE		equ	0FFFFFFFFh
   158                              <2> ;  Types:
   159                              <2> SOCK_STREAM		equ	1
   160                              <2> SOCK_DGRAM		equ	2
   161                              <2> ;  Events:
   162                              <2> SOCKEVENT_READ		equ	01h
   163                              <2> SOCKEVENT_WRITE		equ	02h
   164                              <2> SOCKEVENT_OOB		equ	04h
   165                              <2> SOCKEVENT_ACCEPT	equ	08h
   166                              <2> SOCKEVENT_CONNECT	equ	10h
   167                              <2> SOCKEVENT_CLOSE		equ	20h
   168                              <2> 
   169                              <2> ; Socket structures
   170                              <2> 	STRUC	SOCKADDR
   171 00000000 <res 00000002>      <2> .Port		resw	1	; Port number
   172 00000002 <res 00000004>      <2> .Address	resd	1	; Network address
   173                              <2> 	ENDSTRUC
   174                              <2> 
   175                              <2> 	STRUC	HOSTENT
   176 00000000 <res 00000004>      <2> .Name		resd	1	; Pointer to official name of host
   177 00000004 <res 00000004>      <2> .Aliases	resd	1	; Pointer to 0-terminated array of pointers to
   178                              <2> 				;  alias names
   179 00000008 <res 00000004>      <2> .AddrList	resd	1	; Pointer to 0-terminated array of pointers to
   180                              <2> 				;  addresses
   181                              <2> 	ENDSTRUC
   182                              <2> 
   183                              <1> %include "globals.inc"
   184                              <2> ; General constants and stuff
   185                              <2> ;  By Peter Johnson, 1999-2001
   186                              <2> ;
   187                              <2> ; $Id: globals.inc,v 1.4 2001/03/19 01:10:36 pete Exp $
   188                              <2> 
   189                              <2>         EXTERN _ScratchBlock    ; Scratch Block (1 meg)
   190                              <2>         EXTERN _textsel         ; Selector to the textmode ram
   191                              <2> 
   192                              <2> NET_BUFFER_SIZE equ     16*1024         ; Network send/receive buffer size
   193                              <2>                                         ; (per buffer)
   194                              <2>         
   195                              <2> RXBuffer        equ     0               ; Receive Data Buffer (offset into NetTransferSel)
   196                              <2> TXBuffer        equ     NET_BUFFER_SIZE ; Transmit Data Buffer (offset into NetTransferSel)
   197                              <2> 
   198                              <1> %include "dma.inc"
   199                              <2> ; DMA interface code (used primarily by sound routines)
   200                              <2> ;  By Peter Johnson, 1999
   201                              <2> ;
   202                              <2> ; $Id: dma.inc,v 1.2 2000/12/14 07:52:21 pete Exp $
   203                              <2> 
   204                              <2>         EXTERN  _DMA_Allocate_Mem
   205                              <2>         EXTERN  _DMA_Start
   206                              <2>         EXTERN  _DMA_Stop
   207                              <2>         EXTERN  _DMA_Todo
   208                              <2>         EXTERN  _DMA_Lock_Mem
   209                              <2> 
   210                              <2> _DMA_Allocate_Mem_arglen        equ     12
   211                              <2> _DMA_Start_arglen               equ     20
   212                              <2> _DMA_Stop_arglen                equ     4
   213                              <2> _DMA_Todo_arglen                equ     4
   214                              <2> 
   215                              <1> %include "dpmi_int.inc"
   216                              <2> ; DPMI Interrupt Interface header file
   217                              <2> ;  By Peter Johnson, 1999
   218                              <2> ;
   219                              <2> ; $Id: dpmi_int.inc,v 1.3 2000/12/14 07:52:21 pete Exp $
   220                              <2> 
   221                              <2> 	EXTERN DPMI_Int
   222                              <2> 	EXTERN _AllocTransferBuf
   223                              <2> 	EXTERN _FreeTransferBuf
   224                              <2> 
   225                              <2> 	EXTERN	DPMI_Regs
   226                              <2> 	EXTERN	DPMI_EDI
   227                              <2> 	EXTERN	DPMI_ESI
   228                              <2> 	EXTERN	DPMI_EBP
   229                              <2> 	EXTERN	DPMI_EBX
   230                              <2> 	EXTERN	DPMI_EDX
   231                              <2> 	EXTERN	DPMI_ECX
   232                              <2> 	EXTERN	DPMI_EAX
   233                              <2> 	EXTERN	DPMI_FLAGS
   234                              <2> 	EXTERN	DPMI_ES
   235                              <2> 	EXTERN	DPMI_DS
   236                              <2> 	EXTERN	DPMI_FS
   237                              <2> 	EXTERN	DPMI_GS
   238                              <2> 	EXTERN	DPMI_SP
   239                              <2> 	EXTERN	DPMI_SS
   240                              <2> 
   241                              <2> 	EXTERN	_Transfer_Buf
   242                              <2> 	EXTERN	_Transfer_Buf_Seg
   243                              <2> 	EXTERN	_Transfer_Buf_Size
   244                              <2> 
   245                              <2> DPMI_EDI_off    equ     00h
   246                              <2> DPMI_ESI_off    equ     04h
   247                              <2> DPMI_EBP_off    equ     08h
   248                              <2> ;DPMI_RES0_off  equ     0Ch
   249                              <2> DPMI_EBX_off    equ     10h
   250                              <2> DPMI_EDX_off    equ     14h
   251                              <2> DPMI_ECX_off    equ     18h
   252                              <2> DPMI_EAX_off    equ     1Ch
   253                              <2> DPMI_FLAGS_off  equ     20h
   254                              <2> DPMI_ES_off     equ     22h
   255                              <2> DPMI_DS_off     equ     24h
   256                              <2> DPMI_FS_off     equ     26h
   257                              <2> DPMI_GS_off     equ     28h
   258                              <2> DPMI_IP_off     equ     2Ah
   259                              <2> DPMI_CS_off     equ     2Ch
   260                              <2> DPMI_SP_off     equ     2Eh
   261                              <2> DPMI_SS_off     equ     30h
   262                              <1> %include "dpmi_mem.inc"
   263                              <2> ; DPMI Memory Interface header file
   264                              <2> ;  By Peter Johnson, 1999-2001
   265                              <2> ;
   266                              <2> ; $Id: dpmi_mem.inc,v 1.6 2001/03/16 23:52:18 pete Exp $
   267                              <2> 
   268                              <2> 	EXTERN _AllocMem
   269                              <2> 	EXTERN _AllocSelector
   270                              <2> 	EXTERN _FreeSelector
   271                              <2>         EXTERN _GetPhysicalMapping
   272                              <2>         EXTERN _FreePhysicalMapping
   273                              <2>         EXTERN _LockArea
   274                              <2> 
   275                              <2> _AllocMem_arglen		equ	4
   276                              <2> _AllocSelector_arglen		equ	4
   277                              <2> _FreeSelector_arglen		equ	2
   278                              <2> _GetPhysicalMapping_arglen      equ     16
   279                              <2> _FreePhysicalMapping_arglen     equ     8
   280                              <2> _LockArea_arglen                equ     10
   281                              <1> %include "filefunc.inc"
   282                              <2> ; File handling functions header file
   283                              <2> ;  By Peter Johnson, 1999-2001
   284                              <2> ;
   285                              <2> ; $Id: filefunc.inc,v 1.5 2001/03/16 22:58:36 pete Exp $
   286                              <2> 
   287                              <2> 	EXTERN _OpenFile
   288                              <2> 	EXTERN _CloseFile
   289                              <2> 	EXTERN _ReadFile
   290                              <2> 	EXTERN _ReadFile_Sel
   291                              <2> 	EXTERN _WriteFile
   292                              <2> 	EXTERN _WriteFile_Sel
   293                              <2> 	EXTERN _SeekFile
   294                              <2> 
   295                              <2> _OpenFile_arglen	equ	6
   296                              <2> _CloseFile_arglen	equ	4
   297                              <2> _ReadFile_arglen	equ	12
   298                              <2> _ReadFile_Sel_arglen	equ	14
   299                              <2> _WriteFile_arglen	equ	12
   300                              <2> _WriteFile_Sel_arglen	equ	14
   301                              <2> _SeekFile_arglen	equ	10
   302                              <1> %include "gfxfiles.inc"
   303                              <2> ; File loading functions header file
   304                              <2> ;  By Peter Johnson, 1999-2001
   305                              <2> ;
   306                              <2> ; $Id: gfxfiles.inc,v 1.6 2001/10/17 21:02:27 pete Exp $
   307                              <2> 
   308                              <2> 	EXTERN _LoadPNG
   309                              <2> 	EXTERN _LoadPNG_Sel
   310                              <2> 	EXTERN _LoadJPG
   311                              <2> 	EXTERN _LoadBMP
   312                              <2> 	EXTERN _LoadBMP_Sel
   313                              <2>         EXTERN _SaveBMP
   314                              <2>         EXTERN _SaveBMP_Sel
   315                              <2> 	
   316                              <2> _LoadPNG_arglen 	equ     16
   317                              <2> _LoadPNG_Sel_arglen 	equ     18
   318                              <2> _LoadJPG_arglen 	equ     16
   319                              <2> _LoadBMP_arglen		equ	8
   320                              <2> _LoadBMP_Sel_arglen	equ	10
   321                              <2> _SaveBMP_arglen 	equ     16
   322                              <2> _SaveBMP_Sel_arglen 	equ     18
   323                              <1> %include "int_wrap.inc"
   324                              <2> ; IRQ Wrappers and handling functions header file
   325                              <2> ;  By Peter Johnson, 1999
   326                              <2> ;
   327                              <2> ; $Id: int_wrap.inc,v 1.2 2000/12/14 07:52:21 pete Exp $
   328                              <2> 
   329                              <2>         EXTERN  _Install_Int
   330                              <2>         EXTERN  _Remove_Int
   331                              <2>         EXTERN  _Exit_IRQ
   332                              <2>         EXTERN  _Init_IRQ
   333                              <2>         EXTERN  _Restore_IRQ
   334                              <2>         EXTERN  _Enable_IRQ
   335                              <2>         EXTERN  _Disable_IRQ
   336                              <2> 
   337                              <2> _Install_Int_arglen             equ     8
   338                              <2> _Remove_Int_arglen              equ     4
   339                              <2> _Restore_IRQ_arglen             equ     4
   340                              <2> _Enable_IRQ_arglen              equ     4
   341                              <2> _Disable_IRQ_arglen             equ     4
   342                              <1> %include "lib_load.inc"
   343                              <2> ; Library Init/Deinit Header File
   344                              <2> ;  By Peter Johnson, 2000
   345                              <2> ;
   346                              <2> ; $Id: lib_load.inc,v 1.2 2000/12/14 07:52:21 pete Exp $
   347                              <2> 
   348                              <2> 	EXTERN _LibInit
   349                              <2>         EXTERN _LibExit
   350                              <2>  
   351                              <1> %include "misc.inc"
   352                              <2> ; Miscellaneous functions header file
   353                              <2> ;  By Peter Johnson, 2000
   354                              <2> ;
   355                              <2> ; $Id: misc.inc,v 1.3 2000/12/14 07:52:21 pete Exp $
   356                              <2> 
   357                              <2>         EXTERN BinAsc
   358                              <2> 	EXTERN AscBin
   359                              <2> 
   360                              <1> %include "netbios.inc"
   361                              <2> ; Include file for NetBIOS
   362                              <2> ;  Written by Peter Johnson, 2000
   363                              <2> ;
   364                              <2> ; $Id: netbios.inc,v 1.2 2000/12/14 07:52:21 pete Exp $
   365                              <2> 
   366                              <2>         EXTERN _NetInit
   367                              <2>         EXTERN _SendPacket
   368                              <2>         EXTERN _NetRelease
   369                              <2> 
   370                              <2>         EXTERN _NetTransferSel
   371                              <2> 
   372                              <2> _NetInit_arglen                 equ     12
   373                              <2> _SendPacket_arglen              equ     4
   374                              <2> 
   375                              <2> 
   376                              <1> %include "rmcbwrap.inc"
   377                              <2> ; IRQ Wrappers and handling functions header file
   378                              <2> ;  By Peter Johnson, 1999
   379                              <2> ;
   380                              <2> ; $Id: rmcbwrap.inc,v 1.2 2000/12/14 07:52:21 pete Exp $
   381                              <2> 
   382                              <2>         EXTERN  _Get_RMCB
   383                              <2>         EXTERN  _Free_RMCB
   384                              <2> 
   385                              <2> _Get_RMCB_arglen                equ     16
   386                              <2> _Free_RMCB_arglen               equ     4
   387                              <1> %include "sb16.inc"
   388                              <2> ; SB16 interface code
   389                              <2> ;  By Michael Urman, 2001
   390                              <2> ;
   391                              <2> ; $Id: sb16.inc,v 1.2 2001/04/07 20:52:00 mu Exp $
   392                              <2> 
   393                              <2> 	EXTERN	_SB16_Init
   394                              <2> 	EXTERN	_SB16_Exit
   395                              <2> 	EXTERN	_SB16_Start
   396                              <2> 	EXTERN	_SB16_Stop
   397                              <2> 	EXTERN	_SB16_SetCallback
   398                              <2> 	EXTERN	_SB16_SetFormat
   399                              <2> 	EXTERN	_SB16_SetMixers
   400                              <2> 	EXTERN	_SB16_GetChannel
   401                              <2> 
   402                              <2> 
   403                              <2> _SB16_Init_arglen		equ	4
   404                              <2> _SB16_Start_arglen		equ	12
   405                              <2> _SB16_SetCallback_arglen	equ	4
   406                              <2> _SB16_SetFormat_arglen		equ	12
   407                              <2> _SB16_SetMixers_arglen		equ	8
   408                              <1> %include "socket.inc"
   409                              <2> ; Socket (TCP/IP, UDP/IP) functions header file
   410                              <2> ;  By Peter Johnson, 2001
   411                              <2> ;
   412                              <2> ; $Id: socket.inc,v 1.3 2001/04/10 09:08:09 pete Exp $
   413                              <2> 
   414                              <2> 	EXTERN _InitSocket
   415                              <2> 	EXTERN _ExitSocket
   416                              <2> 	EXTERN _Socket_SetCallback
   417                              <2> 	EXTERN _Socket_AddCallback
   418                              <2> 	EXTERN _Socket_accept
   419                              <2> 	EXTERN _Socket_bind
   420                              <2> 	EXTERN _Socket_close
   421                              <2> 	EXTERN _Socket_connect
   422                              <2> 	EXTERN _Socket_getpeername
   423                              <2> 	EXTERN _Socket_getsockname
   424                              <2> 	EXTERN _Socket_ntohl
   425                              <2> 	EXTERN _Socket_htonl
   426                              <2> 	EXTERN _Socket_ntohs
   427                              <2> 	EXTERN _Socket_htons
   428                              <2> 	EXTERN _Socket_inet_addr
   429                              <2> 	EXTERN _Socket_inet_ntoa
   430                              <2> 	EXTERN _Socket_listen
   431                              <2> 	EXTERN _Socket_recv
   432                              <2> 	EXTERN _Socket_recvfrom
   433                              <2> 	EXTERN _Socket_send
   434                              <2> 	EXTERN _Socket_sendto
   435                              <2> 	EXTERN _Socket_shutdown
   436                              <2> 	EXTERN _Socket_create
   437                              <2> 	EXTERN _Socket_gethostbyaddr
   438                              <2> 	EXTERN _Socket_gethostbyname
   439                              <2> 	EXTERN _Socket_gethostname
   440                              <2> 	EXTERN _Socket_GetLastError
   441                              <2> 
   442                              <2> _Socket_SetCallback_arglen	equ	4
   443                              <2> _Socket_AddCallback_arglen	equ	8
   444                              <2> _Socket_accept_arglen		equ	8
   445                              <2> _Socket_bind_arglen		equ	8
   446                              <2> _Socket_close_arglen		equ	4
   447                              <2> _Socket_connect_arglen		equ	8
   448                              <2> _Socket_getpeername_arglen	equ	8
   449                              <2> _Socket_getsockname_arglen	equ	8
   450                              <2> _Socket_ntohl_arglen		equ	4
   451                              <2> _Socket_htonl_arglen		equ	4
   452                              <2> _Socket_ntohs_arglen		equ	2
   453                              <2> _Socket_htons_arglen		equ	2
   454                              <2> _Socket_inet_addr_arglen	equ	4
   455                              <2> _Socket_inet_ntoa_arglen	equ	4
   456                              <2> _Socket_listen_arglen		equ	8
   457                              <2> _Socket_recv_arglen		equ	16
   458                              <2> _Socket_recvfrom_arglen		equ	20
   459                              <2> _Socket_send_arglen		equ	16
   460                              <2> _Socket_sendto_arglen		equ	20
   461                              <2> _Socket_shutdown_arglen		equ	8
   462                              <2> _Socket_create_arglen		equ	4
   463                              <2> _Socket_gethostbyaddr_arglen	equ	4
   464                              <2> _Socket_gethostbyname_arglen	equ	4
   465                              <2> _Socket_gethostname_arglen	equ	8
   466                              <1> %include "textmode.inc"
   467                              <2> ; Text Mode (80x25x16) header file
   468                              <2> ;  By Peter Johnson, 1999
   469                              <2> ;
   470                              <2> ; $Id: textmode.inc,v 1.3 2000/12/14 07:52:21 pete Exp $
   471                              <2> 
   472                              <2>         EXTERN _SetModeC80
   473                              <2>         EXTERN _TextSetPage
   474                              <2> 	EXTERN _TextClearScreen
   475                              <2> 	EXTERN _TextWriteChar
   476                              <2> 	EXTERN _TextWriteString
   477                              <2> 
   478                              <2> _TextSetPage_arglen             equ     2
   479                              <2> _TextWriteChar_arglen		equ	8
   480                              <2> _TextWriteString_arglen		equ	10
   481                              <1> %include "vbeaf.inc"
   482                              <2> ; VBE/AF loadable graphics driver header file
   483                              <2> ;  By Peter Johnson, 2001
   484                              <2> ;
   485                              <2> ; $Id: vbeaf.inc,v 1.1 2001/03/02 08:03:39 pete Exp $
   486                              <2> 
   487                              <2> 	EXTERN _LoadGraphicsDriver
   488                              <2> 	EXTERN _InitGraphics
   489                              <2> 	EXTERN _ExitGraphics
   490                              <2> 	EXTERN _FindGraphicsMode
   491                              <2> 	EXTERN _SetGraphicsMode
   492                              <2> 	EXTERN _UnsetGraphicsMode
   493                              <2> 	EXTERN _CopyToScreen
   494                              <2> 
   495                              <2> _LoadGraphicsDriver_arglen	equ	4
   496                              <2> _InitGraphics_arglen		equ	12
   497                              <2> _FindGraphicsMode_arglen	equ	10
   498                              <2> _SetGraphicsMode_arglen		equ	2
   499                              <2> _CopyToScreen_arglen		equ	32
   500                                  %include "libmp4.inc"
   501                              <1> ; MP4 Header File
   502                              <1> 
   503                              <1> ; EXTERN all library functions
   504                              <1> 	EXTERN	_MP4LibExit
   505                              <1> 	EXTERN	_libPointInBox
   506                              <1> 	EXTERN	_libGetPixel
   507                              <1> 	EXTERN	_libDrawPixel
   508                              <1> 	EXTERN	_libDrawLine
   509                              <1> 	EXTERN	_libDrawRect
   510                              <1> 	EXTERN	_libDrawCircle
   511                              <1> 	EXTERN	_libDrawText
   512                              <1> 	EXTERN	_libClearBuffer
   513                              <1> 	EXTERN	_libCopyBuffer
   514                              <1> 	EXTERN	_libComposeBuffers
   515                              <1> 	EXTERN	_libBlurBuffer
   516                              <1> 	EXTERN	_libFloodFill
   517                              <1> 	EXTERN	_libInstallKeyboard
   518                              <1> 	EXTERN	_libRemoveKeyboard
   519                              <1> 	EXTERN	_libKeyboardISR
   520                              <1> 	EXTERN	_libInstallMouse
   521                              <1> 	EXTERN	_libRemoveMouse
   522                              <1> 	EXTERN	_libMouseCallback
   523                              <1> 	EXTERN	_MP4Main
   524                              <1> 	EXTERN	_DrawBackground
   525                              <1> 
   526                              <1> ; DEFINE all library function lengths
   527                              <1> 	_libPointInBox_arglen		EQU	12
   528                              <1> 	_libGetPixel_arglen		EQU	12
   529                              <1> 	_libDrawPixel_arglen		EQU	16
   530                              <1> 	_libDrawLine_arglen		EQU	20
   531                              <1> 	_libDrawRect_arglen		EQU	24
   532                              <1> 	_libDrawCircle_arglen		EQU	22
   533                              <1> 	_libDrawText_arglen		EQU	20
   534                              <1> 	_libClearBuffer_arglen		EQU	12
   535                              <1> 	_libCopyBuffer_arglen		EQU	20
   536                              <1> 	_libComposeBuffers_arglen	EQU	20
   537                              <1> 	_libBlurBuffer_arglen		EQU	12
   538                              <1> 	_libFloodFill_arglen		EQU	20
   539                              <1> 	_libMouseCallback_arglen	EQU	4
   540                              <1> 	_DrawBackground_arglen		EQU	8
   541                              <1> 
   542                              <1> ; GLOBAL all program functions
   543                              <1>     	GLOBAL	_PointInBox
   544                              <1> 	GLOBAL	_GetPixel
   545                              <1> 	GLOBAL	_DrawPixel
   546                              <1> 	GLOBAL	_DrawLine
   547                              <1> 	GLOBAL	_DrawRect
   548                              <1> 	GLOBAL	_DrawCircle
   549                              <1> 	GLOBAL	_DrawText
   550                              <1> 	GLOBAL	_ClearBuffer
   551                              <1> 	GLOBAL	_CopyBuffer
   552                              <1> 	GLOBAL	_ComposeBuffers
   553                              <1> 	GLOBAL	_FloodFill
   554                              <1> 	GLOBAL	_InstallKeyboard
   555                              <1> 	GLOBAL	_RemoveKeyboard
   556                              <1> 	GLOBAL	_KeyboardISR
   557                              <1> 	GLOBAL	_InstallMouse
   558                              <1> 	GLOBAL	_RemoveMouse
   559                              <1> 	GLOBAL	_MouseCallback
   560                              <1> 	GLOBAL	_MP4Main
   561                              <1> 	GLOBAL	_DrawBackground
   562                              <1> 
   563                              <1> ; GLOBAL all program variables
   564                              <1> 	GLOBAL	_GraphicsMode
   565                              <1> 	GLOBAL	_kbINT
   566                              <1> 	GLOBAL	_kbIRQ
   567                              <1> 	GLOBAL	_kbPort
   568                              <1> 	GLOBAL	_MouseSeg
   569                              <1> 	GLOBAL	_MouseOff
   570                              <1> 	GLOBAL	_MouseX
   571                              <1> 	GLOBAL	_MouseY					
   572                              <1> 	GLOBAL	_ScreenOff
   573                              <1> 	GLOBAL	_CanvasOff
   574                              <1> 	GLOBAL	_OverlayOff
   575                              <1> 	GLOBAL	_FontOff
   576                              <1> 	GLOBAL	_MenuOff
   577                              <1> 	GLOBAL	_TitleOff
   578                              <1> 	GLOBAL	_MPFlags			
   579                              <1> 	GLOBAL	_MenuItem				
   580                              <1> 	GLOBAL	_x
   581                              <1> 	GLOBAL	_y
   582                              <1> 	GLOBAL	_dx
   583                              <1> 	GLOBAL	_dy   
   584                              <1> 	GLOBAL	_lineerror
   585                              <1> 	GLOBAL	_xhorizinc
   586                              <1> 	GLOBAL	_xdiaginc
   587                              <1> 	GLOBAL	_yvertinc
   588                              <1> 	GLOBAL	_ydiaginc
   589                              <1> 	GLOBAL	_errordiaginc
   590                              <1> 	GLOBAL	_errornodiaginc
   591                              <1> 	GLOBAL	_radius
   592                              <1> 	GLOBAL	_circleerror
   593                              <1> 	GLOBAL	_xdist
   594                              <1> 	GLOBAL	_ydist
   595                              <1> 	GLOBAL	_PointQueue
   596                              <1> 	GLOBAL	_QueueHead
   597                              <1> 	GLOBAL	_QueueTail
   598                              <1> 	GLOBAL	_key
   599                              <1> 	GLOBAL	_FontFN
   600                              <1> 	GLOBAL	_MenuFN
   601                              <1> 	GLOBAL	_TitleFN
   602                              <1> 	GLOBAL	_CurrentColor
   603                              <1> 	GLOBAL	_ColorBlue
   604                              <1> 	GLOBAL	_ColorWhite
   605                              <1> 	GLOBAL	_ColorBlack
   606                              <1> 	GLOBAL	_ColorHalfBlack
   607                              <1> 	GLOBAL	_buffer
   608                              <1> 	GLOBAL	_ColorString1
   609                              <1> 	GLOBAL	_ColorString2
   610                              <1> 	GLOBAL	_ColorString3
   611                              <1> 	GLOBAL	_ColorString4
   612                              <1> 	GLOBAL	_MenuLocations
   613                              <1> 	GLOBAL	_ProcessMenu
   614                              <1> 	GLOBAL	_QwertyNames
   615                              <1> 	GLOBAL	_QwertyNames_end
   616                              <1> 	GLOBAL	_QwertyShift
   617                              <1> 	GLOBAL	_QwertyShift_end
   618                              <1> 	GLOBAL	_TextInputString
   619                              <1> 	GLOBAL	_ColorInputString
   620                              <1> 	GLOBAL	_RoundingFactor
   621                              <1> 
   622                                  
   623                                  	BITS 32
   624                                  
   625                                  	GLOBAL _main
   626                                  
   627                                  ; EXTERN	_LoadPNG
   628                                  
   629                                  ; Define Contstants
   630                                  
   631                                  	DOWNARROW	EQU	80
   632                                  	RIGHTARROW	EQU	77
   633                                  	LEFTARROW	EQU	75
   634                                  	UPARROW		EQU	72
   635                                  
   636                                  	CANVAS_X	EQU	20
   637                                  	CANVAS_Y	EQU	20
   638                                  
   639                                  	NUM_MENU_ITEMS	EQU	11
   640                                  
   641                                  	BKSP		EQU	8
   642                                  	ESC		EQU	1
   643                                  	ENTERKEY	EQU	13
   644                                  	SPACE		EQU	57
   645                                  	LSHIFT		EQU	42
   646                                  	RSHIFT		EQU	54
   647                                  
   648                                  
   649                                  	SECTION .bss
   650                                  
   651 00000000 <res 00000002>          _GraphicsMode	resw	1	; Graphics mode #
   652                                  
   653 00000002 <res 00000001>          _kbINT		resb	1	; Keyboard interrupt #
   654 00000003 <res 00000001>          _kbIRQ		resb	1	; Keyboard IRQ
   655 00000004 <res 00000002>          _kbPort		resw	1	; Keyboard port
   656                                  
   657 00000006 <res 00000002>          _MouseSeg	resw	1       ; real mode segment for MouseCallback
   658 00000008 <res 00000002>          _MouseOff	resw	1	; real mode offset for MouseCallback
   659 0000000A <res 00000002>          _MouseX		resw	1       ; X coordinate position of mouse on screen
   660 0000000C <res 00000002>          _MouseY		resw	1       ; Y coordinate position of mouse on screen
   661                                  					
   662 0000000E <res 00000004>          _ScreenOff	resd	1	; Screen image offset
   663 00000012 <res 00000004>          _CanvasOff	resd	1	; Canvas image offset
   664 00000016 <res 00000004>          _OverlayOff	resd	1	; Overlay image offset
   665 0000001A <res 00000004>          _FontOff	resd	1	; Font image offset
   666 0000001E <res 00000004>          _MenuOff	resd	1	; Menu image offset
   667 00000022 <res 00000004>          _TitleOff	resd	1	; Title Bar image offset
   668                                  
   669 00000026 <res 00000001>          _MPFlags	resb	1	; program flags
   670                                  				; Bit 0 - Exit program
   671                                  				; Bit 1 - Left mouse button (LMB) status: set if down, cleared if up
   672                                  				; Bit 2 - Change in LMB status: set if button status
   673                                  				;         moves from pressed->released or vice-versa
   674                                  				; Bit 3 - Right shift key status: set if down, cleared if up
   675                                  				; Bit 4 - Left shift key status: set if down, cleared if up
   676                                  				; Bit 5 - Key other than shift was pressed
   677                                  				; Bit 6 - Not Used Anymore
   678                                  				; Bit 7 - Status of chosen color: set if obtained with user input,
   679                                                                  ;         cleared if obtained with eyedrop (you do not have to deal
   680                                  				;         with this - the library code uses it)
   681                                  				
   682 00000027 <res 00000001>          _MenuItem	resb	1	; selected menu item
   683                                  
   684                                  ; line algorithm variables				
   685 00000028 <res 00000002>          _x		resw	1
   686 0000002A <res 00000002>          _y		resw	1
   687 0000002C <res 00000002>          _dx		resw	1
   688 0000002E <res 00000002>          _dy		resw	1
   689 00000030 <res 00000002>          _lineerror	resw	1
   690 00000032 <res 00000002>          _xhorizinc	resw	1
   691 00000034 <res 00000002>          _xdiaginc	resw	1
   692 00000036 <res 00000002>          _yvertinc	resw	1
   693 00000038 <res 00000002>          _ydiaginc	resw	1
   694 0000003A <res 00000002>          _errordiaginc	resw	1
   695 0000003C <res 00000002>          _errornodiaginc	resw	1
   696                                   
   697                                  ; circle algorithm variables
   698 0000003E <res 00000002>          _radius		resw	1
   699 00000040 <res 00000002>          _circleerror	resw	1
   700 00000042 <res 00000002>          _xdist		resw	1
   701 00000044 <res 00000002>          _ydist		resw	1
   702                                  
   703                                  ; flood fill variables
   704 00000046 <res 00000004>          _PointQueue	resd	1
   705 0000004A <res 00000004>          _QueueHead	resd	1
   706 0000004E <res 00000004>          _QueueTail	resd	1
   707                                  
   708 00000052 <res 00000001>          _key		resb	1
   709                                  
   710                                  
   711                                  	SECTION .data
   712                                  
   713                                  	
   714                                  ; Required image files
   715 00000000 666F6E742E706E6700      _FontFN		db	'font.png',0   
   716 00000009 6D656E752E706E6700      _MenuFN		db	'menu.png',0
   717 00000012 7469746C652E706E67-     _TitleFN	db	'title.png',0
   718 0000001B 00                 
   719                                  
   720                                  ; Defined color values
   721 0000001C 0000FFFF                _CurrentColor	dd	0ffff0000h	; current color
   722 00000020 FF3300FF                _ColorBlue	dd	0ff0033ffh
   723 00000024 FFFFFFFF                _ColorWhite	dd	0ffffffffh
   724 00000028 000000FF                _ColorBlack	dd	0ff000000h
   725 0000002C 000000CC                _ColorHalfBlack dd	0cc000000h
   726                                  
   727 00000030 2020202020202024        _buffer		db	'       ','$'
   728                                  
   729 00000038 456E746572206E756D-     _ColorString1	db	'Enter numerical values for','$'
   730 00000041 65726963616C207661-
   731 0000004A 6C75657320666F7224 
   732 00000053 65616368206368616E-     _ColorString2	db	'each channel (ARGB), and','$'
   733 0000005C 6E656C202841524742-
   734 00000065 292C20616E6424     
   735 0000006C 736570617261746520-     _ColorString3	db	'separate each number by a','$'
   736 00000075 65616368206E756D62-
   737 0000007E 6572206279206124   
   738 00000086 737061636520286578-     _ColorString4	db	'space (ex. 127 255 255 0).','$'
   739 0000008F 2E2031323720323535-
   740 00000098 203235352030292E24 
   741                                   
   742                                  _QwertyNames
   743 000000A1 00                      	db	0	; filler
   744 000000A2 003132333435363738-     	db	0,'1','2','3','4','5','6','7','8','9','0','-','=',BKSP
   745 000000AB 39302D3D08         
   746 000000B0 007177657274797569-     	db	0, 'q','w','e','r','t','y','u','i','o','p','[',']',ENTERKEY
   747 000000B9 6F705B5D0D         
   748 000000BE 006173646667686A6B-     	db	0,'a','s','d','f','g','h','j','k','l',';',"'","`"
   749 000000C7 6C3B2760           
   750 000000CB 005C7A786376626E6D-     	db	0,'\','z','x','c','v','b','n','m',",",'.','/',0,'*'
   751 000000D4 2C2E2F002A         
   752 000000D9 002000000000000000-     	db	0, ' ', 0, 0,0,0,0,0,0,0,0,0,0 ; F1-F10
   753 000000E2 00000000           
   754 000000E6 0000                    	db	0,0	; numlock, scroll lock
   755 000000E8 0000002D                	db	0, 0, 0, '-'
   756 000000EC 0000002B                	db	0, 0, 0, '+'
   757 000000F0 00000000                	db	0, 0, 0, 0
   758 000000F4 0000                    	db	0, 0; sysrq
   759                                  _QwertyNames_end resb 0
   760                                  
   761                                  _QwertyShift
   762 000000F6 00                      	db	0	; filler
   763 000000F7 0021402324255E262A-     	db	0,'!','@','#','$','%','^','&','*','(',')','_','+',BKSP
   764 00000100 28295F2B08         
   765 00000105 005157455254595549-     	db	0, 'Q','W','E','R','T','Y','U','I','O','P','{','}',ENTERKEY
   766 0000010E 4F507B7D0D         
   767 00000113 004153444647484A4B-     	db	0,'A','S','D','F','G','H','J','K','L',':','"','~'
   768 0000011C 4C3A227E           
   769 00000120 007C5A584356424E4D-     	db	0,'|','Z','X','C','V','B','N','M',"<",'>','?',0,'*'
   770 00000129 3C3E3F002A         
   771 0000012E 002000000000000000-     	db	0, ' ', 0, 0,0,0,0,0,0,0,0,0,0 ; F1-F10
   772 00000137 00000000           
   773 0000013B 0000                    	db	0,0	; numlock, scroll lock
   774 0000013D 0000002D                	db	0, 0, 0, '-'
   775 00000141 0000002B                	db	0, 0, 0, '+'
   776 00000145 00000000                	db	0, 0, 0, 0
   777 00000149 0000                    	db	0, 0; sysrq
   778                                  _QwertyShift_end resb 0
   779                                  
   780 0000014B 0024<rept>              _TextInputString	times 80 db 0,'$'
   781 000001EB 0024<rept>              _ColorInputString	times 15 db 0,'$'
   782                                  
   783 00000209 8000800080000000        _RoundingFactor	dd	000800080h, 00000080h
   784                                  
   785                                  
   786                                  	SECTION .text
   787                                  
   788                                  
   789                                  _main
   790 00000000 E8(00000000)            	call	_LibInit
   791                                  
   792                                  	; Allocate Screen Image buffer
   793                                  	invoke	_AllocMem, dword 640*480*4
   794                              <1> %rotate -1
   795                              <1> 
   796                              <1> %rep (%0-1)
   797                              <1> 
   798                              <1> 
   799                              <1> 
   800                              <1> 
   801                              <1> 
   802                              <1> 
   803                              <1> 
   804                              <1>         %ifidni %1, cs
   805                              <1>                 o16 push %1
   806                              <1>         %elifidni %1, ds
   807                              <1>                 o16 push %1
   808                              <1>         %elifidni %1, es
   809                              <1>                 o16 push %1
   810                              <1>         %elifidni %1, fs
   811                              <1>                 o16 push %1
   812                              <1>         %elifidni %1, gs
   813                              <1>                 o16 push %1
   814                              <1>         %elifidni %1, word cs
   815                              <1>                 o16 push %1
   816                              <1>         %elifidni %1, word ds
   817                              <1>                 o16 push %1
   818                              <1>         %elifidni %1, word es
   819                              <1>                 o16 push %1
   820                              <1>         %elifidni %1, word fs
   821                              <1>                 o16 push %1
   822                              <1>         %elifidni %1, word gs
   823                              <1>                 o16 push %1
   824                              <1>         %else
   825                              <1>                 push %1
   826                              <1>         %endif
   827                              <1> 
   828                              <1>         %rotate -1
   829                              <1> %endrep
   830                              <2> 
   831                              <2> 
   832                              <2> 
   833                              <2> 
   834                              <2> 
   835                              <2> 
   836                              <2> 
   837                              <2>         %ifidni %1, cs
   838                              <2>                 o16 push %1
   839                              <2>         %elifidni %1, ds
   840                              <2>                 o16 push %1
   841                              <2>         %elifidni %1, es
   842                              <2>                 o16 push %1
   843                              <2>         %elifidni %1, fs
   844                              <2>                 o16 push %1
   845                              <2>         %elifidni %1, gs
   846                              <2>                 o16 push %1
   847                              <2>         %elifidni %1, word cs
   848                              <2>                 o16 push %1
   849                              <2>         %elifidni %1, word ds
   850                              <2>                 o16 push %1
   851                              <2>         %elifidni %1, word es
   852                              <2>                 o16 push %1
   853                              <2>         %elifidni %1, word fs
   854                              <2>                 o16 push %1
   855                              <2>         %elifidni %1, word gs
   856                              <2>                 o16 push %1
   857                              <2>         %else
   858 00000005 6800C01200          <2>                 push %1
   859                              <2>         %endif
   860                              <2> 
   861                              <2>         %rotate -1
   862 0000000A E8(00000000)        <1> call %1
   863                              <1> %if (%0!=1)
   864 0000000F 83C404              <1>         add esp, byte %1_arglen
   865                              <1> %endif
   866 00000012 3DFFFFFFFF              	cmp	eax, -1
   867 00000017 0F849D010000            	je	near .memerror
   868 0000001D A3[0E000000]            	mov	[_ScreenOff], eax
   869                                  
   870                                  	; Allocate Canvas Image buffer
   871                                  	invoke	_AllocMem, dword 480*400*4
   872                              <1> %rotate -1
   873                              <1> 
   874                              <1> %rep (%0-1)
   875                              <1> 
   876                              <1> 
   877                              <1> 
   878                              <1> 
   879                              <1> 
   880                              <1> 
   881                              <1> 
   882                              <1>         %ifidni %1, cs
   883                              <1>                 o16 push %1
   884                              <1>         %elifidni %1, ds
   885                              <1>                 o16 push %1
   886                              <1>         %elifidni %1, es
   887                              <1>                 o16 push %1
   888                              <1>         %elifidni %1, fs
   889                              <1>                 o16 push %1
   890                              <1>         %elifidni %1, gs
   891                              <1>                 o16 push %1
   892                              <1>         %elifidni %1, word cs
   893                              <1>                 o16 push %1
   894                              <1>         %elifidni %1, word ds
   895                              <1>                 o16 push %1
   896                              <1>         %elifidni %1, word es
   897                              <1>                 o16 push %1
   898                              <1>         %elifidni %1, word fs
   899                              <1>                 o16 push %1
   900                              <1>         %elifidni %1, word gs
   901                              <1>                 o16 push %1
   902                              <1>         %else
   903                              <1>                 push %1
   904                              <1>         %endif
   905                              <1> 
   906                              <1>         %rotate -1
   907                              <1> %endrep
   908                              <2> 
   909                              <2> 
   910                              <2> 
   911                              <2> 
   912                              <2> 
   913                              <2> 
   914                              <2> 
   915                              <2>         %ifidni %1, cs
   916                              <2>                 o16 push %1
   917                              <2>         %elifidni %1, ds
   918                              <2>                 o16 push %1
   919                              <2>         %elifidni %1, es
   920                              <2>                 o16 push %1
   921                              <2>         %elifidni %1, fs
   922                              <2>                 o16 push %1
   923                              <2>         %elifidni %1, gs
   924                              <2>                 o16 push %1
   925                              <2>         %elifidni %1, word cs
   926                              <2>                 o16 push %1
   927                              <2>         %elifidni %1, word ds
   928                              <2>                 o16 push %1
   929                              <2>         %elifidni %1, word es
   930                              <2>                 o16 push %1
   931                              <2>         %elifidni %1, word fs
   932                              <2>                 o16 push %1
   933                              <2>         %elifidni %1, word gs
   934                              <2>                 o16 push %1
   935                              <2>         %else
   936 00000022 6800B80B00          <2>                 push %1
   937                              <2>         %endif
   938                              <2> 
   939                              <2>         %rotate -1
   940 00000027 E8(00000000)        <1> call %1
   941                              <1> %if (%0!=1)
   942 0000002C 83C404              <1>         add esp, byte %1_arglen
   943                              <1> %endif
   944 0000002F 3DFFFFFFFF              	cmp	eax, -1
   945 00000034 0F8480010000            	je	near .memerror
   946 0000003A A3[12000000]            	mov	[_CanvasOff], eax
   947                                  
   948                                  	; Allocate Overlay Image buffer
   949                                  	invoke	_AllocMem, dword 480*400*4
   950                              <1> %rotate -1
   951                              <1> 
   952                              <1> %rep (%0-1)
   953                              <1> 
   954                              <1> 
   955                              <1> 
   956                              <1> 
   957                              <1> 
   958                              <1> 
   959                              <1> 
   960                              <1>         %ifidni %1, cs
   961                              <1>                 o16 push %1
   962                              <1>         %elifidni %1, ds
   963                              <1>                 o16 push %1
   964                              <1>         %elifidni %1, es
   965                              <1>                 o16 push %1
   966                              <1>         %elifidni %1, fs
   967                              <1>                 o16 push %1
   968                              <1>         %elifidni %1, gs
   969                              <1>                 o16 push %1
   970                              <1>         %elifidni %1, word cs
   971                              <1>                 o16 push %1
   972                              <1>         %elifidni %1, word ds
   973                              <1>                 o16 push %1
   974                              <1>         %elifidni %1, word es
   975                              <1>                 o16 push %1
   976                              <1>         %elifidni %1, word fs
   977                              <1>                 o16 push %1
   978                              <1>         %elifidni %1, word gs
   979                              <1>                 o16 push %1
   980                              <1>         %else
   981                              <1>                 push %1
   982                              <1>         %endif
   983                              <1> 
   984                              <1>         %rotate -1
   985                              <1> %endrep
   986                              <2> 
   987                              <2> 
   988                              <2> 
   989                              <2> 
   990                              <2> 
   991                              <2> 
   992                              <2> 
   993                              <2>         %ifidni %1, cs
   994                              <2>                 o16 push %1
   995                              <2>         %elifidni %1, ds
   996                              <2>                 o16 push %1
   997                              <2>         %elifidni %1, es
   998                              <2>                 o16 push %1
   999                              <2>         %elifidni %1, fs
  1000                              <2>                 o16 push %1
  1001                              <2>         %elifidni %1, gs
  1002                              <2>                 o16 push %1
  1003                              <2>         %elifidni %1, word cs
  1004                              <2>                 o16 push %1
  1005                              <2>         %elifidni %1, word ds
  1006                              <2>                 o16 push %1
  1007                              <2>         %elifidni %1, word es
  1008                              <2>                 o16 push %1
  1009                              <2>         %elifidni %1, word fs
  1010                              <2>                 o16 push %1
  1011                              <2>         %elifidni %1, word gs
  1012                              <2>                 o16 push %1
  1013                              <2>         %else
  1014 0000003F 6800B80B00          <2>                 push %1
  1015                              <2>         %endif
  1016                              <2> 
  1017                              <2>         %rotate -1
  1018 00000044 E8(00000000)        <1> call %1
  1019                              <1> %if (%0!=1)
  1020 00000049 83C404              <1>         add esp, byte %1_arglen
  1021                              <1> %endif
  1022 0000004C 3DFFFFFFFF              	cmp	eax, -1
  1023 00000051 0F8463010000            	je	near .memerror
  1024 00000057 A3[16000000]            	mov	[_OverlayOff], eax
  1025                                  
  1026                                  	; Allocate Font Image buffer
  1027                                  	invoke	_AllocMem, dword 2048*16*4
  1028                              <1> %rotate -1
  1029                              <1> 
  1030                              <1> %rep (%0-1)
  1031                              <1> 
  1032                              <1> 
  1033                              <1> 
  1034                              <1> 
  1035                              <1> 
  1036                              <1> 
  1037                              <1> 
  1038                              <1>         %ifidni %1, cs
  1039                              <1>                 o16 push %1
  1040                              <1>         %elifidni %1, ds
  1041                              <1>                 o16 push %1
  1042                              <1>         %elifidni %1, es
  1043                              <1>                 o16 push %1
  1044                              <1>         %elifidni %1, fs
  1045                              <1>                 o16 push %1
  1046                              <1>         %elifidni %1, gs
  1047                              <1>                 o16 push %1
  1048                              <1>         %elifidni %1, word cs
  1049                              <1>                 o16 push %1
  1050                              <1>         %elifidni %1, word ds
  1051                              <1>                 o16 push %1
  1052                              <1>         %elifidni %1, word es
  1053                              <1>                 o16 push %1
  1054                              <1>         %elifidni %1, word fs
  1055                              <1>                 o16 push %1
  1056                              <1>         %elifidni %1, word gs
  1057                              <1>                 o16 push %1
  1058                              <1>         %else
  1059                              <1>                 push %1
  1060                              <1>         %endif
  1061                              <1> 
  1062                              <1>         %rotate -1
  1063                              <1> %endrep
  1064                              <2> 
  1065                              <2> 
  1066                              <2> 
  1067                              <2> 
  1068                              <2> 
  1069                              <2> 
  1070                              <2> 
  1071                              <2>         %ifidni %1, cs
  1072                              <2>                 o16 push %1
  1073                              <2>         %elifidni %1, ds
  1074                              <2>                 o16 push %1
  1075                              <2>         %elifidni %1, es
  1076                              <2>                 o16 push %1
  1077                              <2>         %elifidni %1, fs
  1078                              <2>                 o16 push %1
  1079                              <2>         %elifidni %1, gs
  1080                              <2>                 o16 push %1
  1081                              <2>         %elifidni %1, word cs
  1082                              <2>                 o16 push %1
  1083                              <2>         %elifidni %1, word ds
  1084                              <2>                 o16 push %1
  1085                              <2>         %elifidni %1, word es
  1086                              <2>                 o16 push %1
  1087                              <2>         %elifidni %1, word fs
  1088                              <2>                 o16 push %1
  1089                              <2>         %elifidni %1, word gs
  1090                              <2>                 o16 push %1
  1091                              <2>         %else
  1092 0000005C 6800000200          <2>                 push %1
  1093                              <2>         %endif
  1094                              <2> 
  1095                              <2>         %rotate -1
  1096 00000061 E8(00000000)        <1> call %1
  1097                              <1> %if (%0!=1)
  1098 00000066 83C404              <1>         add esp, byte %1_arglen
  1099                              <1> %endif
  1100 00000069 3DFFFFFFFF              	cmp	eax, -1
  1101 0000006E 0F8446010000            	je	near .memerror
  1102 00000074 A3[1A000000]            	mov	[_FontOff], eax  
  1103                                  
  1104                                  	; Allocate Menu Image buffer
  1105                                  	invoke	_AllocMem, dword 400*100*4
  1106                              <1> %rotate -1
  1107                              <1> 
  1108                              <1> %rep (%0-1)
  1109                              <1> 
  1110                              <1> 
  1111                              <1> 
  1112                              <1> 
  1113                              <1> 
  1114                              <1> 
  1115                              <1> 
  1116                              <1>         %ifidni %1, cs
  1117                              <1>                 o16 push %1
  1118                              <1>         %elifidni %1, ds
  1119                              <1>                 o16 push %1
  1120                              <1>         %elifidni %1, es
  1121                              <1>                 o16 push %1
  1122                              <1>         %elifidni %1, fs
  1123                              <1>                 o16 push %1
  1124                              <1>         %elifidni %1, gs
  1125                              <1>                 o16 push %1
  1126                              <1>         %elifidni %1, word cs
  1127                              <1>                 o16 push %1
  1128                              <1>         %elifidni %1, word ds
  1129                              <1>                 o16 push %1
  1130                              <1>         %elifidni %1, word es
  1131                              <1>                 o16 push %1
  1132                              <1>         %elifidni %1, word fs
  1133                              <1>                 o16 push %1
  1134                              <1>         %elifidni %1, word gs
  1135                              <1>                 o16 push %1
  1136                              <1>         %else
  1137                              <1>                 push %1
  1138                              <1>         %endif
  1139                              <1> 
  1140                              <1>         %rotate -1
  1141                              <1> %endrep
  1142                              <2> 
  1143                              <2> 
  1144                              <2> 
  1145                              <2> 
  1146                              <2> 
  1147                              <2> 
  1148                              <2> 
  1149                              <2>         %ifidni %1, cs
  1150                              <2>                 o16 push %1
  1151                              <2>         %elifidni %1, ds
  1152                              <2>                 o16 push %1
  1153                              <2>         %elifidni %1, es
  1154                              <2>                 o16 push %1
  1155                              <2>         %elifidni %1, fs
  1156                              <2>                 o16 push %1
  1157                              <2>         %elifidni %1, gs
  1158                              <2>                 o16 push %1
  1159                              <2>         %elifidni %1, word cs
  1160                              <2>                 o16 push %1
  1161                              <2>         %elifidni %1, word ds
  1162                              <2>                 o16 push %1
  1163                              <2>         %elifidni %1, word es
  1164                              <2>                 o16 push %1
  1165                              <2>         %elifidni %1, word fs
  1166                              <2>                 o16 push %1
  1167                              <2>         %elifidni %1, word gs
  1168                              <2>                 o16 push %1
  1169                              <2>         %else
  1170 00000079 6800710200          <2>                 push %1
  1171                              <2>         %endif
  1172                              <2> 
  1173                              <2>         %rotate -1
  1174 0000007E E8(00000000)        <1> call %1
  1175                              <1> %if (%0!=1)
  1176 00000083 83C404              <1>         add esp, byte %1_arglen
  1177                              <1> %endif
  1178 00000086 3DFFFFFFFF              	cmp	eax, -1
  1179 0000008B 0F8429010000            	je	near .memerror
  1180 00000091 A3[1E000000]            	mov	[_MenuOff], eax 
  1181                                  
  1182                                  	; Allocate Title Bar Image buffer
  1183                                  	invoke	_AllocMem, dword 640*20*4
  1184                              <1> %rotate -1
  1185                              <1> 
  1186                              <1> %rep (%0-1)
  1187                              <1> 
  1188                              <1> 
  1189                              <1> 
  1190                              <1> 
  1191                              <1> 
  1192                              <1> 
  1193                              <1> 
  1194                              <1>         %ifidni %1, cs
  1195                              <1>                 o16 push %1
  1196                              <1>         %elifidni %1, ds
  1197                              <1>                 o16 push %1
  1198                              <1>         %elifidni %1, es
  1199                              <1>                 o16 push %1
  1200                              <1>         %elifidni %1, fs
  1201                              <1>                 o16 push %1
  1202                              <1>         %elifidni %1, gs
  1203                              <1>                 o16 push %1
  1204                              <1>         %elifidni %1, word cs
  1205                              <1>                 o16 push %1
  1206                              <1>         %elifidni %1, word ds
  1207                              <1>                 o16 push %1
  1208                              <1>         %elifidni %1, word es
  1209                              <1>                 o16 push %1
  1210                              <1>         %elifidni %1, word fs
  1211                              <1>                 o16 push %1
  1212                              <1>         %elifidni %1, word gs
  1213                              <1>                 o16 push %1
  1214                              <1>         %else
  1215                              <1>                 push %1
  1216                              <1>         %endif
  1217                              <1> 
  1218                              <1>         %rotate -1
  1219                              <1> %endrep
  1220                              <2> 
  1221                              <2> 
  1222                              <2> 
  1223                              <2> 
  1224                              <2> 
  1225                              <2> 
  1226                              <2> 
  1227                              <2>         %ifidni %1, cs
  1228                              <2>                 o16 push %1
  1229                              <2>         %elifidni %1, ds
  1230                              <2>                 o16 push %1
  1231                              <2>         %elifidni %1, es
  1232                              <2>                 o16 push %1
  1233                              <2>         %elifidni %1, fs
  1234                              <2>                 o16 push %1
  1235                              <2>         %elifidni %1, gs
  1236                              <2>                 o16 push %1
  1237                              <2>         %elifidni %1, word cs
  1238                              <2>                 o16 push %1
  1239                              <2>         %elifidni %1, word ds
  1240                              <2>                 o16 push %1
  1241                              <2>         %elifidni %1, word es
  1242                              <2>                 o16 push %1
  1243                              <2>         %elifidni %1, word fs
  1244                              <2>                 o16 push %1
  1245                              <2>         %elifidni %1, word gs
  1246                              <2>                 o16 push %1
  1247                              <2>         %else
  1248 00000096 6800C80000          <2>                 push %1
  1249                              <2>         %endif
  1250                              <2> 
  1251                              <2>         %rotate -1
  1252 0000009B E8(00000000)        <1> call %1
  1253                              <1> %if (%0!=1)
  1254 000000A0 83C404              <1>         add esp, byte %1_arglen
  1255                              <1> %endif
  1256 000000A3 3DFFFFFFFF              	cmp	eax, -1
  1257 000000A8 0F840C010000            	je	near .memerror
  1258 000000AE A3[22000000]            	mov	[_TitleOff], eax 
  1259                                  
  1260                                  	; Allocate Point Queue
  1261                                  	invoke	_AllocMem, dword 480*400*4*40
  1262                              <1> %rotate -1
  1263                              <1> 
  1264                              <1> %rep (%0-1)
  1265                              <1> 
  1266                              <1> 
  1267                              <1> 
  1268                              <1> 
  1269                              <1> 
  1270                              <1> 
  1271                              <1> 
  1272                              <1>         %ifidni %1, cs
  1273                              <1>                 o16 push %1
  1274                              <1>         %elifidni %1, ds
  1275                              <1>                 o16 push %1
  1276                              <1>         %elifidni %1, es
  1277                              <1>                 o16 push %1
  1278                              <1>         %elifidni %1, fs
  1279                              <1>                 o16 push %1
  1280                              <1>         %elifidni %1, gs
  1281                              <1>                 o16 push %1
  1282                              <1>         %elifidni %1, word cs
  1283                              <1>                 o16 push %1
  1284                              <1>         %elifidni %1, word ds
  1285                              <1>                 o16 push %1
  1286                              <1>         %elifidni %1, word es
  1287                              <1>                 o16 push %1
  1288                              <1>         %elifidni %1, word fs
  1289                              <1>                 o16 push %1
  1290                              <1>         %elifidni %1, word gs
  1291                              <1>                 o16 push %1
  1292                              <1>         %else
  1293                              <1>                 push %1
  1294                              <1>         %endif
  1295                              <1> 
  1296                              <1>         %rotate -1
  1297                              <1> %endrep
  1298                              <2> 
  1299                              <2> 
  1300                              <2> 
  1301                              <2> 
  1302                              <2> 
  1303                              <2> 
  1304                              <2> 
  1305                              <2>         %ifidni %1, cs
  1306                              <2>                 o16 push %1
  1307                              <2>         %elifidni %1, ds
  1308                              <2>                 o16 push %1
  1309                              <2>         %elifidni %1, es
  1310                              <2>                 o16 push %1
  1311                              <2>         %elifidni %1, fs
  1312                              <2>                 o16 push %1
  1313                              <2>         %elifidni %1, gs
  1314                              <2>                 o16 push %1
  1315                              <2>         %elifidni %1, word cs
  1316                              <2>                 o16 push %1
  1317                              <2>         %elifidni %1, word ds
  1318                              <2>                 o16 push %1
  1319                              <2>         %elifidni %1, word es
  1320                              <2>                 o16 push %1
  1321                              <2>         %elifidni %1, word fs
  1322                              <2>                 o16 push %1
  1323                              <2>         %elifidni %1, word gs
  1324                              <2>                 o16 push %1
  1325                              <2>         %else
  1326 000000B3 6800C0D401          <2>                 push %1
  1327                              <2>         %endif
  1328                              <2> 
  1329                              <2>         %rotate -1
  1330 000000B8 E8(00000000)        <1> call %1
  1331                              <1> %if (%0!=1)
  1332 000000BD 83C404              <1>         add esp, byte %1_arglen
  1333                              <1> %endif
  1334 000000C0 3DFFFFFFFF              	cmp	eax, -1
  1335 000000C5 0F84EF000000            	je	near .memerror
  1336 000000CB A3[46000000]            	mov	[_PointQueue], eax
  1337                                  
  1338                                  	; Load image files
  1339                                  	invoke	_LoadPNG, dword _FontFN, dword [_FontOff], dword 0, dword 0 
  1340                              <1> %rotate -1
  1341                              <1> 
  1342                              <1> %rep (%0-1)
  1343                              <1> 
  1344                              <1> 
  1345                              <1> 
  1346                              <1> 
  1347                              <1> 
  1348                              <1> 
  1349                              <1> 
  1350                              <1>         %ifidni %1, cs
  1351                              <1>                 o16 push %1
  1352                              <1>         %elifidni %1, ds
  1353                              <1>                 o16 push %1
  1354                              <1>         %elifidni %1, es
  1355                              <1>                 o16 push %1
  1356                              <1>         %elifidni %1, fs
  1357                              <1>                 o16 push %1
  1358                              <1>         %elifidni %1, gs
  1359                              <1>                 o16 push %1
  1360                              <1>         %elifidni %1, word cs
  1361                              <1>                 o16 push %1
  1362                              <1>         %elifidni %1, word ds
  1363                              <1>                 o16 push %1
  1364                              <1>         %elifidni %1, word es
  1365                              <1>                 o16 push %1
  1366                              <1>         %elifidni %1, word fs
  1367                              <1>                 o16 push %1
  1368                              <1>         %elifidni %1, word gs
  1369                              <1>                 o16 push %1
  1370                              <1>         %else
  1371                              <1>                 push %1
  1372                              <1>         %endif
  1373                              <1> 
  1374                              <1>         %rotate -1
  1375                              <1> %endrep
  1376                              <2> 
  1377                              <2> 
  1378                              <2> 
  1379                              <2> 
  1380                              <2> 
  1381                              <2> 
  1382                              <2> 
  1383                              <2>         %ifidni %1, cs
  1384                              <2>                 o16 push %1
  1385                              <2>         %elifidni %1, ds
  1386                              <2>                 o16 push %1
  1387                              <2>         %elifidni %1, es
  1388                              <2>                 o16 push %1
  1389                              <2>         %elifidni %1, fs
  1390                              <2>                 o16 push %1
  1391                              <2>         %elifidni %1, gs
  1392                              <2>                 o16 push %1
  1393                              <2>         %elifidni %1, word cs
  1394                              <2>                 o16 push %1
  1395                              <2>         %elifidni %1, word ds
  1396                              <2>                 o16 push %1
  1397                              <2>         %elifidni %1, word es
  1398                              <2>                 o16 push %1
  1399                              <2>         %elifidni %1, word fs
  1400                              <2>                 o16 push %1
  1401                              <2>         %elifidni %1, word gs
  1402                              <2>                 o16 push %1
  1403                              <2>         %else
  1404 000000D0 6800000000          <2>                 push %1
  1405                              <2>         %endif
  1406                              <2> 
  1407                              <2>         %rotate -1
  1408                              <2> 
  1409                              <2> 
  1410                              <2> 
  1411                              <2> 
  1412                              <2> 
  1413                              <2> 
  1414                              <2> 
  1415                              <2>         %ifidni %1, cs
  1416                              <2>                 o16 push %1
  1417                              <2>         %elifidni %1, ds
  1418                              <2>                 o16 push %1
  1419                              <2>         %elifidni %1, es
  1420                              <2>                 o16 push %1
  1421                              <2>         %elifidni %1, fs
  1422                              <2>                 o16 push %1
  1423                              <2>         %elifidni %1, gs
  1424                              <2>                 o16 push %1
  1425                              <2>         %elifidni %1, word cs
  1426                              <2>                 o16 push %1
  1427                              <2>         %elifidni %1, word ds
  1428                              <2>                 o16 push %1
  1429                              <2>         %elifidni %1, word es
  1430                              <2>                 o16 push %1
  1431                              <2>         %elifidni %1, word fs
  1432                              <2>                 o16 push %1
  1433                              <2>         %elifidni %1, word gs
  1434                              <2>                 o16 push %1
  1435                              <2>         %else
  1436 000000D5 6800000000          <2>                 push %1
  1437                              <2>         %endif
  1438                              <2> 
  1439                              <2>         %rotate -1
  1440                              <2> 
  1441                              <2> 
  1442                              <2> 
  1443                              <2> 
  1444                              <2> 
  1445                              <2> 
  1446                              <2> 
  1447                              <2>         %ifidni %1, cs
  1448                              <2>                 o16 push %1
  1449                              <2>         %elifidni %1, ds
  1450                              <2>                 o16 push %1
  1451                              <2>         %elifidni %1, es
  1452                              <2>                 o16 push %1
  1453                              <2>         %elifidni %1, fs
  1454                              <2>                 o16 push %1
  1455                              <2>         %elifidni %1, gs
  1456                              <2>                 o16 push %1
  1457                              <2>         %elifidni %1, word cs
  1458                              <2>                 o16 push %1
  1459                              <2>         %elifidni %1, word ds
  1460                              <2>                 o16 push %1
  1461                              <2>         %elifidni %1, word es
  1462                              <2>                 o16 push %1
  1463                              <2>         %elifidni %1, word fs
  1464                              <2>                 o16 push %1
  1465                              <2>         %elifidni %1, word gs
  1466                              <2>                 o16 push %1
  1467                              <2>         %else
  1468 000000DA FF35[1A000000]      <2>                 push %1
  1469                              <2>         %endif
  1470                              <2> 
  1471                              <2>         %rotate -1
  1472                              <2> 
  1473                              <2> 
  1474                              <2> 
  1475                              <2> 
  1476                              <2> 
  1477                              <2> 
  1478                              <2> 
  1479                              <2>         %ifidni %1, cs
  1480                              <2>                 o16 push %1
  1481                              <2>         %elifidni %1, ds
  1482                              <2>                 o16 push %1
  1483                              <2>         %elifidni %1, es
  1484                              <2>                 o16 push %1
  1485                              <2>         %elifidni %1, fs
  1486                              <2>                 o16 push %1
  1487                              <2>         %elifidni %1, gs
  1488                              <2>                 o16 push %1
  1489                              <2>         %elifidni %1, word cs
  1490                              <2>                 o16 push %1
  1491                              <2>         %elifidni %1, word ds
  1492                              <2>                 o16 push %1
  1493                              <2>         %elifidni %1, word es
  1494                              <2>                 o16 push %1
  1495                              <2>         %elifidni %1, word fs
  1496                              <2>                 o16 push %1
  1497                              <2>         %elifidni %1, word gs
  1498                              <2>                 o16 push %1
  1499                              <2>         %else
  1500 000000E0 68[00000000]        <2>                 push %1
  1501                              <2>         %endif
  1502                              <2> 
  1503                              <2>         %rotate -1
  1504 000000E5 E8(00000000)        <1> call %1
  1505                              <1> %if (%0!=1)
  1506 000000EA 83C410              <1>         add esp, byte %1_arglen
  1507                              <1> %endif
  1508                                  	invoke	_LoadPNG, dword _MenuFN, dword [_MenuOff], dword 0, dword 0 
  1509                              <1> %rotate -1
  1510                              <1> 
  1511                              <1> %rep (%0-1)
  1512                              <1> 
  1513                              <1> 
  1514                              <1> 
  1515                              <1> 
  1516                              <1> 
  1517                              <1> 
  1518                              <1> 
  1519                              <1>         %ifidni %1, cs
  1520                              <1>                 o16 push %1
  1521                              <1>         %elifidni %1, ds
  1522                              <1>                 o16 push %1
  1523                              <1>         %elifidni %1, es
  1524                              <1>                 o16 push %1
  1525                              <1>         %elifidni %1, fs
  1526                              <1>                 o16 push %1
  1527                              <1>         %elifidni %1, gs
  1528                              <1>                 o16 push %1
  1529                              <1>         %elifidni %1, word cs
  1530                              <1>                 o16 push %1
  1531                              <1>         %elifidni %1, word ds
  1532                              <1>                 o16 push %1
  1533                              <1>         %elifidni %1, word es
  1534                              <1>                 o16 push %1
  1535                              <1>         %elifidni %1, word fs
  1536                              <1>                 o16 push %1
  1537                              <1>         %elifidni %1, word gs
  1538                              <1>                 o16 push %1
  1539                              <1>         %else
  1540                              <1>                 push %1
  1541                              <1>         %endif
  1542                              <1> 
  1543                              <1>         %rotate -1
  1544                              <1> %endrep
  1545                              <2> 
  1546                              <2> 
  1547                              <2> 
  1548                              <2> 
  1549                              <2> 
  1550                              <2> 
  1551                              <2> 
  1552                              <2>         %ifidni %1, cs
  1553                              <2>                 o16 push %1
  1554                              <2>         %elifidni %1, ds
  1555                              <2>                 o16 push %1
  1556                              <2>         %elifidni %1, es
  1557                              <2>                 o16 push %1
  1558                              <2>         %elifidni %1, fs
  1559                              <2>                 o16 push %1
  1560                              <2>         %elifidni %1, gs
  1561                              <2>                 o16 push %1
  1562                              <2>         %elifidni %1, word cs
  1563                              <2>                 o16 push %1
  1564                              <2>         %elifidni %1, word ds
  1565                              <2>                 o16 push %1
  1566                              <2>         %elifidni %1, word es
  1567                              <2>                 o16 push %1
  1568                              <2>         %elifidni %1, word fs
  1569                              <2>                 o16 push %1
  1570                              <2>         %elifidni %1, word gs
  1571                              <2>                 o16 push %1
  1572                              <2>         %else
  1573 000000ED 6800000000          <2>                 push %1
  1574                              <2>         %endif
  1575                              <2> 
  1576                              <2>         %rotate -1
  1577                              <2> 
  1578                              <2> 
  1579                              <2> 
  1580                              <2> 
  1581                              <2> 
  1582                              <2> 
  1583                              <2> 
  1584                              <2>         %ifidni %1, cs
  1585                              <2>                 o16 push %1
  1586                              <2>         %elifidni %1, ds
  1587                              <2>                 o16 push %1
  1588                              <2>         %elifidni %1, es
  1589                              <2>                 o16 push %1
  1590                              <2>         %elifidni %1, fs
  1591                              <2>                 o16 push %1
  1592                              <2>         %elifidni %1, gs
  1593                              <2>                 o16 push %1
  1594                              <2>         %elifidni %1, word cs
  1595                              <2>                 o16 push %1
  1596                              <2>         %elifidni %1, word ds
  1597                              <2>                 o16 push %1
  1598                              <2>         %elifidni %1, word es
  1599                              <2>                 o16 push %1
  1600                              <2>         %elifidni %1, word fs
  1601                              <2>                 o16 push %1
  1602                              <2>         %elifidni %1, word gs
  1603                              <2>                 o16 push %1
  1604                              <2>         %else
  1605 000000F2 6800000000          <2>                 push %1
  1606                              <2>         %endif
  1607                              <2> 
  1608                              <2>         %rotate -1
  1609                              <2> 
  1610                              <2> 
  1611                              <2> 
  1612                              <2> 
  1613                              <2> 
  1614                              <2> 
  1615                              <2> 
  1616                              <2>         %ifidni %1, cs
  1617                              <2>                 o16 push %1
  1618                              <2>         %elifidni %1, ds
  1619                              <2>                 o16 push %1
  1620                              <2>         %elifidni %1, es
  1621                              <2>                 o16 push %1
  1622                              <2>         %elifidni %1, fs
  1623                              <2>                 o16 push %1
  1624                              <2>         %elifidni %1, gs
  1625                              <2>                 o16 push %1
  1626                              <2>         %elifidni %1, word cs
  1627                              <2>                 o16 push %1
  1628                              <2>         %elifidni %1, word ds
  1629                              <2>                 o16 push %1
  1630                              <2>         %elifidni %1, word es
  1631                              <2>                 o16 push %1
  1632                              <2>         %elifidni %1, word fs
  1633                              <2>                 o16 push %1
  1634                              <2>         %elifidni %1, word gs
  1635                              <2>                 o16 push %1
  1636                              <2>         %else
  1637 000000F7 FF35[1E000000]      <2>                 push %1
  1638                              <2>         %endif
  1639                              <2> 
  1640                              <2>         %rotate -1
  1641                              <2> 
  1642                              <2> 
  1643                              <2> 
  1644                              <2> 
  1645                              <2> 
  1646                              <2> 
  1647                              <2> 
  1648                              <2>         %ifidni %1, cs
  1649                              <2>                 o16 push %1
  1650                              <2>         %elifidni %1, ds
  1651                              <2>                 o16 push %1
  1652                              <2>         %elifidni %1, es
  1653                              <2>                 o16 push %1
  1654                              <2>         %elifidni %1, fs
  1655                              <2>                 o16 push %1
  1656                              <2>         %elifidni %1, gs
  1657                              <2>                 o16 push %1
  1658                              <2>         %elifidni %1, word cs
  1659                              <2>                 o16 push %1
  1660                              <2>         %elifidni %1, word ds
  1661                              <2>                 o16 push %1
  1662                              <2>         %elifidni %1, word es
  1663                              <2>                 o16 push %1
  1664                              <2>         %elifidni %1, word fs
  1665                              <2>                 o16 push %1
  1666                              <2>         %elifidni %1, word gs
  1667                              <2>                 o16 push %1
  1668                              <2>         %else
  1669 000000FD 68[09000000]        <2>                 push %1
  1670                              <2>         %endif
  1671                              <2> 
  1672                              <2>         %rotate -1
  1673 00000102 E8(00000000)        <1> call %1
  1674                              <1> %if (%0!=1)
  1675 00000107 83C410              <1>         add esp, byte %1_arglen
  1676                              <1> %endif
  1677                                  	invoke	_LoadPNG, dword _TitleFN, dword [_TitleOff], dword 0, dword 0 
  1678                              <1> %rotate -1
  1679                              <1> 
  1680                              <1> %rep (%0-1)
  1681                              <1> 
  1682                              <1> 
  1683                              <1> 
  1684                              <1> 
  1685                              <1> 
  1686                              <1> 
  1687                              <1> 
  1688                              <1>         %ifidni %1, cs
  1689                              <1>                 o16 push %1
  1690                              <1>         %elifidni %1, ds
  1691                              <1>                 o16 push %1
  1692                              <1>         %elifidni %1, es
  1693                              <1>                 o16 push %1
  1694                              <1>         %elifidni %1, fs
  1695                              <1>                 o16 push %1
  1696                              <1>         %elifidni %1, gs
  1697                              <1>                 o16 push %1
  1698                              <1>         %elifidni %1, word cs
  1699                              <1>                 o16 push %1
  1700                              <1>         %elifidni %1, word ds
  1701                              <1>                 o16 push %1
  1702                              <1>         %elifidni %1, word es
  1703                              <1>                 o16 push %1
  1704                              <1>         %elifidni %1, word fs
  1705                              <1>                 o16 push %1
  1706                              <1>         %elifidni %1, word gs
  1707                              <1>                 o16 push %1
  1708                              <1>         %else
  1709                              <1>                 push %1
  1710                              <1>         %endif
  1711                              <1> 
  1712                              <1>         %rotate -1
  1713                              <1> %endrep
  1714                              <2> 
  1715                              <2> 
  1716                              <2> 
  1717                              <2> 
  1718                              <2> 
  1719                              <2> 
  1720                              <2> 
  1721                              <2>         %ifidni %1, cs
  1722                              <2>                 o16 push %1
  1723                              <2>         %elifidni %1, ds
  1724                              <2>                 o16 push %1
  1725                              <2>         %elifidni %1, es
  1726                              <2>                 o16 push %1
  1727                              <2>         %elifidni %1, fs
  1728                              <2>                 o16 push %1
  1729                              <2>         %elifidni %1, gs
  1730                              <2>                 o16 push %1
  1731                              <2>         %elifidni %1, word cs
  1732                              <2>                 o16 push %1
  1733                              <2>         %elifidni %1, word ds
  1734                              <2>                 o16 push %1
  1735                              <2>         %elifidni %1, word es
  1736                              <2>                 o16 push %1
  1737                              <2>         %elifidni %1, word fs
  1738                              <2>                 o16 push %1
  1739                              <2>         %elifidni %1, word gs
  1740                              <2>                 o16 push %1
  1741                              <2>         %else
  1742 0000010A 6800000000          <2>                 push %1
  1743                              <2>         %endif
  1744                              <2> 
  1745                              <2>         %rotate -1
  1746                              <2> 
  1747                              <2> 
  1748                              <2> 
  1749                              <2> 
  1750                              <2> 
  1751                              <2> 
  1752                              <2> 
  1753                              <2>         %ifidni %1, cs
  1754                              <2>                 o16 push %1
  1755                              <2>         %elifidni %1, ds
  1756                              <2>                 o16 push %1
  1757                              <2>         %elifidni %1, es
  1758                              <2>                 o16 push %1
  1759                              <2>         %elifidni %1, fs
  1760                              <2>                 o16 push %1
  1761                              <2>         %elifidni %1, gs
  1762                              <2>                 o16 push %1
  1763                              <2>         %elifidni %1, word cs
  1764                              <2>                 o16 push %1
  1765                              <2>         %elifidni %1, word ds
  1766                              <2>                 o16 push %1
  1767                              <2>         %elifidni %1, word es
  1768                              <2>                 o16 push %1
  1769                              <2>         %elifidni %1, word fs
  1770                              <2>                 o16 push %1
  1771                              <2>         %elifidni %1, word gs
  1772                              <2>                 o16 push %1
  1773                              <2>         %else
  1774 0000010F 6800000000          <2>                 push %1
  1775                              <2>         %endif
  1776                              <2> 
  1777                              <2>         %rotate -1
  1778                              <2> 
  1779                              <2> 
  1780                              <2> 
  1781                              <2> 
  1782                              <2> 
  1783                              <2> 
  1784                              <2> 
  1785                              <2>         %ifidni %1, cs
  1786                              <2>                 o16 push %1
  1787                              <2>         %elifidni %1, ds
  1788                              <2>                 o16 push %1
  1789                              <2>         %elifidni %1, es
  1790                              <2>                 o16 push %1
  1791                              <2>         %elifidni %1, fs
  1792                              <2>                 o16 push %1
  1793                              <2>         %elifidni %1, gs
  1794                              <2>                 o16 push %1
  1795                              <2>         %elifidni %1, word cs
  1796                              <2>                 o16 push %1
  1797                              <2>         %elifidni %1, word ds
  1798                              <2>                 o16 push %1
  1799                              <2>         %elifidni %1, word es
  1800                              <2>                 o16 push %1
  1801                              <2>         %elifidni %1, word fs
  1802                              <2>                 o16 push %1
  1803                              <2>         %elifidni %1, word gs
  1804                              <2>                 o16 push %1
  1805                              <2>         %else
  1806 00000114 FF35[22000000]      <2>                 push %1
  1807                              <2>         %endif
  1808                              <2> 
  1809                              <2>         %rotate -1
  1810                              <2> 
  1811                              <2> 
  1812                              <2> 
  1813                              <2> 
  1814                              <2> 
  1815                              <2> 
  1816                              <2> 
  1817                              <2>         %ifidni %1, cs
  1818                              <2>                 o16 push %1
  1819                              <2>         %elifidni %1, ds
  1820                              <2>                 o16 push %1
  1821                              <2>         %elifidni %1, es
  1822                              <2>                 o16 push %1
  1823                              <2>         %elifidni %1, fs
  1824                              <2>                 o16 push %1
  1825                              <2>         %elifidni %1, gs
  1826                              <2>                 o16 push %1
  1827                              <2>         %elifidni %1, word cs
  1828                              <2>                 o16 push %1
  1829                              <2>         %elifidni %1, word ds
  1830                              <2>                 o16 push %1
  1831                              <2>         %elifidni %1, word es
  1832                              <2>                 o16 push %1
  1833                              <2>         %elifidni %1, word fs
  1834                              <2>                 o16 push %1
  1835                              <2>         %elifidni %1, word gs
  1836                              <2>                 o16 push %1
  1837                              <2>         %else
  1838 0000011A 68[12000000]        <2>                 push %1
  1839                              <2>         %endif
  1840                              <2> 
  1841                              <2>         %rotate -1
  1842 0000011F E8(00000000)        <1> call %1
  1843                              <1> %if (%0!=1)
  1844 00000124 83C410              <1>         add esp, byte %1_arglen
  1845                              <1> %endif
  1846                                   
  1847                                  	; Graphics init
  1848                                  	invoke	_InitGraphics, dword _kbINT, dword _kbIRQ, dword _kbPort
  1849                              <1> %rotate -1
  1850                              <1> 
  1851                              <1> %rep (%0-1)
  1852                              <1> 
  1853                              <1> 
  1854                              <1> 
  1855                              <1> 
  1856                              <1> 
  1857                              <1> 
  1858                              <1> 
  1859                              <1>         %ifidni %1, cs
  1860                              <1>                 o16 push %1
  1861                              <1>         %elifidni %1, ds
  1862                              <1>                 o16 push %1
  1863                              <1>         %elifidni %1, es
  1864                              <1>                 o16 push %1
  1865                              <1>         %elifidni %1, fs
  1866                              <1>                 o16 push %1
  1867                              <1>         %elifidni %1, gs
  1868                              <1>                 o16 push %1
  1869                              <1>         %elifidni %1, word cs
  1870                              <1>                 o16 push %1
  1871                              <1>         %elifidni %1, word ds
  1872                              <1>                 o16 push %1
  1873                              <1>         %elifidni %1, word es
  1874                              <1>                 o16 push %1
  1875                              <1>         %elifidni %1, word fs
  1876                              <1>                 o16 push %1
  1877                              <1>         %elifidni %1, word gs
  1878                              <1>                 o16 push %1
  1879                              <1>         %else
  1880                              <1>                 push %1
  1881                              <1>         %endif
  1882                              <1> 
  1883                              <1>         %rotate -1
  1884                              <1> %endrep
  1885                              <2> 
  1886                              <2> 
  1887                              <2> 
  1888                              <2> 
  1889                              <2> 
  1890                              <2> 
  1891                              <2> 
  1892                              <2>         %ifidni %1, cs
  1893                              <2>                 o16 push %1
  1894                              <2>         %elifidni %1, ds
  1895                              <2>                 o16 push %1
  1896                              <2>         %elifidni %1, es
  1897                              <2>                 o16 push %1
  1898                              <2>         %elifidni %1, fs
  1899                              <2>                 o16 push %1
  1900                              <2>         %elifidni %1, gs
  1901                              <2>                 o16 push %1
  1902                              <2>         %elifidni %1, word cs
  1903                              <2>                 o16 push %1
  1904                              <2>         %elifidni %1, word ds
  1905                              <2>                 o16 push %1
  1906                              <2>         %elifidni %1, word es
  1907                              <2>                 o16 push %1
  1908                              <2>         %elifidni %1, word fs
  1909                              <2>                 o16 push %1
  1910                              <2>         %elifidni %1, word gs
  1911                              <2>                 o16 push %1
  1912                              <2>         %else
  1913 00000127 68[04000000]        <2>                 push %1
  1914                              <2>         %endif
  1915                              <2> 
  1916                              <2>         %rotate -1
  1917                              <2> 
  1918                              <2> 
  1919                              <2> 
  1920                              <2> 
  1921                              <2> 
  1922                              <2> 
  1923                              <2> 
  1924                              <2>         %ifidni %1, cs
  1925                              <2>                 o16 push %1
  1926                              <2>         %elifidni %1, ds
  1927                              <2>                 o16 push %1
  1928                              <2>         %elifidni %1, es
  1929                              <2>                 o16 push %1
  1930                              <2>         %elifidni %1, fs
  1931                              <2>                 o16 push %1
  1932                              <2>         %elifidni %1, gs
  1933                              <2>                 o16 push %1
  1934                              <2>         %elifidni %1, word cs
  1935                              <2>                 o16 push %1
  1936                              <2>         %elifidni %1, word ds
  1937                              <2>                 o16 push %1
  1938                              <2>         %elifidni %1, word es
  1939                              <2>                 o16 push %1
  1940                              <2>         %elifidni %1, word fs
  1941                              <2>                 o16 push %1
  1942                              <2>         %elifidni %1, word gs
  1943                              <2>                 o16 push %1
  1944                              <2>         %else
  1945 0000012C 68[03000000]        <2>                 push %1
  1946                              <2>         %endif
  1947                              <2> 
  1948                              <2>         %rotate -1
  1949                              <2> 
  1950                              <2> 
  1951                              <2> 
  1952                              <2> 
  1953                              <2> 
  1954                              <2> 
  1955                              <2> 
  1956                              <2>         %ifidni %1, cs
  1957                              <2>                 o16 push %1
  1958                              <2>         %elifidni %1, ds
  1959                              <2>                 o16 push %1
  1960                              <2>         %elifidni %1, es
  1961                              <2>                 o16 push %1
  1962                              <2>         %elifidni %1, fs
  1963                              <2>                 o16 push %1
  1964                              <2>         %elifidni %1, gs
  1965                              <2>                 o16 push %1
  1966                              <2>         %elifidni %1, word cs
  1967                              <2>                 o16 push %1
  1968                              <2>         %elifidni %1, word ds
  1969                              <2>                 o16 push %1
  1970                              <2>         %elifidni %1, word es
  1971                              <2>                 o16 push %1
  1972                              <2>         %elifidni %1, word fs
  1973                              <2>                 o16 push %1
  1974                              <2>         %elifidni %1, word gs
  1975                              <2>                 o16 push %1
  1976                              <2>         %else
  1977 00000131 68[02000000]        <2>                 push %1
  1978                              <2>         %endif
  1979                              <2> 
  1980                              <2>         %rotate -1
  1981 00000136 E8(00000000)        <1> call %1
  1982                              <1> %if (%0!=1)
  1983 0000013B 83C40C              <1>         add esp, byte %1_arglen
  1984                              <1> %endif
  1985 0000013E 85C0                    	test	eax, eax
  1986 00000140 0F856F000000            	jnz	near .graphicserror
  1987                                  
  1988                                  	; Find graphics mode: 640x480x32, allow driver-emulated modes
  1989                                  	invoke	_FindGraphicsMode, word 640, word 480, word 32, dword 1
  1990                              <1> %rotate -1
  1991                              <1> 
  1992                              <1> %rep (%0-1)
  1993                              <1> 
  1994                              <1> 
  1995                              <1> 
  1996                              <1> 
  1997                              <1> 
  1998                              <1> 
  1999                              <1> 
  2000                              <1>         %ifidni %1, cs
  2001                              <1>                 o16 push %1
  2002                              <1>         %elifidni %1, ds
  2003                              <1>                 o16 push %1
  2004                              <1>         %elifidni %1, es
  2005                              <1>                 o16 push %1
  2006                              <1>         %elifidni %1, fs
  2007                              <1>                 o16 push %1
  2008                              <1>         %elifidni %1, gs
  2009                              <1>                 o16 push %1
  2010                              <1>         %elifidni %1, word cs
  2011                              <1>                 o16 push %1
  2012                              <1>         %elifidni %1, word ds
  2013                              <1>                 o16 push %1
  2014                              <1>         %elifidni %1, word es
  2015                              <1>                 o16 push %1
  2016                              <1>         %elifidni %1, word fs
  2017                              <1>                 o16 push %1
  2018                              <1>         %elifidni %1, word gs
  2019                              <1>                 o16 push %1
  2020                              <1>         %else
  2021                              <1>                 push %1
  2022                              <1>         %endif
  2023                              <1> 
  2024                              <1>         %rotate -1
  2025                              <1> %endrep
  2026                              <2> 
  2027                              <2> 
  2028                              <2> 
  2029                              <2> 
  2030                              <2> 
  2031                              <2> 
  2032                              <2> 
  2033                              <2>         %ifidni %1, cs
  2034                              <2>                 o16 push %1
  2035                              <2>         %elifidni %1, ds
  2036                              <2>                 o16 push %1
  2037                              <2>         %elifidni %1, es
  2038                              <2>                 o16 push %1
  2039                              <2>         %elifidni %1, fs
  2040                              <2>                 o16 push %1
  2041                              <2>         %elifidni %1, gs
  2042                              <2>                 o16 push %1
  2043                              <2>         %elifidni %1, word cs
  2044                              <2>                 o16 push %1
  2045                              <2>         %elifidni %1, word ds
  2046                              <2>                 o16 push %1
  2047                              <2>         %elifidni %1, word es
  2048                              <2>                 o16 push %1
  2049                              <2>         %elifidni %1, word fs
  2050                              <2>                 o16 push %1
  2051                              <2>         %elifidni %1, word gs
  2052                              <2>                 o16 push %1
  2053                              <2>         %else
  2054 00000146 6801000000          <2>                 push %1
  2055                              <2>         %endif
  2056                              <2> 
  2057                              <2>         %rotate -1
  2058                              <2> 
  2059                              <2> 
  2060                              <2> 
  2061                              <2> 
  2062                              <2> 
  2063                              <2> 
  2064                              <2> 
  2065                              <2>         %ifidni %1, cs
  2066                              <2>                 o16 push %1
  2067                              <2>         %elifidni %1, ds
  2068                              <2>                 o16 push %1
  2069                              <2>         %elifidni %1, es
  2070                              <2>                 o16 push %1
  2071                              <2>         %elifidni %1, fs
  2072                              <2>                 o16 push %1
  2073                              <2>         %elifidni %1, gs
  2074                              <2>                 o16 push %1
  2075                              <2>         %elifidni %1, word cs
  2076                              <2>                 o16 push %1
  2077                              <2>         %elifidni %1, word ds
  2078                              <2>                 o16 push %1
  2079                              <2>         %elifidni %1, word es
  2080                              <2>                 o16 push %1
  2081                              <2>         %elifidni %1, word fs
  2082                              <2>                 o16 push %1
  2083                              <2>         %elifidni %1, word gs
  2084                              <2>                 o16 push %1
  2085                              <2>         %else
  2086 0000014B 66682000            <2>                 push %1
  2087                              <2>         %endif
  2088                              <2> 
  2089                              <2>         %rotate -1
  2090                              <2> 
  2091                              <2> 
  2092                              <2> 
  2093                              <2> 
  2094                              <2> 
  2095                              <2> 
  2096                              <2> 
  2097                              <2>         %ifidni %1, cs
  2098                              <2>                 o16 push %1
  2099                              <2>         %elifidni %1, ds
  2100                              <2>                 o16 push %1
  2101                              <2>         %elifidni %1, es
  2102                              <2>                 o16 push %1
  2103                              <2>         %elifidni %1, fs
  2104                              <2>                 o16 push %1
  2105                              <2>         %elifidni %1, gs
  2106                              <2>                 o16 push %1
  2107                              <2>         %elifidni %1, word cs
  2108                              <2>                 o16 push %1
  2109                              <2>         %elifidni %1, word ds
  2110                              <2>                 o16 push %1
  2111                              <2>         %elifidni %1, word es
  2112                              <2>                 o16 push %1
  2113                              <2>         %elifidni %1, word fs
  2114                              <2>                 o16 push %1
  2115                              <2>         %elifidni %1, word gs
  2116                              <2>                 o16 push %1
  2117                              <2>         %else
  2118 0000014F 6668E001            <2>                 push %1
  2119                              <2>         %endif
  2120                              <2> 
  2121                              <2>         %rotate -1
  2122                              <2> 
  2123                              <2> 
  2124                              <2> 
  2125                              <2> 
  2126                              <2> 
  2127                              <2> 
  2128                              <2> 
  2129                              <2>         %ifidni %1, cs
  2130                              <2>                 o16 push %1
  2131                              <2>         %elifidni %1, ds
  2132                              <2>                 o16 push %1
  2133                              <2>         %elifidni %1, es
  2134                              <2>                 o16 push %1
  2135                              <2>         %elifidni %1, fs
  2136                              <2>                 o16 push %1
  2137                              <2>         %elifidni %1, gs
  2138                              <2>                 o16 push %1
  2139                              <2>         %elifidni %1, word cs
  2140                              <2>                 o16 push %1
  2141                              <2>         %elifidni %1, word ds
  2142                              <2>                 o16 push %1
  2143                              <2>         %elifidni %1, word es
  2144                              <2>                 o16 push %1
  2145                              <2>         %elifidni %1, word fs
  2146                              <2>                 o16 push %1
  2147                              <2>         %elifidni %1, word gs
  2148                              <2>                 o16 push %1
  2149                              <2>         %else
  2150 00000153 66688002            <2>                 push %1
  2151                              <2>         %endif
  2152                              <2> 
  2153                              <2>         %rotate -1
  2154 00000157 E8(00000000)        <1> call %1
  2155                              <1> %if (%0!=1)
  2156 0000015C 83C40A              <1>         add esp, byte %1_arglen
  2157                              <1> %endif
  2158 0000015F 66A3[00000000]          	mov	[_GraphicsMode], ax
  2159                                  
  2160                                  	; Keyboard/Mouse init
  2161 00000165 E8150E0000              	call	_InstallKeyboard
  2162 0000016A 85C0                    	test	eax, eax
  2163 0000016C 0F853E000000            	jnz	near .keyboarderror
  2164                                  	invoke	_SetGraphicsMode, word [_GraphicsMode]
  2165                              <1> %rotate -1
  2166                              <1> 
  2167                              <1> %rep (%0-1)
  2168                              <1> 
  2169                              <1> 
  2170                              <1> 
  2171                              <1> 
  2172                              <1> 
  2173                              <1> 
  2174                              <1> 
  2175                              <1>         %ifidni %1, cs
  2176                              <1>                 o16 push %1
  2177                              <1>         %elifidni %1, ds
  2178                              <1>                 o16 push %1
  2179                              <1>         %elifidni %1, es
  2180                              <1>                 o16 push %1
  2181                              <1>         %elifidni %1, fs
  2182                              <1>                 o16 push %1
  2183                              <1>         %elifidni %1, gs
  2184                              <1>                 o16 push %1
  2185                              <1>         %elifidni %1, word cs
  2186                              <1>                 o16 push %1
  2187                              <1>         %elifidni %1, word ds
  2188                              <1>                 o16 push %1
  2189                              <1>         %elifidni %1, word es
  2190                              <1>                 o16 push %1
  2191                              <1>         %elifidni %1, word fs
  2192                              <1>                 o16 push %1
  2193                              <1>         %elifidni %1, word gs
  2194                              <1>                 o16 push %1
  2195                              <1>         %else
  2196                              <1>                 push %1
  2197                              <1>         %endif
  2198                              <1> 
  2199                              <1>         %rotate -1
  2200                              <1> %endrep
  2201                              <2> 
  2202                              <2> 
  2203                              <2> 
  2204                              <2> 
  2205                              <2> 
  2206                              <2> 
  2207                              <2> 
  2208                              <2>         %ifidni %1, cs
  2209                              <2>                 o16 push %1
  2210                              <2>         %elifidni %1, ds
  2211                              <2>                 o16 push %1
  2212                              <2>         %elifidni %1, es
  2213                              <2>                 o16 push %1
  2214                              <2>         %elifidni %1, fs
  2215                              <2>                 o16 push %1
  2216                              <2>         %elifidni %1, gs
  2217                              <2>                 o16 push %1
  2218                              <2>         %elifidni %1, word cs
  2219                              <2>                 o16 push %1
  2220                              <2>         %elifidni %1, word ds
  2221                              <2>                 o16 push %1
  2222                              <2>         %elifidni %1, word es
  2223                              <2>                 o16 push %1
  2224                              <2>         %elifidni %1, word fs
  2225                              <2>                 o16 push %1
  2226                              <2>         %elifidni %1, word gs
  2227                              <2>                 o16 push %1
  2228                              <2>         %else
  2229 00000172 66FF35[00000000]    <2>                 push %1
  2230                              <2>         %endif
  2231                              <2> 
  2232                              <2>         %rotate -1
  2233 00000179 E8(00000000)        <1> call %1
  2234                              <1> %if (%0!=1)
  2235 0000017E 83C402              <1>         add esp, byte %1_arglen
  2236                              <1> %endif
  2237 00000181 85C0                    	test	eax, eax
  2238 00000183 7526                    	jnz	.setgraphicserror
  2239 00000185 E8430F0000              	call	_InstallMouse
  2240 0000018A 85C0                    	test	eax, eax
  2241 0000018C 7518                    	jnz	.mouseerror
  2242                                  
  2243                                  	; Show mouse cursor	
  2244 0000018E C705[00000000]0100-     	mov	dword [DPMI_EAX], 01h
  2245 00000196 0000               
  2246 00000198 66BB3300                	mov	bx, 33h
  2247 0000019C E8(00000000)            	call	DPMI_Int
  2248                                  
  2249 000001A1 E8(00000000)            	call	_MP4Main	
  2250                                  
  2251                                  	; Shutdown and cleanup	      
  2252                                  
  2253                                  .mouseerror
  2254 000001A6 E803100000              	call	_RemoveMouse
  2255                                  
  2256                                  .setgraphicserror
  2257 000001AB E8(00000000)            	call	_UnsetGraphicsMode
  2258                                  
  2259                                  .keyboarderror
  2260 000001B0 E8320E0000              	call	_RemoveKeyboard
  2261                                  
  2262                                  .graphicserror
  2263 000001B5 E8(00000000)            	call	_ExitGraphics
  2264                                  
  2265                                  .memerror
  2266 000001BA E8(00000000)            	call	_MP4LibExit
  2267 000001BF E8(00000000)            	call	_LibExit
  2268                                  	ret
  2269                              <1> %ifnctx proc
  2270 000001C4 C3                  <1> 	ret	%1
  2271                              <1> %else
  2272                              <1> 	mov	esp, ebp
  2273                              <1> 	pop	ebp
  2274                              <1> 	ret	%1
  2275                              <1> %endif
  2276                                  
  2277                                  
  2278                                  
  2279                                  
  2280                                  
  2281                                  ;-------------------------------------------------------------------------;
  2282                                  ; PointInBox()								  ;
  2283                                  ;									  ;
  2284                                  ;   dword _PointInBox(word PointX, word PointY, word BoxULCornerX,	  ;
  2285                                  ;		 word BoxULCornerY, word BoxLRCornerX, word BoxLRCornerY) ;
  2286                                  ;									  ;
  2287                                  ;   Inputs: X = x coordinate of point in question			  ;
  2288                                  ;	    Y = y coordinate of point in question			  ;
  2289                                  ;	    BoxULCornerX = x coordinate of upper-left hand corner of box  ;
  2290                                  ;	    BoxULCornerY = y coordinate of upper-left hand corner of box  ;
  2291                                  ;	    BoxLRCornerX = x coordinate of lower-right hand corner of box ;
  2292                                  ;	    BoxLRCornerY = y coordinate of lower-right hand corner of box ;
  2293                                  ;									  ;
  2294                                  ;   Outputs: none							  ;
  2295                                  ;									  ;
  2296                                  ;   Calls: none								  ;
  2297                                  ;									  ;
  2298                                  ;   Returns: eax = 1 if BoxULCornerX <= X <= BoxLRCornerX and		  ;
  2299                                  ;		        BoxULCornerY <= Y <= BoxLRCornerY		  ;
  2300                                  ;	         = 0 otherwise						  ;
  2301                                  ;									  ;
  2302                                  ;   Purpose: Determines if the point (X,Y) is located in the box formed	  ;
  2303                                  ;	     by the points (BoxULCornerX,BoxULCornerY)			  ;
  2304                                  ;	     and (BoxLRCornerX,BoxLRCornerY)				  ;
  2305                                  ;									  ;
  2306                                  ;-------------------------------------------------------------------------;
  2307                                  proc _PointInBox
  2308                              <1> %push proc
  2309                              <1>           global %1
  2310 000001C5 55                  <1> %1:       push  ebp
  2311 000001C6 89E5                <1>           mov   ebp, esp
  2312                              <1> %assign %$arg 8
  2313                              <1> 
  2314                              <1> %define %$procname %1
  2315                                  .X		arg	2
  2316                              <1> .X       equ %$arg
  2317                              <1> 
  2318                              <1> 
  2319                              <1> %assign %$arg %1+%$arg
  2320                                  .Y		arg	2
  2321                              <1> .Y       equ %$arg
  2322                              <1> 
  2323                              <1> 
  2324                              <1> %assign %$arg %1+%$arg
  2325                                  .BoxULCornerX	arg	2
  2326                              <1> .BoxULCornerX       equ %$arg
  2327                              <1> 
  2328                              <1> 
  2329                              <1> %assign %$arg %1+%$arg
  2330                                  .BoxULCornerY	arg	2
  2331                              <1> .BoxULCornerY       equ %$arg
  2332                              <1> 
  2333                              <1> 
  2334                              <1> %assign %$arg %1+%$arg
  2335                                  .BoxLRCornerX	arg	2
  2336                              <1> .BoxLRCornerX       equ %$arg
  2337                              <1> 
  2338                              <1> 
  2339                              <1> %assign %$arg %1+%$arg
  2340                                  .BoxLRCornerY	arg	2
  2341                              <1> .BoxLRCornerY       equ %$arg
  2342                              <1> 
  2343                              <1> 
  2344                              <1> %assign %$arg %1+%$arg
  2345                                  ;invoke	_libPointInBox, word [ebp+.X], word [ebp+.Y], word [ebp+.BoxULCornerX], word [ebp+.BoxULCornerY], word [ebp+.BoxLRCornerX], word [ebp+.BoxLRCornerY]
  2346                                  ;ret
  2347                                  
  2348                                  
  2349                                  
  2350 000001C8 668B4508                 mov ax, word [ebp+.X]			; Check if the X coord is within box
  2351 000001CC 663B450C                 cmp ax, word [ebp+.BoxULCornerX]	; by checking UR corner and LR corner
  2352 000001D0 0F822B000000             jb near .NotInBox
  2353                                  
  2354 000001D6 663B4510                 cmp ax, word [ebp+.BoxLRCornerX]
  2355 000001DA 0F8721000000             ja near .NotInBox
  2356                                  
  2357                                  
  2358 000001E0 668B450A                 mov ax, word [ebp+.Y]			; Check if the Y coord is within box
  2359 000001E4 663B450E                 cmp ax, word [ebp+.BoxULCornerY]	; by checking UR corner and LR corner
  2360 000001E8 0F8213000000             jb near .NotInBox
  2361                                  
  2362 000001EE 663B4512                 cmp ax, word [ebp+.BoxLRCornerY]
  2363 000001F2 0F8709000000             ja near .NotInBox
  2364                                  
  2365 000001F8 B801000000               mov eax, 1				; If point is in box, return 1
  2366                                   ret
  2367                              <1> %ifnctx proc
  2368                              <1> 	ret	%1
  2369                              <1> %else
  2370 000001FD 89EC                <1> 	mov	esp, ebp
  2371 000001FF 5D                  <1> 	pop	ebp
  2372 00000200 C3                  <1> 	ret	%1
  2373                              <1> %endif
  2374                                  
  2375                                  
  2376                                   .NotInBox:
  2377 00000201 31C0                     xor eax, eax				; If point isn't in box, return 0
  2378                                   ret
  2379                              <1> %ifnctx proc
  2380                              <1> 	ret	%1
  2381                              <1> %else
  2382 00000203 89EC                <1> 	mov	esp, ebp
  2383 00000205 5D                  <1> 	pop	ebp
  2384 00000206 C3                  <1> 	ret	%1
  2385                              <1> %endif
  2386                                  
  2387                                  
  2388                                  
  2389                                  endproc
  2390                              <1> %ifnctx proc
  2391                              <1> %error Mismatched `endproc'/`proc'
  2392                              <1> %else
  2393                              <1> 
  2394                              <1> 
  2395                              <1> %ifdef LEGACY_ENDPROC
  2396                              <1>         ret
  2397                              <1> %endif
  2398                              <1> 
  2399                              <1> 
  2400                              <1> 
  2401                              <1> 
  2402                              <1> 
  2403                              <1> 
  2404                              <1> 
  2405                              <1> 
  2406                              <1> 
  2407                              <1> %pop
  2408                              <1> %endif
  2409                                  _PointInBox_arglen	EQU	12
  2410                                  
  2411                                  
  2412                                  
  2413                                  
  2414                                  
  2415                                  
  2416                                  
  2417                                  
  2418                                  ;-------------------------------------------------------------------------;
  2419                                  ; GetPixel()								  ;
  2420                                  ;									  ;
  2421                                  ;   dword _GetPixel(dword DestOff, word DestWidth, word DestHeight,	  ;
  2422                                  ;                 word X, word Y)					  ;
  2423                                  ;									  ;
  2424                                  ;   Inputs: DestOff = offset of an image buffer in memory		  ;
  2425                                  ;	    DestWidth = width of the buffer				  ;
  2426                                  ;	    DestHeight = height of the buffer				  ;
  2427                                  ;	    X = x coordinate of point					  ;
  2428                                  ;	    Y = y coordinate of point					  ;
  2429                                  ;									  ;
  2430                                  ;   Outputs: none							  ;
  2431                                  ;									  ;
  2432                                  ;   Calls: _PointInBox							  ;
  2433                                  ;									  ;
  2434                                  ;   Returns: eax = color of the pixel located at (X,Y) in the buffer	  ;
  2435                                  ;	         = 0 if point is not within boundary of buffer		  ;
  2436                                  ;									  ;
  2437                                  ;   Purpose: Gets the color of the pixel located at the point (X,Y) in	  ;
  2438                                  ;	     the buffer pointed to by DestOff				  ;
  2439                                  ;									  ;
  2440                                  ;-------------------------------------------------------------------------;
  2441                                  proc _GetPixel
  2442                              <1> %push proc
  2443                              <1>           global %1
  2444 00000207 55                  <1> %1:       push  ebp
  2445 00000208 89E5                <1>           mov   ebp, esp
  2446                              <1> %assign %$arg 8
  2447                              <1> 
  2448                              <1> %define %$procname %1
  2449                                  .DestOff	arg	4
  2450                              <1> .DestOff       equ %$arg
  2451                              <1> 
  2452                              <1> 
  2453                              <1> %assign %$arg %1+%$arg
  2454                                  .DestWidth	arg	2
  2455                              <1> .DestWidth       equ %$arg
  2456                              <1> 
  2457                              <1> 
  2458                              <1> %assign %$arg %1+%$arg
  2459                                  .DestHeight	arg	2
  2460                              <1> .DestHeight       equ %$arg
  2461                              <1> 
  2462                              <1> 
  2463                              <1> %assign %$arg %1+%$arg
  2464                                  .X		arg	2
  2465                              <1> .X       equ %$arg
  2466                              <1> 
  2467                              <1> 
  2468                              <1> %assign %$arg %1+%$arg
  2469                                  .Y		arg	2
  2470                              <1> .Y       equ %$arg
  2471                              <1> 
  2472                              <1> 
  2473                              <1> %assign %$arg %1+%$arg
  2474                                  ;invoke	_libGetPixel, dword [ebp+.DestOff], word [ebp+.DestWidth], word [ebp+.DestHeight], word [ebp+.X], word [ebp+.Y]
  2475                                  ;ret
  2476                                  
  2477                                  
  2478                                   ; First check if pixel is a point in the box
  2479                                   invoke _PointInBox, word [ebp + .X], word [ebp + .Y], word 0, word 0, word [ebp + .DestWidth], word [ebp + .DestHeight]
  2480                              <1> %rotate -1
  2481                              <1> 
  2482                              <1> %rep (%0-1)
  2483                              <1> 
  2484                              <1> 
  2485                              <1> 
  2486                              <1> 
  2487                              <1> 
  2488                              <1> 
  2489                              <1> 
  2490                              <1>         %ifidni %1, cs
  2491                              <1>                 o16 push %1
  2492                              <1>         %elifidni %1, ds
  2493                              <1>                 o16 push %1
  2494                              <1>         %elifidni %1, es
  2495                              <1>                 o16 push %1
  2496                              <1>         %elifidni %1, fs
  2497                              <1>                 o16 push %1
  2498                              <1>         %elifidni %1, gs
  2499                              <1>                 o16 push %1
  2500                              <1>         %elifidni %1, word cs
  2501                              <1>                 o16 push %1
  2502                              <1>         %elifidni %1, word ds
  2503                              <1>                 o16 push %1
  2504                              <1>         %elifidni %1, word es
  2505                              <1>                 o16 push %1
  2506                              <1>         %elifidni %1, word fs
  2507                              <1>                 o16 push %1
  2508                              <1>         %elifidni %1, word gs
  2509                              <1>                 o16 push %1
  2510                              <1>         %else
  2511                              <1>                 push %1
  2512                              <1>         %endif
  2513                              <1> 
  2514                              <1>         %rotate -1
  2515                              <1> %endrep
  2516                              <2> 
  2517                              <2> 
  2518                              <2> 
  2519                              <2> 
  2520                              <2> 
  2521                              <2> 
  2522                              <2> 
  2523                              <2>         %ifidni %1, cs
  2524                              <2>                 o16 push %1
  2525                              <2>         %elifidni %1, ds
  2526                              <2>                 o16 push %1
  2527                              <2>         %elifidni %1, es
  2528                              <2>                 o16 push %1
  2529                              <2>         %elifidni %1, fs
  2530                              <2>                 o16 push %1
  2531                              <2>         %elifidni %1, gs
  2532                              <2>                 o16 push %1
  2533                              <2>         %elifidni %1, word cs
  2534                              <2>                 o16 push %1
  2535                              <2>         %elifidni %1, word ds
  2536                              <2>                 o16 push %1
  2537                              <2>         %elifidni %1, word es
  2538                              <2>                 o16 push %1
  2539                              <2>         %elifidni %1, word fs
  2540                              <2>                 o16 push %1
  2541                              <2>         %elifidni %1, word gs
  2542                              <2>                 o16 push %1
  2543                              <2>         %else
  2544 0000020A 66FF750E            <2>                 push %1
  2545                              <2>         %endif
  2546                              <2> 
  2547                              <2>         %rotate -1
  2548                              <2> 
  2549                              <2> 
  2550                              <2> 
  2551                              <2> 
  2552                              <2> 
  2553                              <2> 
  2554                              <2> 
  2555                              <2>         %ifidni %1, cs
  2556                              <2>                 o16 push %1
  2557                              <2>         %elifidni %1, ds
  2558                              <2>                 o16 push %1
  2559                              <2>         %elifidni %1, es
  2560                              <2>                 o16 push %1
  2561                              <2>         %elifidni %1, fs
  2562                              <2>                 o16 push %1
  2563                              <2>         %elifidni %1, gs
  2564                              <2>                 o16 push %1
  2565                              <2>         %elifidni %1, word cs
  2566                              <2>                 o16 push %1
  2567                              <2>         %elifidni %1, word ds
  2568                              <2>                 o16 push %1
  2569                              <2>         %elifidni %1, word es
  2570                              <2>                 o16 push %1
  2571                              <2>         %elifidni %1, word fs
  2572                              <2>                 o16 push %1
  2573                              <2>         %elifidni %1, word gs
  2574                              <2>                 o16 push %1
  2575                              <2>         %else
  2576 0000020E 66FF750C            <2>                 push %1
  2577                              <2>         %endif
  2578                              <2> 
  2579                              <2>         %rotate -1
  2580                              <2> 
  2581                              <2> 
  2582                              <2> 
  2583                              <2> 
  2584                              <2> 
  2585                              <2> 
  2586                              <2> 
  2587                              <2>         %ifidni %1, cs
  2588                              <2>                 o16 push %1
  2589                              <2>         %elifidni %1, ds
  2590                              <2>                 o16 push %1
  2591                              <2>         %elifidni %1, es
  2592                              <2>                 o16 push %1
  2593                              <2>         %elifidni %1, fs
  2594                              <2>                 o16 push %1
  2595                              <2>         %elifidni %1, gs
  2596                              <2>                 o16 push %1
  2597                              <2>         %elifidni %1, word cs
  2598                              <2>                 o16 push %1
  2599                              <2>         %elifidni %1, word ds
  2600                              <2>                 o16 push %1
  2601                              <2>         %elifidni %1, word es
  2602                              <2>                 o16 push %1
  2603                              <2>         %elifidni %1, word fs
  2604                              <2>                 o16 push %1
  2605                              <2>         %elifidni %1, word gs
  2606                              <2>                 o16 push %1
  2607                              <2>         %else
  2608 00000212 66680000            <2>                 push %1
  2609                              <2>         %endif
  2610                              <2> 
  2611                              <2>         %rotate -1
  2612                              <2> 
  2613                              <2> 
  2614                              <2> 
  2615                              <2> 
  2616                              <2> 
  2617                              <2> 
  2618                              <2> 
  2619                              <2>         %ifidni %1, cs
  2620                              <2>                 o16 push %1
  2621                              <2>         %elifidni %1, ds
  2622                              <2>                 o16 push %1
  2623                              <2>         %elifidni %1, es
  2624                              <2>                 o16 push %1
  2625                              <2>         %elifidni %1, fs
  2626                              <2>                 o16 push %1
  2627                              <2>         %elifidni %1, gs
  2628                              <2>                 o16 push %1
  2629                              <2>         %elifidni %1, word cs
  2630                              <2>                 o16 push %1
  2631                              <2>         %elifidni %1, word ds
  2632                              <2>                 o16 push %1
  2633                              <2>         %elifidni %1, word es
  2634                              <2>                 o16 push %1
  2635                              <2>         %elifidni %1, word fs
  2636                              <2>                 o16 push %1
  2637                              <2>         %elifidni %1, word gs
  2638                              <2>                 o16 push %1
  2639                              <2>         %else
  2640 00000216 66680000            <2>                 push %1
  2641                              <2>         %endif
  2642                              <2> 
  2643                              <2>         %rotate -1
  2644                              <2> 
  2645                              <2> 
  2646                              <2> 
  2647                              <2> 
  2648                              <2> 
  2649                              <2> 
  2650                              <2> 
  2651                              <2>         %ifidni %1, cs
  2652                              <2>                 o16 push %1
  2653                              <2>         %elifidni %1, ds
  2654                              <2>                 o16 push %1
  2655                              <2>         %elifidni %1, es
  2656                              <2>                 o16 push %1
  2657                              <2>         %elifidni %1, fs
  2658                              <2>                 o16 push %1
  2659                              <2>         %elifidni %1, gs
  2660                              <2>                 o16 push %1
  2661                              <2>         %elifidni %1, word cs
  2662                              <2>                 o16 push %1
  2663                              <2>         %elifidni %1, word ds
  2664                              <2>                 o16 push %1
  2665                              <2>         %elifidni %1, word es
  2666                              <2>                 o16 push %1
  2667                              <2>         %elifidni %1, word fs
  2668                              <2>                 o16 push %1
  2669                              <2>         %elifidni %1, word gs
  2670                              <2>                 o16 push %1
  2671                              <2>         %else
  2672 0000021A 66FF7512            <2>                 push %1
  2673                              <2>         %endif
  2674                              <2> 
  2675                              <2>         %rotate -1
  2676                              <2> 
  2677                              <2> 
  2678                              <2> 
  2679                              <2> 
  2680                              <2> 
  2681                              <2> 
  2682                              <2> 
  2683                              <2>         %ifidni %1, cs
  2684                              <2>                 o16 push %1
  2685                              <2>         %elifidni %1, ds
  2686                              <2>                 o16 push %1
  2687                              <2>         %elifidni %1, es
  2688                              <2>                 o16 push %1
  2689                              <2>         %elifidni %1, fs
  2690                              <2>                 o16 push %1
  2691                              <2>         %elifidni %1, gs
  2692                              <2>                 o16 push %1
  2693                              <2>         %elifidni %1, word cs
  2694                              <2>                 o16 push %1
  2695                              <2>         %elifidni %1, word ds
  2696                              <2>                 o16 push %1
  2697                              <2>         %elifidni %1, word es
  2698                              <2>                 o16 push %1
  2699                              <2>         %elifidni %1, word fs
  2700                              <2>                 o16 push %1
  2701                              <2>         %elifidni %1, word gs
  2702                              <2>                 o16 push %1
  2703                              <2>         %else
  2704 0000021E 66FF7510            <2>                 push %1
  2705                              <2>         %endif
  2706                              <2> 
  2707                              <2>         %rotate -1
  2708 00000222 E89EFFFFFF          <1> call %1
  2709                              <1> %if (%0!=1)
  2710 00000227 83C40C              <1>         add esp, byte %1_arglen
  2711                              <1> %endif
  2712 0000022A 85C0                     test eax, eax
  2713 0000022C 0F8420000000             jz near .InvalidPixel			; If point not in box, then return 0
  2714                                  
  2715                                   
  2716 00000232 53                       push ebx				; Save registers
  2717 00000233 51                       push ecx
  2718 00000234 52                       push edx
  2719                                  
  2720                                   
  2721 00000235 0FB7450C                 movzx eax, word [ebp + .DestWidth]	; The pixel is at [DestOff + 4*(DestWidth*Y + X)]
  2722 00000239 0FB74D12                 movzx ecx, word [ebp + .Y]		; So we set eax = DestWidth*Y
  2723 0000023D F7E1                     mul ecx
  2724                                  
  2725                                  
  2726 0000023F 0FB74D10                 movzx ecx, word [ebp + .X]		; ecx = X
  2727                                  
  2728                                  
  2729 00000243 01C1                     add ecx, eax				; ecx = DestWidth*Y + X
  2730 00000245 C1E102                   shl ecx, 2				; ecx = 4*(DestWidth*Y + X)
  2731                                  					; We multiply by 4 because each pixel is 4 bytes
  2732                                  
  2733 00000248 8B5D08                   mov ebx, dword [ebp + .DestOff]
  2734 0000024B 01CB                     add ebx, ecx				; ebx = DestOff + 4*(DestWidth*Y + X)
  2735 0000024D 8B03                     mov eax, dword [ebx]			; Move pixel into eax
  2736                                  
  2737                                  
  2738 0000024F 5A                       pop edx				; Restore registers
  2739 00000250 59                       pop ecx
  2740 00000251 5B                       pop ebx
  2741                                  
  2742                                   .InvalidPixel:
  2743                                   ret
  2744                              <1> %ifnctx proc
  2745                              <1> 	ret	%1
  2746                              <1> %else
  2747 00000252 89EC                <1> 	mov	esp, ebp
  2748 00000254 5D                  <1> 	pop	ebp
  2749 00000255 C3                  <1> 	ret	%1
  2750                              <1> %endif
  2751                                  
  2752                                  
  2753                                  
  2754                                  endproc
  2755                              <1> %ifnctx proc
  2756                              <1> %error Mismatched `endproc'/`proc'
  2757                              <1> %else
  2758                              <1> 
  2759                              <1> 
  2760                              <1> %ifdef LEGACY_ENDPROC
  2761                              <1>         ret
  2762                              <1> %endif
  2763                              <1> 
  2764                              <1> 
  2765                              <1> 
  2766                              <1> 
  2767                              <1> 
  2768                              <1> 
  2769                              <1> 
  2770                              <1> 
  2771                              <1> 
  2772                              <1> %pop
  2773                              <1> %endif
  2774                                  _GetPixel_arglen	EQU	12
  2775                                  
  2776                                  
  2777                                  
  2778                                  
  2779                                  
  2780                                  
  2781                                  
  2782                                  ;-------------------------------------------------------------------------;
  2783                                  ; DrawPixel()								  ;
  2784                                  ;									  ;
  2785                                  ;   void _DrawPixel(dword DestOff, word DestWidth, word DestHeight,	  ;
  2786                                  ;                 word X, word Y, dword Color)				  ;
  2787                                  ;									  ;
  2788                                  ;   Inputs: DestOff = offset of an image buffer in memory		  ;
  2789                                  ;	    DestWidth = width of the buffer				  ;
  2790                                  ;	    DestHeight = height of the buffer				  ;
  2791                                  ;	    X = x coordinate of point					  ;
  2792                                  ;	    Y = y coordinate of point					  ;
  2793                                  ;	    Color = color of pixel to draw				  ;
  2794                                  ;									  ;
  2795                                  ;   Outputs: Pixel drawn to buffer					  ;
  2796                                  ;									  ;
  2797                                  ;   Calls: _PointInBox							  ;
  2798                                  ;									  ;
  2799                                  ;   Returns: none							  ;
  2800                                  ;									  ;
  2801                                  ;   Purpose: Draws a pixel with color Color at point (X,Y) in		  ;
  2802                                  ;	     the buffer pointed to by DestOff				  ;
  2803                                  ;									  ;
  2804                                  ;-------------------------------------------------------------------------;
  2805                                  proc _DrawPixel
  2806                              <1> %push proc
  2807                              <1>           global %1
  2808 00000256 55                  <1> %1:       push  ebp
  2809 00000257 89E5                <1>           mov   ebp, esp
  2810                              <1> %assign %$arg 8
  2811                              <1> 
  2812                              <1> %define %$procname %1
  2813                                  .DestOff	arg	4
  2814                              <1> .DestOff       equ %$arg
  2815                              <1> 
  2816                              <1> 
  2817                              <1> %assign %$arg %1+%$arg
  2818                                  .DestWidth	arg	2
  2819                              <1> .DestWidth       equ %$arg
  2820                              <1> 
  2821                              <1> 
  2822                              <1> %assign %$arg %1+%$arg
  2823                                  .DestHeight	arg	2
  2824                              <1> .DestHeight       equ %$arg
  2825                              <1> 
  2826                              <1> 
  2827                              <1> %assign %$arg %1+%$arg
  2828                                  .X		arg	2
  2829                              <1> .X       equ %$arg
  2830                              <1> 
  2831                              <1> 
  2832                              <1> %assign %$arg %1+%$arg
  2833                                  .Y		arg	2
  2834                              <1> .Y       equ %$arg
  2835                              <1> 
  2836                              <1> 
  2837                              <1> %assign %$arg %1+%$arg
  2838                                  .Color		arg	4
  2839                              <1> .Color       equ %$arg
  2840                              <1> 
  2841                              <1> 
  2842                              <1> %assign %$arg %1+%$arg
  2843                                  ;invoke	_libDrawPixel, dword [ebp+.DestOff], word [ebp+.DestWidth], word [ebp+.DestHeight], word [ebp+.X], word [ebp+.Y], dword [ebp+.Color]
  2844                                  ;ret
  2845                                  
  2846                                  
  2847 00000259 50                       push eax
  2848                                  
  2849                                   invoke _PointInBox, word [ebp + .X], word [ebp + .Y], word 0, word 0, word [ebp + .DestWidth], word [ebp + .DestHeight]
  2850                              <1> %rotate -1
  2851                              <1> 
  2852                              <1> %rep (%0-1)
  2853                              <1> 
  2854                              <1> 
  2855                              <1> 
  2856                              <1> 
  2857                              <1> 
  2858                              <1> 
  2859                              <1> 
  2860                              <1>         %ifidni %1, cs
  2861                              <1>                 o16 push %1
  2862                              <1>         %elifidni %1, ds
  2863                              <1>                 o16 push %1
  2864                              <1>         %elifidni %1, es
  2865                              <1>                 o16 push %1
  2866                              <1>         %elifidni %1, fs
  2867                              <1>                 o16 push %1
  2868                              <1>         %elifidni %1, gs
  2869                              <1>                 o16 push %1
  2870                              <1>         %elifidni %1, word cs
  2871                              <1>                 o16 push %1
  2872                              <1>         %elifidni %1, word ds
  2873                              <1>                 o16 push %1
  2874                              <1>         %elifidni %1, word es
  2875                              <1>                 o16 push %1
  2876                              <1>         %elifidni %1, word fs
  2877                              <1>                 o16 push %1
  2878                              <1>         %elifidni %1, word gs
  2879                              <1>                 o16 push %1
  2880                              <1>         %else
  2881                              <1>                 push %1
  2882                              <1>         %endif
  2883                              <1> 
  2884                              <1>         %rotate -1
  2885                              <1> %endrep
  2886                              <2> 
  2887                              <2> 
  2888                              <2> 
  2889                              <2> 
  2890                              <2> 
  2891                              <2> 
  2892                              <2> 
  2893                              <2>         %ifidni %1, cs
  2894                              <2>                 o16 push %1
  2895                              <2>         %elifidni %1, ds
  2896                              <2>                 o16 push %1
  2897                              <2>         %elifidni %1, es
  2898                              <2>                 o16 push %1
  2899                              <2>         %elifidni %1, fs
  2900                              <2>                 o16 push %1
  2901                              <2>         %elifidni %1, gs
  2902                              <2>                 o16 push %1
  2903                              <2>         %elifidni %1, word cs
  2904                              <2>                 o16 push %1
  2905                              <2>         %elifidni %1, word ds
  2906                              <2>                 o16 push %1
  2907                              <2>         %elifidni %1, word es
  2908                              <2>                 o16 push %1
  2909                              <2>         %elifidni %1, word fs
  2910                              <2>                 o16 push %1
  2911                              <2>         %elifidni %1, word gs
  2912                              <2>                 o16 push %1
  2913                              <2>         %else
  2914 0000025A 66FF750E            <2>                 push %1
  2915                              <2>         %endif
  2916                              <2> 
  2917                              <2>         %rotate -1
  2918                              <2> 
  2919                              <2> 
  2920                              <2> 
  2921                              <2> 
  2922                              <2> 
  2923                              <2> 
  2924                              <2> 
  2925                              <2>         %ifidni %1, cs
  2926                              <2>                 o16 push %1
  2927                              <2>         %elifidni %1, ds
  2928                              <2>                 o16 push %1
  2929                              <2>         %elifidni %1, es
  2930                              <2>                 o16 push %1
  2931                              <2>         %elifidni %1, fs
  2932                              <2>                 o16 push %1
  2933                              <2>         %elifidni %1, gs
  2934                              <2>                 o16 push %1
  2935                              <2>         %elifidni %1, word cs
  2936                              <2>                 o16 push %1
  2937                              <2>         %elifidni %1, word ds
  2938                              <2>                 o16 push %1
  2939                              <2>         %elifidni %1, word es
  2940                              <2>                 o16 push %1
  2941                              <2>         %elifidni %1, word fs
  2942                              <2>                 o16 push %1
  2943                              <2>         %elifidni %1, word gs
  2944                              <2>                 o16 push %1
  2945                              <2>         %else
  2946 0000025E 66FF750C            <2>                 push %1
  2947                              <2>         %endif
  2948                              <2> 
  2949                              <2>         %rotate -1
  2950                              <2> 
  2951                              <2> 
  2952                              <2> 
  2953                              <2> 
  2954                              <2> 
  2955                              <2> 
  2956                              <2> 
  2957                              <2>         %ifidni %1, cs
  2958                              <2>                 o16 push %1
  2959                              <2>         %elifidni %1, ds
  2960                              <2>                 o16 push %1
  2961                              <2>         %elifidni %1, es
  2962                              <2>                 o16 push %1
  2963                              <2>         %elifidni %1, fs
  2964                              <2>                 o16 push %1
  2965                              <2>         %elifidni %1, gs
  2966                              <2>                 o16 push %1
  2967                              <2>         %elifidni %1, word cs
  2968                              <2>                 o16 push %1
  2969                              <2>         %elifidni %1, word ds
  2970                              <2>                 o16 push %1
  2971                              <2>         %elifidni %1, word es
  2972                              <2>                 o16 push %1
  2973                              <2>         %elifidni %1, word fs
  2974                              <2>                 o16 push %1
  2975                              <2>         %elifidni %1, word gs
  2976                              <2>                 o16 push %1
  2977                              <2>         %else
  2978 00000262 66680000            <2>                 push %1
  2979                              <2>         %endif
  2980                              <2> 
  2981                              <2>         %rotate -1
  2982                              <2> 
  2983                              <2> 
  2984                              <2> 
  2985                              <2> 
  2986                              <2> 
  2987                              <2> 
  2988                              <2> 
  2989                              <2>         %ifidni %1, cs
  2990                              <2>                 o16 push %1
  2991                              <2>         %elifidni %1, ds
  2992                              <2>                 o16 push %1
  2993                              <2>         %elifidni %1, es
  2994                              <2>                 o16 push %1
  2995                              <2>         %elifidni %1, fs
  2996                              <2>                 o16 push %1
  2997                              <2>         %elifidni %1, gs
  2998                              <2>                 o16 push %1
  2999                              <2>         %elifidni %1, word cs
  3000                              <2>                 o16 push %1
  3001                              <2>         %elifidni %1, word ds
  3002                              <2>                 o16 push %1
  3003                              <2>         %elifidni %1, word es
  3004                              <2>                 o16 push %1
  3005                              <2>         %elifidni %1, word fs
  3006                              <2>                 o16 push %1
  3007                              <2>         %elifidni %1, word gs
  3008                              <2>                 o16 push %1
  3009                              <2>         %else
  3010 00000266 66680000            <2>                 push %1
  3011                              <2>         %endif
  3012                              <2> 
  3013                              <2>         %rotate -1
  3014                              <2> 
  3015                              <2> 
  3016                              <2> 
  3017                              <2> 
  3018                              <2> 
  3019                              <2> 
  3020                              <2> 
  3021                              <2>         %ifidni %1, cs
  3022                              <2>                 o16 push %1
  3023                              <2>         %elifidni %1, ds
  3024                              <2>                 o16 push %1
  3025                              <2>         %elifidni %1, es
  3026                              <2>                 o16 push %1
  3027                              <2>         %elifidni %1, fs
  3028                              <2>                 o16 push %1
  3029                              <2>         %elifidni %1, gs
  3030                              <2>                 o16 push %1
  3031                              <2>         %elifidni %1, word cs
  3032                              <2>                 o16 push %1
  3033                              <2>         %elifidni %1, word ds
  3034                              <2>                 o16 push %1
  3035                              <2>         %elifidni %1, word es
  3036                              <2>                 o16 push %1
  3037                              <2>         %elifidni %1, word fs
  3038                              <2>                 o16 push %1
  3039                              <2>         %elifidni %1, word gs
  3040                              <2>                 o16 push %1
  3041                              <2>         %else
  3042 0000026A 66FF7512            <2>                 push %1
  3043                              <2>         %endif
  3044                              <2> 
  3045                              <2>         %rotate -1
  3046                              <2> 
  3047                              <2> 
  3048                              <2> 
  3049                              <2> 
  3050                              <2> 
  3051                              <2> 
  3052                              <2> 
  3053                              <2>         %ifidni %1, cs
  3054                              <2>                 o16 push %1
  3055                              <2>         %elifidni %1, ds
  3056                              <2>                 o16 push %1
  3057                              <2>         %elifidni %1, es
  3058                              <2>                 o16 push %1
  3059                              <2>         %elifidni %1, fs
  3060                              <2>                 o16 push %1
  3061                              <2>         %elifidni %1, gs
  3062                              <2>                 o16 push %1
  3063                              <2>         %elifidni %1, word cs
  3064                              <2>                 o16 push %1
  3065                              <2>         %elifidni %1, word ds
  3066                              <2>                 o16 push %1
  3067                              <2>         %elifidni %1, word es
  3068                              <2>                 o16 push %1
  3069                              <2>         %elifidni %1, word fs
  3070                              <2>                 o16 push %1
  3071                              <2>         %elifidni %1, word gs
  3072                              <2>                 o16 push %1
  3073                              <2>         %else
  3074 0000026E 66FF7510            <2>                 push %1
  3075                              <2>         %endif
  3076                              <2> 
  3077                              <2>         %rotate -1
  3078 00000272 E84EFFFFFF          <1> call %1
  3079                              <1> %if (%0!=1)
  3080 00000277 83C40C              <1>         add esp, byte %1_arglen
  3081                              <1> %endif
  3082 0000027A 85C0                     test eax, eax
  3083 0000027C 0F8423000000             jz near .InvalidPixel			; If point not in box, then return
  3084                                  
  3085                                  
  3086 00000282 53                       push ebx
  3087 00000283 51                       push ecx
  3088 00000284 52                       push edx
  3089                                  
  3090                                  
  3091 00000285 0FB7450C                 movzx eax, word [ebp + .DestWidth]	; The pixel is at [DestOff + 4*(DestWidth*Y + X)]
  3092 00000289 0FB74D12                 movzx ecx, word [ebp + .Y]		; So we set eax = DestWidth*Y
  3093 0000028D F7E1                     mul ecx
  3094                                  
  3095                                  
  3096                                  
  3097 0000028F 0FB74D10                 movzx ecx, word [ebp + .X]		; ecx = X
  3098                                  
  3099                                  
  3100 00000293 01C1                     add ecx, eax				; ecx = DestWidth*Y + X
  3101 00000295 C1E102                   shl ecx, 2				; ecx = 4*(DestWidth*Y + X)
  3102                                  					; We multiply by 4 because each pixel is 4 bytes
  3103                                  
  3104                                  
  3105 00000298 8B5D08                   mov ebx, dword [ebp + .DestOff]
  3106 0000029B 01CB                     add ebx, ecx				; ebx = DestOff + 4*(DestWidth*Y + X)
  3107 0000029D 8B4D14                   mov ecx, dword [ebp + .Color]
  3108 000002A0 890B                     mov dword [ebx], ecx			; Draw pixel with color at point (X,Y)
  3109                                   
  3110                                  
  3111 000002A2 5A                       pop edx				; Restore registers
  3112 000002A3 59                       pop ecx
  3113 000002A4 5B                       pop ebx
  3114                                  
  3115                                  
  3116                                   .InvalidPixel:
  3117                                  
  3118 000002A5 58                       pop eax
  3119                                  
  3120                                   ret
  3121                              <1> %ifnctx proc
  3122                              <1> 	ret	%1
  3123                              <1> %else
  3124 000002A6 89EC                <1> 	mov	esp, ebp
  3125 000002A8 5D                  <1> 	pop	ebp
  3126 000002A9 C3                  <1> 	ret	%1
  3127                              <1> %endif
  3128                                  
  3129                                  
  3130                                  endproc
  3131                              <1> %ifnctx proc
  3132                              <1> %error Mismatched `endproc'/`proc'
  3133                              <1> %else
  3134                              <1> 
  3135                              <1> 
  3136                              <1> %ifdef LEGACY_ENDPROC
  3137                              <1>         ret
  3138                              <1> %endif
  3139                              <1> 
  3140                              <1> 
  3141                              <1> 
  3142                              <1> 
  3143                              <1> 
  3144                              <1> 
  3145                              <1> 
  3146                              <1> 
  3147                              <1> 
  3148                              <1> %pop
  3149                              <1> %endif
  3150                                  _DrawPixel_arglen	EQU	16
  3151                                  
  3152                                  
  3153                                  
  3154                                  
  3155                                  
  3156                                  
  3157                                  
  3158                                  
  3159                                  
  3160                                  
  3161                                  ;-------------------------------------------------------------------------;
  3162                                  ; DrawLine()								  ;
  3163                                  ;									  ;
  3164                                  ;   void _DrawLine(dword DestOff, word DestWidth, word DestHeight,	  ;
  3165                                  ;                  word X1, word Y1, word X2, word Y2, dword Color)	  ;
  3166                                  ;									  ;
  3167                                  ;   Inputs: DestOff = offset of an image buffer in memory		  ;
  3168                                  ;	    DestWidth = width of the buffer				  ;
  3169                                  ;	    DestHeight = height of the buffer				  ;
  3170                                  ;	    X1 = x coordinate of start point				  ;
  3171                                  ;	    Y1 = y coordinate of start point				  ;
  3172                                  ;	    X2 = x coordinate of end point				  ;
  3173                                  ;	    Y2 = y coordinate of end point				  ;
  3174                                  ;	    Color = color of line to draw				  ;
  3175                                  ;									  ;
  3176                                  ;   Outputs: Line drawn to buffer					  ;
  3177                                  ;									  ;
  3178                                  ;   Calls: _DrawPixel							  ;
  3179                                  ;									  ;
  3180                                  ;   Returns: none							  ;
  3181                                  ;									  ;
  3182                                  ;   Purpose: Draws a line with color Color from point (X1,Y1) to (X2,Y2)  ;
  3183                                  ;	     in the buffer pointed to by DestOff			  ;
  3184                                  ;									  ;
  3185                                  ;-------------------------------------------------------------------------;
  3186                                  proc _DrawLine
  3187                              <1> %push proc
  3188                              <1>           global %1
  3189 000002AA 55                  <1> %1:       push  ebp
  3190 000002AB 89E5                <1>           mov   ebp, esp
  3191                              <1> %assign %$arg 8
  3192                              <1> 
  3193                              <1> %define %$procname %1
  3194                                  .DestOff	arg	4
  3195                              <1> .DestOff       equ %$arg
  3196                              <1> 
  3197                              <1> 
  3198                              <1> %assign %$arg %1+%$arg
  3199                                  .DestWidth	arg	2
  3200                              <1> .DestWidth       equ %$arg
  3201                              <1> 
  3202                              <1> 
  3203                              <1> %assign %$arg %1+%$arg
  3204                                  .DestHeight	arg	2
  3205                              <1> .DestHeight       equ %$arg
  3206                              <1> 
  3207                              <1> 
  3208                              <1> %assign %$arg %1+%$arg
  3209                                  .X1		arg	2
  3210                              <1> .X1       equ %$arg
  3211                              <1> 
  3212                              <1> 
  3213                              <1> %assign %$arg %1+%$arg
  3214                                  .Y1		arg	2
  3215                              <1> .Y1       equ %$arg
  3216                              <1> 
  3217                              <1> 
  3218                              <1> %assign %$arg %1+%$arg
  3219                                  .X2		arg	2
  3220                              <1> .X2       equ %$arg
  3221                              <1> 
  3222                              <1> 
  3223                              <1> %assign %$arg %1+%$arg
  3224                                  .Y2		arg	2
  3225                              <1> .Y2       equ %$arg
  3226                              <1> 
  3227                              <1> 
  3228                              <1> %assign %$arg %1+%$arg
  3229                                  .Color		arg	4
  3230                              <1> .Color       equ %$arg
  3231                              <1> 
  3232                              <1> 
  3233                              <1> %assign %$arg %1+%$arg
  3234                                  ;invoke	_libDrawLine, dword [ebp+.DestOff], word [ebp+.DestWidth], word [ebp+.DestHeight], word [ebp+.X1], word [ebp+.Y1], word [ebp+.X2], word [ebp+.Y2], dword [ebp+.Color]
  3235                                  ;ret
  3236                                  
  3237                                  
  3238 000002AD 6650                     push ax				; Save registers
  3239 000002AF 6651                     push cx
  3240                                  
  3241                                  
  3242                                  					; Begin Bresenham's Line Algorithm:
  3243 000002B1 668B4514                 mov ax, word [ebp + .X2]		; dx = abs(x2 - x1)
  3244 000002B5 662B4510                 sub ax, word [ebp + .X1]
  3245 000002B9 663D0000                 cmp ax, 0
  3246 000002BD 0F8C05000000             jl near .AbsValueX
  3247 000002C3 E903000000               jmp near .StoreDX
  3248                                  
  3249                                  
  3250                                  
  3251                                   .AbsValueX:				; if x2 - x1 is negative,
  3252 000002C8 66F7D8                   neg ax					; then make value positive
  3253                                  
  3254                                   .StoreDX:
  3255 000002CB 66A3[2C000000]           mov word [_dx], ax			; _dx = abs(x2 - x1)
  3256                                  
  3257                                  
  3258                                   ;Calculate (y2 - y1)
  3259 000002D1 668B4516                 mov ax, word [ebp + .Y2]		; dy = abs(y2 - y1)
  3260 000002D5 662B4512                 sub ax, word [ebp + .Y1]
  3261 000002D9 663D0000                 cmp ax, 0
  3262 000002DD 0F8C05000000             jl near .AbsValueY
  3263 000002E3 E903000000               jmp near .StoreDY
  3264                                  
  3265                                  
  3266                                   .AbsValueY:				; if y2 - y1 is negative,
  3267 000002E8 66F7D8                   neg ax					; then make value positive
  3268                                  
  3269                                  
  3270                                   .StoreDY:
  3271 000002EB 66A3[2E000000]           mov word [_dy], ax			; _dy = abs(y2 - y1)
  3272                                  
  3273                                  
  3274 000002F1 66C705[34000000]01-      mov word [_xdiaginc], 1		; xdiaginc = 1  always
  3275 000002F9 00                 
  3276 000002FA 66C705[38000000]01-      mov word [_ydiaginc], 1		; ydiaginc = 1  always
  3277 00000302 00                 
  3278                                  
  3279                                  
  3280                                  
  3281 00000303 663B05[2C000000]         cmp ax, word [_dx]			; ax is currently holding _dy
  3282 0000030A 0F8F4E000000             jg near .DYisBigger
  3283                                  
  3284                                  
  3285                                   ;--- If dx >= dy then -----------------------------------------------
  3286                                  
  3287 00000310 66D1E0                   shl ax, 1				; ax = 2 * dy
  3288 00000313 66A3[3C000000]           mov word [_errornodiaginc], ax		; errornodiaginc = 2 * dy
  3289                                  
  3290 00000319 662B05[2C000000]         sub ax, [_dx]
  3291 00000320 66A3[30000000]           mov word [_lineerror], ax		; lineerror = (2 * dy) - dx
  3292                                  
  3293 00000326 66A1[2E000000]           mov ax, word [_dy]
  3294 0000032C 662B05[2C000000]         sub ax, word [_dx]
  3295 00000333 66D1E0                   shl ax, 1
  3296 00000336 66A3[3A000000]           mov word [_errordiaginc], ax		; errordiaginc = 2 * (dy - dx)
  3297                                  
  3298 0000033C 66A1[2C000000]           mov ax, word [_dx]
  3299 00000342 6640                     inc ax
  3300 00000344 6689C1                   mov cx, ax				; numpixels = cx = dx + 1
  3301                                  
  3302 00000347 66C705[32000000]01-      mov word [_xhorizinc], 1		; xhorizinc = 1
  3303 0000034F 00                 
  3304 00000350 66C705[36000000]00-      mov word [_yvertinc], 0		; yvertinc = 0
  3305 00000358 00                 
  3306 00000359 E949000000               jmp near .CheckXinc
  3307                                  
  3308                                   ;--------------------------------------------------------------------
  3309                                   ;
  3310                                   ;
  3311                                   ;--- Else (dy > dx) -------------------------------------------------
  3312                                  
  3313                                   .DYisBigger:
  3314 0000035E 66C705[32000000]00-      mov word [_xhorizinc], 0		; xhorizinc = 0
  3315 00000366 00                 
  3316 00000367 66C705[36000000]01-      mov word [_yvertinc], 1		; yvertinc = 1
  3317 0000036F 00                 
  3318                                  
  3319 00000370 6689C1                   mov cx, ax				; ax is currently holding _dy
  3320 00000373 6641                     inc cx					; numpixels = cx = dy + 1
  3321                                  
  3322 00000375 66A1[2C000000]           mov ax, word [_dx]
  3323 0000037B 66D1E0                   shl ax, 1
  3324 0000037E 66A3[3C000000]           mov word [_errornodiaginc], ax		; errornodiaginc = 2 * dx
  3325                                  
  3326 00000384 662B05[2E000000]         sub ax, word [_dy]
  3327 0000038B 66A3[30000000]           mov word [_lineerror], ax		; lineerror = (2 * dx) - dy
  3328                                  
  3329 00000391 66A1[2C000000]           mov ax, word [_dx]
  3330 00000397 662B05[2E000000]         sub ax, word [_dy]
  3331 0000039E 66D1E0                   shl ax, 1				; errordiaginc = 2 * (dx - dy)
  3332 000003A1 66A3[3A000000]           mov word [_errordiaginc], ax
  3333                                  
  3334                                  ;---------------------------------------------------------------------
  3335                                  
  3336                                  
  3337                                   ;----------
  3338                                   .CheckXinc:
  3339                                   ;----------
  3340 000003A7 668B4510                    mov ax, word [ebp + .X1]
  3341 000003AB 663B4514                    cmp ax, word [ebp + .X2]		; Check if x1 > x2
  3342 000003AF 7E0E                        jng .CheckYinc
  3343                                  
  3344 000003B1 66F71D[32000000]            neg word [_xhorizinc]		; If so, then xhorizinc = -xhorizinc
  3345 000003B8 66F71D[34000000]            neg word [_xdiaginc]		;         and xdiaginc  = -xdiaginc
  3346                                  
  3347                                  
  3348                                   ;----------
  3349                                   .CheckYinc:
  3350                                   ;----------
  3351 000003BF 668B4512                    mov ax, word [ebp + .Y1]
  3352 000003C3 663B4516                    cmp ax, word [ebp + .Y2]		; Check if y1 > y2
  3353 000003C7 7E0E                        jng .SetXandY
  3354                                  
  3355 000003C9 66F71D[36000000]            neg word [_yvertinc]		; If so, then yvertinc = -yvertinc
  3356 000003D0 66F71D[38000000]            neg word [_ydiaginc]		;         and ydiaginc = -ydiaginc
  3357                                  
  3358                                  
  3359                                   ;---------
  3360                                   .SetXandY:
  3361                                   ;---------
  3362 000003D7 668B4510                    mov ax, word [ebp + .X1]
  3363 000003DB 66A3[28000000]              mov word [_x], ax			; x = x1
  3364 000003E1 668B4512                    mov ax, word [ebp + .Y1]
  3365 000003E5 66A3[2A000000]              mov word [_y], ax			; y = y1
  3366                                  
  3367                                  
  3368                                  
  3369                                  
  3370                                   ;----------
  3371                                   .PixelLoop:
  3372                                   ;----------
  3373                                      invoke _DrawPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [_x], word [_y], dword [ebp + .Color]
  3374                              <1> %rotate -1
  3375                              <1> 
  3376                              <1> %rep (%0-1)
  3377                              <1> 
  3378                              <1> 
  3379                              <1> 
  3380                              <1> 
  3381                              <1> 
  3382                              <1> 
  3383                              <1> 
  3384                              <1>         %ifidni %1, cs
  3385                              <1>                 o16 push %1
  3386                              <1>         %elifidni %1, ds
  3387                              <1>                 o16 push %1
  3388                              <1>         %elifidni %1, es
  3389                              <1>                 o16 push %1
  3390                              <1>         %elifidni %1, fs
  3391                              <1>                 o16 push %1
  3392                              <1>         %elifidni %1, gs
  3393                              <1>                 o16 push %1
  3394                              <1>         %elifidni %1, word cs
  3395                              <1>                 o16 push %1
  3396                              <1>         %elifidni %1, word ds
  3397                              <1>                 o16 push %1
  3398                              <1>         %elifidni %1, word es
  3399                              <1>                 o16 push %1
  3400                              <1>         %elifidni %1, word fs
  3401                              <1>                 o16 push %1
  3402                              <1>         %elifidni %1, word gs
  3403                              <1>                 o16 push %1
  3404                              <1>         %else
  3405                              <1>                 push %1
  3406                              <1>         %endif
  3407                              <1> 
  3408                              <1>         %rotate -1
  3409                              <1> %endrep
  3410                              <2> 
  3411                              <2> 
  3412                              <2> 
  3413                              <2> 
  3414                              <2> 
  3415                              <2> 
  3416                              <2> 
  3417                              <2>         %ifidni %1, cs
  3418                              <2>                 o16 push %1
  3419                              <2>         %elifidni %1, ds
  3420                              <2>                 o16 push %1
  3421                              <2>         %elifidni %1, es
  3422                              <2>                 o16 push %1
  3423                              <2>         %elifidni %1, fs
  3424                              <2>                 o16 push %1
  3425                              <2>         %elifidni %1, gs
  3426                              <2>                 o16 push %1
  3427                              <2>         %elifidni %1, word cs
  3428                              <2>                 o16 push %1
  3429                              <2>         %elifidni %1, word ds
  3430                              <2>                 o16 push %1
  3431                              <2>         %elifidni %1, word es
  3432                              <2>                 o16 push %1
  3433                              <2>         %elifidni %1, word fs
  3434                              <2>                 o16 push %1
  3435                              <2>         %elifidni %1, word gs
  3436                              <2>                 o16 push %1
  3437                              <2>         %else
  3438 000003EB FF7518              <2>                 push %1
  3439                              <2>         %endif
  3440                              <2> 
  3441                              <2>         %rotate -1
  3442                              <2> 
  3443                              <2> 
  3444                              <2> 
  3445                              <2> 
  3446                              <2> 
  3447                              <2> 
  3448                              <2> 
  3449                              <2>         %ifidni %1, cs
  3450                              <2>                 o16 push %1
  3451                              <2>         %elifidni %1, ds
  3452                              <2>                 o16 push %1
  3453                              <2>         %elifidni %1, es
  3454                              <2>                 o16 push %1
  3455                              <2>         %elifidni %1, fs
  3456                              <2>                 o16 push %1
  3457                              <2>         %elifidni %1, gs
  3458                              <2>                 o16 push %1
  3459                              <2>         %elifidni %1, word cs
  3460                              <2>                 o16 push %1
  3461                              <2>         %elifidni %1, word ds
  3462                              <2>                 o16 push %1
  3463                              <2>         %elifidni %1, word es
  3464                              <2>                 o16 push %1
  3465                              <2>         %elifidni %1, word fs
  3466                              <2>                 o16 push %1
  3467                              <2>         %elifidni %1, word gs
  3468                              <2>                 o16 push %1
  3469                              <2>         %else
  3470 000003EE 66FF35[2A000000]    <2>                 push %1
  3471                              <2>         %endif
  3472                              <2> 
  3473                              <2>         %rotate -1
  3474                              <2> 
  3475                              <2> 
  3476                              <2> 
  3477                              <2> 
  3478                              <2> 
  3479                              <2> 
  3480                              <2> 
  3481                              <2>         %ifidni %1, cs
  3482                              <2>                 o16 push %1
  3483                              <2>         %elifidni %1, ds
  3484                              <2>                 o16 push %1
  3485                              <2>         %elifidni %1, es
  3486                              <2>                 o16 push %1
  3487                              <2>         %elifidni %1, fs
  3488                              <2>                 o16 push %1
  3489                              <2>         %elifidni %1, gs
  3490                              <2>                 o16 push %1
  3491                              <2>         %elifidni %1, word cs
  3492                              <2>                 o16 push %1
  3493                              <2>         %elifidni %1, word ds
  3494                              <2>                 o16 push %1
  3495                              <2>         %elifidni %1, word es
  3496                              <2>                 o16 push %1
  3497                              <2>         %elifidni %1, word fs
  3498                              <2>                 o16 push %1
  3499                              <2>         %elifidni %1, word gs
  3500                              <2>                 o16 push %1
  3501                              <2>         %else
  3502 000003F5 66FF35[28000000]    <2>                 push %1
  3503                              <2>         %endif
  3504                              <2> 
  3505                              <2>         %rotate -1
  3506                              <2> 
  3507                              <2> 
  3508                              <2> 
  3509                              <2> 
  3510                              <2> 
  3511                              <2> 
  3512                              <2> 
  3513                              <2>         %ifidni %1, cs
  3514                              <2>                 o16 push %1
  3515                              <2>         %elifidni %1, ds
  3516                              <2>                 o16 push %1
  3517                              <2>         %elifidni %1, es
  3518                              <2>                 o16 push %1
  3519                              <2>         %elifidni %1, fs
  3520                              <2>                 o16 push %1
  3521                              <2>         %elifidni %1, gs
  3522                              <2>                 o16 push %1
  3523                              <2>         %elifidni %1, word cs
  3524                              <2>                 o16 push %1
  3525                              <2>         %elifidni %1, word ds
  3526                              <2>                 o16 push %1
  3527                              <2>         %elifidni %1, word es
  3528                              <2>                 o16 push %1
  3529                              <2>         %elifidni %1, word fs
  3530                              <2>                 o16 push %1
  3531                              <2>         %elifidni %1, word gs
  3532                              <2>                 o16 push %1
  3533                              <2>         %else
  3534 000003FC 66FF750E            <2>                 push %1
  3535                              <2>         %endif
  3536                              <2> 
  3537                              <2>         %rotate -1
  3538                              <2> 
  3539                              <2> 
  3540                              <2> 
  3541                              <2> 
  3542                              <2> 
  3543                              <2> 
  3544                              <2> 
  3545                              <2>         %ifidni %1, cs
  3546                              <2>                 o16 push %1
  3547                              <2>         %elifidni %1, ds
  3548                              <2>                 o16 push %1
  3549                              <2>         %elifidni %1, es
  3550                              <2>                 o16 push %1
  3551                              <2>         %elifidni %1, fs
  3552                              <2>                 o16 push %1
  3553                              <2>         %elifidni %1, gs
  3554                              <2>                 o16 push %1
  3555                              <2>         %elifidni %1, word cs
  3556                              <2>                 o16 push %1
  3557                              <2>         %elifidni %1, word ds
  3558                              <2>                 o16 push %1
  3559                              <2>         %elifidni %1, word es
  3560                              <2>                 o16 push %1
  3561                              <2>         %elifidni %1, word fs
  3562                              <2>                 o16 push %1
  3563                              <2>         %elifidni %1, word gs
  3564                              <2>                 o16 push %1
  3565                              <2>         %else
  3566 00000400 66FF750C            <2>                 push %1
  3567                              <2>         %endif
  3568                              <2> 
  3569                              <2>         %rotate -1
  3570                              <2> 
  3571                              <2> 
  3572                              <2> 
  3573                              <2> 
  3574                              <2> 
  3575                              <2> 
  3576                              <2> 
  3577                              <2>         %ifidni %1, cs
  3578                              <2>                 o16 push %1
  3579                              <2>         %elifidni %1, ds
  3580                              <2>                 o16 push %1
  3581                              <2>         %elifidni %1, es
  3582                              <2>                 o16 push %1
  3583                              <2>         %elifidni %1, fs
  3584                              <2>                 o16 push %1
  3585                              <2>         %elifidni %1, gs
  3586                              <2>                 o16 push %1
  3587                              <2>         %elifidni %1, word cs
  3588                              <2>                 o16 push %1
  3589                              <2>         %elifidni %1, word ds
  3590                              <2>                 o16 push %1
  3591                              <2>         %elifidni %1, word es
  3592                              <2>                 o16 push %1
  3593                              <2>         %elifidni %1, word fs
  3594                              <2>                 o16 push %1
  3595                              <2>         %elifidni %1, word gs
  3596                              <2>                 o16 push %1
  3597                              <2>         %else
  3598 00000404 FF7508              <2>                 push %1
  3599                              <2>         %endif
  3600                              <2> 
  3601                              <2>         %rotate -1
  3602 00000407 E84AFEFFFF          <1> call %1
  3603                              <1> %if (%0!=1)
  3604 0000040C 83C410              <1>         add esp, byte %1_arglen
  3605                              <1> %endif
  3606 0000040F 66A1[30000000]              mov ax, word [_lineerror]
  3607 00000415 663D0000                    cmp ax, 0
  3608 00000419 7D38                        jge .NotNegativeError
  3609                                  
  3610 0000041B 660305[3C000000]            add ax, word [_errornodiaginc]
  3611 00000422 66A3[30000000]              mov word [_lineerror], ax		; lineerror = lineerror + errornodiaginc
  3612                                  
  3613 00000428 66A1[28000000]              mov ax, word [_x]
  3614 0000042E 660305[32000000]            add ax, word [_xhorizinc]
  3615 00000435 66A3[28000000]              mov word [_x], ax			; x = x + xhorizinc
  3616                                  
  3617 0000043B 66A1[2A000000]              mov ax, word [_y]
  3618 00000441 660305[36000000]            add ax, word [_yvertinc]
  3619 00000448 66A3[2A000000]              mov word [_y], ax			; y = y + yvertinc
  3620 0000044E E933000000                  jmp near .CheckCounter
  3621                                  
  3622                                  
  3623                                    ;-----------------
  3624                                    .NotNegativeError:
  3625                                    ;-----------------
  3626 00000453 660305[3A000000]             add ax, word [_errordiaginc]
  3627 0000045A 66A3[30000000]               mov word [_lineerror], ax		; lineerror = lineerror + errordiaginc
  3628                                  
  3629 00000460 66A1[28000000]               mov ax, word [_x]
  3630 00000466 660305[34000000]             add ax, word [_xdiaginc]
  3631 0000046D 66A3[28000000]               mov word [_x], ax			; x = x + xdiaginc
  3632                                  
  3633 00000473 66A1[2A000000]               mov ax, word [_y]
  3634 00000479 660305[38000000]             add ax, word [_ydiaginc]
  3635 00000480 66A3[2A000000]               mov word [_y], ax			; y = y + ydiaginc
  3636                                  
  3637                                  
  3638                                    ;-------------
  3639                                    .CheckCounter:
  3640                                    ;-------------
  3641 00000486 6649                         dec cx				; loop PixelLoop as many times
  3642 00000488 0F855DFFFFFF                 jnz near .PixelLoop		; as there are pixels
  3643                                  
  3644                                  
  3645 0000048E 6659                        pop cx				; Restore registers
  3646 00000490 6658                        pop ax
  3647                                      ret
  3648                              <1> %ifnctx proc
  3649                              <1> 	ret	%1
  3650                              <1> %else
  3651 00000492 89EC                <1> 	mov	esp, ebp
  3652 00000494 5D                  <1> 	pop	ebp
  3653 00000495 C3                  <1> 	ret	%1
  3654                              <1> %endif
  3655                                  
  3656                                  endproc
  3657                              <1> %ifnctx proc
  3658                              <1> %error Mismatched `endproc'/`proc'
  3659                              <1> %else
  3660                              <1> 
  3661                              <1> 
  3662                              <1> %ifdef LEGACY_ENDPROC
  3663                              <1>         ret
  3664                              <1> %endif
  3665                              <1> 
  3666                              <1> 
  3667                              <1> 
  3668                              <1> 
  3669                              <1> 
  3670                              <1> 
  3671                              <1> 
  3672                              <1> 
  3673                              <1> 
  3674                              <1> %pop
  3675                              <1> %endif
  3676                                  _DrawLine_arglen	EQU	20
  3677                                  
  3678                                  
  3679                                  
  3680                                  
  3681                                  
  3682                                  
  3683                                  
  3684                                  
  3685                                  
  3686                                  ;-------------------------------------------------------------------------;
  3687                                  ; DrawRect()								  ;
  3688                                  ;									  ;
  3689                                  ;   void _DrawRect(dword DestOff, word DestWidth, word DestHeight,	  ;
  3690                                  ;                  word X1, word Y1, word X2, word Y2,			  ;
  3691                                  ;		   dword Color, dword FillRectFlag)			  ;
  3692                                  ;									  ;
  3693                                  ;   Inputs: DestOff = offset of an image buffer in memory		  ;
  3694                                  ;	    DestWidth = width of the buffer				  ;
  3695                                  ;	    DestHeight = height of the buffer				  ;
  3696                                  ;	    X1 = x coordinate of start point				  ;
  3697                                  ;	    Y1 = y coordinate of start point				  ;
  3698                                  ;	    X2 = x coordinate of end point				  ;
  3699                                  ;	    Y2 = y coordinate of end point				  ;
  3700                                  ;	    Color = color of rectangle to draw				  ;
  3701                                  ;	    FillRectFlag = flag to determine whether or not to fill	  ;
  3702                                  ;			   the rectangle				  ;
  3703                                  ;									  ;
  3704                                  ;   Outputs: Rectangle drawn to buffer, filled if necessary		  ;
  3705                                  ;									  ;
  3706                                  ;   Calls: _DrawLine, _FloodFill					  ;
  3707                                  ;									  ;
  3708                                  ;   Returns: none							  ;
  3709                                  ;									  ;
  3710                                  ;   Purpose: Draws a rectangle with color Color from point (X1,Y1)	  ;
  3711                                  ;	     to (X2,Y2) in the buffer pointed to by DestOff		  ;
  3712                                  ;									  ;
  3713                                  ;-------------------------------------------------------------------------;
  3714                                  proc _DrawRect
  3715                              <1> %push proc
  3716                              <1>           global %1
  3717 00000496 55                  <1> %1:       push  ebp
  3718 00000497 89E5                <1>           mov   ebp, esp
  3719                              <1> %assign %$arg 8
  3720                              <1> 
  3721                              <1> %define %$procname %1
  3722                                  .DestOff	arg	4
  3723                              <1> .DestOff       equ %$arg
  3724                              <1> 
  3725                              <1> 
  3726                              <1> %assign %$arg %1+%$arg
  3727                                  .DestWidth	arg	2
  3728                              <1> .DestWidth       equ %$arg
  3729                              <1> 
  3730                              <1> 
  3731                              <1> %assign %$arg %1+%$arg
  3732                                  .DestHeight	arg	2
  3733                              <1> .DestHeight       equ %$arg
  3734                              <1> 
  3735                              <1> 
  3736                              <1> %assign %$arg %1+%$arg
  3737                                  .X1		arg	2
  3738                              <1> .X1       equ %$arg
  3739                              <1> 
  3740                              <1> 
  3741                              <1> %assign %$arg %1+%$arg
  3742                                  .Y1		arg	2
  3743                              <1> .Y1       equ %$arg
  3744                              <1> 
  3745                              <1> 
  3746                              <1> %assign %$arg %1+%$arg
  3747                                  .X2		arg	2
  3748                              <1> .X2       equ %$arg
  3749                              <1> 
  3750                              <1> 
  3751                              <1> %assign %$arg %1+%$arg
  3752                                  .Y2		arg	2
  3753                              <1> .Y2       equ %$arg
  3754                              <1> 
  3755                              <1> 
  3756                              <1> %assign %$arg %1+%$arg
  3757                                  .Color		arg	4
  3758                              <1> .Color       equ %$arg
  3759                              <1> 
  3760                              <1> 
  3761                              <1> %assign %$arg %1+%$arg
  3762                                  .FillRectFlag	arg	4
  3763                              <1> .FillRectFlag       equ %$arg
  3764                              <1> 
  3765                              <1> 
  3766                              <1> %assign %$arg %1+%$arg
  3767                                  ;invoke	_libDrawRect, dword [ebp+.DestOff], word [ebp+.DestWidth], word [ebp+.DestHeight], word [ebp+.X1], word [ebp+.Y1], word [ebp+.X2], word [ebp+.Y2], dword [ebp+.Color], dword [ebp+.FillRectFlag]
  3768                                  ;ret
  3769                                  
  3770                                  
  3771                                  
  3772                                  
  3773                                   ; Draw the 4 lines of the rectangle
  3774                                   invoke	_DrawLine, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [ebp + .X1], word [ebp + .Y1], word [ebp + .X2], word [ebp + .Y1], dword [ebp + .Color]
  3775                              <1> %rotate -1
  3776                              <1> 
  3777                              <1> %rep (%0-1)
  3778                              <1> 
  3779                              <1> 
  3780                              <1> 
  3781                              <1> 
  3782                              <1> 
  3783                              <1> 
  3784                              <1> 
  3785                              <1>         %ifidni %1, cs
  3786                              <1>                 o16 push %1
  3787                              <1>         %elifidni %1, ds
  3788                              <1>                 o16 push %1
  3789                              <1>         %elifidni %1, es
  3790                              <1>                 o16 push %1
  3791                              <1>         %elifidni %1, fs
  3792                              <1>                 o16 push %1
  3793                              <1>         %elifidni %1, gs
  3794                              <1>                 o16 push %1
  3795                              <1>         %elifidni %1, word cs
  3796                              <1>                 o16 push %1
  3797                              <1>         %elifidni %1, word ds
  3798                              <1>                 o16 push %1
  3799                              <1>         %elifidni %1, word es
  3800                              <1>                 o16 push %1
  3801                              <1>         %elifidni %1, word fs
  3802                              <1>                 o16 push %1
  3803                              <1>         %elifidni %1, word gs
  3804                              <1>                 o16 push %1
  3805                              <1>         %else
  3806                              <1>                 push %1
  3807                              <1>         %endif
  3808                              <1> 
  3809                              <1>         %rotate -1
  3810                              <1> %endrep
  3811                              <2> 
  3812                              <2> 
  3813                              <2> 
  3814                              <2> 
  3815                              <2> 
  3816                              <2> 
  3817                              <2> 
  3818                              <2>         %ifidni %1, cs
  3819                              <2>                 o16 push %1
  3820                              <2>         %elifidni %1, ds
  3821                              <2>                 o16 push %1
  3822                              <2>         %elifidni %1, es
  3823                              <2>                 o16 push %1
  3824                              <2>         %elifidni %1, fs
  3825                              <2>                 o16 push %1
  3826                              <2>         %elifidni %1, gs
  3827                              <2>                 o16 push %1
  3828                              <2>         %elifidni %1, word cs
  3829                              <2>                 o16 push %1
  3830                              <2>         %elifidni %1, word ds
  3831                              <2>                 o16 push %1
  3832                              <2>         %elifidni %1, word es
  3833                              <2>                 o16 push %1
  3834                              <2>         %elifidni %1, word fs
  3835                              <2>                 o16 push %1
  3836                              <2>         %elifidni %1, word gs
  3837                              <2>                 o16 push %1
  3838                              <2>         %else
  3839 00000499 FF7518              <2>                 push %1
  3840                              <2>         %endif
  3841                              <2> 
  3842                              <2>         %rotate -1
  3843                              <2> 
  3844                              <2> 
  3845                              <2> 
  3846                              <2> 
  3847                              <2> 
  3848                              <2> 
  3849                              <2> 
  3850                              <2>         %ifidni %1, cs
  3851                              <2>                 o16 push %1
  3852                              <2>         %elifidni %1, ds
  3853                              <2>                 o16 push %1
  3854                              <2>         %elifidni %1, es
  3855                              <2>                 o16 push %1
  3856                              <2>         %elifidni %1, fs
  3857                              <2>                 o16 push %1
  3858                              <2>         %elifidni %1, gs
  3859                              <2>                 o16 push %1
  3860                              <2>         %elifidni %1, word cs
  3861                              <2>                 o16 push %1
  3862                              <2>         %elifidni %1, word ds
  3863                              <2>                 o16 push %1
  3864                              <2>         %elifidni %1, word es
  3865                              <2>                 o16 push %1
  3866                              <2>         %elifidni %1, word fs
  3867                              <2>                 o16 push %1
  3868                              <2>         %elifidni %1, word gs
  3869                              <2>                 o16 push %1
  3870                              <2>         %else
  3871 0000049C 66FF7512            <2>                 push %1
  3872                              <2>         %endif
  3873                              <2> 
  3874                              <2>         %rotate -1
  3875                              <2> 
  3876                              <2> 
  3877                              <2> 
  3878                              <2> 
  3879                              <2> 
  3880                              <2> 
  3881                              <2> 
  3882                              <2>         %ifidni %1, cs
  3883                              <2>                 o16 push %1
  3884                              <2>         %elifidni %1, ds
  3885                              <2>                 o16 push %1
  3886                              <2>         %elifidni %1, es
  3887                              <2>                 o16 push %1
  3888                              <2>         %elifidni %1, fs
  3889                              <2>                 o16 push %1
  3890                              <2>         %elifidni %1, gs
  3891                              <2>                 o16 push %1
  3892                              <2>         %elifidni %1, word cs
  3893                              <2>                 o16 push %1
  3894                              <2>         %elifidni %1, word ds
  3895                              <2>                 o16 push %1
  3896                              <2>         %elifidni %1, word es
  3897                              <2>                 o16 push %1
  3898                              <2>         %elifidni %1, word fs
  3899                              <2>                 o16 push %1
  3900                              <2>         %elifidni %1, word gs
  3901                              <2>                 o16 push %1
  3902                              <2>         %else
  3903 000004A0 66FF7514            <2>                 push %1
  3904                              <2>         %endif
  3905                              <2> 
  3906                              <2>         %rotate -1
  3907                              <2> 
  3908                              <2> 
  3909                              <2> 
  3910                              <2> 
  3911                              <2> 
  3912                              <2> 
  3913                              <2> 
  3914                              <2>         %ifidni %1, cs
  3915                              <2>                 o16 push %1
  3916                              <2>         %elifidni %1, ds
  3917                              <2>                 o16 push %1
  3918                              <2>         %elifidni %1, es
  3919                              <2>                 o16 push %1
  3920                              <2>         %elifidni %1, fs
  3921                              <2>                 o16 push %1
  3922                              <2>         %elifidni %1, gs
  3923                              <2>                 o16 push %1
  3924                              <2>         %elifidni %1, word cs
  3925                              <2>                 o16 push %1
  3926                              <2>         %elifidni %1, word ds
  3927                              <2>                 o16 push %1
  3928                              <2>         %elifidni %1, word es
  3929                              <2>                 o16 push %1
  3930                              <2>         %elifidni %1, word fs
  3931                              <2>                 o16 push %1
  3932                              <2>         %elifidni %1, word gs
  3933                              <2>                 o16 push %1
  3934                              <2>         %else
  3935 000004A4 66FF7512            <2>                 push %1
  3936                              <2>         %endif
  3937                              <2> 
  3938                              <2>         %rotate -1
  3939                              <2> 
  3940                              <2> 
  3941                              <2> 
  3942                              <2> 
  3943                              <2> 
  3944                              <2> 
  3945                              <2> 
  3946                              <2>         %ifidni %1, cs
  3947                              <2>                 o16 push %1
  3948                              <2>         %elifidni %1, ds
  3949                              <2>                 o16 push %1
  3950                              <2>         %elifidni %1, es
  3951                              <2>                 o16 push %1
  3952                              <2>         %elifidni %1, fs
  3953                              <2>                 o16 push %1
  3954                              <2>         %elifidni %1, gs
  3955                              <2>                 o16 push %1
  3956                              <2>         %elifidni %1, word cs
  3957                              <2>                 o16 push %1
  3958                              <2>         %elifidni %1, word ds
  3959                              <2>                 o16 push %1
  3960                              <2>         %elifidni %1, word es
  3961                              <2>                 o16 push %1
  3962                              <2>         %elifidni %1, word fs
  3963                              <2>                 o16 push %1
  3964                              <2>         %elifidni %1, word gs
  3965                              <2>                 o16 push %1
  3966                              <2>         %else
  3967 000004A8 66FF7510            <2>                 push %1
  3968                              <2>         %endif
  3969                              <2> 
  3970                              <2>         %rotate -1
  3971                              <2> 
  3972                              <2> 
  3973                              <2> 
  3974                              <2> 
  3975                              <2> 
  3976                              <2> 
  3977                              <2> 
  3978                              <2>         %ifidni %1, cs
  3979                              <2>                 o16 push %1
  3980                              <2>         %elifidni %1, ds
  3981                              <2>                 o16 push %1
  3982                              <2>         %elifidni %1, es
  3983                              <2>                 o16 push %1
  3984                              <2>         %elifidni %1, fs
  3985                              <2>                 o16 push %1
  3986                              <2>         %elifidni %1, gs
  3987                              <2>                 o16 push %1
  3988                              <2>         %elifidni %1, word cs
  3989                              <2>                 o16 push %1
  3990                              <2>         %elifidni %1, word ds
  3991                              <2>                 o16 push %1
  3992                              <2>         %elifidni %1, word es
  3993                              <2>                 o16 push %1
  3994                              <2>         %elifidni %1, word fs
  3995                              <2>                 o16 push %1
  3996                              <2>         %elifidni %1, word gs
  3997                              <2>                 o16 push %1
  3998                              <2>         %else
  3999 000004AC 66FF750E            <2>                 push %1
  4000                              <2>         %endif
  4001                              <2> 
  4002                              <2>         %rotate -1
  4003                              <2> 
  4004                              <2> 
  4005                              <2> 
  4006                              <2> 
  4007                              <2> 
  4008                              <2> 
  4009                              <2> 
  4010                              <2>         %ifidni %1, cs
  4011                              <2>                 o16 push %1
  4012                              <2>         %elifidni %1, ds
  4013                              <2>                 o16 push %1
  4014                              <2>         %elifidni %1, es
  4015                              <2>                 o16 push %1
  4016                              <2>         %elifidni %1, fs
  4017                              <2>                 o16 push %1
  4018                              <2>         %elifidni %1, gs
  4019                              <2>                 o16 push %1
  4020                              <2>         %elifidni %1, word cs
  4021                              <2>                 o16 push %1
  4022                              <2>         %elifidni %1, word ds
  4023                              <2>                 o16 push %1
  4024                              <2>         %elifidni %1, word es
  4025                              <2>                 o16 push %1
  4026                              <2>         %elifidni %1, word fs
  4027                              <2>                 o16 push %1
  4028                              <2>         %elifidni %1, word gs
  4029                              <2>                 o16 push %1
  4030                              <2>         %else
  4031 000004B0 66FF750C            <2>                 push %1
  4032                              <2>         %endif
  4033                              <2> 
  4034                              <2>         %rotate -1
  4035                              <2> 
  4036                              <2> 
  4037                              <2> 
  4038                              <2> 
  4039                              <2> 
  4040                              <2> 
  4041                              <2> 
  4042                              <2>         %ifidni %1, cs
  4043                              <2>                 o16 push %1
  4044                              <2>         %elifidni %1, ds
  4045                              <2>                 o16 push %1
  4046                              <2>         %elifidni %1, es
  4047                              <2>                 o16 push %1
  4048                              <2>         %elifidni %1, fs
  4049                              <2>                 o16 push %1
  4050                              <2>         %elifidni %1, gs
  4051                              <2>                 o16 push %1
  4052                              <2>         %elifidni %1, word cs
  4053                              <2>                 o16 push %1
  4054                              <2>         %elifidni %1, word ds
  4055                              <2>                 o16 push %1
  4056                              <2>         %elifidni %1, word es
  4057                              <2>                 o16 push %1
  4058                              <2>         %elifidni %1, word fs
  4059                              <2>                 o16 push %1
  4060                              <2>         %elifidni %1, word gs
  4061                              <2>                 o16 push %1
  4062                              <2>         %else
  4063 000004B4 FF7508              <2>                 push %1
  4064                              <2>         %endif
  4065                              <2> 
  4066                              <2>         %rotate -1
  4067 000004B7 E8EEFDFFFF          <1> call %1
  4068                              <1> %if (%0!=1)
  4069 000004BC 83C414              <1>         add esp, byte %1_arglen
  4070                              <1> %endif
  4071                                   invoke	_DrawLine, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [ebp + .X1], word [ebp + .Y1], word [ebp + .X1], word [ebp + .Y2], dword [ebp + .Color]
  4072                              <1> %rotate -1
  4073                              <1> 
  4074                              <1> %rep (%0-1)
  4075                              <1> 
  4076                              <1> 
  4077                              <1> 
  4078                              <1> 
  4079                              <1> 
  4080                              <1> 
  4081                              <1> 
  4082                              <1>         %ifidni %1, cs
  4083                              <1>                 o16 push %1
  4084                              <1>         %elifidni %1, ds
  4085                              <1>                 o16 push %1
  4086                              <1>         %elifidni %1, es
  4087                              <1>                 o16 push %1
  4088                              <1>         %elifidni %1, fs
  4089                              <1>                 o16 push %1
  4090                              <1>         %elifidni %1, gs
  4091                              <1>                 o16 push %1
  4092                              <1>         %elifidni %1, word cs
  4093                              <1>                 o16 push %1
  4094                              <1>         %elifidni %1, word ds
  4095                              <1>                 o16 push %1
  4096                              <1>         %elifidni %1, word es
  4097                              <1>                 o16 push %1
  4098                              <1>         %elifidni %1, word fs
  4099                              <1>                 o16 push %1
  4100                              <1>         %elifidni %1, word gs
  4101                              <1>                 o16 push %1
  4102                              <1>         %else
  4103                              <1>                 push %1
  4104                              <1>         %endif
  4105                              <1> 
  4106                              <1>         %rotate -1
  4107                              <1> %endrep
  4108                              <2> 
  4109                              <2> 
  4110                              <2> 
  4111                              <2> 
  4112                              <2> 
  4113                              <2> 
  4114                              <2> 
  4115                              <2>         %ifidni %1, cs
  4116                              <2>                 o16 push %1
  4117                              <2>         %elifidni %1, ds
  4118                              <2>                 o16 push %1
  4119                              <2>         %elifidni %1, es
  4120                              <2>                 o16 push %1
  4121                              <2>         %elifidni %1, fs
  4122                              <2>                 o16 push %1
  4123                              <2>         %elifidni %1, gs
  4124                              <2>                 o16 push %1
  4125                              <2>         %elifidni %1, word cs
  4126                              <2>                 o16 push %1
  4127                              <2>         %elifidni %1, word ds
  4128                              <2>                 o16 push %1
  4129                              <2>         %elifidni %1, word es
  4130                              <2>                 o16 push %1
  4131                              <2>         %elifidni %1, word fs
  4132                              <2>                 o16 push %1
  4133                              <2>         %elifidni %1, word gs
  4134                              <2>                 o16 push %1
  4135                              <2>         %else
  4136 000004BF FF7518              <2>                 push %1
  4137                              <2>         %endif
  4138                              <2> 
  4139                              <2>         %rotate -1
  4140                              <2> 
  4141                              <2> 
  4142                              <2> 
  4143                              <2> 
  4144                              <2> 
  4145                              <2> 
  4146                              <2> 
  4147                              <2>         %ifidni %1, cs
  4148                              <2>                 o16 push %1
  4149                              <2>         %elifidni %1, ds
  4150                              <2>                 o16 push %1
  4151                              <2>         %elifidni %1, es
  4152                              <2>                 o16 push %1
  4153                              <2>         %elifidni %1, fs
  4154                              <2>                 o16 push %1
  4155                              <2>         %elifidni %1, gs
  4156                              <2>                 o16 push %1
  4157                              <2>         %elifidni %1, word cs
  4158                              <2>                 o16 push %1
  4159                              <2>         %elifidni %1, word ds
  4160                              <2>                 o16 push %1
  4161                              <2>         %elifidni %1, word es
  4162                              <2>                 o16 push %1
  4163                              <2>         %elifidni %1, word fs
  4164                              <2>                 o16 push %1
  4165                              <2>         %elifidni %1, word gs
  4166                              <2>                 o16 push %1
  4167                              <2>         %else
  4168 000004C2 66FF7516            <2>                 push %1
  4169                              <2>         %endif
  4170                              <2> 
  4171                              <2>         %rotate -1
  4172                              <2> 
  4173                              <2> 
  4174                              <2> 
  4175                              <2> 
  4176                              <2> 
  4177                              <2> 
  4178                              <2> 
  4179                              <2>         %ifidni %1, cs
  4180                              <2>                 o16 push %1
  4181                              <2>         %elifidni %1, ds
  4182                              <2>                 o16 push %1
  4183                              <2>         %elifidni %1, es
  4184                              <2>                 o16 push %1
  4185                              <2>         %elifidni %1, fs
  4186                              <2>                 o16 push %1
  4187                              <2>         %elifidni %1, gs
  4188                              <2>                 o16 push %1
  4189                              <2>         %elifidni %1, word cs
  4190                              <2>                 o16 push %1
  4191                              <2>         %elifidni %1, word ds
  4192                              <2>                 o16 push %1
  4193                              <2>         %elifidni %1, word es
  4194                              <2>                 o16 push %1
  4195                              <2>         %elifidni %1, word fs
  4196                              <2>                 o16 push %1
  4197                              <2>         %elifidni %1, word gs
  4198                              <2>                 o16 push %1
  4199                              <2>         %else
  4200 000004C6 66FF7510            <2>                 push %1
  4201                              <2>         %endif
  4202                              <2> 
  4203                              <2>         %rotate -1
  4204                              <2> 
  4205                              <2> 
  4206                              <2> 
  4207                              <2> 
  4208                              <2> 
  4209                              <2> 
  4210                              <2> 
  4211                              <2>         %ifidni %1, cs
  4212                              <2>                 o16 push %1
  4213                              <2>         %elifidni %1, ds
  4214                              <2>                 o16 push %1
  4215                              <2>         %elifidni %1, es
  4216                              <2>                 o16 push %1
  4217                              <2>         %elifidni %1, fs
  4218                              <2>                 o16 push %1
  4219                              <2>         %elifidni %1, gs
  4220                              <2>                 o16 push %1
  4221                              <2>         %elifidni %1, word cs
  4222                              <2>                 o16 push %1
  4223                              <2>         %elifidni %1, word ds
  4224                              <2>                 o16 push %1
  4225                              <2>         %elifidni %1, word es
  4226                              <2>                 o16 push %1
  4227                              <2>         %elifidni %1, word fs
  4228                              <2>                 o16 push %1
  4229                              <2>         %elifidni %1, word gs
  4230                              <2>                 o16 push %1
  4231                              <2>         %else
  4232 000004CA 66FF7512            <2>                 push %1
  4233                              <2>         %endif
  4234                              <2> 
  4235                              <2>         %rotate -1
  4236                              <2> 
  4237                              <2> 
  4238                              <2> 
  4239                              <2> 
  4240                              <2> 
  4241                              <2> 
  4242                              <2> 
  4243                              <2>         %ifidni %1, cs
  4244                              <2>                 o16 push %1
  4245                              <2>         %elifidni %1, ds
  4246                              <2>                 o16 push %1
  4247                              <2>         %elifidni %1, es
  4248                              <2>                 o16 push %1
  4249                              <2>         %elifidni %1, fs
  4250                              <2>                 o16 push %1
  4251                              <2>         %elifidni %1, gs
  4252                              <2>                 o16 push %1
  4253                              <2>         %elifidni %1, word cs
  4254                              <2>                 o16 push %1
  4255                              <2>         %elifidni %1, word ds
  4256                              <2>                 o16 push %1
  4257                              <2>         %elifidni %1, word es
  4258                              <2>                 o16 push %1
  4259                              <2>         %elifidni %1, word fs
  4260                              <2>                 o16 push %1
  4261                              <2>         %elifidni %1, word gs
  4262                              <2>                 o16 push %1
  4263                              <2>         %else
  4264 000004CE 66FF7510            <2>                 push %1
  4265                              <2>         %endif
  4266                              <2> 
  4267                              <2>         %rotate -1
  4268                              <2> 
  4269                              <2> 
  4270                              <2> 
  4271                              <2> 
  4272                              <2> 
  4273                              <2> 
  4274                              <2> 
  4275                              <2>         %ifidni %1, cs
  4276                              <2>                 o16 push %1
  4277                              <2>         %elifidni %1, ds
  4278                              <2>                 o16 push %1
  4279                              <2>         %elifidni %1, es
  4280                              <2>                 o16 push %1
  4281                              <2>         %elifidni %1, fs
  4282                              <2>                 o16 push %1
  4283                              <2>         %elifidni %1, gs
  4284                              <2>                 o16 push %1
  4285                              <2>         %elifidni %1, word cs
  4286                              <2>                 o16 push %1
  4287                              <2>         %elifidni %1, word ds
  4288                              <2>                 o16 push %1
  4289                              <2>         %elifidni %1, word es
  4290                              <2>                 o16 push %1
  4291                              <2>         %elifidni %1, word fs
  4292                              <2>                 o16 push %1
  4293                              <2>         %elifidni %1, word gs
  4294                              <2>                 o16 push %1
  4295                              <2>         %else
  4296 000004D2 66FF750E            <2>                 push %1
  4297                              <2>         %endif
  4298                              <2> 
  4299                              <2>         %rotate -1
  4300                              <2> 
  4301                              <2> 
  4302                              <2> 
  4303                              <2> 
  4304                              <2> 
  4305                              <2> 
  4306                              <2> 
  4307                              <2>         %ifidni %1, cs
  4308                              <2>                 o16 push %1
  4309                              <2>         %elifidni %1, ds
  4310                              <2>                 o16 push %1
  4311                              <2>         %elifidni %1, es
  4312                              <2>                 o16 push %1
  4313                              <2>         %elifidni %1, fs
  4314                              <2>                 o16 push %1
  4315                              <2>         %elifidni %1, gs
  4316                              <2>                 o16 push %1
  4317                              <2>         %elifidni %1, word cs
  4318                              <2>                 o16 push %1
  4319                              <2>         %elifidni %1, word ds
  4320                              <2>                 o16 push %1
  4321                              <2>         %elifidni %1, word es
  4322                              <2>                 o16 push %1
  4323                              <2>         %elifidni %1, word fs
  4324                              <2>                 o16 push %1
  4325                              <2>         %elifidni %1, word gs
  4326                              <2>                 o16 push %1
  4327                              <2>         %else
  4328 000004D6 66FF750C            <2>                 push %1
  4329                              <2>         %endif
  4330                              <2> 
  4331                              <2>         %rotate -1
  4332                              <2> 
  4333                              <2> 
  4334                              <2> 
  4335                              <2> 
  4336                              <2> 
  4337                              <2> 
  4338                              <2> 
  4339                              <2>         %ifidni %1, cs
  4340                              <2>                 o16 push %1
  4341                              <2>         %elifidni %1, ds
  4342                              <2>                 o16 push %1
  4343                              <2>         %elifidni %1, es
  4344                              <2>                 o16 push %1
  4345                              <2>         %elifidni %1, fs
  4346                              <2>                 o16 push %1
  4347                              <2>         %elifidni %1, gs
  4348                              <2>                 o16 push %1
  4349                              <2>         %elifidni %1, word cs
  4350                              <2>                 o16 push %1
  4351                              <2>         %elifidni %1, word ds
  4352                              <2>                 o16 push %1
  4353                              <2>         %elifidni %1, word es
  4354                              <2>                 o16 push %1
  4355                              <2>         %elifidni %1, word fs
  4356                              <2>                 o16 push %1
  4357                              <2>         %elifidni %1, word gs
  4358                              <2>                 o16 push %1
  4359                              <2>         %else
  4360 000004DA FF7508              <2>                 push %1
  4361                              <2>         %endif
  4362                              <2> 
  4363                              <2>         %rotate -1
  4364 000004DD E8C8FDFFFF          <1> call %1
  4365                              <1> %if (%0!=1)
  4366 000004E2 83C414              <1>         add esp, byte %1_arglen
  4367                              <1> %endif
  4368                                   invoke	_DrawLine, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [ebp + .X1], word [ebp + .Y2], word [ebp + .X2], word [ebp + .Y2], dword [ebp + .Color]
  4369                              <1> %rotate -1
  4370                              <1> 
  4371                              <1> %rep (%0-1)
  4372                              <1> 
  4373                              <1> 
  4374                              <1> 
  4375                              <1> 
  4376                              <1> 
  4377                              <1> 
  4378                              <1> 
  4379                              <1>         %ifidni %1, cs
  4380                              <1>                 o16 push %1
  4381                              <1>         %elifidni %1, ds
  4382                              <1>                 o16 push %1
  4383                              <1>         %elifidni %1, es
  4384                              <1>                 o16 push %1
  4385                              <1>         %elifidni %1, fs
  4386                              <1>                 o16 push %1
  4387                              <1>         %elifidni %1, gs
  4388                              <1>                 o16 push %1
  4389                              <1>         %elifidni %1, word cs
  4390                              <1>                 o16 push %1
  4391                              <1>         %elifidni %1, word ds
  4392                              <1>                 o16 push %1
  4393                              <1>         %elifidni %1, word es
  4394                              <1>                 o16 push %1
  4395                              <1>         %elifidni %1, word fs
  4396                              <1>                 o16 push %1
  4397                              <1>         %elifidni %1, word gs
  4398                              <1>                 o16 push %1
  4399                              <1>         %else
  4400                              <1>                 push %1
  4401                              <1>         %endif
  4402                              <1> 
  4403                              <1>         %rotate -1
  4404                              <1> %endrep
  4405                              <2> 
  4406                              <2> 
  4407                              <2> 
  4408                              <2> 
  4409                              <2> 
  4410                              <2> 
  4411                              <2> 
  4412                              <2>         %ifidni %1, cs
  4413                              <2>                 o16 push %1
  4414                              <2>         %elifidni %1, ds
  4415                              <2>                 o16 push %1
  4416                              <2>         %elifidni %1, es
  4417                              <2>                 o16 push %1
  4418                              <2>         %elifidni %1, fs
  4419                              <2>                 o16 push %1
  4420                              <2>         %elifidni %1, gs
  4421                              <2>                 o16 push %1
  4422                              <2>         %elifidni %1, word cs
  4423                              <2>                 o16 push %1
  4424                              <2>         %elifidni %1, word ds
  4425                              <2>                 o16 push %1
  4426                              <2>         %elifidni %1, word es
  4427                              <2>                 o16 push %1
  4428                              <2>         %elifidni %1, word fs
  4429                              <2>                 o16 push %1
  4430                              <2>         %elifidni %1, word gs
  4431                              <2>                 o16 push %1
  4432                              <2>         %else
  4433 000004E5 FF7518              <2>                 push %1
  4434                              <2>         %endif
  4435                              <2> 
  4436                              <2>         %rotate -1
  4437                              <2> 
  4438                              <2> 
  4439                              <2> 
  4440                              <2> 
  4441                              <2> 
  4442                              <2> 
  4443                              <2> 
  4444                              <2>         %ifidni %1, cs
  4445                              <2>                 o16 push %1
  4446                              <2>         %elifidni %1, ds
  4447                              <2>                 o16 push %1
  4448                              <2>         %elifidni %1, es
  4449                              <2>                 o16 push %1
  4450                              <2>         %elifidni %1, fs
  4451                              <2>                 o16 push %1
  4452                              <2>         %elifidni %1, gs
  4453                              <2>                 o16 push %1
  4454                              <2>         %elifidni %1, word cs
  4455                              <2>                 o16 push %1
  4456                              <2>         %elifidni %1, word ds
  4457                              <2>                 o16 push %1
  4458                              <2>         %elifidni %1, word es
  4459                              <2>                 o16 push %1
  4460                              <2>         %elifidni %1, word fs
  4461                              <2>                 o16 push %1
  4462                              <2>         %elifidni %1, word gs
  4463                              <2>                 o16 push %1
  4464                              <2>         %else
  4465 000004E8 66FF7516            <2>                 push %1
  4466                              <2>         %endif
  4467                              <2> 
  4468                              <2>         %rotate -1
  4469                              <2> 
  4470                              <2> 
  4471                              <2> 
  4472                              <2> 
  4473                              <2> 
  4474                              <2> 
  4475                              <2> 
  4476                              <2>         %ifidni %1, cs
  4477                              <2>                 o16 push %1
  4478                              <2>         %elifidni %1, ds
  4479                              <2>                 o16 push %1
  4480                              <2>         %elifidni %1, es
  4481                              <2>                 o16 push %1
  4482                              <2>         %elifidni %1, fs
  4483                              <2>                 o16 push %1
  4484                              <2>         %elifidni %1, gs
  4485                              <2>                 o16 push %1
  4486                              <2>         %elifidni %1, word cs
  4487                              <2>                 o16 push %1
  4488                              <2>         %elifidni %1, word ds
  4489                              <2>                 o16 push %1
  4490                              <2>         %elifidni %1, word es
  4491                              <2>                 o16 push %1
  4492                              <2>         %elifidni %1, word fs
  4493                              <2>                 o16 push %1
  4494                              <2>         %elifidni %1, word gs
  4495                              <2>                 o16 push %1
  4496                              <2>         %else
  4497 000004EC 66FF7514            <2>                 push %1
  4498                              <2>         %endif
  4499                              <2> 
  4500                              <2>         %rotate -1
  4501                              <2> 
  4502                              <2> 
  4503                              <2> 
  4504                              <2> 
  4505                              <2> 
  4506                              <2> 
  4507                              <2> 
  4508                              <2>         %ifidni %1, cs
  4509                              <2>                 o16 push %1
  4510                              <2>         %elifidni %1, ds
  4511                              <2>                 o16 push %1
  4512                              <2>         %elifidni %1, es
  4513                              <2>                 o16 push %1
  4514                              <2>         %elifidni %1, fs
  4515                              <2>                 o16 push %1
  4516                              <2>         %elifidni %1, gs
  4517                              <2>                 o16 push %1
  4518                              <2>         %elifidni %1, word cs
  4519                              <2>                 o16 push %1
  4520                              <2>         %elifidni %1, word ds
  4521                              <2>                 o16 push %1
  4522                              <2>         %elifidni %1, word es
  4523                              <2>                 o16 push %1
  4524                              <2>         %elifidni %1, word fs
  4525                              <2>                 o16 push %1
  4526                              <2>         %elifidni %1, word gs
  4527                              <2>                 o16 push %1
  4528                              <2>         %else
  4529 000004F0 66FF7516            <2>                 push %1
  4530                              <2>         %endif
  4531                              <2> 
  4532                              <2>         %rotate -1
  4533                              <2> 
  4534                              <2> 
  4535                              <2> 
  4536                              <2> 
  4537                              <2> 
  4538                              <2> 
  4539                              <2> 
  4540                              <2>         %ifidni %1, cs
  4541                              <2>                 o16 push %1
  4542                              <2>         %elifidni %1, ds
  4543                              <2>                 o16 push %1
  4544                              <2>         %elifidni %1, es
  4545                              <2>                 o16 push %1
  4546                              <2>         %elifidni %1, fs
  4547                              <2>                 o16 push %1
  4548                              <2>         %elifidni %1, gs
  4549                              <2>                 o16 push %1
  4550                              <2>         %elifidni %1, word cs
  4551                              <2>                 o16 push %1
  4552                              <2>         %elifidni %1, word ds
  4553                              <2>                 o16 push %1
  4554                              <2>         %elifidni %1, word es
  4555                              <2>                 o16 push %1
  4556                              <2>         %elifidni %1, word fs
  4557                              <2>                 o16 push %1
  4558                              <2>         %elifidni %1, word gs
  4559                              <2>                 o16 push %1
  4560                              <2>         %else
  4561 000004F4 66FF7510            <2>                 push %1
  4562                              <2>         %endif
  4563                              <2> 
  4564                              <2>         %rotate -1
  4565                              <2> 
  4566                              <2> 
  4567                              <2> 
  4568                              <2> 
  4569                              <2> 
  4570                              <2> 
  4571                              <2> 
  4572                              <2>         %ifidni %1, cs
  4573                              <2>                 o16 push %1
  4574                              <2>         %elifidni %1, ds
  4575                              <2>                 o16 push %1
  4576                              <2>         %elifidni %1, es
  4577                              <2>                 o16 push %1
  4578                              <2>         %elifidni %1, fs
  4579                              <2>                 o16 push %1
  4580                              <2>         %elifidni %1, gs
  4581                              <2>                 o16 push %1
  4582                              <2>         %elifidni %1, word cs
  4583                              <2>                 o16 push %1
  4584                              <2>         %elifidni %1, word ds
  4585                              <2>                 o16 push %1
  4586                              <2>         %elifidni %1, word es
  4587                              <2>                 o16 push %1
  4588                              <2>         %elifidni %1, word fs
  4589                              <2>                 o16 push %1
  4590                              <2>         %elifidni %1, word gs
  4591                              <2>                 o16 push %1
  4592                              <2>         %else
  4593 000004F8 66FF750E            <2>                 push %1
  4594                              <2>         %endif
  4595                              <2> 
  4596                              <2>         %rotate -1
  4597                              <2> 
  4598                              <2> 
  4599                              <2> 
  4600                              <2> 
  4601                              <2> 
  4602                              <2> 
  4603                              <2> 
  4604                              <2>         %ifidni %1, cs
  4605                              <2>                 o16 push %1
  4606                              <2>         %elifidni %1, ds
  4607                              <2>                 o16 push %1
  4608                              <2>         %elifidni %1, es
  4609                              <2>                 o16 push %1
  4610                              <2>         %elifidni %1, fs
  4611                              <2>                 o16 push %1
  4612                              <2>         %elifidni %1, gs
  4613                              <2>                 o16 push %1
  4614                              <2>         %elifidni %1, word cs
  4615                              <2>                 o16 push %1
  4616                              <2>         %elifidni %1, word ds
  4617                              <2>                 o16 push %1
  4618                              <2>         %elifidni %1, word es
  4619                              <2>                 o16 push %1
  4620                              <2>         %elifidni %1, word fs
  4621                              <2>                 o16 push %1
  4622                              <2>         %elifidni %1, word gs
  4623                              <2>                 o16 push %1
  4624                              <2>         %else
  4625 000004FC 66FF750C            <2>                 push %1
  4626                              <2>         %endif
  4627                              <2> 
  4628                              <2>         %rotate -1
  4629                              <2> 
  4630                              <2> 
  4631                              <2> 
  4632                              <2> 
  4633                              <2> 
  4634                              <2> 
  4635                              <2> 
  4636                              <2>         %ifidni %1, cs
  4637                              <2>                 o16 push %1
  4638                              <2>         %elifidni %1, ds
  4639                              <2>                 o16 push %1
  4640                              <2>         %elifidni %1, es
  4641                              <2>                 o16 push %1
  4642                              <2>         %elifidni %1, fs
  4643                              <2>                 o16 push %1
  4644                              <2>         %elifidni %1, gs
  4645                              <2>                 o16 push %1
  4646                              <2>         %elifidni %1, word cs
  4647                              <2>                 o16 push %1
  4648                              <2>         %elifidni %1, word ds
  4649                              <2>                 o16 push %1
  4650                              <2>         %elifidni %1, word es
  4651                              <2>                 o16 push %1
  4652                              <2>         %elifidni %1, word fs
  4653                              <2>                 o16 push %1
  4654                              <2>         %elifidni %1, word gs
  4655                              <2>                 o16 push %1
  4656                              <2>         %else
  4657 00000500 FF7508              <2>                 push %1
  4658                              <2>         %endif
  4659                              <2> 
  4660                              <2>         %rotate -1
  4661 00000503 E8A2FDFFFF          <1> call %1
  4662                              <1> %if (%0!=1)
  4663 00000508 83C414              <1>         add esp, byte %1_arglen
  4664                              <1> %endif
  4665                                   invoke	_DrawLine, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [ebp + .X2], word [ebp + .Y1], word [ebp + .X2], word [ebp + .Y2], dword [ebp + .Color]
  4666                              <1> %rotate -1
  4667                              <1> 
  4668                              <1> %rep (%0-1)
  4669                              <1> 
  4670                              <1> 
  4671                              <1> 
  4672                              <1> 
  4673                              <1> 
  4674                              <1> 
  4675                              <1> 
  4676                              <1>         %ifidni %1, cs
  4677                              <1>                 o16 push %1
  4678                              <1>         %elifidni %1, ds
  4679                              <1>                 o16 push %1
  4680                              <1>         %elifidni %1, es
  4681                              <1>                 o16 push %1
  4682                              <1>         %elifidni %1, fs
  4683                              <1>                 o16 push %1
  4684                              <1>         %elifidni %1, gs
  4685                              <1>                 o16 push %1
  4686                              <1>         %elifidni %1, word cs
  4687                              <1>                 o16 push %1
  4688                              <1>         %elifidni %1, word ds
  4689                              <1>                 o16 push %1
  4690                              <1>         %elifidni %1, word es
  4691                              <1>                 o16 push %1
  4692                              <1>         %elifidni %1, word fs
  4693                              <1>                 o16 push %1
  4694                              <1>         %elifidni %1, word gs
  4695                              <1>                 o16 push %1
  4696                              <1>         %else
  4697                              <1>                 push %1
  4698                              <1>         %endif
  4699                              <1> 
  4700                              <1>         %rotate -1
  4701                              <1> %endrep
  4702                              <2> 
  4703                              <2> 
  4704                              <2> 
  4705                              <2> 
  4706                              <2> 
  4707                              <2> 
  4708                              <2> 
  4709                              <2>         %ifidni %1, cs
  4710                              <2>                 o16 push %1
  4711                              <2>         %elifidni %1, ds
  4712                              <2>                 o16 push %1
  4713                              <2>         %elifidni %1, es
  4714                              <2>                 o16 push %1
  4715                              <2>         %elifidni %1, fs
  4716                              <2>                 o16 push %1
  4717                              <2>         %elifidni %1, gs
  4718                              <2>                 o16 push %1
  4719                              <2>         %elifidni %1, word cs
  4720                              <2>                 o16 push %1
  4721                              <2>         %elifidni %1, word ds
  4722                              <2>                 o16 push %1
  4723                              <2>         %elifidni %1, word es
  4724                              <2>                 o16 push %1
  4725                              <2>         %elifidni %1, word fs
  4726                              <2>                 o16 push %1
  4727                              <2>         %elifidni %1, word gs
  4728                              <2>                 o16 push %1
  4729                              <2>         %else
  4730 0000050B FF7518              <2>                 push %1
  4731                              <2>         %endif
  4732                              <2> 
  4733                              <2>         %rotate -1
  4734                              <2> 
  4735                              <2> 
  4736                              <2> 
  4737                              <2> 
  4738                              <2> 
  4739                              <2> 
  4740                              <2> 
  4741                              <2>         %ifidni %1, cs
  4742                              <2>                 o16 push %1
  4743                              <2>         %elifidni %1, ds
  4744                              <2>                 o16 push %1
  4745                              <2>         %elifidni %1, es
  4746                              <2>                 o16 push %1
  4747                              <2>         %elifidni %1, fs
  4748                              <2>                 o16 push %1
  4749                              <2>         %elifidni %1, gs
  4750                              <2>                 o16 push %1
  4751                              <2>         %elifidni %1, word cs
  4752                              <2>                 o16 push %1
  4753                              <2>         %elifidni %1, word ds
  4754                              <2>                 o16 push %1
  4755                              <2>         %elifidni %1, word es
  4756                              <2>                 o16 push %1
  4757                              <2>         %elifidni %1, word fs
  4758                              <2>                 o16 push %1
  4759                              <2>         %elifidni %1, word gs
  4760                              <2>                 o16 push %1
  4761                              <2>         %else
  4762 0000050E 66FF7516            <2>                 push %1
  4763                              <2>         %endif
  4764                              <2> 
  4765                              <2>         %rotate -1
  4766                              <2> 
  4767                              <2> 
  4768                              <2> 
  4769                              <2> 
  4770                              <2> 
  4771                              <2> 
  4772                              <2> 
  4773                              <2>         %ifidni %1, cs
  4774                              <2>                 o16 push %1
  4775                              <2>         %elifidni %1, ds
  4776                              <2>                 o16 push %1
  4777                              <2>         %elifidni %1, es
  4778                              <2>                 o16 push %1
  4779                              <2>         %elifidni %1, fs
  4780                              <2>                 o16 push %1
  4781                              <2>         %elifidni %1, gs
  4782                              <2>                 o16 push %1
  4783                              <2>         %elifidni %1, word cs
  4784                              <2>                 o16 push %1
  4785                              <2>         %elifidni %1, word ds
  4786                              <2>                 o16 push %1
  4787                              <2>         %elifidni %1, word es
  4788                              <2>                 o16 push %1
  4789                              <2>         %elifidni %1, word fs
  4790                              <2>                 o16 push %1
  4791                              <2>         %elifidni %1, word gs
  4792                              <2>                 o16 push %1
  4793                              <2>         %else
  4794 00000512 66FF7514            <2>                 push %1
  4795                              <2>         %endif
  4796                              <2> 
  4797                              <2>         %rotate -1
  4798                              <2> 
  4799                              <2> 
  4800                              <2> 
  4801                              <2> 
  4802                              <2> 
  4803                              <2> 
  4804                              <2> 
  4805                              <2>         %ifidni %1, cs
  4806                              <2>                 o16 push %1
  4807                              <2>         %elifidni %1, ds
  4808                              <2>                 o16 push %1
  4809                              <2>         %elifidni %1, es
  4810                              <2>                 o16 push %1
  4811                              <2>         %elifidni %1, fs
  4812                              <2>                 o16 push %1
  4813                              <2>         %elifidni %1, gs
  4814                              <2>                 o16 push %1
  4815                              <2>         %elifidni %1, word cs
  4816                              <2>                 o16 push %1
  4817                              <2>         %elifidni %1, word ds
  4818                              <2>                 o16 push %1
  4819                              <2>         %elifidni %1, word es
  4820                              <2>                 o16 push %1
  4821                              <2>         %elifidni %1, word fs
  4822                              <2>                 o16 push %1
  4823                              <2>         %elifidni %1, word gs
  4824                              <2>                 o16 push %1
  4825                              <2>         %else
  4826 00000516 66FF7512            <2>                 push %1
  4827                              <2>         %endif
  4828                              <2> 
  4829                              <2>         %rotate -1
  4830                              <2> 
  4831                              <2> 
  4832                              <2> 
  4833                              <2> 
  4834                              <2> 
  4835                              <2> 
  4836                              <2> 
  4837                              <2>         %ifidni %1, cs
  4838                              <2>                 o16 push %1
  4839                              <2>         %elifidni %1, ds
  4840                              <2>                 o16 push %1
  4841                              <2>         %elifidni %1, es
  4842                              <2>                 o16 push %1
  4843                              <2>         %elifidni %1, fs
  4844                              <2>                 o16 push %1
  4845                              <2>         %elifidni %1, gs
  4846                              <2>                 o16 push %1
  4847                              <2>         %elifidni %1, word cs
  4848                              <2>                 o16 push %1
  4849                              <2>         %elifidni %1, word ds
  4850                              <2>                 o16 push %1
  4851                              <2>         %elifidni %1, word es
  4852                              <2>                 o16 push %1
  4853                              <2>         %elifidni %1, word fs
  4854                              <2>                 o16 push %1
  4855                              <2>         %elifidni %1, word gs
  4856                              <2>                 o16 push %1
  4857                              <2>         %else
  4858 0000051A 66FF7514            <2>                 push %1
  4859                              <2>         %endif
  4860                              <2> 
  4861                              <2>         %rotate -1
  4862                              <2> 
  4863                              <2> 
  4864                              <2> 
  4865                              <2> 
  4866                              <2> 
  4867                              <2> 
  4868                              <2> 
  4869                              <2>         %ifidni %1, cs
  4870                              <2>                 o16 push %1
  4871                              <2>         %elifidni %1, ds
  4872                              <2>                 o16 push %1
  4873                              <2>         %elifidni %1, es
  4874                              <2>                 o16 push %1
  4875                              <2>         %elifidni %1, fs
  4876                              <2>                 o16 push %1
  4877                              <2>         %elifidni %1, gs
  4878                              <2>                 o16 push %1
  4879                              <2>         %elifidni %1, word cs
  4880                              <2>                 o16 push %1
  4881                              <2>         %elifidni %1, word ds
  4882                              <2>                 o16 push %1
  4883                              <2>         %elifidni %1, word es
  4884                              <2>                 o16 push %1
  4885                              <2>         %elifidni %1, word fs
  4886                              <2>                 o16 push %1
  4887                              <2>         %elifidni %1, word gs
  4888                              <2>                 o16 push %1
  4889                              <2>         %else
  4890 0000051E 66FF750E            <2>                 push %1
  4891                              <2>         %endif
  4892                              <2> 
  4893                              <2>         %rotate -1
  4894                              <2> 
  4895                              <2> 
  4896                              <2> 
  4897                              <2> 
  4898                              <2> 
  4899                              <2> 
  4900                              <2> 
  4901                              <2>         %ifidni %1, cs
  4902                              <2>                 o16 push %1
  4903                              <2>         %elifidni %1, ds
  4904                              <2>                 o16 push %1
  4905                              <2>         %elifidni %1, es
  4906                              <2>                 o16 push %1
  4907                              <2>         %elifidni %1, fs
  4908                              <2>                 o16 push %1
  4909                              <2>         %elifidni %1, gs
  4910                              <2>                 o16 push %1
  4911                              <2>         %elifidni %1, word cs
  4912                              <2>                 o16 push %1
  4913                              <2>         %elifidni %1, word ds
  4914                              <2>                 o16 push %1
  4915                              <2>         %elifidni %1, word es
  4916                              <2>                 o16 push %1
  4917                              <2>         %elifidni %1, word fs
  4918                              <2>                 o16 push %1
  4919                              <2>         %elifidni %1, word gs
  4920                              <2>                 o16 push %1
  4921                              <2>         %else
  4922 00000522 66FF750C            <2>                 push %1
  4923                              <2>         %endif
  4924                              <2> 
  4925                              <2>         %rotate -1
  4926                              <2> 
  4927                              <2> 
  4928                              <2> 
  4929                              <2> 
  4930                              <2> 
  4931                              <2> 
  4932                              <2> 
  4933                              <2>         %ifidni %1, cs
  4934                              <2>                 o16 push %1
  4935                              <2>         %elifidni %1, ds
  4936                              <2>                 o16 push %1
  4937                              <2>         %elifidni %1, es
  4938                              <2>                 o16 push %1
  4939                              <2>         %elifidni %1, fs
  4940                              <2>                 o16 push %1
  4941                              <2>         %elifidni %1, gs
  4942                              <2>                 o16 push %1
  4943                              <2>         %elifidni %1, word cs
  4944                              <2>                 o16 push %1
  4945                              <2>         %elifidni %1, word ds
  4946                              <2>                 o16 push %1
  4947                              <2>         %elifidni %1, word es
  4948                              <2>                 o16 push %1
  4949                              <2>         %elifidni %1, word fs
  4950                              <2>                 o16 push %1
  4951                              <2>         %elifidni %1, word gs
  4952                              <2>                 o16 push %1
  4953                              <2>         %else
  4954 00000526 FF7508              <2>                 push %1
  4955                              <2>         %endif
  4956                              <2> 
  4957                              <2>         %rotate -1
  4958 00000529 E87CFDFFFF          <1> call %1
  4959                              <1> %if (%0!=1)
  4960 0000052E 83C414              <1>         add esp, byte %1_arglen
  4961                              <1> %endif
  4962                                  
  4963                                  
  4964 00000531 817D1C00000000           cmp dword [ebp + .FillRectFlag], 0	; Check whether to fill the rectangle
  4965 00000538 0F843D000000             jz near .End
  4966                                  
  4967                                  
  4968 0000053E 6650                     push ax
  4969 00000540 6651                     push cx
  4970                                  
  4971 00000542 668B4510                 mov ax, word [ebp + .X1]		; X coordinate of point in center of
  4972 00000546 66034514                 add ax, word [ebp + .X2]		; box is (X1 + X2)/2
  4973 0000054A 66D1E8                   shr ax, 1
  4974                                  
  4975 0000054D 668B4D12                 mov cx, word [ebp + .Y1]		; Y coordinate of point in center of
  4976 00000551 66034D16                 add cx, word [ebp + .Y2]		; box is (Y1 + Y2)/2
  4977 00000555 66D1E9                   shr cx, 1
  4978                                  
  4979                                   invoke	_FloodFill, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word ax, word cx, dword [ebp + .Color], dword 0
  4980                              <1> %rotate -1
  4981                              <1> 
  4982                              <1> %rep (%0-1)
  4983                              <1> 
  4984                              <1> 
  4985                              <1> 
  4986                              <1> 
  4987                              <1> 
  4988                              <1> 
  4989                              <1> 
  4990                              <1>         %ifidni %1, cs
  4991                              <1>                 o16 push %1
  4992                              <1>         %elifidni %1, ds
  4993                              <1>                 o16 push %1
  4994                              <1>         %elifidni %1, es
  4995                              <1>                 o16 push %1
  4996                              <1>         %elifidni %1, fs
  4997                              <1>                 o16 push %1
  4998                              <1>         %elifidni %1, gs
  4999                              <1>                 o16 push %1
  5000                              <1>         %elifidni %1, word cs
  5001                              <1>                 o16 push %1
  5002                              <1>         %elifidni %1, word ds
  5003                              <1>                 o16 push %1
  5004                              <1>         %elifidni %1, word es
  5005                              <1>                 o16 push %1
  5006                              <1>         %elifidni %1, word fs
  5007                              <1>                 o16 push %1
  5008                              <1>         %elifidni %1, word gs
  5009                              <1>                 o16 push %1
  5010                              <1>         %else
  5011                              <1>                 push %1
  5012                              <1>         %endif
  5013                              <1> 
  5014                              <1>         %rotate -1
  5015                              <1> %endrep
  5016                              <2> 
  5017                              <2> 
  5018                              <2> 
  5019                              <2> 
  5020                              <2> 
  5021                              <2> 
  5022                              <2> 
  5023                              <2>         %ifidni %1, cs
  5024                              <2>                 o16 push %1
  5025                              <2>         %elifidni %1, ds
  5026                              <2>                 o16 push %1
  5027                              <2>         %elifidni %1, es
  5028                              <2>                 o16 push %1
  5029                              <2>         %elifidni %1, fs
  5030                              <2>                 o16 push %1
  5031                              <2>         %elifidni %1, gs
  5032                              <2>                 o16 push %1
  5033                              <2>         %elifidni %1, word cs
  5034                              <2>                 o16 push %1
  5035                              <2>         %elifidni %1, word ds
  5036                              <2>                 o16 push %1
  5037                              <2>         %elifidni %1, word es
  5038                              <2>                 o16 push %1
  5039                              <2>         %elifidni %1, word fs
  5040                              <2>                 o16 push %1
  5041                              <2>         %elifidni %1, word gs
  5042                              <2>                 o16 push %1
  5043                              <2>         %else
  5044 00000558 6800000000          <2>                 push %1
  5045                              <2>         %endif
  5046                              <2> 
  5047                              <2>         %rotate -1
  5048                              <2> 
  5049                              <2> 
  5050                              <2> 
  5051                              <2> 
  5052                              <2> 
  5053                              <2> 
  5054                              <2> 
  5055                              <2>         %ifidni %1, cs
  5056                              <2>                 o16 push %1
  5057                              <2>         %elifidni %1, ds
  5058                              <2>                 o16 push %1
  5059                              <2>         %elifidni %1, es
  5060                              <2>                 o16 push %1
  5061                              <2>         %elifidni %1, fs
  5062                              <2>                 o16 push %1
  5063                              <2>         %elifidni %1, gs
  5064                              <2>                 o16 push %1
  5065                              <2>         %elifidni %1, word cs
  5066                              <2>                 o16 push %1
  5067                              <2>         %elifidni %1, word ds
  5068                              <2>                 o16 push %1
  5069                              <2>         %elifidni %1, word es
  5070                              <2>                 o16 push %1
  5071                              <2>         %elifidni %1, word fs
  5072                              <2>                 o16 push %1
  5073                              <2>         %elifidni %1, word gs
  5074                              <2>                 o16 push %1
  5075                              <2>         %else
  5076 0000055D FF7518              <2>                 push %1
  5077                              <2>         %endif
  5078                              <2> 
  5079                              <2>         %rotate -1
  5080                              <2> 
  5081                              <2> 
  5082                              <2> 
  5083                              <2> 
  5084                              <2> 
  5085                              <2> 
  5086                              <2> 
  5087                              <2>         %ifidni %1, cs
  5088                              <2>                 o16 push %1
  5089                              <2>         %elifidni %1, ds
  5090                              <2>                 o16 push %1
  5091                              <2>         %elifidni %1, es
  5092                              <2>                 o16 push %1
  5093                              <2>         %elifidni %1, fs
  5094                              <2>                 o16 push %1
  5095                              <2>         %elifidni %1, gs
  5096                              <2>                 o16 push %1
  5097                              <2>         %elifidni %1, word cs
  5098                              <2>                 o16 push %1
  5099                              <2>         %elifidni %1, word ds
  5100                              <2>                 o16 push %1
  5101                              <2>         %elifidni %1, word es
  5102                              <2>                 o16 push %1
  5103                              <2>         %elifidni %1, word fs
  5104                              <2>                 o16 push %1
  5105                              <2>         %elifidni %1, word gs
  5106                              <2>                 o16 push %1
  5107                              <2>         %else
  5108 00000560 6651                <2>                 push %1
  5109                              <2>         %endif
  5110                              <2> 
  5111                              <2>         %rotate -1
  5112                              <2> 
  5113                              <2> 
  5114                              <2> 
  5115                              <2> 
  5116                              <2> 
  5117                              <2> 
  5118                              <2> 
  5119                              <2>         %ifidni %1, cs
  5120                              <2>                 o16 push %1
  5121                              <2>         %elifidni %1, ds
  5122                              <2>                 o16 push %1
  5123                              <2>         %elifidni %1, es
  5124                              <2>                 o16 push %1
  5125                              <2>         %elifidni %1, fs
  5126                              <2>                 o16 push %1
  5127                              <2>         %elifidni %1, gs
  5128                              <2>                 o16 push %1
  5129                              <2>         %elifidni %1, word cs
  5130                              <2>                 o16 push %1
  5131                              <2>         %elifidni %1, word ds
  5132                              <2>                 o16 push %1
  5133                              <2>         %elifidni %1, word es
  5134                              <2>                 o16 push %1
  5135                              <2>         %elifidni %1, word fs
  5136                              <2>                 o16 push %1
  5137                              <2>         %elifidni %1, word gs
  5138                              <2>                 o16 push %1
  5139                              <2>         %else
  5140 00000562 6650                <2>                 push %1
  5141                              <2>         %endif
  5142                              <2> 
  5143                              <2>         %rotate -1
  5144                              <2> 
  5145                              <2> 
  5146                              <2> 
  5147                              <2> 
  5148                              <2> 
  5149                              <2> 
  5150                              <2> 
  5151                              <2>         %ifidni %1, cs
  5152                              <2>                 o16 push %1
  5153                              <2>         %elifidni %1, ds
  5154                              <2>                 o16 push %1
  5155                              <2>         %elifidni %1, es
  5156                              <2>                 o16 push %1
  5157                              <2>         %elifidni %1, fs
  5158                              <2>                 o16 push %1
  5159                              <2>         %elifidni %1, gs
  5160                              <2>                 o16 push %1
  5161                              <2>         %elifidni %1, word cs
  5162                              <2>                 o16 push %1
  5163                              <2>         %elifidni %1, word ds
  5164                              <2>                 o16 push %1
  5165                              <2>         %elifidni %1, word es
  5166                              <2>                 o16 push %1
  5167                              <2>         %elifidni %1, word fs
  5168                              <2>                 o16 push %1
  5169                              <2>         %elifidni %1, word gs
  5170                              <2>                 o16 push %1
  5171                              <2>         %else
  5172 00000564 66FF750E            <2>                 push %1
  5173                              <2>         %endif
  5174                              <2> 
  5175                              <2>         %rotate -1
  5176                              <2> 
  5177                              <2> 
  5178                              <2> 
  5179                              <2> 
  5180                              <2> 
  5181                              <2> 
  5182                              <2> 
  5183                              <2>         %ifidni %1, cs
  5184                              <2>                 o16 push %1
  5185                              <2>         %elifidni %1, ds
  5186                              <2>                 o16 push %1
  5187                              <2>         %elifidni %1, es
  5188                              <2>                 o16 push %1
  5189                              <2>         %elifidni %1, fs
  5190                              <2>                 o16 push %1
  5191                              <2>         %elifidni %1, gs
  5192                              <2>                 o16 push %1
  5193                              <2>         %elifidni %1, word cs
  5194                              <2>                 o16 push %1
  5195                              <2>         %elifidni %1, word ds
  5196                              <2>                 o16 push %1
  5197                              <2>         %elifidni %1, word es
  5198                              <2>                 o16 push %1
  5199                              <2>         %elifidni %1, word fs
  5200                              <2>                 o16 push %1
  5201                              <2>         %elifidni %1, word gs
  5202                              <2>                 o16 push %1
  5203                              <2>         %else
  5204 00000568 66FF750C            <2>                 push %1
  5205                              <2>         %endif
  5206                              <2> 
  5207                              <2>         %rotate -1
  5208                              <2> 
  5209                              <2> 
  5210                              <2> 
  5211                              <2> 
  5212                              <2> 
  5213                              <2> 
  5214                              <2> 
  5215                              <2>         %ifidni %1, cs
  5216                              <2>                 o16 push %1
  5217                              <2>         %elifidni %1, ds
  5218                              <2>                 o16 push %1
  5219                              <2>         %elifidni %1, es
  5220                              <2>                 o16 push %1
  5221                              <2>         %elifidni %1, fs
  5222                              <2>                 o16 push %1
  5223                              <2>         %elifidni %1, gs
  5224                              <2>                 o16 push %1
  5225                              <2>         %elifidni %1, word cs
  5226                              <2>                 o16 push %1
  5227                              <2>         %elifidni %1, word ds
  5228                              <2>                 o16 push %1
  5229                              <2>         %elifidni %1, word es
  5230                              <2>                 o16 push %1
  5231                              <2>         %elifidni %1, word fs
  5232                              <2>                 o16 push %1
  5233                              <2>         %elifidni %1, word gs
  5234                              <2>                 o16 push %1
  5235                              <2>         %else
  5236 0000056C FF7508              <2>                 push %1
  5237                              <2>         %endif
  5238                              <2> 
  5239                              <2>         %rotate -1
  5240 0000056F E84A070000          <1> call %1
  5241                              <1> %if (%0!=1)
  5242 00000574 83C414              <1>         add esp, byte %1_arglen
  5243                              <1> %endif
  5244                                   
  5245 00000577 6659                     pop cx
  5246 00000579 6658                     pop ax
  5247                                  
  5248                                  
  5249                                   .End:
  5250                                   ret
  5251                              <1> %ifnctx proc
  5252                              <1> 	ret	%1
  5253                              <1> %else
  5254 0000057B 89EC                <1> 	mov	esp, ebp
  5255 0000057D 5D                  <1> 	pop	ebp
  5256 0000057E C3                  <1> 	ret	%1
  5257                              <1> %endif
  5258                                  
  5259                                  
  5260                                  endproc
  5261                              <1> %ifnctx proc
  5262                              <1> %error Mismatched `endproc'/`proc'
  5263                              <1> %else
  5264                              <1> 
  5265                              <1> 
  5266                              <1> %ifdef LEGACY_ENDPROC
  5267                              <1>         ret
  5268                              <1> %endif
  5269                              <1> 
  5270                              <1> 
  5271                              <1> 
  5272                              <1> 
  5273                              <1> 
  5274                              <1> 
  5275                              <1> 
  5276                              <1> 
  5277                              <1> 
  5278                              <1> %pop
  5279                              <1> %endif
  5280                                  _DrawRect_arglen	EQU	24
  5281                                  
  5282                                  
  5283                                  
  5284                                  
  5285                                  
  5286                                  
  5287                                  
  5288                                  
  5289                                  ;-------------------------------------------------------------------------;
  5290                                  ; DrawCircle()								  ;
  5291                                  ;									  ;
  5292                                  ;   void _DrawCircle(dword DestOff, word DestWidth, word DestHeight,	  ;
  5293                                  ;                  word X, word Y, word Radius, dword Color,		  ;
  5294                                  ;		   dword FillCircleFlag)				  ;
  5295                                  ;									  ;
  5296                                  ;   Inputs: DestOff = offset of an image buffer in memory		  ;
  5297                                  ;	    DestWidth = width of the buffer				  ;
  5298                                  ;	    DestHeight = height of the buffer				  ;
  5299                                  ;	    X = x coordinate of center					  ;
  5300                                  ;	    Y = y coordinate of center					  ;
  5301                                  ;	    Color = color of circle to draw				  ;
  5302                                  ;	    FillCircleFlag = flag to determine whether or not to fill	  ;
  5303                                  ;			     the circle					  ;
  5304                                  ;									  ;
  5305                                  ;   Outputs: Circle drawn to buffer, filled if necessary		  ;
  5306                                  ;									  ;
  5307                                  ;   Calls: _DrawPixel, _FloodFill					  ;
  5308                                  ;									  ;
  5309                                  ;   Returns: none							  ;
  5310                                  ;									  ;
  5311                                  ;   Purpose: Draws a circle with center (X1,Y1), color Color, and	  ;
  5312                                  ;	     radius Radius in the buffer pointed to by DestOff		  ;
  5313                                  ;									  ;
  5314                                  ;-------------------------------------------------------------------------;
  5315                                  proc _DrawCircle
  5316                              <1> %push proc
  5317                              <1>           global %1
  5318 0000057F 55                  <1> %1:       push  ebp
  5319 00000580 89E5                <1>           mov   ebp, esp
  5320                              <1> %assign %$arg 8
  5321                              <1> 
  5322                              <1> %define %$procname %1
  5323                                  .DestOff	arg	4
  5324                              <1> .DestOff       equ %$arg
  5325                              <1> 
  5326                              <1> 
  5327                              <1> %assign %$arg %1+%$arg
  5328                                  .DestWidth	arg	2
  5329                              <1> .DestWidth       equ %$arg
  5330                              <1> 
  5331                              <1> 
  5332                              <1> %assign %$arg %1+%$arg
  5333                                  .DestHeight	arg	2
  5334                              <1> .DestHeight       equ %$arg
  5335                              <1> 
  5336                              <1> 
  5337                              <1> %assign %$arg %1+%$arg
  5338                                  .X		arg	2
  5339                              <1> .X       equ %$arg
  5340                              <1> 
  5341                              <1> 
  5342                              <1> %assign %$arg %1+%$arg
  5343                                  .Y		arg	2
  5344                              <1> .Y       equ %$arg
  5345                              <1> 
  5346                              <1> 
  5347                              <1> %assign %$arg %1+%$arg
  5348                                  .Radius		arg	2
  5349                              <1> .Radius       equ %$arg
  5350                              <1> 
  5351                              <1> 
  5352                              <1> %assign %$arg %1+%$arg
  5353                                  .Color		arg	4
  5354                              <1> .Color       equ %$arg
  5355                              <1> 
  5356                              <1> 
  5357                              <1> %assign %$arg %1+%$arg
  5358                                  .FillCircleFlag	arg	4
  5359                              <1> .FillCircleFlag       equ %$arg
  5360                              <1> 
  5361                              <1> 
  5362                              <1> %assign %$arg %1+%$arg
  5363                                  ;invoke	_libDrawCircle, dword [ebp+.DestOff], word [ebp+.DestWidth], word [ebp+.DestHeight], word [ebp+.X], word [ebp+.Y], word [ebp+.Radius], dword [ebp+.Color], dword [ebp+.FillCircleFlag]
  5364                                  ;ret
  5365                                  
  5366                                  
  5367                                  
  5368                                  
  5369 00000582 6650                     push ax				; Save registers
  5370 00000584 6653                     push bx
  5371 00000586 6651                     push cx
  5372 00000588 6652                     push dx
  5373                                  
  5374                                  
  5375                                  					; Begin Bresenham's Circle Algorithm:
  5376 0000058A 66C705[42000000]00-      mov word [_xdist], 0			; xdist = 0
  5377 00000592 00                 
  5378 00000593 668B4514                 mov ax, word [ebp + .Radius]
  5379 00000597 66A3[44000000]           mov word [_ydist], ax			; ydist = r
  5380 0000059D 66C705[40000000]01-      mov word [_circleerror], 1 
  5381 000005A5 00                 
  5382 000005A6 662905[40000000]         sub word [_circleerror], ax		; circleerror = 1 - r
  5383                                  
  5384                                  
  5385                                  
  5386                                   ;----------
  5387                                   .PixelLoop:
  5388                                   ;----------
  5389                                  					; DrawPixel(x + xdist, y + ydist)
  5390                                  					; DrawPixel(x - xdist, y + ydist)
  5391                                  					; DrawPixel(x + xdist, y - ydist)
  5392                                  					; DrawPixel(x - xdist, y - ydist)
  5393                                  
  5394 000005AD 668B4510                    mov ax, word [ebp + .X]
  5395 000005B1 6689C1                      mov cx, ax
  5396 000005B4 660305[42000000]            add ax, word [_xdist]		; ax = x + xdist
  5397 000005BB 668B5D12                    mov bx, word [ebp + .Y]
  5398 000005BF 6689DA                      mov dx, bx
  5399 000005C2 66031D[44000000]            add bx, word [_ydist]		; bx = y + ydist
  5400                                  
  5401 000005C9 662B0D[42000000]            sub cx, word [_xdist]		; cx = x - xdist
  5402 000005D0 662B15[44000000]            sub dx, word [_ydist]		; dx = y - ydist
  5403                                   
  5404                                      invoke _DrawPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word ax, word bx, dword [ebp + .Color]
  5405                              <1> %rotate -1
  5406                              <1> 
  5407                              <1> %rep (%0-1)
  5408                              <1> 
  5409                              <1> 
  5410                              <1> 
  5411                              <1> 
  5412                              <1> 
  5413                              <1> 
  5414                              <1> 
  5415                              <1>         %ifidni %1, cs
  5416                              <1>                 o16 push %1
  5417                              <1>         %elifidni %1, ds
  5418                              <1>                 o16 push %1
  5419                              <1>         %elifidni %1, es
  5420                              <1>                 o16 push %1
  5421                              <1>         %elifidni %1, fs
  5422                              <1>                 o16 push %1
  5423                              <1>         %elifidni %1, gs
  5424                              <1>                 o16 push %1
  5425                              <1>         %elifidni %1, word cs
  5426                              <1>                 o16 push %1
  5427                              <1>         %elifidni %1, word ds
  5428                              <1>                 o16 push %1
  5429                              <1>         %elifidni %1, word es
  5430                              <1>                 o16 push %1
  5431                              <1>         %elifidni %1, word fs
  5432                              <1>                 o16 push %1
  5433                              <1>         %elifidni %1, word gs
  5434                              <1>                 o16 push %1
  5435                              <1>         %else
  5436                              <1>                 push %1
  5437                              <1>         %endif
  5438                              <1> 
  5439                              <1>         %rotate -1
  5440                              <1> %endrep
  5441                              <2> 
  5442                              <2> 
  5443                              <2> 
  5444                              <2> 
  5445                              <2> 
  5446                              <2> 
  5447                              <2> 
  5448                              <2>         %ifidni %1, cs
  5449                              <2>                 o16 push %1
  5450                              <2>         %elifidni %1, ds
  5451                              <2>                 o16 push %1
  5452                              <2>         %elifidni %1, es
  5453                              <2>                 o16 push %1
  5454                              <2>         %elifidni %1, fs
  5455                              <2>                 o16 push %1
  5456                              <2>         %elifidni %1, gs
  5457                              <2>                 o16 push %1
  5458                              <2>         %elifidni %1, word cs
  5459                              <2>                 o16 push %1
  5460                              <2>         %elifidni %1, word ds
  5461                              <2>                 o16 push %1
  5462                              <2>         %elifidni %1, word es
  5463                              <2>                 o16 push %1
  5464                              <2>         %elifidni %1, word fs
  5465                              <2>                 o16 push %1
  5466                              <2>         %elifidni %1, word gs
  5467                              <2>                 o16 push %1
  5468                              <2>         %else
  5469 000005D7 FF7516              <2>                 push %1
  5470                              <2>         %endif
  5471                              <2> 
  5472                              <2>         %rotate -1
  5473                              <2> 
  5474                              <2> 
  5475                              <2> 
  5476                              <2> 
  5477                              <2> 
  5478                              <2> 
  5479                              <2> 
  5480                              <2>         %ifidni %1, cs
  5481                              <2>                 o16 push %1
  5482                              <2>         %elifidni %1, ds
  5483                              <2>                 o16 push %1
  5484                              <2>         %elifidni %1, es
  5485                              <2>                 o16 push %1
  5486                              <2>         %elifidni %1, fs
  5487                              <2>                 o16 push %1
  5488                              <2>         %elifidni %1, gs
  5489                              <2>                 o16 push %1
  5490                              <2>         %elifidni %1, word cs
  5491                              <2>                 o16 push %1
  5492                              <2>         %elifidni %1, word ds
  5493                              <2>                 o16 push %1
  5494                              <2>         %elifidni %1, word es
  5495                              <2>                 o16 push %1
  5496                              <2>         %elifidni %1, word fs
  5497                              <2>                 o16 push %1
  5498                              <2>         %elifidni %1, word gs
  5499                              <2>                 o16 push %1
  5500                              <2>         %else
  5501 000005DA 6653                <2>                 push %1
  5502                              <2>         %endif
  5503                              <2> 
  5504                              <2>         %rotate -1
  5505                              <2> 
  5506                              <2> 
  5507                              <2> 
  5508                              <2> 
  5509                              <2> 
  5510                              <2> 
  5511                              <2> 
  5512                              <2>         %ifidni %1, cs
  5513                              <2>                 o16 push %1
  5514                              <2>         %elifidni %1, ds
  5515                              <2>                 o16 push %1
  5516                              <2>         %elifidni %1, es
  5517                              <2>                 o16 push %1
  5518                              <2>         %elifidni %1, fs
  5519                              <2>                 o16 push %1
  5520                              <2>         %elifidni %1, gs
  5521                              <2>                 o16 push %1
  5522                              <2>         %elifidni %1, word cs
  5523                              <2>                 o16 push %1
  5524                              <2>         %elifidni %1, word ds
  5525                              <2>                 o16 push %1
  5526                              <2>         %elifidni %1, word es
  5527                              <2>                 o16 push %1
  5528                              <2>         %elifidni %1, word fs
  5529                              <2>                 o16 push %1
  5530                              <2>         %elifidni %1, word gs
  5531                              <2>                 o16 push %1
  5532                              <2>         %else
  5533 000005DC 6650                <2>                 push %1
  5534                              <2>         %endif
  5535                              <2> 
  5536                              <2>         %rotate -1
  5537                              <2> 
  5538                              <2> 
  5539                              <2> 
  5540                              <2> 
  5541                              <2> 
  5542                              <2> 
  5543                              <2> 
  5544                              <2>         %ifidni %1, cs
  5545                              <2>                 o16 push %1
  5546                              <2>         %elifidni %1, ds
  5547                              <2>                 o16 push %1
  5548                              <2>         %elifidni %1, es
  5549                              <2>                 o16 push %1
  5550                              <2>         %elifidni %1, fs
  5551                              <2>                 o16 push %1
  5552                              <2>         %elifidni %1, gs
  5553                              <2>                 o16 push %1
  5554                              <2>         %elifidni %1, word cs
  5555                              <2>                 o16 push %1
  5556                              <2>         %elifidni %1, word ds
  5557                              <2>                 o16 push %1
  5558                              <2>         %elifidni %1, word es
  5559                              <2>                 o16 push %1
  5560                              <2>         %elifidni %1, word fs
  5561                              <2>                 o16 push %1
  5562                              <2>         %elifidni %1, word gs
  5563                              <2>                 o16 push %1
  5564                              <2>         %else
  5565 000005DE 66FF750E            <2>                 push %1
  5566                              <2>         %endif
  5567                              <2> 
  5568                              <2>         %rotate -1
  5569                              <2> 
  5570                              <2> 
  5571                              <2> 
  5572                              <2> 
  5573                              <2> 
  5574                              <2> 
  5575                              <2> 
  5576                              <2>         %ifidni %1, cs
  5577                              <2>                 o16 push %1
  5578                              <2>         %elifidni %1, ds
  5579                              <2>                 o16 push %1
  5580                              <2>         %elifidni %1, es
  5581                              <2>                 o16 push %1
  5582                              <2>         %elifidni %1, fs
  5583                              <2>                 o16 push %1
  5584                              <2>         %elifidni %1, gs
  5585                              <2>                 o16 push %1
  5586                              <2>         %elifidni %1, word cs
  5587                              <2>                 o16 push %1
  5588                              <2>         %elifidni %1, word ds
  5589                              <2>                 o16 push %1
  5590                              <2>         %elifidni %1, word es
  5591                              <2>                 o16 push %1
  5592                              <2>         %elifidni %1, word fs
  5593                              <2>                 o16 push %1
  5594                              <2>         %elifidni %1, word gs
  5595                              <2>                 o16 push %1
  5596                              <2>         %else
  5597 000005E2 66FF750C            <2>                 push %1
  5598                              <2>         %endif
  5599                              <2> 
  5600                              <2>         %rotate -1
  5601                              <2> 
  5602                              <2> 
  5603                              <2> 
  5604                              <2> 
  5605                              <2> 
  5606                              <2> 
  5607                              <2> 
  5608                              <2>         %ifidni %1, cs
  5609                              <2>                 o16 push %1
  5610                              <2>         %elifidni %1, ds
  5611                              <2>                 o16 push %1
  5612                              <2>         %elifidni %1, es
  5613                              <2>                 o16 push %1
  5614                              <2>         %elifidni %1, fs
  5615                              <2>                 o16 push %1
  5616                              <2>         %elifidni %1, gs
  5617                              <2>                 o16 push %1
  5618                              <2>         %elifidni %1, word cs
  5619                              <2>                 o16 push %1
  5620                              <2>         %elifidni %1, word ds
  5621                              <2>                 o16 push %1
  5622                              <2>         %elifidni %1, word es
  5623                              <2>                 o16 push %1
  5624                              <2>         %elifidni %1, word fs
  5625                              <2>                 o16 push %1
  5626                              <2>         %elifidni %1, word gs
  5627                              <2>                 o16 push %1
  5628                              <2>         %else
  5629 000005E6 FF7508              <2>                 push %1
  5630                              <2>         %endif
  5631                              <2> 
  5632                              <2>         %rotate -1
  5633 000005E9 E868FCFFFF          <1> call %1
  5634                              <1> %if (%0!=1)
  5635 000005EE 83C410              <1>         add esp, byte %1_arglen
  5636                              <1> %endif
  5637                                      invoke _DrawPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word cx, word bx, dword [ebp + .Color]
  5638                              <1> %rotate -1
  5639                              <1> 
  5640                              <1> %rep (%0-1)
  5641                              <1> 
  5642                              <1> 
  5643                              <1> 
  5644                              <1> 
  5645                              <1> 
  5646                              <1> 
  5647                              <1> 
  5648                              <1>         %ifidni %1, cs
  5649                              <1>                 o16 push %1
  5650                              <1>         %elifidni %1, ds
  5651                              <1>                 o16 push %1
  5652                              <1>         %elifidni %1, es
  5653                              <1>                 o16 push %1
  5654                              <1>         %elifidni %1, fs
  5655                              <1>                 o16 push %1
  5656                              <1>         %elifidni %1, gs
  5657                              <1>                 o16 push %1
  5658                              <1>         %elifidni %1, word cs
  5659                              <1>                 o16 push %1
  5660                              <1>         %elifidni %1, word ds
  5661                              <1>                 o16 push %1
  5662                              <1>         %elifidni %1, word es
  5663                              <1>                 o16 push %1
  5664                              <1>         %elifidni %1, word fs
  5665                              <1>                 o16 push %1
  5666                              <1>         %elifidni %1, word gs
  5667                              <1>                 o16 push %1
  5668                              <1>         %else
  5669                              <1>                 push %1
  5670                              <1>         %endif
  5671                              <1> 
  5672                              <1>         %rotate -1
  5673                              <1> %endrep
  5674                              <2> 
  5675                              <2> 
  5676                              <2> 
  5677                              <2> 
  5678                              <2> 
  5679                              <2> 
  5680                              <2> 
  5681                              <2>         %ifidni %1, cs
  5682                              <2>                 o16 push %1
  5683                              <2>         %elifidni %1, ds
  5684                              <2>                 o16 push %1
  5685                              <2>         %elifidni %1, es
  5686                              <2>                 o16 push %1
  5687                              <2>         %elifidni %1, fs
  5688                              <2>                 o16 push %1
  5689                              <2>         %elifidni %1, gs
  5690                              <2>                 o16 push %1
  5691                              <2>         %elifidni %1, word cs
  5692                              <2>                 o16 push %1
  5693                              <2>         %elifidni %1, word ds
  5694                              <2>                 o16 push %1
  5695                              <2>         %elifidni %1, word es
  5696                              <2>                 o16 push %1
  5697                              <2>         %elifidni %1, word fs
  5698                              <2>                 o16 push %1
  5699                              <2>         %elifidni %1, word gs
  5700                              <2>                 o16 push %1
  5701                              <2>         %else
  5702 000005F1 FF7516              <2>                 push %1
  5703                              <2>         %endif
  5704                              <2> 
  5705                              <2>         %rotate -1
  5706                              <2> 
  5707                              <2> 
  5708                              <2> 
  5709                              <2> 
  5710                              <2> 
  5711                              <2> 
  5712                              <2> 
  5713                              <2>         %ifidni %1, cs
  5714                              <2>                 o16 push %1
  5715                              <2>         %elifidni %1, ds
  5716                              <2>                 o16 push %1
  5717                              <2>         %elifidni %1, es
  5718                              <2>                 o16 push %1
  5719                              <2>         %elifidni %1, fs
  5720                              <2>                 o16 push %1
  5721                              <2>         %elifidni %1, gs
  5722                              <2>                 o16 push %1
  5723                              <2>         %elifidni %1, word cs
  5724                              <2>                 o16 push %1
  5725                              <2>         %elifidni %1, word ds
  5726                              <2>                 o16 push %1
  5727                              <2>         %elifidni %1, word es
  5728                              <2>                 o16 push %1
  5729                              <2>         %elifidni %1, word fs
  5730                              <2>                 o16 push %1
  5731                              <2>         %elifidni %1, word gs
  5732                              <2>                 o16 push %1
  5733                              <2>         %else
  5734 000005F4 6653                <2>                 push %1
  5735                              <2>         %endif
  5736                              <2> 
  5737                              <2>         %rotate -1
  5738                              <2> 
  5739                              <2> 
  5740                              <2> 
  5741                              <2> 
  5742                              <2> 
  5743                              <2> 
  5744                              <2> 
  5745                              <2>         %ifidni %1, cs
  5746                              <2>                 o16 push %1
  5747                              <2>         %elifidni %1, ds
  5748                              <2>                 o16 push %1
  5749                              <2>         %elifidni %1, es
  5750                              <2>                 o16 push %1
  5751                              <2>         %elifidni %1, fs
  5752                              <2>                 o16 push %1
  5753                              <2>         %elifidni %1, gs
  5754                              <2>                 o16 push %1
  5755                              <2>         %elifidni %1, word cs
  5756                              <2>                 o16 push %1
  5757                              <2>         %elifidni %1, word ds
  5758                              <2>                 o16 push %1
  5759                              <2>         %elifidni %1, word es
  5760                              <2>                 o16 push %1
  5761                              <2>         %elifidni %1, word fs
  5762                              <2>                 o16 push %1
  5763                              <2>         %elifidni %1, word gs
  5764                              <2>                 o16 push %1
  5765                              <2>         %else
  5766 000005F6 6651                <2>                 push %1
  5767                              <2>         %endif
  5768                              <2> 
  5769                              <2>         %rotate -1
  5770                              <2> 
  5771                              <2> 
  5772                              <2> 
  5773                              <2> 
  5774                              <2> 
  5775                              <2> 
  5776                              <2> 
  5777                              <2>         %ifidni %1, cs
  5778                              <2>                 o16 push %1
  5779                              <2>         %elifidni %1, ds
  5780                              <2>                 o16 push %1
  5781                              <2>         %elifidni %1, es
  5782                              <2>                 o16 push %1
  5783                              <2>         %elifidni %1, fs
  5784                              <2>                 o16 push %1
  5785                              <2>         %elifidni %1, gs
  5786                              <2>                 o16 push %1
  5787                              <2>         %elifidni %1, word cs
  5788                              <2>                 o16 push %1
  5789                              <2>         %elifidni %1, word ds
  5790                              <2>                 o16 push %1
  5791                              <2>         %elifidni %1, word es
  5792                              <2>                 o16 push %1
  5793                              <2>         %elifidni %1, word fs
  5794                              <2>                 o16 push %1
  5795                              <2>         %elifidni %1, word gs
  5796                              <2>                 o16 push %1
  5797                              <2>         %else
  5798 000005F8 66FF750E            <2>                 push %1
  5799                              <2>         %endif
  5800                              <2> 
  5801                              <2>         %rotate -1
  5802                              <2> 
  5803                              <2> 
  5804                              <2> 
  5805                              <2> 
  5806                              <2> 
  5807                              <2> 
  5808                              <2> 
  5809                              <2>         %ifidni %1, cs
  5810                              <2>                 o16 push %1
  5811                              <2>         %elifidni %1, ds
  5812                              <2>                 o16 push %1
  5813                              <2>         %elifidni %1, es
  5814                              <2>                 o16 push %1
  5815                              <2>         %elifidni %1, fs
  5816                              <2>                 o16 push %1
  5817                              <2>         %elifidni %1, gs
  5818                              <2>                 o16 push %1
  5819                              <2>         %elifidni %1, word cs
  5820                              <2>                 o16 push %1
  5821                              <2>         %elifidni %1, word ds
  5822                              <2>                 o16 push %1
  5823                              <2>         %elifidni %1, word es
  5824                              <2>                 o16 push %1
  5825                              <2>         %elifidni %1, word fs
  5826                              <2>                 o16 push %1
  5827                              <2>         %elifidni %1, word gs
  5828                              <2>                 o16 push %1
  5829                              <2>         %else
  5830 000005FC 66FF750C            <2>                 push %1
  5831                              <2>         %endif
  5832                              <2> 
  5833                              <2>         %rotate -1
  5834                              <2> 
  5835                              <2> 
  5836                              <2> 
  5837                              <2> 
  5838                              <2> 
  5839                              <2> 
  5840                              <2> 
  5841                              <2>         %ifidni %1, cs
  5842                              <2>                 o16 push %1
  5843                              <2>         %elifidni %1, ds
  5844                              <2>                 o16 push %1
  5845                              <2>         %elifidni %1, es
  5846                              <2>                 o16 push %1
  5847                              <2>         %elifidni %1, fs
  5848                              <2>                 o16 push %1
  5849                              <2>         %elifidni %1, gs
  5850                              <2>                 o16 push %1
  5851                              <2>         %elifidni %1, word cs
  5852                              <2>                 o16 push %1
  5853                              <2>         %elifidni %1, word ds
  5854                              <2>                 o16 push %1
  5855                              <2>         %elifidni %1, word es
  5856                              <2>                 o16 push %1
  5857                              <2>         %elifidni %1, word fs
  5858                              <2>                 o16 push %1
  5859                              <2>         %elifidni %1, word gs
  5860                              <2>                 o16 push %1
  5861                              <2>         %else
  5862 00000600 FF7508              <2>                 push %1
  5863                              <2>         %endif
  5864                              <2> 
  5865                              <2>         %rotate -1
  5866 00000603 E84EFCFFFF          <1> call %1
  5867                              <1> %if (%0!=1)
  5868 00000608 83C410              <1>         add esp, byte %1_arglen
  5869                              <1> %endif
  5870                                      invoke _DrawPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word ax, word dx, dword [ebp + .Color]
  5871                              <1> %rotate -1
  5872                              <1> 
  5873                              <1> %rep (%0-1)
  5874                              <1> 
  5875                              <1> 
  5876                              <1> 
  5877                              <1> 
  5878                              <1> 
  5879                              <1> 
  5880                              <1> 
  5881                              <1>         %ifidni %1, cs
  5882                              <1>                 o16 push %1
  5883                              <1>         %elifidni %1, ds
  5884                              <1>                 o16 push %1
  5885                              <1>         %elifidni %1, es
  5886                              <1>                 o16 push %1
  5887                              <1>         %elifidni %1, fs
  5888                              <1>                 o16 push %1
  5889                              <1>         %elifidni %1, gs
  5890                              <1>                 o16 push %1
  5891                              <1>         %elifidni %1, word cs
  5892                              <1>                 o16 push %1
  5893                              <1>         %elifidni %1, word ds
  5894                              <1>                 o16 push %1
  5895                              <1>         %elifidni %1, word es
  5896                              <1>                 o16 push %1
  5897                              <1>         %elifidni %1, word fs
  5898                              <1>                 o16 push %1
  5899                              <1>         %elifidni %1, word gs
  5900                              <1>                 o16 push %1
  5901                              <1>         %else
  5902                              <1>                 push %1
  5903                              <1>         %endif
  5904                              <1> 
  5905                              <1>         %rotate -1
  5906                              <1> %endrep
  5907                              <2> 
  5908                              <2> 
  5909                              <2> 
  5910                              <2> 
  5911                              <2> 
  5912                              <2> 
  5913                              <2> 
  5914                              <2>         %ifidni %1, cs
  5915                              <2>                 o16 push %1
  5916                              <2>         %elifidni %1, ds
  5917                              <2>                 o16 push %1
  5918                              <2>         %elifidni %1, es
  5919                              <2>                 o16 push %1
  5920                              <2>         %elifidni %1, fs
  5921                              <2>                 o16 push %1
  5922                              <2>         %elifidni %1, gs
  5923                              <2>                 o16 push %1
  5924                              <2>         %elifidni %1, word cs
  5925                              <2>                 o16 push %1
  5926                              <2>         %elifidni %1, word ds
  5927                              <2>                 o16 push %1
  5928                              <2>         %elifidni %1, word es
  5929                              <2>                 o16 push %1
  5930                              <2>         %elifidni %1, word fs
  5931                              <2>                 o16 push %1
  5932                              <2>         %elifidni %1, word gs
  5933                              <2>                 o16 push %1
  5934                              <2>         %else
  5935 0000060B FF7516              <2>                 push %1
  5936                              <2>         %endif
  5937                              <2> 
  5938                              <2>         %rotate -1
  5939                              <2> 
  5940                              <2> 
  5941                              <2> 
  5942                              <2> 
  5943                              <2> 
  5944                              <2> 
  5945                              <2> 
  5946                              <2>         %ifidni %1, cs
  5947                              <2>                 o16 push %1
  5948                              <2>         %elifidni %1, ds
  5949                              <2>                 o16 push %1
  5950                              <2>         %elifidni %1, es
  5951                              <2>                 o16 push %1
  5952                              <2>         %elifidni %1, fs
  5953                              <2>                 o16 push %1
  5954                              <2>         %elifidni %1, gs
  5955                              <2>                 o16 push %1
  5956                              <2>         %elifidni %1, word cs
  5957                              <2>                 o16 push %1
  5958                              <2>         %elifidni %1, word ds
  5959                              <2>                 o16 push %1
  5960                              <2>         %elifidni %1, word es
  5961                              <2>                 o16 push %1
  5962                              <2>         %elifidni %1, word fs
  5963                              <2>                 o16 push %1
  5964                              <2>         %elifidni %1, word gs
  5965                              <2>                 o16 push %1
  5966                              <2>         %else
  5967 0000060E 6652                <2>                 push %1
  5968                              <2>         %endif
  5969                              <2> 
  5970                              <2>         %rotate -1
  5971                              <2> 
  5972                              <2> 
  5973                              <2> 
  5974                              <2> 
  5975                              <2> 
  5976                              <2> 
  5977                              <2> 
  5978                              <2>         %ifidni %1, cs
  5979                              <2>                 o16 push %1
  5980                              <2>         %elifidni %1, ds
  5981                              <2>                 o16 push %1
  5982                              <2>         %elifidni %1, es
  5983                              <2>                 o16 push %1
  5984                              <2>         %elifidni %1, fs
  5985                              <2>                 o16 push %1
  5986                              <2>         %elifidni %1, gs
  5987                              <2>                 o16 push %1
  5988                              <2>         %elifidni %1, word cs
  5989                              <2>                 o16 push %1
  5990                              <2>         %elifidni %1, word ds
  5991                              <2>                 o16 push %1
  5992                              <2>         %elifidni %1, word es
  5993                              <2>                 o16 push %1
  5994                              <2>         %elifidni %1, word fs
  5995                              <2>                 o16 push %1
  5996                              <2>         %elifidni %1, word gs
  5997                              <2>                 o16 push %1
  5998                              <2>         %else
  5999 00000610 6650                <2>                 push %1
  6000                              <2>         %endif
  6001                              <2> 
  6002                              <2>         %rotate -1
  6003                              <2> 
  6004                              <2> 
  6005                              <2> 
  6006                              <2> 
  6007                              <2> 
  6008                              <2> 
  6009                              <2> 
  6010                              <2>         %ifidni %1, cs
  6011                              <2>                 o16 push %1
  6012                              <2>         %elifidni %1, ds
  6013                              <2>                 o16 push %1
  6014                              <2>         %elifidni %1, es
  6015                              <2>                 o16 push %1
  6016                              <2>         %elifidni %1, fs
  6017                              <2>                 o16 push %1
  6018                              <2>         %elifidni %1, gs
  6019                              <2>                 o16 push %1
  6020                              <2>         %elifidni %1, word cs
  6021                              <2>                 o16 push %1
  6022                              <2>         %elifidni %1, word ds
  6023                              <2>                 o16 push %1
  6024                              <2>         %elifidni %1, word es
  6025                              <2>                 o16 push %1
  6026                              <2>         %elifidni %1, word fs
  6027                              <2>                 o16 push %1
  6028                              <2>         %elifidni %1, word gs
  6029                              <2>                 o16 push %1
  6030                              <2>         %else
  6031 00000612 66FF750E            <2>                 push %1
  6032                              <2>         %endif
  6033                              <2> 
  6034                              <2>         %rotate -1
  6035                              <2> 
  6036                              <2> 
  6037                              <2> 
  6038                              <2> 
  6039                              <2> 
  6040                              <2> 
  6041                              <2> 
  6042                              <2>         %ifidni %1, cs
  6043                              <2>                 o16 push %1
  6044                              <2>         %elifidni %1, ds
  6045                              <2>                 o16 push %1
  6046                              <2>         %elifidni %1, es
  6047                              <2>                 o16 push %1
  6048                              <2>         %elifidni %1, fs
  6049                              <2>                 o16 push %1
  6050                              <2>         %elifidni %1, gs
  6051                              <2>                 o16 push %1
  6052                              <2>         %elifidni %1, word cs
  6053                              <2>                 o16 push %1
  6054                              <2>         %elifidni %1, word ds
  6055                              <2>                 o16 push %1
  6056                              <2>         %elifidni %1, word es
  6057                              <2>                 o16 push %1
  6058                              <2>         %elifidni %1, word fs
  6059                              <2>                 o16 push %1
  6060                              <2>         %elifidni %1, word gs
  6061                              <2>                 o16 push %1
  6062                              <2>         %else
  6063 00000616 66FF750C            <2>                 push %1
  6064                              <2>         %endif
  6065                              <2> 
  6066                              <2>         %rotate -1
  6067                              <2> 
  6068                              <2> 
  6069                              <2> 
  6070                              <2> 
  6071                              <2> 
  6072                              <2> 
  6073                              <2> 
  6074                              <2>         %ifidni %1, cs
  6075                              <2>                 o16 push %1
  6076                              <2>         %elifidni %1, ds
  6077                              <2>                 o16 push %1
  6078                              <2>         %elifidni %1, es
  6079                              <2>                 o16 push %1
  6080                              <2>         %elifidni %1, fs
  6081                              <2>                 o16 push %1
  6082                              <2>         %elifidni %1, gs
  6083                              <2>                 o16 push %1
  6084                              <2>         %elifidni %1, word cs
  6085                              <2>                 o16 push %1
  6086                              <2>         %elifidni %1, word ds
  6087                              <2>                 o16 push %1
  6088                              <2>         %elifidni %1, word es
  6089                              <2>                 o16 push %1
  6090                              <2>         %elifidni %1, word fs
  6091                              <2>                 o16 push %1
  6092                              <2>         %elifidni %1, word gs
  6093                              <2>                 o16 push %1
  6094                              <2>         %else
  6095 0000061A FF7508              <2>                 push %1
  6096                              <2>         %endif
  6097                              <2> 
  6098                              <2>         %rotate -1
  6099 0000061D E834FCFFFF          <1> call %1
  6100                              <1> %if (%0!=1)
  6101 00000622 83C410              <1>         add esp, byte %1_arglen
  6102                              <1> %endif
  6103                                      invoke _DrawPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word cx, word dx, dword [ebp + .Color]
  6104                              <1> %rotate -1
  6105                              <1> 
  6106                              <1> %rep (%0-1)
  6107                              <1> 
  6108                              <1> 
  6109                              <1> 
  6110                              <1> 
  6111                              <1> 
  6112                              <1> 
  6113                              <1> 
  6114                              <1>         %ifidni %1, cs
  6115                              <1>                 o16 push %1
  6116                              <1>         %elifidni %1, ds
  6117                              <1>                 o16 push %1
  6118                              <1>         %elifidni %1, es
  6119                              <1>                 o16 push %1
  6120                              <1>         %elifidni %1, fs
  6121                              <1>                 o16 push %1
  6122                              <1>         %elifidni %1, gs
  6123                              <1>                 o16 push %1
  6124                              <1>         %elifidni %1, word cs
  6125                              <1>                 o16 push %1
  6126                              <1>         %elifidni %1, word ds
  6127                              <1>                 o16 push %1
  6128                              <1>         %elifidni %1, word es
  6129                              <1>                 o16 push %1
  6130                              <1>         %elifidni %1, word fs
  6131                              <1>                 o16 push %1
  6132                              <1>         %elifidni %1, word gs
  6133                              <1>                 o16 push %1
  6134                              <1>         %else
  6135                              <1>                 push %1
  6136                              <1>         %endif
  6137                              <1> 
  6138                              <1>         %rotate -1
  6139                              <1> %endrep
  6140                              <2> 
  6141                              <2> 
  6142                              <2> 
  6143                              <2> 
  6144                              <2> 
  6145                              <2> 
  6146                              <2> 
  6147                              <2>         %ifidni %1, cs
  6148                              <2>                 o16 push %1
  6149                              <2>         %elifidni %1, ds
  6150                              <2>                 o16 push %1
  6151                              <2>         %elifidni %1, es
  6152                              <2>                 o16 push %1
  6153                              <2>         %elifidni %1, fs
  6154                              <2>                 o16 push %1
  6155                              <2>         %elifidni %1, gs
  6156                              <2>                 o16 push %1
  6157                              <2>         %elifidni %1, word cs
  6158                              <2>                 o16 push %1
  6159                              <2>         %elifidni %1, word ds
  6160                              <2>                 o16 push %1
  6161                              <2>         %elifidni %1, word es
  6162                              <2>                 o16 push %1
  6163                              <2>         %elifidni %1, word fs
  6164                              <2>                 o16 push %1
  6165                              <2>         %elifidni %1, word gs
  6166                              <2>                 o16 push %1
  6167                              <2>         %else
  6168 00000625 FF7516              <2>                 push %1
  6169                              <2>         %endif
  6170                              <2> 
  6171                              <2>         %rotate -1
  6172                              <2> 
  6173                              <2> 
  6174                              <2> 
  6175                              <2> 
  6176                              <2> 
  6177                              <2> 
  6178                              <2> 
  6179                              <2>         %ifidni %1, cs
  6180                              <2>                 o16 push %1
  6181                              <2>         %elifidni %1, ds
  6182                              <2>                 o16 push %1
  6183                              <2>         %elifidni %1, es
  6184                              <2>                 o16 push %1
  6185                              <2>         %elifidni %1, fs
  6186                              <2>                 o16 push %1
  6187                              <2>         %elifidni %1, gs
  6188                              <2>                 o16 push %1
  6189                              <2>         %elifidni %1, word cs
  6190                              <2>                 o16 push %1
  6191                              <2>         %elifidni %1, word ds
  6192                              <2>                 o16 push %1
  6193                              <2>         %elifidni %1, word es
  6194                              <2>                 o16 push %1
  6195                              <2>         %elifidni %1, word fs
  6196                              <2>                 o16 push %1
  6197                              <2>         %elifidni %1, word gs
  6198                              <2>                 o16 push %1
  6199                              <2>         %else
  6200 00000628 6652                <2>                 push %1
  6201                              <2>         %endif
  6202                              <2> 
  6203                              <2>         %rotate -1
  6204                              <2> 
  6205                              <2> 
  6206                              <2> 
  6207                              <2> 
  6208                              <2> 
  6209                              <2> 
  6210                              <2> 
  6211                              <2>         %ifidni %1, cs
  6212                              <2>                 o16 push %1
  6213                              <2>         %elifidni %1, ds
  6214                              <2>                 o16 push %1
  6215                              <2>         %elifidni %1, es
  6216                              <2>                 o16 push %1
  6217                              <2>         %elifidni %1, fs
  6218                              <2>                 o16 push %1
  6219                              <2>         %elifidni %1, gs
  6220                              <2>                 o16 push %1
  6221                              <2>         %elifidni %1, word cs
  6222                              <2>                 o16 push %1
  6223                              <2>         %elifidni %1, word ds
  6224                              <2>                 o16 push %1
  6225                              <2>         %elifidni %1, word es
  6226                              <2>                 o16 push %1
  6227                              <2>         %elifidni %1, word fs
  6228                              <2>                 o16 push %1
  6229                              <2>         %elifidni %1, word gs
  6230                              <2>                 o16 push %1
  6231                              <2>         %else
  6232 0000062A 6651                <2>                 push %1
  6233                              <2>         %endif
  6234                              <2> 
  6235                              <2>         %rotate -1
  6236                              <2> 
  6237                              <2> 
  6238                              <2> 
  6239                              <2> 
  6240                              <2> 
  6241                              <2> 
  6242                              <2> 
  6243                              <2>         %ifidni %1, cs
  6244                              <2>                 o16 push %1
  6245                              <2>         %elifidni %1, ds
  6246                              <2>                 o16 push %1
  6247                              <2>         %elifidni %1, es
  6248                              <2>                 o16 push %1
  6249                              <2>         %elifidni %1, fs
  6250                              <2>                 o16 push %1
  6251                              <2>         %elifidni %1, gs
  6252                              <2>                 o16 push %1
  6253                              <2>         %elifidni %1, word cs
  6254                              <2>                 o16 push %1
  6255                              <2>         %elifidni %1, word ds
  6256                              <2>                 o16 push %1
  6257                              <2>         %elifidni %1, word es
  6258                              <2>                 o16 push %1
  6259                              <2>         %elifidni %1, word fs
  6260                              <2>                 o16 push %1
  6261                              <2>         %elifidni %1, word gs
  6262                              <2>                 o16 push %1
  6263                              <2>         %else
  6264 0000062C 66FF750E            <2>                 push %1
  6265                              <2>         %endif
  6266                              <2> 
  6267                              <2>         %rotate -1
  6268                              <2> 
  6269                              <2> 
  6270                              <2> 
  6271                              <2> 
  6272                              <2> 
  6273                              <2> 
  6274                              <2> 
  6275                              <2>         %ifidni %1, cs
  6276                              <2>                 o16 push %1
  6277                              <2>         %elifidni %1, ds
  6278                              <2>                 o16 push %1
  6279                              <2>         %elifidni %1, es
  6280                              <2>                 o16 push %1
  6281                              <2>         %elifidni %1, fs
  6282                              <2>                 o16 push %1
  6283                              <2>         %elifidni %1, gs
  6284                              <2>                 o16 push %1
  6285                              <2>         %elifidni %1, word cs
  6286                              <2>                 o16 push %1
  6287                              <2>         %elifidni %1, word ds
  6288                              <2>                 o16 push %1
  6289                              <2>         %elifidni %1, word es
  6290                              <2>                 o16 push %1
  6291                              <2>         %elifidni %1, word fs
  6292                              <2>                 o16 push %1
  6293                              <2>         %elifidni %1, word gs
  6294                              <2>                 o16 push %1
  6295                              <2>         %else
  6296 00000630 66FF750C            <2>                 push %1
  6297                              <2>         %endif
  6298                              <2> 
  6299                              <2>         %rotate -1
  6300                              <2> 
  6301                              <2> 
  6302                              <2> 
  6303                              <2> 
  6304                              <2> 
  6305                              <2> 
  6306                              <2> 
  6307                              <2>         %ifidni %1, cs
  6308                              <2>                 o16 push %1
  6309                              <2>         %elifidni %1, ds
  6310                              <2>                 o16 push %1
  6311                              <2>         %elifidni %1, es
  6312                              <2>                 o16 push %1
  6313                              <2>         %elifidni %1, fs
  6314                              <2>                 o16 push %1
  6315                              <2>         %elifidni %1, gs
  6316                              <2>                 o16 push %1
  6317                              <2>         %elifidni %1, word cs
  6318                              <2>                 o16 push %1
  6319                              <2>         %elifidni %1, word ds
  6320                              <2>                 o16 push %1
  6321                              <2>         %elifidni %1, word es
  6322                              <2>                 o16 push %1
  6323                              <2>         %elifidni %1, word fs
  6324                              <2>                 o16 push %1
  6325                              <2>         %elifidni %1, word gs
  6326                              <2>                 o16 push %1
  6327                              <2>         %else
  6328 00000634 FF7508              <2>                 push %1
  6329                              <2>         %endif
  6330                              <2> 
  6331                              <2>         %rotate -1
  6332 00000637 E81AFCFFFF          <1> call %1
  6333                              <1> %if (%0!=1)
  6334 0000063C 83C410              <1>         add esp, byte %1_arglen
  6335                              <1> %endif
  6336                                  
  6337                                  
  6338                                  
  6339                                  
  6340                                  					; DrawPixel(x + ydist, y + xdist)
  6341                                  					; DrawPixel(x - ydist, y + xdist)
  6342                                  					; DrawPixel(x + ydist, y - xdist)
  6343                                  					; DrawPixel(x - ydist, y - xdist)
  6344                                  
  6345 0000063F 668B4510                    mov ax, word [ebp + .X]
  6346 00000643 6689C1                      mov cx, ax
  6347 00000646 660305[44000000]            add ax, word [_ydist]		; ax = x + ydist
  6348 0000064D 668B5D12                    mov bx, word [ebp + .Y]
  6349 00000651 6689DA                      mov dx, bx
  6350 00000654 66031D[42000000]            add bx, word [_xdist]		; bx = y + xdist
  6351                                  
  6352 0000065B 662B0D[44000000]            sub cx, word [_ydist]		; cx = x - ydist
  6353 00000662 662B15[42000000]            sub dx, word [_xdist]		; dx = y - xdist
  6354                                  
  6355                                      invoke _DrawPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word ax, word bx, dword [ebp + .Color]
  6356                              <1> %rotate -1
  6357                              <1> 
  6358                              <1> %rep (%0-1)
  6359                              <1> 
  6360                              <1> 
  6361                              <1> 
  6362                              <1> 
  6363                              <1> 
  6364                              <1> 
  6365                              <1> 
  6366                              <1>         %ifidni %1, cs
  6367                              <1>                 o16 push %1
  6368                              <1>         %elifidni %1, ds
  6369                              <1>                 o16 push %1
  6370                              <1>         %elifidni %1, es
  6371                              <1>                 o16 push %1
  6372                              <1>         %elifidni %1, fs
  6373                              <1>                 o16 push %1
  6374                              <1>         %elifidni %1, gs
  6375                              <1>                 o16 push %1
  6376                              <1>         %elifidni %1, word cs
  6377                              <1>                 o16 push %1
  6378                              <1>         %elifidni %1, word ds
  6379                              <1>                 o16 push %1
  6380                              <1>         %elifidni %1, word es
  6381                              <1>                 o16 push %1
  6382                              <1>         %elifidni %1, word fs
  6383                              <1>                 o16 push %1
  6384                              <1>         %elifidni %1, word gs
  6385                              <1>                 o16 push %1
  6386                              <1>         %else
  6387                              <1>                 push %1
  6388                              <1>         %endif
  6389                              <1> 
  6390                              <1>         %rotate -1
  6391                              <1> %endrep
  6392                              <2> 
  6393                              <2> 
  6394                              <2> 
  6395                              <2> 
  6396                              <2> 
  6397                              <2> 
  6398                              <2> 
  6399                              <2>         %ifidni %1, cs
  6400                              <2>                 o16 push %1
  6401                              <2>         %elifidni %1, ds
  6402                              <2>                 o16 push %1
  6403                              <2>         %elifidni %1, es
  6404                              <2>                 o16 push %1
  6405                              <2>         %elifidni %1, fs
  6406                              <2>                 o16 push %1
  6407                              <2>         %elifidni %1, gs
  6408                              <2>                 o16 push %1
  6409                              <2>         %elifidni %1, word cs
  6410                              <2>                 o16 push %1
  6411                              <2>         %elifidni %1, word ds
  6412                              <2>                 o16 push %1
  6413                              <2>         %elifidni %1, word es
  6414                              <2>                 o16 push %1
  6415                              <2>         %elifidni %1, word fs
  6416                              <2>                 o16 push %1
  6417                              <2>         %elifidni %1, word gs
  6418                              <2>                 o16 push %1
  6419                              <2>         %else
  6420 00000669 FF7516              <2>                 push %1
  6421                              <2>         %endif
  6422                              <2> 
  6423                              <2>         %rotate -1
  6424                              <2> 
  6425                              <2> 
  6426                              <2> 
  6427                              <2> 
  6428                              <2> 
  6429                              <2> 
  6430                              <2> 
  6431                              <2>         %ifidni %1, cs
  6432                              <2>                 o16 push %1
  6433                              <2>         %elifidni %1, ds
  6434                              <2>                 o16 push %1
  6435                              <2>         %elifidni %1, es
  6436                              <2>                 o16 push %1
  6437                              <2>         %elifidni %1, fs
  6438                              <2>                 o16 push %1
  6439                              <2>         %elifidni %1, gs
  6440                              <2>                 o16 push %1
  6441                              <2>         %elifidni %1, word cs
  6442                              <2>                 o16 push %1
  6443                              <2>         %elifidni %1, word ds
  6444                              <2>                 o16 push %1
  6445                              <2>         %elifidni %1, word es
  6446                              <2>                 o16 push %1
  6447                              <2>         %elifidni %1, word fs
  6448                              <2>                 o16 push %1
  6449                              <2>         %elifidni %1, word gs
  6450                              <2>                 o16 push %1
  6451                              <2>         %else
  6452 0000066C 6653                <2>                 push %1
  6453                              <2>         %endif
  6454                              <2> 
  6455                              <2>         %rotate -1
  6456                              <2> 
  6457                              <2> 
  6458                              <2> 
  6459                              <2> 
  6460                              <2> 
  6461                              <2> 
  6462                              <2> 
  6463                              <2>         %ifidni %1, cs
  6464                              <2>                 o16 push %1
  6465                              <2>         %elifidni %1, ds
  6466                              <2>                 o16 push %1
  6467                              <2>         %elifidni %1, es
  6468                              <2>                 o16 push %1
  6469                              <2>         %elifidni %1, fs
  6470                              <2>                 o16 push %1
  6471                              <2>         %elifidni %1, gs
  6472                              <2>                 o16 push %1
  6473                              <2>         %elifidni %1, word cs
  6474                              <2>                 o16 push %1
  6475                              <2>         %elifidni %1, word ds
  6476                              <2>                 o16 push %1
  6477                              <2>         %elifidni %1, word es
  6478                              <2>                 o16 push %1
  6479                              <2>         %elifidni %1, word fs
  6480                              <2>                 o16 push %1
  6481                              <2>         %elifidni %1, word gs
  6482                              <2>                 o16 push %1
  6483                              <2>         %else
  6484 0000066E 6650                <2>                 push %1
  6485                              <2>         %endif
  6486                              <2> 
  6487                              <2>         %rotate -1
  6488                              <2> 
  6489                              <2> 
  6490                              <2> 
  6491                              <2> 
  6492                              <2> 
  6493                              <2> 
  6494                              <2> 
  6495                              <2>         %ifidni %1, cs
  6496                              <2>                 o16 push %1
  6497                              <2>         %elifidni %1, ds
  6498                              <2>                 o16 push %1
  6499                              <2>         %elifidni %1, es
  6500                              <2>                 o16 push %1
  6501                              <2>         %elifidni %1, fs
  6502                              <2>                 o16 push %1
  6503                              <2>         %elifidni %1, gs
  6504                              <2>                 o16 push %1
  6505                              <2>         %elifidni %1, word cs
  6506                              <2>                 o16 push %1
  6507                              <2>         %elifidni %1, word ds
  6508                              <2>                 o16 push %1
  6509                              <2>         %elifidni %1, word es
  6510                              <2>                 o16 push %1
  6511                              <2>         %elifidni %1, word fs
  6512                              <2>                 o16 push %1
  6513                              <2>         %elifidni %1, word gs
  6514                              <2>                 o16 push %1
  6515                              <2>         %else
  6516 00000670 66FF750E            <2>                 push %1
  6517                              <2>         %endif
  6518                              <2> 
  6519                              <2>         %rotate -1
  6520                              <2> 
  6521                              <2> 
  6522                              <2> 
  6523                              <2> 
  6524                              <2> 
  6525                              <2> 
  6526                              <2> 
  6527                              <2>         %ifidni %1, cs
  6528                              <2>                 o16 push %1
  6529                              <2>         %elifidni %1, ds
  6530                              <2>                 o16 push %1
  6531                              <2>         %elifidni %1, es
  6532                              <2>                 o16 push %1
  6533                              <2>         %elifidni %1, fs
  6534                              <2>                 o16 push %1
  6535                              <2>         %elifidni %1, gs
  6536                              <2>                 o16 push %1
  6537                              <2>         %elifidni %1, word cs
  6538                              <2>                 o16 push %1
  6539                              <2>         %elifidni %1, word ds
  6540                              <2>                 o16 push %1
  6541                              <2>         %elifidni %1, word es
  6542                              <2>                 o16 push %1
  6543                              <2>         %elifidni %1, word fs
  6544                              <2>                 o16 push %1
  6545                              <2>         %elifidni %1, word gs
  6546                              <2>                 o16 push %1
  6547                              <2>         %else
  6548 00000674 66FF750C            <2>                 push %1
  6549                              <2>         %endif
  6550                              <2> 
  6551                              <2>         %rotate -1
  6552                              <2> 
  6553                              <2> 
  6554                              <2> 
  6555                              <2> 
  6556                              <2> 
  6557                              <2> 
  6558                              <2> 
  6559                              <2>         %ifidni %1, cs
  6560                              <2>                 o16 push %1
  6561                              <2>         %elifidni %1, ds
  6562                              <2>                 o16 push %1
  6563                              <2>         %elifidni %1, es
  6564                              <2>                 o16 push %1
  6565                              <2>         %elifidni %1, fs
  6566                              <2>                 o16 push %1
  6567                              <2>         %elifidni %1, gs
  6568                              <2>                 o16 push %1
  6569                              <2>         %elifidni %1, word cs
  6570                              <2>                 o16 push %1
  6571                              <2>         %elifidni %1, word ds
  6572                              <2>                 o16 push %1
  6573                              <2>         %elifidni %1, word es
  6574                              <2>                 o16 push %1
  6575                              <2>         %elifidni %1, word fs
  6576                              <2>                 o16 push %1
  6577                              <2>         %elifidni %1, word gs
  6578                              <2>                 o16 push %1
  6579                              <2>         %else
  6580 00000678 FF7508              <2>                 push %1
  6581                              <2>         %endif
  6582                              <2> 
  6583                              <2>         %rotate -1
  6584 0000067B E8D6FBFFFF          <1> call %1
  6585                              <1> %if (%0!=1)
  6586 00000680 83C410              <1>         add esp, byte %1_arglen
  6587                              <1> %endif
  6588                                      invoke _DrawPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word cx, word bx, dword [ebp + .Color]
  6589                              <1> %rotate -1
  6590                              <1> 
  6591                              <1> %rep (%0-1)
  6592                              <1> 
  6593                              <1> 
  6594                              <1> 
  6595                              <1> 
  6596                              <1> 
  6597                              <1> 
  6598                              <1> 
  6599                              <1>         %ifidni %1, cs
  6600                              <1>                 o16 push %1
  6601                              <1>         %elifidni %1, ds
  6602                              <1>                 o16 push %1
  6603                              <1>         %elifidni %1, es
  6604                              <1>                 o16 push %1
  6605                              <1>         %elifidni %1, fs
  6606                              <1>                 o16 push %1
  6607                              <1>         %elifidni %1, gs
  6608                              <1>                 o16 push %1
  6609                              <1>         %elifidni %1, word cs
  6610                              <1>                 o16 push %1
  6611                              <1>         %elifidni %1, word ds
  6612                              <1>                 o16 push %1
  6613                              <1>         %elifidni %1, word es
  6614                              <1>                 o16 push %1
  6615                              <1>         %elifidni %1, word fs
  6616                              <1>                 o16 push %1
  6617                              <1>         %elifidni %1, word gs
  6618                              <1>                 o16 push %1
  6619                              <1>         %else
  6620                              <1>                 push %1
  6621                              <1>         %endif
  6622                              <1> 
  6623                              <1>         %rotate -1
  6624                              <1> %endrep
  6625                              <2> 
  6626                              <2> 
  6627                              <2> 
  6628                              <2> 
  6629                              <2> 
  6630                              <2> 
  6631                              <2> 
  6632                              <2>         %ifidni %1, cs
  6633                              <2>                 o16 push %1
  6634                              <2>         %elifidni %1, ds
  6635                              <2>                 o16 push %1
  6636                              <2>         %elifidni %1, es
  6637                              <2>                 o16 push %1
  6638                              <2>         %elifidni %1, fs
  6639                              <2>                 o16 push %1
  6640                              <2>         %elifidni %1, gs
  6641                              <2>                 o16 push %1
  6642                              <2>         %elifidni %1, word cs
  6643                              <2>                 o16 push %1
  6644                              <2>         %elifidni %1, word ds
  6645                              <2>                 o16 push %1
  6646                              <2>         %elifidni %1, word es
  6647                              <2>                 o16 push %1
  6648                              <2>         %elifidni %1, word fs
  6649                              <2>                 o16 push %1
  6650                              <2>         %elifidni %1, word gs
  6651                              <2>                 o16 push %1
  6652                              <2>         %else
  6653 00000683 FF7516              <2>                 push %1
  6654                              <2>         %endif
  6655                              <2> 
  6656                              <2>         %rotate -1
  6657                              <2> 
  6658                              <2> 
  6659                              <2> 
  6660                              <2> 
  6661                              <2> 
  6662                              <2> 
  6663                              <2> 
  6664                              <2>         %ifidni %1, cs
  6665                              <2>                 o16 push %1
  6666                              <2>         %elifidni %1, ds
  6667                              <2>                 o16 push %1
  6668                              <2>         %elifidni %1, es
  6669                              <2>                 o16 push %1
  6670                              <2>         %elifidni %1, fs
  6671                              <2>                 o16 push %1
  6672                              <2>         %elifidni %1, gs
  6673                              <2>                 o16 push %1
  6674                              <2>         %elifidni %1, word cs
  6675                              <2>                 o16 push %1
  6676                              <2>         %elifidni %1, word ds
  6677                              <2>                 o16 push %1
  6678                              <2>         %elifidni %1, word es
  6679                              <2>                 o16 push %1
  6680                              <2>         %elifidni %1, word fs
  6681                              <2>                 o16 push %1
  6682                              <2>         %elifidni %1, word gs
  6683                              <2>                 o16 push %1
  6684                              <2>         %else
  6685 00000686 6653                <2>                 push %1
  6686                              <2>         %endif
  6687                              <2> 
  6688                              <2>         %rotate -1
  6689                              <2> 
  6690                              <2> 
  6691                              <2> 
  6692                              <2> 
  6693                              <2> 
  6694                              <2> 
  6695                              <2> 
  6696                              <2>         %ifidni %1, cs
  6697                              <2>                 o16 push %1
  6698                              <2>         %elifidni %1, ds
  6699                              <2>                 o16 push %1
  6700                              <2>         %elifidni %1, es
  6701                              <2>                 o16 push %1
  6702                              <2>         %elifidni %1, fs
  6703                              <2>                 o16 push %1
  6704                              <2>         %elifidni %1, gs
  6705                              <2>                 o16 push %1
  6706                              <2>         %elifidni %1, word cs
  6707                              <2>                 o16 push %1
  6708                              <2>         %elifidni %1, word ds
  6709                              <2>                 o16 push %1
  6710                              <2>         %elifidni %1, word es
  6711                              <2>                 o16 push %1
  6712                              <2>         %elifidni %1, word fs
  6713                              <2>                 o16 push %1
  6714                              <2>         %elifidni %1, word gs
  6715                              <2>                 o16 push %1
  6716                              <2>         %else
  6717 00000688 6651                <2>                 push %1
  6718                              <2>         %endif
  6719                              <2> 
  6720                              <2>         %rotate -1
  6721                              <2> 
  6722                              <2> 
  6723                              <2> 
  6724                              <2> 
  6725                              <2> 
  6726                              <2> 
  6727                              <2> 
  6728                              <2>         %ifidni %1, cs
  6729                              <2>                 o16 push %1
  6730                              <2>         %elifidni %1, ds
  6731                              <2>                 o16 push %1
  6732                              <2>         %elifidni %1, es
  6733                              <2>                 o16 push %1
  6734                              <2>         %elifidni %1, fs
  6735                              <2>                 o16 push %1
  6736                              <2>         %elifidni %1, gs
  6737                              <2>                 o16 push %1
  6738                              <2>         %elifidni %1, word cs
  6739                              <2>                 o16 push %1
  6740                              <2>         %elifidni %1, word ds
  6741                              <2>                 o16 push %1
  6742                              <2>         %elifidni %1, word es
  6743                              <2>                 o16 push %1
  6744                              <2>         %elifidni %1, word fs
  6745                              <2>                 o16 push %1
  6746                              <2>         %elifidni %1, word gs
  6747                              <2>                 o16 push %1
  6748                              <2>         %else
  6749 0000068A 66FF750E            <2>                 push %1
  6750                              <2>         %endif
  6751                              <2> 
  6752                              <2>         %rotate -1
  6753                              <2> 
  6754                              <2> 
  6755                              <2> 
  6756                              <2> 
  6757                              <2> 
  6758                              <2> 
  6759                              <2> 
  6760                              <2>         %ifidni %1, cs
  6761                              <2>                 o16 push %1
  6762                              <2>         %elifidni %1, ds
  6763                              <2>                 o16 push %1
  6764                              <2>         %elifidni %1, es
  6765                              <2>                 o16 push %1
  6766                              <2>         %elifidni %1, fs
  6767                              <2>                 o16 push %1
  6768                              <2>         %elifidni %1, gs
  6769                              <2>                 o16 push %1
  6770                              <2>         %elifidni %1, word cs
  6771                              <2>                 o16 push %1
  6772                              <2>         %elifidni %1, word ds
  6773                              <2>                 o16 push %1
  6774                              <2>         %elifidni %1, word es
  6775                              <2>                 o16 push %1
  6776                              <2>         %elifidni %1, word fs
  6777                              <2>                 o16 push %1
  6778                              <2>         %elifidni %1, word gs
  6779                              <2>                 o16 push %1
  6780                              <2>         %else
  6781 0000068E 66FF750C            <2>                 push %1
  6782                              <2>         %endif
  6783                              <2> 
  6784                              <2>         %rotate -1
  6785                              <2> 
  6786                              <2> 
  6787                              <2> 
  6788                              <2> 
  6789                              <2> 
  6790                              <2> 
  6791                              <2> 
  6792                              <2>         %ifidni %1, cs
  6793                              <2>                 o16 push %1
  6794                              <2>         %elifidni %1, ds
  6795                              <2>                 o16 push %1
  6796                              <2>         %elifidni %1, es
  6797                              <2>                 o16 push %1
  6798                              <2>         %elifidni %1, fs
  6799                              <2>                 o16 push %1
  6800                              <2>         %elifidni %1, gs
  6801                              <2>                 o16 push %1
  6802                              <2>         %elifidni %1, word cs
  6803                              <2>                 o16 push %1
  6804                              <2>         %elifidni %1, word ds
  6805                              <2>                 o16 push %1
  6806                              <2>         %elifidni %1, word es
  6807                              <2>                 o16 push %1
  6808                              <2>         %elifidni %1, word fs
  6809                              <2>                 o16 push %1
  6810                              <2>         %elifidni %1, word gs
  6811                              <2>                 o16 push %1
  6812                              <2>         %else
  6813 00000692 FF7508              <2>                 push %1
  6814                              <2>         %endif
  6815                              <2> 
  6816                              <2>         %rotate -1
  6817 00000695 E8BCFBFFFF          <1> call %1
  6818                              <1> %if (%0!=1)
  6819 0000069A 83C410              <1>         add esp, byte %1_arglen
  6820                              <1> %endif
  6821                                      invoke _DrawPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word ax, word dx, dword [ebp + .Color]
  6822                              <1> %rotate -1
  6823                              <1> 
  6824                              <1> %rep (%0-1)
  6825                              <1> 
  6826                              <1> 
  6827                              <1> 
  6828                              <1> 
  6829                              <1> 
  6830                              <1> 
  6831                              <1> 
  6832                              <1>         %ifidni %1, cs
  6833                              <1>                 o16 push %1
  6834                              <1>         %elifidni %1, ds
  6835                              <1>                 o16 push %1
  6836                              <1>         %elifidni %1, es
  6837                              <1>                 o16 push %1
  6838                              <1>         %elifidni %1, fs
  6839                              <1>                 o16 push %1
  6840                              <1>         %elifidni %1, gs
  6841                              <1>                 o16 push %1
  6842                              <1>         %elifidni %1, word cs
  6843                              <1>                 o16 push %1
  6844                              <1>         %elifidni %1, word ds
  6845                              <1>                 o16 push %1
  6846                              <1>         %elifidni %1, word es
  6847                              <1>                 o16 push %1
  6848                              <1>         %elifidni %1, word fs
  6849                              <1>                 o16 push %1
  6850                              <1>         %elifidni %1, word gs
  6851                              <1>                 o16 push %1
  6852                              <1>         %else
  6853                              <1>                 push %1
  6854                              <1>         %endif
  6855                              <1> 
  6856                              <1>         %rotate -1
  6857                              <1> %endrep
  6858                              <2> 
  6859                              <2> 
  6860                              <2> 
  6861                              <2> 
  6862                              <2> 
  6863                              <2> 
  6864                              <2> 
  6865                              <2>         %ifidni %1, cs
  6866                              <2>                 o16 push %1
  6867                              <2>         %elifidni %1, ds
  6868                              <2>                 o16 push %1
  6869                              <2>         %elifidni %1, es
  6870                              <2>                 o16 push %1
  6871                              <2>         %elifidni %1, fs
  6872                              <2>                 o16 push %1
  6873                              <2>         %elifidni %1, gs
  6874                              <2>                 o16 push %1
  6875                              <2>         %elifidni %1, word cs
  6876                              <2>                 o16 push %1
  6877                              <2>         %elifidni %1, word ds
  6878                              <2>                 o16 push %1
  6879                              <2>         %elifidni %1, word es
  6880                              <2>                 o16 push %1
  6881                              <2>         %elifidni %1, word fs
  6882                              <2>                 o16 push %1
  6883                              <2>         %elifidni %1, word gs
  6884                              <2>                 o16 push %1
  6885                              <2>         %else
  6886 0000069D FF7516              <2>                 push %1
  6887                              <2>         %endif
  6888                              <2> 
  6889                              <2>         %rotate -1
  6890                              <2> 
  6891                              <2> 
  6892                              <2> 
  6893                              <2> 
  6894                              <2> 
  6895                              <2> 
  6896                              <2> 
  6897                              <2>         %ifidni %1, cs
  6898                              <2>                 o16 push %1
  6899                              <2>         %elifidni %1, ds
  6900                              <2>                 o16 push %1
  6901                              <2>         %elifidni %1, es
  6902                              <2>                 o16 push %1
  6903                              <2>         %elifidni %1, fs
  6904                              <2>                 o16 push %1
  6905                              <2>         %elifidni %1, gs
  6906                              <2>                 o16 push %1
  6907                              <2>         %elifidni %1, word cs
  6908                              <2>                 o16 push %1
  6909                              <2>         %elifidni %1, word ds
  6910                              <2>                 o16 push %1
  6911                              <2>         %elifidni %1, word es
  6912                              <2>                 o16 push %1
  6913                              <2>         %elifidni %1, word fs
  6914                              <2>                 o16 push %1
  6915                              <2>         %elifidni %1, word gs
  6916                              <2>                 o16 push %1
  6917                              <2>         %else
  6918 000006A0 6652                <2>                 push %1
  6919                              <2>         %endif
  6920                              <2> 
  6921                              <2>         %rotate -1
  6922                              <2> 
  6923                              <2> 
  6924                              <2> 
  6925                              <2> 
  6926                              <2> 
  6927                              <2> 
  6928                              <2> 
  6929                              <2>         %ifidni %1, cs
  6930                              <2>                 o16 push %1
  6931                              <2>         %elifidni %1, ds
  6932                              <2>                 o16 push %1
  6933                              <2>         %elifidni %1, es
  6934                              <2>                 o16 push %1
  6935                              <2>         %elifidni %1, fs
  6936                              <2>                 o16 push %1
  6937                              <2>         %elifidni %1, gs
  6938                              <2>                 o16 push %1
  6939                              <2>         %elifidni %1, word cs
  6940                              <2>                 o16 push %1
  6941                              <2>         %elifidni %1, word ds
  6942                              <2>                 o16 push %1
  6943                              <2>         %elifidni %1, word es
  6944                              <2>                 o16 push %1
  6945                              <2>         %elifidni %1, word fs
  6946                              <2>                 o16 push %1
  6947                              <2>         %elifidni %1, word gs
  6948                              <2>                 o16 push %1
  6949                              <2>         %else
  6950 000006A2 6650                <2>                 push %1
  6951                              <2>         %endif
  6952                              <2> 
  6953                              <2>         %rotate -1
  6954                              <2> 
  6955                              <2> 
  6956                              <2> 
  6957                              <2> 
  6958                              <2> 
  6959                              <2> 
  6960                              <2> 
  6961                              <2>         %ifidni %1, cs
  6962                              <2>                 o16 push %1
  6963                              <2>         %elifidni %1, ds
  6964                              <2>                 o16 push %1
  6965                              <2>         %elifidni %1, es
  6966                              <2>                 o16 push %1
  6967                              <2>         %elifidni %1, fs
  6968                              <2>                 o16 push %1
  6969                              <2>         %elifidni %1, gs
  6970                              <2>                 o16 push %1
  6971                              <2>         %elifidni %1, word cs
  6972                              <2>                 o16 push %1
  6973                              <2>         %elifidni %1, word ds
  6974                              <2>                 o16 push %1
  6975                              <2>         %elifidni %1, word es
  6976                              <2>                 o16 push %1
  6977                              <2>         %elifidni %1, word fs
  6978                              <2>                 o16 push %1
  6979                              <2>         %elifidni %1, word gs
  6980                              <2>                 o16 push %1
  6981                              <2>         %else
  6982 000006A4 66FF750E            <2>                 push %1
  6983                              <2>         %endif
  6984                              <2> 
  6985                              <2>         %rotate -1
  6986                              <2> 
  6987                              <2> 
  6988                              <2> 
  6989                              <2> 
  6990                              <2> 
  6991                              <2> 
  6992                              <2> 
  6993                              <2>         %ifidni %1, cs
  6994                              <2>                 o16 push %1
  6995                              <2>         %elifidni %1, ds
  6996                              <2>                 o16 push %1
  6997                              <2>         %elifidni %1, es
  6998                              <2>                 o16 push %1
  6999                              <2>         %elifidni %1, fs
  7000                              <2>                 o16 push %1
  7001                              <2>         %elifidni %1, gs
  7002                              <2>                 o16 push %1
  7003                              <2>         %elifidni %1, word cs
  7004                              <2>                 o16 push %1
  7005                              <2>         %elifidni %1, word ds
  7006                              <2>                 o16 push %1
  7007                              <2>         %elifidni %1, word es
  7008                              <2>                 o16 push %1
  7009                              <2>         %elifidni %1, word fs
  7010                              <2>                 o16 push %1
  7011                              <2>         %elifidni %1, word gs
  7012                              <2>                 o16 push %1
  7013                              <2>         %else
  7014 000006A8 66FF750C            <2>                 push %1
  7015                              <2>         %endif
  7016                              <2> 
  7017                              <2>         %rotate -1
  7018                              <2> 
  7019                              <2> 
  7020                              <2> 
  7021                              <2> 
  7022                              <2> 
  7023                              <2> 
  7024                              <2> 
  7025                              <2>         %ifidni %1, cs
  7026                              <2>                 o16 push %1
  7027                              <2>         %elifidni %1, ds
  7028                              <2>                 o16 push %1
  7029                              <2>         %elifidni %1, es
  7030                              <2>                 o16 push %1
  7031                              <2>         %elifidni %1, fs
  7032                              <2>                 o16 push %1
  7033                              <2>         %elifidni %1, gs
  7034                              <2>                 o16 push %1
  7035                              <2>         %elifidni %1, word cs
  7036                              <2>                 o16 push %1
  7037                              <2>         %elifidni %1, word ds
  7038                              <2>                 o16 push %1
  7039                              <2>         %elifidni %1, word es
  7040                              <2>                 o16 push %1
  7041                              <2>         %elifidni %1, word fs
  7042                              <2>                 o16 push %1
  7043                              <2>         %elifidni %1, word gs
  7044                              <2>                 o16 push %1
  7045                              <2>         %else
  7046 000006AC FF7508              <2>                 push %1
  7047                              <2>         %endif
  7048                              <2> 
  7049                              <2>         %rotate -1
  7050 000006AF E8A2FBFFFF          <1> call %1
  7051                              <1> %if (%0!=1)
  7052 000006B4 83C410              <1>         add esp, byte %1_arglen
  7053                              <1> %endif
  7054                                      invoke _DrawPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word cx, word dx, dword [ebp + .Color]
  7055                              <1> %rotate -1
  7056                              <1> 
  7057                              <1> %rep (%0-1)
  7058                              <1> 
  7059                              <1> 
  7060                              <1> 
  7061                              <1> 
  7062                              <1> 
  7063                              <1> 
  7064                              <1> 
  7065                              <1>         %ifidni %1, cs
  7066                              <1>                 o16 push %1
  7067                              <1>         %elifidni %1, ds
  7068                              <1>                 o16 push %1
  7069                              <1>         %elifidni %1, es
  7070                              <1>                 o16 push %1
  7071                              <1>         %elifidni %1, fs
  7072                              <1>                 o16 push %1
  7073                              <1>         %elifidni %1, gs
  7074                              <1>                 o16 push %1
  7075                              <1>         %elifidni %1, word cs
  7076                              <1>                 o16 push %1
  7077                              <1>         %elifidni %1, word ds
  7078                              <1>                 o16 push %1
  7079                              <1>         %elifidni %1, word es
  7080                              <1>                 o16 push %1
  7081                              <1>         %elifidni %1, word fs
  7082                              <1>                 o16 push %1
  7083                              <1>         %elifidni %1, word gs
  7084                              <1>                 o16 push %1
  7085                              <1>         %else
  7086                              <1>                 push %1
  7087                              <1>         %endif
  7088                              <1> 
  7089                              <1>         %rotate -1
  7090                              <1> %endrep
  7091                              <2> 
  7092                              <2> 
  7093                              <2> 
  7094                              <2> 
  7095                              <2> 
  7096                              <2> 
  7097                              <2> 
  7098                              <2>         %ifidni %1, cs
  7099                              <2>                 o16 push %1
  7100                              <2>         %elifidni %1, ds
  7101                              <2>                 o16 push %1
  7102                              <2>         %elifidni %1, es
  7103                              <2>                 o16 push %1
  7104                              <2>         %elifidni %1, fs
  7105                              <2>                 o16 push %1
  7106                              <2>         %elifidni %1, gs
  7107                              <2>                 o16 push %1
  7108                              <2>         %elifidni %1, word cs
  7109                              <2>                 o16 push %1
  7110                              <2>         %elifidni %1, word ds
  7111                              <2>                 o16 push %1
  7112                              <2>         %elifidni %1, word es
  7113                              <2>                 o16 push %1
  7114                              <2>         %elifidni %1, word fs
  7115                              <2>                 o16 push %1
  7116                              <2>         %elifidni %1, word gs
  7117                              <2>                 o16 push %1
  7118                              <2>         %else
  7119 000006B7 FF7516              <2>                 push %1
  7120                              <2>         %endif
  7121                              <2> 
  7122                              <2>         %rotate -1
  7123                              <2> 
  7124                              <2> 
  7125                              <2> 
  7126                              <2> 
  7127                              <2> 
  7128                              <2> 
  7129                              <2> 
  7130                              <2>         %ifidni %1, cs
  7131                              <2>                 o16 push %1
  7132                              <2>         %elifidni %1, ds
  7133                              <2>                 o16 push %1
  7134                              <2>         %elifidni %1, es
  7135                              <2>                 o16 push %1
  7136                              <2>         %elifidni %1, fs
  7137                              <2>                 o16 push %1
  7138                              <2>         %elifidni %1, gs
  7139                              <2>                 o16 push %1
  7140                              <2>         %elifidni %1, word cs
  7141                              <2>                 o16 push %1
  7142                              <2>         %elifidni %1, word ds
  7143                              <2>                 o16 push %1
  7144                              <2>         %elifidni %1, word es
  7145                              <2>                 o16 push %1
  7146                              <2>         %elifidni %1, word fs
  7147                              <2>                 o16 push %1
  7148                              <2>         %elifidni %1, word gs
  7149                              <2>                 o16 push %1
  7150                              <2>         %else
  7151 000006BA 6652                <2>                 push %1
  7152                              <2>         %endif
  7153                              <2> 
  7154                              <2>         %rotate -1
  7155                              <2> 
  7156                              <2> 
  7157                              <2> 
  7158                              <2> 
  7159                              <2> 
  7160                              <2> 
  7161                              <2> 
  7162                              <2>         %ifidni %1, cs
  7163                              <2>                 o16 push %1
  7164                              <2>         %elifidni %1, ds
  7165                              <2>                 o16 push %1
  7166                              <2>         %elifidni %1, es
  7167                              <2>                 o16 push %1
  7168                              <2>         %elifidni %1, fs
  7169                              <2>                 o16 push %1
  7170                              <2>         %elifidni %1, gs
  7171                              <2>                 o16 push %1
  7172                              <2>         %elifidni %1, word cs
  7173                              <2>                 o16 push %1
  7174                              <2>         %elifidni %1, word ds
  7175                              <2>                 o16 push %1
  7176                              <2>         %elifidni %1, word es
  7177                              <2>                 o16 push %1
  7178                              <2>         %elifidni %1, word fs
  7179                              <2>                 o16 push %1
  7180                              <2>         %elifidni %1, word gs
  7181                              <2>                 o16 push %1
  7182                              <2>         %else
  7183 000006BC 6651                <2>                 push %1
  7184                              <2>         %endif
  7185                              <2> 
  7186                              <2>         %rotate -1
  7187                              <2> 
  7188                              <2> 
  7189                              <2> 
  7190                              <2> 
  7191                              <2> 
  7192                              <2> 
  7193                              <2> 
  7194                              <2>         %ifidni %1, cs
  7195                              <2>                 o16 push %1
  7196                              <2>         %elifidni %1, ds
  7197                              <2>                 o16 push %1
  7198                              <2>         %elifidni %1, es
  7199                              <2>                 o16 push %1
  7200                              <2>         %elifidni %1, fs
  7201                              <2>                 o16 push %1
  7202                              <2>         %elifidni %1, gs
  7203                              <2>                 o16 push %1
  7204                              <2>         %elifidni %1, word cs
  7205                              <2>                 o16 push %1
  7206                              <2>         %elifidni %1, word ds
  7207                              <2>                 o16 push %1
  7208                              <2>         %elifidni %1, word es
  7209                              <2>                 o16 push %1
  7210                              <2>         %elifidni %1, word fs
  7211                              <2>                 o16 push %1
  7212                              <2>         %elifidni %1, word gs
  7213                              <2>                 o16 push %1
  7214                              <2>         %else
  7215 000006BE 66FF750E            <2>                 push %1
  7216                              <2>         %endif
  7217                              <2> 
  7218                              <2>         %rotate -1
  7219                              <2> 
  7220                              <2> 
  7221                              <2> 
  7222                              <2> 
  7223                              <2> 
  7224                              <2> 
  7225                              <2> 
  7226                              <2>         %ifidni %1, cs
  7227                              <2>                 o16 push %1
  7228                              <2>         %elifidni %1, ds
  7229                              <2>                 o16 push %1
  7230                              <2>         %elifidni %1, es
  7231                              <2>                 o16 push %1
  7232                              <2>         %elifidni %1, fs
  7233                              <2>                 o16 push %1
  7234                              <2>         %elifidni %1, gs
  7235                              <2>                 o16 push %1
  7236                              <2>         %elifidni %1, word cs
  7237                              <2>                 o16 push %1
  7238                              <2>         %elifidni %1, word ds
  7239                              <2>                 o16 push %1
  7240                              <2>         %elifidni %1, word es
  7241                              <2>                 o16 push %1
  7242                              <2>         %elifidni %1, word fs
  7243                              <2>                 o16 push %1
  7244                              <2>         %elifidni %1, word gs
  7245                              <2>                 o16 push %1
  7246                              <2>         %else
  7247 000006C2 66FF750C            <2>                 push %1
  7248                              <2>         %endif
  7249                              <2> 
  7250                              <2>         %rotate -1
  7251                              <2> 
  7252                              <2> 
  7253                              <2> 
  7254                              <2> 
  7255                              <2> 
  7256                              <2> 
  7257                              <2> 
  7258                              <2>         %ifidni %1, cs
  7259                              <2>                 o16 push %1
  7260                              <2>         %elifidni %1, ds
  7261                              <2>                 o16 push %1
  7262                              <2>         %elifidni %1, es
  7263                              <2>                 o16 push %1
  7264                              <2>         %elifidni %1, fs
  7265                              <2>                 o16 push %1
  7266                              <2>         %elifidni %1, gs
  7267                              <2>                 o16 push %1
  7268                              <2>         %elifidni %1, word cs
  7269                              <2>                 o16 push %1
  7270                              <2>         %elifidni %1, word ds
  7271                              <2>                 o16 push %1
  7272                              <2>         %elifidni %1, word es
  7273                              <2>                 o16 push %1
  7274                              <2>         %elifidni %1, word fs
  7275                              <2>                 o16 push %1
  7276                              <2>         %elifidni %1, word gs
  7277                              <2>                 o16 push %1
  7278                              <2>         %else
  7279 000006C6 FF7508              <2>                 push %1
  7280                              <2>         %endif
  7281                              <2> 
  7282                              <2>         %rotate -1
  7283 000006C9 E888FBFFFF          <1> call %1
  7284                              <1> %if (%0!=1)
  7285 000006CE 83C410              <1>         add esp, byte %1_arglen
  7286                              <1> %endif
  7287                                  
  7288                                  
  7289                                  
  7290                                  
  7291 000006D1 66FF05[42000000]            inc word [_xdist]
  7292                                  
  7293                                  
  7294 000006D8 66813D[40000000]00-         cmp word [_circleerror], 0
  7295 000006E0 00                 
  7296 000006E1 0F8D1D000000                jge near .NonnegError
  7297                                  
  7298                                  
  7299                                      ;--- If (circleerror < 0) then -----------------------------------
  7300                                      ;								     ;
  7301 000006E7 66A1[42000000]              mov ax, word [_xdist]					     ;
  7302 000006ED 66D1E0                      shl ax, 1							     ;
  7303 000006F0 6640                        inc ax							     ;
  7304 000006F2 660305[40000000]            add ax, word [_circleerror]					     ;
  7305 000006F9 66A3[40000000]              mov word [_circleerror], ax					     ;
  7306 000006FF E926000000                  jmp near .LoopCheck						     ;
  7307                                      ;								     ;
  7308                                      ;-----------------------------------------------------------------
  7309                                  
  7310                                      ;--- Else (circleerror >= 0) -------------------------------------
  7311                                      ;								     ;
  7312                                      .NonnegError:						     ;
  7313 00000704 66FF0D[44000000]            dec word [_ydist]						     ;
  7314 0000070B 66A1[42000000]              mov ax, word [_xdist]					     ;
  7315 00000711 662B05[44000000]            sub ax, word [_ydist]					     ;
  7316 00000718 66D1E0                      shl ax, 1							     ;
  7317 0000071B 6640                        inc ax							     ;
  7318 0000071D 660305[40000000]            add ax, word [_circleerror]					     ;
  7319 00000724 66A3[40000000]              mov word [_circleerror], ax					     ;
  7320                                      ;								     ;
  7321                                      ;-----------------------------------------------------------------
  7322                                  
  7323                                  
  7324                                   ;----------
  7325                                   .LoopCheck:
  7326                                   ;----------
  7327                                  
  7328 0000072A 66A1[42000000]              mov ax, word [_xdist]		; Repeat PixelLoop as long as
  7329 00000730 663B05[44000000]            cmp ax, word [_ydist]		; (xdist <= ydist) is true
  7330 00000737 0F8E70FEFFFF                jle near .PixelLoop
  7331                                  
  7332                                  
  7333                                  
  7334                                  
  7335 0000073D 817D1A00000000           cmp dword [ebp + .FillCircleFlag], 0	; Check whether or not to fill circle
  7336 00000744 0F8423000000             jz near .End
  7337                                  
  7338                                   invoke	_FloodFill, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [ebp + .X], word [ebp + .Y], dword [ebp + .Color], dword 0
  7339                              <1> %rotate -1
  7340                              <1> 
  7341                              <1> %rep (%0-1)
  7342                              <1> 
  7343                              <1> 
  7344                              <1> 
  7345                              <1> 
  7346                              <1> 
  7347                              <1> 
  7348                              <1> 
  7349                              <1>         %ifidni %1, cs
  7350                              <1>                 o16 push %1
  7351                              <1>         %elifidni %1, ds
  7352                              <1>                 o16 push %1
  7353                              <1>         %elifidni %1, es
  7354                              <1>                 o16 push %1
  7355                              <1>         %elifidni %1, fs
  7356                              <1>                 o16 push %1
  7357                              <1>         %elifidni %1, gs
  7358                              <1>                 o16 push %1
  7359                              <1>         %elifidni %1, word cs
  7360                              <1>                 o16 push %1
  7361                              <1>         %elifidni %1, word ds
  7362                              <1>                 o16 push %1
  7363                              <1>         %elifidni %1, word es
  7364                              <1>                 o16 push %1
  7365                              <1>         %elifidni %1, word fs
  7366                              <1>                 o16 push %1
  7367                              <1>         %elifidni %1, word gs
  7368                              <1>                 o16 push %1
  7369                              <1>         %else
  7370                              <1>                 push %1
  7371                              <1>         %endif
  7372                              <1> 
  7373                              <1>         %rotate -1
  7374                              <1> %endrep
  7375                              <2> 
  7376                              <2> 
  7377                              <2> 
  7378                              <2> 
  7379                              <2> 
  7380                              <2> 
  7381                              <2> 
  7382                              <2>         %ifidni %1, cs
  7383                              <2>                 o16 push %1
  7384                              <2>         %elifidni %1, ds
  7385                              <2>                 o16 push %1
  7386                              <2>         %elifidni %1, es
  7387                              <2>                 o16 push %1
  7388                              <2>         %elifidni %1, fs
  7389                              <2>                 o16 push %1
  7390                              <2>         %elifidni %1, gs
  7391                              <2>                 o16 push %1
  7392                              <2>         %elifidni %1, word cs
  7393                              <2>                 o16 push %1
  7394                              <2>         %elifidni %1, word ds
  7395                              <2>                 o16 push %1
  7396                              <2>         %elifidni %1, word es
  7397                              <2>                 o16 push %1
  7398                              <2>         %elifidni %1, word fs
  7399                              <2>                 o16 push %1
  7400                              <2>         %elifidni %1, word gs
  7401                              <2>                 o16 push %1
  7402                              <2>         %else
  7403 0000074A 6800000000          <2>                 push %1
  7404                              <2>         %endif
  7405                              <2> 
  7406                              <2>         %rotate -1
  7407                              <2> 
  7408                              <2> 
  7409                              <2> 
  7410                              <2> 
  7411                              <2> 
  7412                              <2> 
  7413                              <2> 
  7414                              <2>         %ifidni %1, cs
  7415                              <2>                 o16 push %1
  7416                              <2>         %elifidni %1, ds
  7417                              <2>                 o16 push %1
  7418                              <2>         %elifidni %1, es
  7419                              <2>                 o16 push %1
  7420                              <2>         %elifidni %1, fs
  7421                              <2>                 o16 push %1
  7422                              <2>         %elifidni %1, gs
  7423                              <2>                 o16 push %1
  7424                              <2>         %elifidni %1, word cs
  7425                              <2>                 o16 push %1
  7426                              <2>         %elifidni %1, word ds
  7427                              <2>                 o16 push %1
  7428                              <2>         %elifidni %1, word es
  7429                              <2>                 o16 push %1
  7430                              <2>         %elifidni %1, word fs
  7431                              <2>                 o16 push %1
  7432                              <2>         %elifidni %1, word gs
  7433                              <2>                 o16 push %1
  7434                              <2>         %else
  7435 0000074F FF7516              <2>                 push %1
  7436                              <2>         %endif
  7437                              <2> 
  7438                              <2>         %rotate -1
  7439                              <2> 
  7440                              <2> 
  7441                              <2> 
  7442                              <2> 
  7443                              <2> 
  7444                              <2> 
  7445                              <2> 
  7446                              <2>         %ifidni %1, cs
  7447                              <2>                 o16 push %1
  7448                              <2>         %elifidni %1, ds
  7449                              <2>                 o16 push %1
  7450                              <2>         %elifidni %1, es
  7451                              <2>                 o16 push %1
  7452                              <2>         %elifidni %1, fs
  7453                              <2>                 o16 push %1
  7454                              <2>         %elifidni %1, gs
  7455                              <2>                 o16 push %1
  7456                              <2>         %elifidni %1, word cs
  7457                              <2>                 o16 push %1
  7458                              <2>         %elifidni %1, word ds
  7459                              <2>                 o16 push %1
  7460                              <2>         %elifidni %1, word es
  7461                              <2>                 o16 push %1
  7462                              <2>         %elifidni %1, word fs
  7463                              <2>                 o16 push %1
  7464                              <2>         %elifidni %1, word gs
  7465                              <2>                 o16 push %1
  7466                              <2>         %else
  7467 00000752 66FF7512            <2>                 push %1
  7468                              <2>         %endif
  7469                              <2> 
  7470                              <2>         %rotate -1
  7471                              <2> 
  7472                              <2> 
  7473                              <2> 
  7474                              <2> 
  7475                              <2> 
  7476                              <2> 
  7477                              <2> 
  7478                              <2>         %ifidni %1, cs
  7479                              <2>                 o16 push %1
  7480                              <2>         %elifidni %1, ds
  7481                              <2>                 o16 push %1
  7482                              <2>         %elifidni %1, es
  7483                              <2>                 o16 push %1
  7484                              <2>         %elifidni %1, fs
  7485                              <2>                 o16 push %1
  7486                              <2>         %elifidni %1, gs
  7487                              <2>                 o16 push %1
  7488                              <2>         %elifidni %1, word cs
  7489                              <2>                 o16 push %1
  7490                              <2>         %elifidni %1, word ds
  7491                              <2>                 o16 push %1
  7492                              <2>         %elifidni %1, word es
  7493                              <2>                 o16 push %1
  7494                              <2>         %elifidni %1, word fs
  7495                              <2>                 o16 push %1
  7496                              <2>         %elifidni %1, word gs
  7497                              <2>                 o16 push %1
  7498                              <2>         %else
  7499 00000756 66FF7510            <2>                 push %1
  7500                              <2>         %endif
  7501                              <2> 
  7502                              <2>         %rotate -1
  7503                              <2> 
  7504                              <2> 
  7505                              <2> 
  7506                              <2> 
  7507                              <2> 
  7508                              <2> 
  7509                              <2> 
  7510                              <2>         %ifidni %1, cs
  7511                              <2>                 o16 push %1
  7512                              <2>         %elifidni %1, ds
  7513                              <2>                 o16 push %1
  7514                              <2>         %elifidni %1, es
  7515                              <2>                 o16 push %1
  7516                              <2>         %elifidni %1, fs
  7517                              <2>                 o16 push %1
  7518                              <2>         %elifidni %1, gs
  7519                              <2>                 o16 push %1
  7520                              <2>         %elifidni %1, word cs
  7521                              <2>                 o16 push %1
  7522                              <2>         %elifidni %1, word ds
  7523                              <2>                 o16 push %1
  7524                              <2>         %elifidni %1, word es
  7525                              <2>                 o16 push %1
  7526                              <2>         %elifidni %1, word fs
  7527                              <2>                 o16 push %1
  7528                              <2>         %elifidni %1, word gs
  7529                              <2>                 o16 push %1
  7530                              <2>         %else
  7531 0000075A 66FF750E            <2>                 push %1
  7532                              <2>         %endif
  7533                              <2> 
  7534                              <2>         %rotate -1
  7535                              <2> 
  7536                              <2> 
  7537                              <2> 
  7538                              <2> 
  7539                              <2> 
  7540                              <2> 
  7541                              <2> 
  7542                              <2>         %ifidni %1, cs
  7543                              <2>                 o16 push %1
  7544                              <2>         %elifidni %1, ds
  7545                              <2>                 o16 push %1
  7546                              <2>         %elifidni %1, es
  7547                              <2>                 o16 push %1
  7548                              <2>         %elifidni %1, fs
  7549                              <2>                 o16 push %1
  7550                              <2>         %elifidni %1, gs
  7551                              <2>                 o16 push %1
  7552                              <2>         %elifidni %1, word cs
  7553                              <2>                 o16 push %1
  7554                              <2>         %elifidni %1, word ds
  7555                              <2>                 o16 push %1
  7556                              <2>         %elifidni %1, word es
  7557                              <2>                 o16 push %1
  7558                              <2>         %elifidni %1, word fs
  7559                              <2>                 o16 push %1
  7560                              <2>         %elifidni %1, word gs
  7561                              <2>                 o16 push %1
  7562                              <2>         %else
  7563 0000075E 66FF750C            <2>                 push %1
  7564                              <2>         %endif
  7565                              <2> 
  7566                              <2>         %rotate -1
  7567                              <2> 
  7568                              <2> 
  7569                              <2> 
  7570                              <2> 
  7571                              <2> 
  7572                              <2> 
  7573                              <2> 
  7574                              <2>         %ifidni %1, cs
  7575                              <2>                 o16 push %1
  7576                              <2>         %elifidni %1, ds
  7577                              <2>                 o16 push %1
  7578                              <2>         %elifidni %1, es
  7579                              <2>                 o16 push %1
  7580                              <2>         %elifidni %1, fs
  7581                              <2>                 o16 push %1
  7582                              <2>         %elifidni %1, gs
  7583                              <2>                 o16 push %1
  7584                              <2>         %elifidni %1, word cs
  7585                              <2>                 o16 push %1
  7586                              <2>         %elifidni %1, word ds
  7587                              <2>                 o16 push %1
  7588                              <2>         %elifidni %1, word es
  7589                              <2>                 o16 push %1
  7590                              <2>         %elifidni %1, word fs
  7591                              <2>                 o16 push %1
  7592                              <2>         %elifidni %1, word gs
  7593                              <2>                 o16 push %1
  7594                              <2>         %else
  7595 00000762 FF7508              <2>                 push %1
  7596                              <2>         %endif
  7597                              <2> 
  7598                              <2>         %rotate -1
  7599 00000765 E854050000          <1> call %1
  7600                              <1> %if (%0!=1)
  7601 0000076A 83C414              <1>         add esp, byte %1_arglen
  7602                              <1> %endif
  7603                                  
  7604                                  
  7605                                  
  7606                                   ;----
  7607                                   .End:
  7608                                   ;----
  7609 0000076D 665A                        pop dx				; Restore registers
  7610 0000076F 6659                        pop cx
  7611 00000771 665B                        pop bx
  7612 00000773 6658                        pop ax
  7613                                      ret
  7614                              <1> %ifnctx proc
  7615                              <1> 	ret	%1
  7616                              <1> %else
  7617 00000775 89EC                <1> 	mov	esp, ebp
  7618 00000777 5D                  <1> 	pop	ebp
  7619 00000778 C3                  <1> 	ret	%1
  7620                              <1> %endif
  7621                                  
  7622                                  endproc
  7623                              <1> %ifnctx proc
  7624                              <1> %error Mismatched `endproc'/`proc'
  7625                              <1> %else
  7626                              <1> 
  7627                              <1> 
  7628                              <1> %ifdef LEGACY_ENDPROC
  7629                              <1>         ret
  7630                              <1> %endif
  7631                              <1> 
  7632                              <1> 
  7633                              <1> 
  7634                              <1> 
  7635                              <1> 
  7636                              <1> 
  7637                              <1> 
  7638                              <1> 
  7639                              <1> 
  7640                              <1> %pop
  7641                              <1> %endif
  7642                                  _DrawCircle_arglen	EQU	22
  7643                                  
  7644                                  
  7645                                  
  7646                                  
  7647                                  
  7648                                  
  7649                                  
  7650                                  ;-------------------------------------------------------------------------;
  7651                                  ; DrawText()								  ;
  7652                                  ;									  ;
  7653                                  ;   void _DrawText(dword StringOff, dword DestOff, word DestWidth,	  ;
  7654                                  ;		   word DestHeight, word X, word Y, dword Color)	  ;
  7655                                  ;									  ;
  7656                                  ;   Inputs: StringOff = offset of string to draw			  ;
  7657                                  ;	    DestOff = offset of an image buffer in memory		  ;
  7658                                  ;	    DestWidth = width of the buffer				  ;
  7659                                  ;	    DestHeight = height of the buffer				  ;
  7660                                  ;	    X = x coordinate of start point				  ;
  7661                                  ;	    Y = y coordinate of start point				  ;
  7662                                  ;	    Color = color of the string to draw				  ;
  7663                                  ;	    [_FontOff] = offset of font image data			  ;
  7664                                  ;									  ;
  7665                                  ;   Outputs: String drawn to buffer					  ;
  7666                                  ;									  ;
  7667                                  ;   Calls: _PointInBox							  ;
  7668                                  ;									  ;
  7669                                  ;   Returns: none							  ;
  7670                                  ;									  ;
  7671                                  ;   Purpose: Draws a text string pointed to by StringOff with color	  ;
  7672                                  ;	     Color at point (X,Y) in the buffer pointed to by DestOff 	  ;
  7673                                  ;									  ;
  7674                                  ;-------------------------------------------------------------------------;
  7675                                  proc _DrawText
  7676                              <1> %push proc
  7677                              <1>           global %1
  7678 00000779 55                  <1> %1:       push  ebp
  7679 0000077A 89E5                <1>           mov   ebp, esp
  7680                              <1> %assign %$arg 8
  7681                              <1> 
  7682                              <1> %define %$procname %1
  7683                                  .StringOff	arg	4
  7684                              <1> .StringOff       equ %$arg
  7685                              <1> 
  7686                              <1> 
  7687                              <1> %assign %$arg %1+%$arg
  7688                                  .DestOff	arg	4
  7689                              <1> .DestOff       equ %$arg
  7690                              <1> 
  7691                              <1> 
  7692                              <1> %assign %$arg %1+%$arg
  7693                                  .DestWidth	arg	2
  7694                              <1> .DestWidth       equ %$arg
  7695                              <1> 
  7696                              <1> 
  7697                              <1> %assign %$arg %1+%$arg
  7698                                  .DestHeight	arg	2
  7699                              <1> .DestHeight       equ %$arg
  7700                              <1> 
  7701                              <1> 
  7702                              <1> %assign %$arg %1+%$arg
  7703                                  .X		arg	2
  7704                              <1> .X       equ %$arg
  7705                              <1> 
  7706                              <1> 
  7707                              <1> %assign %$arg %1+%$arg
  7708                                  .Y		arg	2
  7709                              <1> .Y       equ %$arg
  7710                              <1> 
  7711                              <1> 
  7712                              <1> %assign %$arg %1+%$arg
  7713                                  .Color		arg	4
  7714                              <1> .Color       equ %$arg
  7715                              <1> 
  7716                              <1> 
  7717                              <1> %assign %$arg %1+%$arg
  7718                                  
  7719                                  ;invoke	_libDrawText, dword [ebp+.StringOff], dword [ebp+.DestOff], word [ebp+.DestWidth], word [ebp+.DestHeight], word [ebp+.X], word [ebp+.Y], dword [ebp+.Color]
  7720                                  ;ret
  7721                                  
  7722                                  
  7723                                  
  7724 0000077C 60                       pushad						; Save registers
  7725                                  
  7726                                  
  7727 0000077D 668B4514                 mov ax, word [ebp+.X]
  7728 00000781 66A3[28000000]           mov word [_x], ax				; Use _x = X coord
  7729                                  
  7730 00000787 668B4516                 mov ax, word [ebp+.Y]
  7731 0000078B 66A3[2A000000]           mov word [_y], ax				; Use _y = Y coord
  7732                                  
  7733 00000791 66C705[2C000000]00-      mov word [_dx], 0				; String offset
  7734 00000799 00                 
  7735                                  
  7736                                  
  7737                                  
  7738                                  
  7739                                   ;--------------
  7740                                   .PositionCheck:
  7741                                   ;--------------
  7742 0000079A 8B4508                      mov eax, dword [ebp+.StringOff]
  7743 0000079D 0FB71D[2C000000]            movzx ebx, word [_dx]
  7744 000007A4 01D8                        add eax, ebx
  7745                                  
  7746 000007A6 8A18                        mov bl, byte [eax]				; bl = character in string
  7747 000007A8 80FB24                      cmp bl, '$'
  7748 000007AB 0F8411010000                je near .End				; we are at the end of the string
  7749                                  
  7750 000007B1 84DB                        test bl, bl
  7751 000007B3 0F8409010000                jz near .End
  7752                                  
  7753                                  
  7754 000007B9 0FB6CB                      movzx ecx, bl
  7755 000007BC C1E106                      shl ecx, 6
  7756 000007BF 8B35[1A000000]              mov esi, dword [_FontOff]
  7757 000007C5 01CE                        add esi, ecx
  7758                                  
  7759 000007C7 6631D2                      xor dx, dx
  7760 000007CA 6631C9                      xor cx, cx
  7761                                  
  7762                                  
  7763                                  
  7764                                   ;----------
  7765                                   .NextPoint:
  7766                                   ;----------
  7767                                      invoke _PointInBox, word [_x], word [_y], word 0, word 0, word [ebp + .DestWidth], word [ebp + .DestHeight]
  7768                              <1> %rotate -1
  7769                              <1> 
  7770                              <1> %rep (%0-1)
  7771                              <1> 
  7772                              <1> 
  7773                              <1> 
  7774                              <1> 
  7775                              <1> 
  7776                              <1> 
  7777                              <1> 
  7778                              <1>         %ifidni %1, cs
  7779                              <1>                 o16 push %1
  7780                              <1>         %elifidni %1, ds
  7781                              <1>                 o16 push %1
  7782                              <1>         %elifidni %1, es
  7783                              <1>                 o16 push %1
  7784                              <1>         %elifidni %1, fs
  7785                              <1>                 o16 push %1
  7786                              <1>         %elifidni %1, gs
  7787                              <1>                 o16 push %1
  7788                              <1>         %elifidni %1, word cs
  7789                              <1>                 o16 push %1
  7790                              <1>         %elifidni %1, word ds
  7791                              <1>                 o16 push %1
  7792                              <1>         %elifidni %1, word es
  7793                              <1>                 o16 push %1
  7794                              <1>         %elifidni %1, word fs
  7795                              <1>                 o16 push %1
  7796                              <1>         %elifidni %1, word gs
  7797                              <1>                 o16 push %1
  7798                              <1>         %else
  7799                              <1>                 push %1
  7800                              <1>         %endif
  7801                              <1> 
  7802                              <1>         %rotate -1
  7803                              <1> %endrep
  7804                              <2> 
  7805                              <2> 
  7806                              <2> 
  7807                              <2> 
  7808                              <2> 
  7809                              <2> 
  7810                              <2> 
  7811                              <2>         %ifidni %1, cs
  7812                              <2>                 o16 push %1
  7813                              <2>         %elifidni %1, ds
  7814                              <2>                 o16 push %1
  7815                              <2>         %elifidni %1, es
  7816                              <2>                 o16 push %1
  7817                              <2>         %elifidni %1, fs
  7818                              <2>                 o16 push %1
  7819                              <2>         %elifidni %1, gs
  7820                              <2>                 o16 push %1
  7821                              <2>         %elifidni %1, word cs
  7822                              <2>                 o16 push %1
  7823                              <2>         %elifidni %1, word ds
  7824                              <2>                 o16 push %1
  7825                              <2>         %elifidni %1, word es
  7826                              <2>                 o16 push %1
  7827                              <2>         %elifidni %1, word fs
  7828                              <2>                 o16 push %1
  7829                              <2>         %elifidni %1, word gs
  7830                              <2>                 o16 push %1
  7831                              <2>         %else
  7832 000007CD 66FF7512            <2>                 push %1
  7833                              <2>         %endif
  7834                              <2> 
  7835                              <2>         %rotate -1
  7836                              <2> 
  7837                              <2> 
  7838                              <2> 
  7839                              <2> 
  7840                              <2> 
  7841                              <2> 
  7842                              <2> 
  7843                              <2>         %ifidni %1, cs
  7844                              <2>                 o16 push %1
  7845                              <2>         %elifidni %1, ds
  7846                              <2>                 o16 push %1
  7847                              <2>         %elifidni %1, es
  7848                              <2>                 o16 push %1
  7849                              <2>         %elifidni %1, fs
  7850                              <2>                 o16 push %1
  7851                              <2>         %elifidni %1, gs
  7852                              <2>                 o16 push %1
  7853                              <2>         %elifidni %1, word cs
  7854                              <2>                 o16 push %1
  7855                              <2>         %elifidni %1, word ds
  7856                              <2>                 o16 push %1
  7857                              <2>         %elifidni %1, word es
  7858                              <2>                 o16 push %1
  7859                              <2>         %elifidni %1, word fs
  7860                              <2>                 o16 push %1
  7861                              <2>         %elifidni %1, word gs
  7862                              <2>                 o16 push %1
  7863                              <2>         %else
  7864 000007D1 66FF7510            <2>                 push %1
  7865                              <2>         %endif
  7866                              <2> 
  7867                              <2>         %rotate -1
  7868                              <2> 
  7869                              <2> 
  7870                              <2> 
  7871                              <2> 
  7872                              <2> 
  7873                              <2> 
  7874                              <2> 
  7875                              <2>         %ifidni %1, cs
  7876                              <2>                 o16 push %1
  7877                              <2>         %elifidni %1, ds
  7878                              <2>                 o16 push %1
  7879                              <2>         %elifidni %1, es
  7880                              <2>                 o16 push %1
  7881                              <2>         %elifidni %1, fs
  7882                              <2>                 o16 push %1
  7883                              <2>         %elifidni %1, gs
  7884                              <2>                 o16 push %1
  7885                              <2>         %elifidni %1, word cs
  7886                              <2>                 o16 push %1
  7887                              <2>         %elifidni %1, word ds
  7888                              <2>                 o16 push %1
  7889                              <2>         %elifidni %1, word es
  7890                              <2>                 o16 push %1
  7891                              <2>         %elifidni %1, word fs
  7892                              <2>                 o16 push %1
  7893                              <2>         %elifidni %1, word gs
  7894                              <2>                 o16 push %1
  7895                              <2>         %else
  7896 000007D5 66680000            <2>                 push %1
  7897                              <2>         %endif
  7898                              <2> 
  7899                              <2>         %rotate -1
  7900                              <2> 
  7901                              <2> 
  7902                              <2> 
  7903                              <2> 
  7904                              <2> 
  7905                              <2> 
  7906                              <2> 
  7907                              <2>         %ifidni %1, cs
  7908                              <2>                 o16 push %1
  7909                              <2>         %elifidni %1, ds
  7910                              <2>                 o16 push %1
  7911                              <2>         %elifidni %1, es
  7912                              <2>                 o16 push %1
  7913                              <2>         %elifidni %1, fs
  7914                              <2>                 o16 push %1
  7915                              <2>         %elifidni %1, gs
  7916                              <2>                 o16 push %1
  7917                              <2>         %elifidni %1, word cs
  7918                              <2>                 o16 push %1
  7919                              <2>         %elifidni %1, word ds
  7920                              <2>                 o16 push %1
  7921                              <2>         %elifidni %1, word es
  7922                              <2>                 o16 push %1
  7923                              <2>         %elifidni %1, word fs
  7924                              <2>                 o16 push %1
  7925                              <2>         %elifidni %1, word gs
  7926                              <2>                 o16 push %1
  7927                              <2>         %else
  7928 000007D9 66680000            <2>                 push %1
  7929                              <2>         %endif
  7930                              <2> 
  7931                              <2>         %rotate -1
  7932                              <2> 
  7933                              <2> 
  7934                              <2> 
  7935                              <2> 
  7936                              <2> 
  7937                              <2> 
  7938                              <2> 
  7939                              <2>         %ifidni %1, cs
  7940                              <2>                 o16 push %1
  7941                              <2>         %elifidni %1, ds
  7942                              <2>                 o16 push %1
  7943                              <2>         %elifidni %1, es
  7944                              <2>                 o16 push %1
  7945                              <2>         %elifidni %1, fs
  7946                              <2>                 o16 push %1
  7947                              <2>         %elifidni %1, gs
  7948                              <2>                 o16 push %1
  7949                              <2>         %elifidni %1, word cs
  7950                              <2>                 o16 push %1
  7951                              <2>         %elifidni %1, word ds
  7952                              <2>                 o16 push %1
  7953                              <2>         %elifidni %1, word es
  7954                              <2>                 o16 push %1
  7955                              <2>         %elifidni %1, word fs
  7956                              <2>                 o16 push %1
  7957                              <2>         %elifidni %1, word gs
  7958                              <2>                 o16 push %1
  7959                              <2>         %else
  7960 000007DD 66FF35[2A000000]    <2>                 push %1
  7961                              <2>         %endif
  7962                              <2> 
  7963                              <2>         %rotate -1
  7964                              <2> 
  7965                              <2> 
  7966                              <2> 
  7967                              <2> 
  7968                              <2> 
  7969                              <2> 
  7970                              <2> 
  7971                              <2>         %ifidni %1, cs
  7972                              <2>                 o16 push %1
  7973                              <2>         %elifidni %1, ds
  7974                              <2>                 o16 push %1
  7975                              <2>         %elifidni %1, es
  7976                              <2>                 o16 push %1
  7977                              <2>         %elifidni %1, fs
  7978                              <2>                 o16 push %1
  7979                              <2>         %elifidni %1, gs
  7980                              <2>                 o16 push %1
  7981                              <2>         %elifidni %1, word cs
  7982                              <2>                 o16 push %1
  7983                              <2>         %elifidni %1, word ds
  7984                              <2>                 o16 push %1
  7985                              <2>         %elifidni %1, word es
  7986                              <2>                 o16 push %1
  7987                              <2>         %elifidni %1, word fs
  7988                              <2>                 o16 push %1
  7989                              <2>         %elifidni %1, word gs
  7990                              <2>                 o16 push %1
  7991                              <2>         %else
  7992 000007E4 66FF35[28000000]    <2>                 push %1
  7993                              <2>         %endif
  7994                              <2> 
  7995                              <2>         %rotate -1
  7996 000007EB E8D5F9FFFF          <1> call %1
  7997                              <1> %if (%0!=1)
  7998 000007F0 83C40C              <1>         add esp, byte %1_arglen
  7999                              <1> %endif
  8000 000007F3 85C0                        test eax, eax
  8001 000007F5 0F844C000000                jz near .OutsideBorder
  8002                                  	
  8003 000007FB 6685C9                      test cx, cx
  8004 000007FE 0F850B000000                jnz near .ColorText
  8005                                  	
  8006 00000804 6681FA1000                  cmp dx, 16
  8007 00000809 0F8482000000                je near .Done
  8008                                  
  8009                                  
  8010                                  
  8011                                   ;----------
  8012                                   .ColorText:
  8013                                   ;----------
  8014 0000080F 52                          push edx					; Save registers
  8015 00000810 51                          push ecx					; Use temporarily
  8016                                  
  8017 00000811 0FB70D[2A000000]            movzx ecx, word [_y]
  8018 00000818 0FB74510                    movzx eax, word [ebp+.DestWidth]
  8019                                  
  8020 0000081C F7E1                        mul ecx
  8021 0000081E 89C2                        mov edx, eax
  8022 00000820 0FB705[28000000]            movzx eax, word [_x]
  8023 00000827 01C2                        add edx, eax
  8024 00000829 C1E202                      shl edx, 2
  8025 0000082C 8B7D0C                      mov dword edi, dword [ebp+.DestOff]
  8026 0000082F 01D7                        add edi, edx
  8027                                  
  8028                                  
  8029 00000831 8B4518                      mov	eax, dword [ebp+.Color]
  8030 00000834 8907                        mov dword [edi], eax
  8031 00000836 8127FFFFFF00                and dword [edi], 00FFFFFFh			; Clear ALPHA byte
  8032 0000083C 8B06                        mov eax, dword [esi]
  8033 0000083E 25000000FF                  and eax, 0FF000000h				; Keep only ALPHA byte
  8034 00000843 0907                        or dword [edi], eax				; Combine color and alpha
  8035                                  	
  8036 00000845 59                          pop ecx					; Restore registers
  8037 00000846 5A                          pop edx
  8038                                  
  8039                                  
  8040                                  
  8041                                  
  8042                                   ;--------------
  8043                                   .OutsideBorder:
  8044                                   ;--------------
  8045 00000847 81C604000000               add esi, 4
  8046                                  
  8047 0000084D 66FF05[28000000]           inc word [_x]
  8048 00000854 6641                       inc cx
  8049                                  
  8050 00000856 6681F91000                 cmp cx, 16				; If we are at end of the row of the char image, then wraparound
  8051 0000085B 0F8410000000               je near .Wraparound
  8052                                  
  8053 00000861 6681FA1000                 cmp dx, 16
  8054 00000866 0F8425000000               je near .Done
  8055                                  	
  8056 0000086C E95CFFFFFF                 jmp near .NextPoint
  8057                                  
  8058                                  
  8059                                  
  8060                                  
  8061                                   ;-----------
  8062                                   .Wraparound:
  8063                                   ;-----------
  8064 00000871 81C6C01F0000                add esi, dword 8128			; 8128 = length of the whole font image
  8065 00000877 66812D[28000000]10-         sub word [_x], 16
  8066 0000087F 00                 
  8067 00000880 66FF05[2A000000]            inc word [_y]
  8068 00000887 6642                        inc dx
  8069 00000889 6631C9                      xor cx, cx
  8070 0000088C E93CFFFFFF                  jmp near .NextPoint
  8071                                  
  8072                                  
  8073                                  
  8074                                   ;-----
  8075                                   .Done:
  8076                                   ;-----
  8077 00000891 66FF05[2C000000]            inc word [_dx]
  8078 00000898 668B4516                    mov ax, word [ebp+.Y]
  8079 0000089C 66A3[2A000000]              mov word [_y], ax
  8080 000008A2 668B4514                    mov ax, word [ebp+.X]
  8081 000008A6 66A3[28000000]              mov word [_x], ax
  8082 000008AC 66A1[2C000000]              mov ax, word [_dx]
  8083 000008B2 66C1E004                    shl ax, 4
  8084 000008B6 660105[28000000]            add word [_x], ax
  8085 000008BD E9D8FEFFFF                  jmp near .PositionCheck
  8086                                  
  8087                                  
  8088                                  
  8089                                   ;----
  8090                                   .End:
  8091                                   ;----
  8092 000008C2 61                          popad				; Restore registers
  8093                                      ret
  8094                              <1> %ifnctx proc
  8095                              <1> 	ret	%1
  8096                              <1> %else
  8097 000008C3 89EC                <1> 	mov	esp, ebp
  8098 000008C5 5D                  <1> 	pop	ebp
  8099 000008C6 C3                  <1> 	ret	%1
  8100                              <1> %endif
  8101                                  
  8102                                  
  8103                                  endproc
  8104                              <1> %ifnctx proc
  8105                              <1> %error Mismatched `endproc'/`proc'
  8106                              <1> %else
  8107                              <1> 
  8108                              <1> 
  8109                              <1> %ifdef LEGACY_ENDPROC
  8110                              <1>         ret
  8111                              <1> %endif
  8112                              <1> 
  8113                              <1> 
  8114                              <1> 
  8115                              <1> 
  8116                              <1> 
  8117                              <1> 
  8118                              <1> 
  8119                              <1> 
  8120                              <1> 
  8121                              <1> %pop
  8122                              <1> %endif
  8123                                  _DrawText_arglen	EQU	20
  8124                                  
  8125                                  
  8126                                  
  8127                                  
  8128                                  
  8129                                  
  8130                                  
  8131                                  ;-------------------------------------------------------------------------;
  8132                                  ; ClearBuffer()								  ;
  8133                                  ;									  ;
  8134                                  ;   void _ClearBuffer(dword DestOff, word DestWidth, word DestHeight,	  ;
  8135                                  ;		      dword Color)					  ;
  8136                                  ;									  ;
  8137                                  ;   Inputs: DestOff = offset of an image buffer in memory		  ;
  8138                                  ;	    DestWidth = width of the buffer				  ;
  8139                                  ;	    DestHeight = height of the buffer				  ;
  8140                                  ;	    Color = color to make buffer				  ;
  8141                                  ;									  ;
  8142                                  ;   Outputs: Color copyied to buffer					  ;
  8143                                  ;									  ;
  8144                                  ;   Calls: none								  ;
  8145                                  ;									  ;
  8146                                  ;   Returns: none							  ;
  8147                                  ;									  ;
  8148                                  ;   Purpose: Clears a buffer pointed to by DestOff by filling it	  ;
  8149                                  ;	     with color Color						  ;
  8150                                  ;									  ;
  8151                                  ;-------------------------------------------------------------------------;
  8152                                  proc _ClearBuffer
  8153                              <1> %push proc
  8154                              <1>           global %1
  8155 000008C7 55                  <1> %1:       push  ebp
  8156 000008C8 89E5                <1>           mov   ebp, esp
  8157                              <1> %assign %$arg 8
  8158                              <1> 
  8159                              <1> %define %$procname %1
  8160                                  .DestOff	arg	4
  8161                              <1> .DestOff       equ %$arg
  8162                              <1> 
  8163                              <1> 
  8164                              <1> %assign %$arg %1+%$arg
  8165                                  .DestWidth	arg	2
  8166                              <1> .DestWidth       equ %$arg
  8167                              <1> 
  8168                              <1> 
  8169                              <1> %assign %$arg %1+%$arg
  8170                                  .DestHeight	arg	2
  8171                              <1> .DestHeight       equ %$arg
  8172                              <1> 
  8173                              <1> 
  8174                              <1> %assign %$arg %1+%$arg
  8175                                  .Color		arg	4
  8176                              <1> .Color       equ %$arg
  8177                              <1> 
  8178                              <1> 
  8179                              <1> %assign %$arg %1+%$arg
  8180                                  ;invoke	_libClearBuffer, dword [ebp+.DestOff], word [ebp+.DestWidth], word [ebp+.DestHeight], dword [ebp+.Color]
  8181                                  ;ret
  8182                                  
  8183                                  
  8184 000008CA 50                       push eax				; Save registers
  8185 000008CB 51                       push ecx
  8186 000008CC 52                       push edx
  8187 000008CD 57                       push edi
  8188                                  
  8189                                  
  8190 000008CE 8B7D08                   mov edi, dword [ebp + .DestOff]
  8191 000008D1 0FB7450C                 movzx eax, word [ebp + .DestWidth]
  8192 000008D5 0FB74D0E                 movzx ecx, word [ebp + .DestHeight]
  8193 000008D9 F7E1                     mul ecx
  8194 000008DB 89C1                     mov ecx, eax				; ecx = DestWidth*DestHeight
  8195 000008DD 8B4510                   mov eax, dword [ebp + .Color]		; Write Color ecx times
  8196                                  
  8197 000008E0 FC                       CLD					; Auto-increment edi by 4
  8198                                  
  8199 000008E1 F3AB                     REP STOSD				; Loop until ecx=0
  8200                                  
  8201                                  
  8202 000008E3 5F                       pop edi				; Restore registers
  8203 000008E4 5A                       pop edx
  8204 000008E5 59                       pop ecx
  8205 000008E6 58                       pop eax
  8206                                  
  8207                                   ret
  8208                              <1> %ifnctx proc
  8209                              <1> 	ret	%1
  8210                              <1> %else
  8211 000008E7 89EC                <1> 	mov	esp, ebp
  8212 000008E9 5D                  <1> 	pop	ebp
  8213 000008EA C3                  <1> 	ret	%1
  8214                              <1> %endif
  8215                                  
  8216                                  
  8217                                  endproc
  8218                              <1> %ifnctx proc
  8219                              <1> %error Mismatched `endproc'/`proc'
  8220                              <1> %else
  8221                              <1> 
  8222                              <1> 
  8223                              <1> %ifdef LEGACY_ENDPROC
  8224                              <1>         ret
  8225                              <1> %endif
  8226                              <1> 
  8227                              <1> 
  8228                              <1> 
  8229                              <1> 
  8230                              <1> 
  8231                              <1> 
  8232                              <1> 
  8233                              <1> 
  8234                              <1> 
  8235                              <1> %pop
  8236                              <1> %endif
  8237                                  _ClearBuffer_arglen	EQU	12
  8238                                  
  8239                                  
  8240                                  
  8241                                  
  8242                                  
  8243                                  
  8244                                  
  8245                                  ;-------------------------------------------------------------------------;
  8246                                  ; CopyBuffer()								  ;
  8247                                  ;									  ;
  8248                                  ;   void _CopyBuffer(dword SrcOff, word SrcWidth, word SrcHeight,	  ;
  8249                                  ;		     dword DestOff, word DestWidth, word DestHeight,	  ;
  8250                                  ;		     word X, word Y)					  ;
  8251                                  ;									  ;
  8252                                  ;   Inputs: SrcOff = offset of source buffer				  ;
  8253                                  ;	    SrcWidth = width of source buffer 				  ;
  8254                                  ;	    SrcHeight = height of source buffer 			  ;
  8255                                  ;	    DestOff = offset of destination buffer 			  ;
  8256                                  ;           DestWidth = width of destination buffer			  ;
  8257                                  ;	    DestHeight = height of destination buffer			  ;
  8258                                  ;	    X = x coordinate of start point in destination buffer	  ;
  8259                                  ;	    Y = y coordinate of start point in destination buffer	  ;
  8260                                  ;									  ;
  8261                                  ;   Outputs: Source buffer copied onto destination buffer		  ;
  8262                                  ;									  ;
  8263                                  ;   Calls: none								  ;
  8264                                  ;									  ;
  8265                                  ;   Returns: none							  ;
  8266                                  ;									  ;
  8267                                  ;   Purpose: Copies a source buffer pointed to by SrcOff to a		  ;
  8268                                  ;	     location (X,Y) in a destination buffer pointed to by DestOff ;
  8269                                  ;									  ;
  8270                                  ;-------------------------------------------------------------------------;
  8271                                  proc _CopyBuffer
  8272                              <1> %push proc
  8273                              <1>           global %1
  8274 000008EB 55                  <1> %1:       push  ebp
  8275 000008EC 89E5                <1>           mov   ebp, esp
  8276                              <1> %assign %$arg 8
  8277                              <1> 
  8278                              <1> %define %$procname %1
  8279                                  .SrcOff		arg	4
  8280                              <1> .SrcOff       equ %$arg
  8281                              <1> 
  8282                              <1> 
  8283                              <1> %assign %$arg %1+%$arg
  8284                                  .SrcWidth	arg	2
  8285                              <1> .SrcWidth       equ %$arg
  8286                              <1> 
  8287                              <1> 
  8288                              <1> %assign %$arg %1+%$arg
  8289                                  .SrcHeight	arg	2
  8290                              <1> .SrcHeight       equ %$arg
  8291                              <1> 
  8292                              <1> 
  8293                              <1> %assign %$arg %1+%$arg
  8294                                  .DestOff	arg	4
  8295                              <1> .DestOff       equ %$arg
  8296                              <1> 
  8297                              <1> 
  8298                              <1> %assign %$arg %1+%$arg
  8299                                  .DestWidth	arg	2
  8300                              <1> .DestWidth       equ %$arg
  8301                              <1> 
  8302                              <1> 
  8303                              <1> %assign %$arg %1+%$arg
  8304                                  .DestHeight	arg	2
  8305                              <1> .DestHeight       equ %$arg
  8306                              <1> 
  8307                              <1> 
  8308                              <1> %assign %$arg %1+%$arg
  8309                                  .X		arg	2
  8310                              <1> .X       equ %$arg
  8311                              <1> 
  8312                              <1> 
  8313                              <1> %assign %$arg %1+%$arg
  8314                                  .Y		arg	2
  8315                              <1> .Y       equ %$arg
  8316                              <1> 
  8317                              <1> 
  8318                              <1> %assign %$arg %1+%$arg
  8319                                  ;invoke	_libCopyBuffer, dword [ebp+.SrcOff], word [ebp+.SrcWidth], word [ebp+.SrcHeight], dword [ebp+.DestOff], word [ebp+.DestWidth], word [ebp+.DestHeight], word [ebp+.X], word [ebp+.Y]
  8320                                  ;ret
  8321                                  
  8322                                  
  8323 000008EE 50                       push eax				; Save registers
  8324 000008EF 51                       push ecx
  8325 000008F0 57                       push edi
  8326 000008F1 56                       push esi
  8327 000008F2 52                       push edx
  8328                                  
  8329                                  
  8330 000008F3 8B7508                   mov esi, dword [ebp + .SrcOff]		; esi = SrcOff
  8331 000008F6 8B7D10                   mov edi, dword [ebp + .DestOff]	; edi = DestOff
  8332                                  
  8333                                  
  8334 000008F9 0FB74514                 movzx eax, word [ebp + .DestWidth]
  8335 000008FD 0FB74D1A                 movzx ecx, word [ebp + .Y]
  8336 00000901 F7E1                     mul ecx				; eax = DestWidth*Y
  8337 00000903 0FB74D18                 movzx ecx, word [ebp + .X]
  8338 00000907 01C8                     add eax, ecx				; eax = DestWidth*Y + .X
  8339 00000909 C1E002                   shl eax, 2				; each pixel is 4 bytes
  8340                                  
  8341 0000090C 01C7                     add edi, eax				; edi = DestOff + 4*(DestWidth*Y + X)
  8342                                  
  8343                                  
  8344                                  
  8345 0000090E 668B550E                 mov dx, word [ebp + .SrcHeight]	; dx = # of rows of the
  8346                                  					; source buffer to copy
  8347 00000912 FC                       CLD					; Auto-increment di, si for MOVSD
  8348                                  
  8349                                  
  8350                                   ;--------
  8351                                   .RowLoop:
  8352                                   ;--------
  8353 00000913 0FB74D0C                    movzx ecx, word [ebp + .SrcWidth]	; ecx = # of pixels in row of Src
  8354                                  
  8355                                  
  8356 00000917 F3A5                        REP MOVSD				; Copy pixels ecx many times
  8357                                  
  8358 00000919 0FB74514                    movzx eax, word [ebp + .DestWidth]	; To get to the beginning of the next
  8359 0000091D C1E002                      shl eax, 2				; line, add the DestWidth to di and
  8360 00000920 01C7                        add edi, eax			; then subtract the SrcWidth from di
  8361 00000922 0FB7450C                    movzx eax, word [ebp + .SrcWidth]
  8362 00000926 C1E002                      shl eax, 2
  8363 00000929 29C7                        sub edi, eax
  8364 0000092B 664A                        dec dx
  8365                                  					; Repeat until all rows from Src
  8366 0000092D 0F85E0FFFFFF                jnz near .RowLoop			; are copied to Dest buffer
  8367                                  
  8368                                  
  8369 00000933 5A                       pop edx				; Restore registers
  8370 00000934 5E                       pop esi
  8371 00000935 5F                       pop edi
  8372 00000936 59                       pop ecx
  8373 00000937 58                       pop eax
  8374                                  
  8375                                   ret
  8376                              <1> %ifnctx proc
  8377                              <1> 	ret	%1
  8378                              <1> %else
  8379 00000938 89EC                <1> 	mov	esp, ebp
  8380 0000093A 5D                  <1> 	pop	ebp
  8381 0000093B C3                  <1> 	ret	%1
  8382                              <1> %endif
  8383                                  
  8384                                  
  8385                                  endproc
  8386                              <1> %ifnctx proc
  8387                              <1> %error Mismatched `endproc'/`proc'
  8388                              <1> %else
  8389                              <1> 
  8390                              <1> 
  8391                              <1> %ifdef LEGACY_ENDPROC
  8392                              <1>         ret
  8393                              <1> %endif
  8394                              <1> 
  8395                              <1> 
  8396                              <1> 
  8397                              <1> 
  8398                              <1> 
  8399                              <1> 
  8400                              <1> 
  8401                              <1> 
  8402                              <1> 
  8403                              <1> %pop
  8404                              <1> %endif
  8405                                  _CopyBuffer_arglen	EQU	20
  8406                                  
  8407                                  
  8408                                  
  8409                                  
  8410                                  
  8411                                  
  8412                                  
  8413                                  ;-------------------------------------------------------------------------;
  8414                                  ; CopyBuffer()								  ;
  8415                                  ;									  ;
  8416                                  ;   void _CopyBuffer(dword SrcOff, word SrcWidth, word SrcHeight,	  ;
  8417                                  ;		     dword DestOff, word DestWidth, word DestHeight,	  ;
  8418                                  ;		     word X, word Y)					  ;
  8419                                  ;									  ;
  8420                                  ;   Inputs: SrcOff = offset of source buffer				  ;
  8421                                  ;	    SrcWidth = width of source buffer 				  ;
  8422                                  ;	    SrcHeight = height of source buffer 			  ;
  8423                                  ;	    DestOff = offset of destination buffer 			  ;
  8424                                  ;           DestWidth = width of destination buffer			  ;
  8425                                  ;	    DestHeight = height of destination buffer			  ;
  8426                                  ;	    X = x coordinate of start point in destination buffer	  ;
  8427                                  ;	    Y = y coordinate of start point in destination buffer	  ;
  8428                                  ;									  ;
  8429                                  ;   Outputs: Source buffer alpha composed onto destination buffer	  ;
  8430                                  ;									  ;
  8431                                  ;   Calls: none								  ;
  8432                                  ;									  ;
  8433                                  ;   Returns: none							  ;
  8434                                  ;									  ;
  8435                                  ;   Purpose: Alpha composes a source buffer pointed to by SrcOff onto a	  ;
  8436                                  ;	     destination buffer pointed to by DestOff at location (X,Y)	  ;
  8437                                  ;									  ;
  8438                                  ;-------------------------------------------------------------------------;
  8439                                  proc _ComposeBuffers
  8440                              <1> %push proc
  8441                              <1>           global %1
  8442 0000093C 55                  <1> %1:       push  ebp
  8443 0000093D 89E5                <1>           mov   ebp, esp
  8444                              <1> %assign %$arg 8
  8445                              <1> 
  8446                              <1> %define %$procname %1
  8447                                  .SrcOff		arg	4
  8448                              <1> .SrcOff       equ %$arg
  8449                              <1> 
  8450                              <1> 
  8451                              <1> %assign %$arg %1+%$arg
  8452                                  .SrcWidth	arg	2
  8453                              <1> .SrcWidth       equ %$arg
  8454                              <1> 
  8455                              <1> 
  8456                              <1> %assign %$arg %1+%$arg
  8457                                  .SrcHeight	arg	2
  8458                              <1> .SrcHeight       equ %$arg
  8459                              <1> 
  8460                              <1> 
  8461                              <1> %assign %$arg %1+%$arg
  8462                                  .DestOff	arg	4
  8463                              <1> .DestOff       equ %$arg
  8464                              <1> 
  8465                              <1> 
  8466                              <1> %assign %$arg %1+%$arg
  8467                                  .DestWidth	arg	2
  8468                              <1> .DestWidth       equ %$arg
  8469                              <1> 
  8470                              <1> 
  8471                              <1> %assign %$arg %1+%$arg
  8472                                  .DestHeight	arg	2
  8473                              <1> .DestHeight       equ %$arg
  8474                              <1> 
  8475                              <1> 
  8476                              <1> %assign %$arg %1+%$arg
  8477                                  .X	        arg	2
  8478                              <1> .X       equ %$arg
  8479                              <1> 
  8480                              <1> 
  8481                              <1> %assign %$arg %1+%$arg
  8482                                  .Y		arg	2
  8483                              <1> .Y       equ %$arg
  8484                              <1> 
  8485                              <1> 
  8486                              <1> %assign %$arg %1+%$arg
  8487                                  
  8488                                  ;invoke	_libComposeBuffers, dword [ebp+.SrcOff], word [ebp+.SrcWidth], word [ebp+.SrcHeight], dword [ebp+.DestOff], word [ebp+.DestWidth], word [ebp+.DestHeight], word [ebp+.X], word [ebp+.Y]
  8489                                  ;ret
  8490                                  
  8491                                  
  8492 0000093F 60                       pushad
  8493                                  
  8494 00000940 8B7508                   mov esi, dword [ebp + .SrcOff]
  8495 00000943 8B7D10                   mov edi, dword [ebp + .DestOff]
  8496                                  
  8497 00000946 0FB74514                 movzx eax, word [ebp + .DestWidth]
  8498 0000094A 0FB74D1A                 movzx ecx, word [ebp + .Y]
  8499 0000094E F7E1                     mul ecx
  8500 00000950 0FB74D18                 movzx ecx, word [ebp + .X]
  8501 00000954 01C8                     add eax, ecx
  8502 00000956 C1E002                   shl eax, 2
  8503                                  
  8504 00000959 01C7                     add edi, eax
  8505                                  
  8506 0000095B 668B5D0E                 mov bx, word [ebp + .SrcHeight]
  8507                                  
  8508                                  
  8509                                  
  8510                                   ;-----------
  8511                                   .HeightLoop:
  8512                                   ;-----------
  8513 0000095F 6685DB                      test bx, bx
  8514 00000962 0F84AD000000                jz near .End
  8515                                  
  8516 00000968 0FB74D0C                    movzx ecx, word [ebp + .SrcWidth]
  8517 0000096C D1E9                        shr ecx, 1					; We are doing 2 pixels at once
  8518                                  
  8519                                  
  8520                                  
  8521                                   ;--------
  8522                                   .RowLoop:
  8523                                   ;--------
  8524 0000096E 6685C9                      test cx, cx
  8525 00000971 0F848A000000                jz near .LoopCheck
  8526                                  
  8527                                  
  8528 00000977 0F6F06                      movq mm0, qword [esi]
  8529 0000097A 0F6FC8                      movq mm1, mm0
  8530                                  
  8531                                  
  8532 0000097D 0FEFFF                      pxor mm7, mm7				; mm7 = [00][00][00][00]
  8533 00000980 0F60C7                      PUNPCKLBW mm0, mm7				; mm0 = unpacked source#1
  8534 00000983 0F68CF                      PUNPCKHBW mm1, mm7				; mm1 = unpacked source#2
  8535                                  
  8536                                  
  8537                                  
  8538 00000986 0F6F17                      movq mm2, qword [edi]
  8539 00000989 0F6FDA                      movq mm3, mm2
  8540 0000098C 0F60D7                      PUNPCKLBW mm2, mm7				; mm2 = unpacked destination#1
  8541 0000098F 0F68DF                      PUNPCKHBW mm3, mm7				; mm3 = unpacked destination#2
  8542                                  
  8543                                  
  8544                                  
  8545 00000992 0F6FE8                      movq mm5, mm0				; mm5 = [0A][0R][0G][0B]
  8546 00000995 0F69ED                      PUNPCKHWD mm5, mm5				; mm5 = [0A][0A][0R][0R]
  8547 00000998 0F6AED                      PUNPCKHDQ mm5, mm5				; mm5 = Source#1 ALPHA
  8548                                  
  8549                                  
  8550                                  
  8551 0000099B 0F6FF1                      movq mm6, mm1				; mm6 = [0A][0R][0G][0B]
  8552 0000099E 0F69F6                      PUNPCKHWD mm6, mm6				; mm6 = [0A][0A][0R][0R]
  8553 000009A1 0F6AF6                      PUNPCKHDQ mm6, mm6				; mm6 = Source#2 ALPHA
  8554                                  
  8555                                  
  8556                                  
  8557 000009A4 0FD5C5                      pmullw mm0, mm5				; mm0 = Source#1 * ALPHA1
  8558 000009A7 0FD5CE                      pmullw mm1, mm6				; mm1 = Source#2 * ALPHA2
  8559                                  
  8560 000009AA 0FFD05[09020000]            paddw mm0, qword [_RoundingFactor]		; Step#4
  8561 000009B1 0FFD0D[09020000]            paddw mm1, qword [_RoundingFactor]		;
  8562                                  
  8563                                  
  8564 000009B8 0F71D008                    psrlw mm0, 8				; Step#5
  8565 000009BC 0F71D108                    psrlw mm1, 8				;
  8566                                  
  8567                                  
  8568 000009C0 0FFDC2                      paddw mm0, mm2				; Step#7
  8569 000009C3 0FFDCB                      paddw mm1, mm3
  8570                                  
  8571                                  
  8572 000009C6 0FD5D5                      pmullw mm2, mm5				; mm2 = Destination#1 * ALPHA1
  8573 000009C9 0FD5DE                      pmullw mm3, mm6				; mm3 = Destination#2 * ALPHA2
  8574                                  
  8575                                  
  8576 000009CC 0FFD15[09020000]            paddw mm2, qword [_RoundingFactor]		; Step#9
  8577 000009D3 0FFD1D[09020000]            paddw mm3, qword [_RoundingFactor]
  8578                                  
  8579                                  
  8580 000009DA 0F71D208                    psrlw mm2, 8				; Step#10
  8581 000009DE 0F71D308                    psrlw mm3, 8
  8582                                  
  8583                                  
  8584 000009E2 0FF9C2                      psubw mm0, mm2				; Step#11
  8585 000009E5 0FF9CB                      psubw mm1, mm3
  8586                                  
  8587                                  
  8588 000009E8 0F67C1                      packuswb mm0, mm1				; Pack both pixels and write to DestBuffer
  8589 000009EB 0F7F07                      movq qword [edi], mm0
  8590                                  
  8591                                  
  8592 000009EE 81C708000000                add edi, 8					; Next 2 pixels are 8 bytes away
  8593 000009F4 81C608000000                add esi, 8
  8594                                  
  8595 000009FA 6649                        dec cx					; Check if we are done with row
  8596 000009FC E96DFFFFFF                  jmp near .RowLoop
  8597                                  
  8598                                  
  8599                                  
  8600                                   ;----------
  8601                                   .LoopCheck:
  8602                                   ;----------
  8603 00000A01 0FB74514                    movzx eax, word [ebp + .DestWidth]
  8604 00000A05 662B450C                    sub ax, word [ebp + .SrcWidth]
  8605 00000A09 C1E002                      shl eax, 2
  8606 00000A0C 01C7                        add edi, eax
  8607                                  
  8608 00000A0E 664B                        dec bx
  8609 00000A10 E94AFFFFFF                  jmp near .HeightLoop
  8610                                  
  8611                                  
  8612                                   ;----
  8613                                   .End:
  8614                                   ;----
  8615 00000A15 61                          popad
  8616 00000A16 0F77                        emms
  8617                                      ret
  8618                              <1> %ifnctx proc
  8619                              <1> 	ret	%1
  8620                              <1> %else
  8621 00000A18 89EC                <1> 	mov	esp, ebp
  8622 00000A1A 5D                  <1> 	pop	ebp
  8623 00000A1B C3                  <1> 	ret	%1
  8624                              <1> %endif
  8625                                  
  8626                                  
  8627                                  endproc
  8628                              <1> %ifnctx proc
  8629                              <1> %error Mismatched `endproc'/`proc'
  8630                              <1> %else
  8631                              <1> 
  8632                              <1> 
  8633                              <1> %ifdef LEGACY_ENDPROC
  8634                              <1>         ret
  8635                              <1> %endif
  8636                              <1> 
  8637                              <1> 
  8638                              <1> 
  8639                              <1> 
  8640                              <1> 
  8641                              <1> 
  8642                              <1> 
  8643                              <1> 
  8644                              <1> 
  8645                              <1> %pop
  8646                              <1> %endif
  8647                                  _ComposeBuffers_arglen	EQU	20
  8648                                  
  8649                                  
  8650                                  
  8651                                  
  8652                                  
  8653                                  
  8654                                  
  8655                                  
  8656                                  
  8657                                  
  8658                                  
  8659                                  
  8660                                  ;-------------------------------------------------------------------------;
  8661                                  ; BlurBuffer()								  ;
  8662                                  ;									  ;
  8663                                  ;   void _CopyBuffer(dword SrcOff, dword DestOff, word DestWidth,	  ;
  8664                                  ;		     word DestHeight)					  ;
  8665                                  ;									  ;
  8666                                  ;   Inputs: SrcOff = offset of source buffer				  ;
  8667                                  ;	    DestOff = offset of destination buffer 			  ;
  8668                                  ;           DestWidth = width of destination buffer			  ;
  8669                                  ;	    DestHeight = height of destination buffer			  ;
  8670                                  ;									  ;
  8671                                  ;   Outputs: Source buffer blurred and written to destination buffer	  ;
  8672                                  ;									  ;
  8673                                  ;   Calls: _PointInBox							  ;
  8674                                  ;									  ;
  8675                                  ;   Returns: none							  ;
  8676                                  ;									  ;
  8677                                  ;   Purpose: Blurs the buffer pointed to by SrcOff and writes the	  ;
  8678                                  ;	     blurred buffer to the buffer pointed to by DestOff		  ;
  8679                                  ;									  ;
  8680                                  ;-------------------------------------------------------------------------;
  8681                                  proc _BlurBuffer
  8682                              <1> %push proc
  8683                              <1>           global %1
  8684 00000A1C 55                  <1> %1:       push  ebp
  8685 00000A1D 89E5                <1>           mov   ebp, esp
  8686                              <1> %assign %$arg 8
  8687                              <1> 
  8688                              <1> %define %$procname %1
  8689                                  .SrcOff		arg	4
  8690                              <1> .SrcOff       equ %$arg
  8691                              <1> 
  8692                              <1> 
  8693                              <1> %assign %$arg %1+%$arg
  8694                                  .DestOff	arg	4
  8695                              <1> .DestOff       equ %$arg
  8696                              <1> 
  8697                              <1> 
  8698                              <1> %assign %$arg %1+%$arg
  8699                                  .DestWidth	arg	2
  8700                              <1> .DestWidth       equ %$arg
  8701                              <1> 
  8702                              <1> 
  8703                              <1> %assign %$arg %1+%$arg
  8704                                  .DestHeight	arg	2
  8705                              <1> .DestHeight       equ %$arg
  8706                              <1> 
  8707                              <1> 
  8708                              <1> %assign %$arg %1+%$arg
  8709                                  
  8710                                  ;invoke	_libBlurBuffer, dword [ebp+.SrcOff], dword [ebp+.DestOff], word [ebp+.DestWidth], word [ebp+.DestHeight]
  8711                                  ;ret
  8712                                  
  8713                                  
  8714 00000A1F 60                       pushad
  8715                                  
  8716 00000A20 66C705[28000000]00-      mov word [_x], 0			; Use [_x] as our X coordinate
  8717 00000A28 00                 
  8718 00000A29 66C705[2A000000]00-      mov word [_y], 0			; Use [_y] as our Y coordinate
  8719 00000A31 00                 
  8720                                  
  8721                                   
  8722 00000A32 8B7508                   mov esi, dword [ebp + .SrcOff]
  8723 00000A35 8B7D0C                   mov edi, dword [ebp + .DestOff]
  8724                                  	
  8725 00000A38 0FB74510                 movzx eax, word [ebp + .DestWidth]
  8726 00000A3C 0FB74D12                 movzx ecx, word [ebp + .DestHeight]
  8727 00000A40 F7E1                     mul ecx
  8728 00000A42 89C1                     mov ecx, eax				; ecx = total number of pixels
  8729                                  
  8730                                  
  8731                                  
  8732                                  
  8733                                   ;--------
  8734                                   .RowLoop:
  8735                                   ;--------
  8736                                   invoke _PointInBox, word [_x], word [_y], word 0, word 0, word [ebp + .DestWidth], word [ebp + .DestHeight]
  8737                              <1> %rotate -1
  8738                              <1> 
  8739                              <1> %rep (%0-1)
  8740                              <1> 
  8741                              <1> 
  8742                              <1> 
  8743                              <1> 
  8744                              <1> 
  8745                              <1> 
  8746                              <1> 
  8747                              <1>         %ifidni %1, cs
  8748                              <1>                 o16 push %1
  8749                              <1>         %elifidni %1, ds
  8750                              <1>                 o16 push %1
  8751                              <1>         %elifidni %1, es
  8752                              <1>                 o16 push %1
  8753                              <1>         %elifidni %1, fs
  8754                              <1>                 o16 push %1
  8755                              <1>         %elifidni %1, gs
  8756                              <1>                 o16 push %1
  8757                              <1>         %elifidni %1, word cs
  8758                              <1>                 o16 push %1
  8759                              <1>         %elifidni %1, word ds
  8760                              <1>                 o16 push %1
  8761                              <1>         %elifidni %1, word es
  8762                              <1>                 o16 push %1
  8763                              <1>         %elifidni %1, word fs
  8764                              <1>                 o16 push %1
  8765                              <1>         %elifidni %1, word gs
  8766                              <1>                 o16 push %1
  8767                              <1>         %else
  8768                              <1>                 push %1
  8769                              <1>         %endif
  8770                              <1> 
  8771                              <1>         %rotate -1
  8772                              <1> %endrep
  8773                              <2> 
  8774                              <2> 
  8775                              <2> 
  8776                              <2> 
  8777                              <2> 
  8778                              <2> 
  8779                              <2> 
  8780                              <2>         %ifidni %1, cs
  8781                              <2>                 o16 push %1
  8782                              <2>         %elifidni %1, ds
  8783                              <2>                 o16 push %1
  8784                              <2>         %elifidni %1, es
  8785                              <2>                 o16 push %1
  8786                              <2>         %elifidni %1, fs
  8787                              <2>                 o16 push %1
  8788                              <2>         %elifidni %1, gs
  8789                              <2>                 o16 push %1
  8790                              <2>         %elifidni %1, word cs
  8791                              <2>                 o16 push %1
  8792                              <2>         %elifidni %1, word ds
  8793                              <2>                 o16 push %1
  8794                              <2>         %elifidni %1, word es
  8795                              <2>                 o16 push %1
  8796                              <2>         %elifidni %1, word fs
  8797                              <2>                 o16 push %1
  8798                              <2>         %elifidni %1, word gs
  8799                              <2>                 o16 push %1
  8800                              <2>         %else
  8801 00000A44 66FF7512            <2>                 push %1
  8802                              <2>         %endif
  8803                              <2> 
  8804                              <2>         %rotate -1
  8805                              <2> 
  8806                              <2> 
  8807                              <2> 
  8808                              <2> 
  8809                              <2> 
  8810                              <2> 
  8811                              <2> 
  8812                              <2>         %ifidni %1, cs
  8813                              <2>                 o16 push %1
  8814                              <2>         %elifidni %1, ds
  8815                              <2>                 o16 push %1
  8816                              <2>         %elifidni %1, es
  8817                              <2>                 o16 push %1
  8818                              <2>         %elifidni %1, fs
  8819                              <2>                 o16 push %1
  8820                              <2>         %elifidni %1, gs
  8821                              <2>                 o16 push %1
  8822                              <2>         %elifidni %1, word cs
  8823                              <2>                 o16 push %1
  8824                              <2>         %elifidni %1, word ds
  8825                              <2>                 o16 push %1
  8826                              <2>         %elifidni %1, word es
  8827                              <2>                 o16 push %1
  8828                              <2>         %elifidni %1, word fs
  8829                              <2>                 o16 push %1
  8830                              <2>         %elifidni %1, word gs
  8831                              <2>                 o16 push %1
  8832                              <2>         %else
  8833 00000A48 66FF7510            <2>                 push %1
  8834                              <2>         %endif
  8835                              <2> 
  8836                              <2>         %rotate -1
  8837                              <2> 
  8838                              <2> 
  8839                              <2> 
  8840                              <2> 
  8841                              <2> 
  8842                              <2> 
  8843                              <2> 
  8844                              <2>         %ifidni %1, cs
  8845                              <2>                 o16 push %1
  8846                              <2>         %elifidni %1, ds
  8847                              <2>                 o16 push %1
  8848                              <2>         %elifidni %1, es
  8849                              <2>                 o16 push %1
  8850                              <2>         %elifidni %1, fs
  8851                              <2>                 o16 push %1
  8852                              <2>         %elifidni %1, gs
  8853                              <2>                 o16 push %1
  8854                              <2>         %elifidni %1, word cs
  8855                              <2>                 o16 push %1
  8856                              <2>         %elifidni %1, word ds
  8857                              <2>                 o16 push %1
  8858                              <2>         %elifidni %1, word es
  8859                              <2>                 o16 push %1
  8860                              <2>         %elifidni %1, word fs
  8861                              <2>                 o16 push %1
  8862                              <2>         %elifidni %1, word gs
  8863                              <2>                 o16 push %1
  8864                              <2>         %else
  8865 00000A4C 66680000            <2>                 push %1
  8866                              <2>         %endif
  8867                              <2> 
  8868                              <2>         %rotate -1
  8869                              <2> 
  8870                              <2> 
  8871                              <2> 
  8872                              <2> 
  8873                              <2> 
  8874                              <2> 
  8875                              <2> 
  8876                              <2>         %ifidni %1, cs
  8877                              <2>                 o16 push %1
  8878                              <2>         %elifidni %1, ds
  8879                              <2>                 o16 push %1
  8880                              <2>         %elifidni %1, es
  8881                              <2>                 o16 push %1
  8882                              <2>         %elifidni %1, fs
  8883                              <2>                 o16 push %1
  8884                              <2>         %elifidni %1, gs
  8885                              <2>                 o16 push %1
  8886                              <2>         %elifidni %1, word cs
  8887                              <2>                 o16 push %1
  8888                              <2>         %elifidni %1, word ds
  8889                              <2>                 o16 push %1
  8890                              <2>         %elifidni %1, word es
  8891                              <2>                 o16 push %1
  8892                              <2>         %elifidni %1, word fs
  8893                              <2>                 o16 push %1
  8894                              <2>         %elifidni %1, word gs
  8895                              <2>                 o16 push %1
  8896                              <2>         %else
  8897 00000A50 66680000            <2>                 push %1
  8898                              <2>         %endif
  8899                              <2> 
  8900                              <2>         %rotate -1
  8901                              <2> 
  8902                              <2> 
  8903                              <2> 
  8904                              <2> 
  8905                              <2> 
  8906                              <2> 
  8907                              <2> 
  8908                              <2>         %ifidni %1, cs
  8909                              <2>                 o16 push %1
  8910                              <2>         %elifidni %1, ds
  8911                              <2>                 o16 push %1
  8912                              <2>         %elifidni %1, es
  8913                              <2>                 o16 push %1
  8914                              <2>         %elifidni %1, fs
  8915                              <2>                 o16 push %1
  8916                              <2>         %elifidni %1, gs
  8917                              <2>                 o16 push %1
  8918                              <2>         %elifidni %1, word cs
  8919                              <2>                 o16 push %1
  8920                              <2>         %elifidni %1, word ds
  8921                              <2>                 o16 push %1
  8922                              <2>         %elifidni %1, word es
  8923                              <2>                 o16 push %1
  8924                              <2>         %elifidni %1, word fs
  8925                              <2>                 o16 push %1
  8926                              <2>         %elifidni %1, word gs
  8927                              <2>                 o16 push %1
  8928                              <2>         %else
  8929 00000A54 66FF35[2A000000]    <2>                 push %1
  8930                              <2>         %endif
  8931                              <2> 
  8932                              <2>         %rotate -1
  8933                              <2> 
  8934                              <2> 
  8935                              <2> 
  8936                              <2> 
  8937                              <2> 
  8938                              <2> 
  8939                              <2> 
  8940                              <2>         %ifidni %1, cs
  8941                              <2>                 o16 push %1
  8942                              <2>         %elifidni %1, ds
  8943                              <2>                 o16 push %1
  8944                              <2>         %elifidni %1, es
  8945                              <2>                 o16 push %1
  8946                              <2>         %elifidni %1, fs
  8947                              <2>                 o16 push %1
  8948                              <2>         %elifidni %1, gs
  8949                              <2>                 o16 push %1
  8950                              <2>         %elifidni %1, word cs
  8951                              <2>                 o16 push %1
  8952                              <2>         %elifidni %1, word ds
  8953                              <2>                 o16 push %1
  8954                              <2>         %elifidni %1, word es
  8955                              <2>                 o16 push %1
  8956                              <2>         %elifidni %1, word fs
  8957                              <2>                 o16 push %1
  8958                              <2>         %elifidni %1, word gs
  8959                              <2>                 o16 push %1
  8960                              <2>         %else
  8961 00000A5B 66FF35[28000000]    <2>                 push %1
  8962                              <2>         %endif
  8963                              <2> 
  8964                              <2>         %rotate -1
  8965 00000A62 E85EF7FFFF          <1> call %1
  8966                              <1> %if (%0!=1)
  8967 00000A67 83C40C              <1>         add esp, byte %1_arglen
  8968                              <1> %endif
  8969 00000A6A 3D00000000               cmp eax, 0
  8970 00000A6F 0F8412020000             je near .InvalidPoint
  8971                                  
  8972                                  
  8973 00000A75 0F77                     emms
  8974                                  
  8975 00000A77 0F6E06                   movd mm0, dword [esi]			; mm0 = [00][00][AR][GB] of center pixel
  8976 00000A7A 0FEFC9                   pxor mm1, mm1				; mm1 = [00][00][00][00]
  8977 00000A7D 0F60C1                   punpcklbw mm0, mm1			; mm0 = [0A][0R][0G][0B]
  8978 00000A80 0F71F002                 psllw mm0, 2				; Each component of center pixel multiplied by 4
  8979                                  
  8980                                  
  8981                                  
  8982                                  
  8983                                  
  8984                                  
  8985 00000A84 66FF0D[28000000]         dec word [_x]
  8986                                   invoke _GetPixel, dword [ebp + .SrcOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [_x], word [_y]
  8987                              <1> %rotate -1
  8988                              <1> 
  8989                              <1> %rep (%0-1)
  8990                              <1> 
  8991                              <1> 
  8992                              <1> 
  8993                              <1> 
  8994                              <1> 
  8995                              <1> 
  8996                              <1> 
  8997                              <1>         %ifidni %1, cs
  8998                              <1>                 o16 push %1
  8999                              <1>         %elifidni %1, ds
  9000                              <1>                 o16 push %1
  9001                              <1>         %elifidni %1, es
  9002                              <1>                 o16 push %1
  9003                              <1>         %elifidni %1, fs
  9004                              <1>                 o16 push %1
  9005                              <1>         %elifidni %1, gs
  9006                              <1>                 o16 push %1
  9007                              <1>         %elifidni %1, word cs
  9008                              <1>                 o16 push %1
  9009                              <1>         %elifidni %1, word ds
  9010                              <1>                 o16 push %1
  9011                              <1>         %elifidni %1, word es
  9012                              <1>                 o16 push %1
  9013                              <1>         %elifidni %1, word fs
  9014                              <1>                 o16 push %1
  9015                              <1>         %elifidni %1, word gs
  9016                              <1>                 o16 push %1
  9017                              <1>         %else
  9018                              <1>                 push %1
  9019                              <1>         %endif
  9020                              <1> 
  9021                              <1>         %rotate -1
  9022                              <1> %endrep
  9023                              <2> 
  9024                              <2> 
  9025                              <2> 
  9026                              <2> 
  9027                              <2> 
  9028                              <2> 
  9029                              <2> 
  9030                              <2>         %ifidni %1, cs
  9031                              <2>                 o16 push %1
  9032                              <2>         %elifidni %1, ds
  9033                              <2>                 o16 push %1
  9034                              <2>         %elifidni %1, es
  9035                              <2>                 o16 push %1
  9036                              <2>         %elifidni %1, fs
  9037                              <2>                 o16 push %1
  9038                              <2>         %elifidni %1, gs
  9039                              <2>                 o16 push %1
  9040                              <2>         %elifidni %1, word cs
  9041                              <2>                 o16 push %1
  9042                              <2>         %elifidni %1, word ds
  9043                              <2>                 o16 push %1
  9044                              <2>         %elifidni %1, word es
  9045                              <2>                 o16 push %1
  9046                              <2>         %elifidni %1, word fs
  9047                              <2>                 o16 push %1
  9048                              <2>         %elifidni %1, word gs
  9049                              <2>                 o16 push %1
  9050                              <2>         %else
  9051 00000A8B 66FF35[2A000000]    <2>                 push %1
  9052                              <2>         %endif
  9053                              <2> 
  9054                              <2>         %rotate -1
  9055                              <2> 
  9056                              <2> 
  9057                              <2> 
  9058                              <2> 
  9059                              <2> 
  9060                              <2> 
  9061                              <2> 
  9062                              <2>         %ifidni %1, cs
  9063                              <2>                 o16 push %1
  9064                              <2>         %elifidni %1, ds
  9065                              <2>                 o16 push %1
  9066                              <2>         %elifidni %1, es
  9067                              <2>                 o16 push %1
  9068                              <2>         %elifidni %1, fs
  9069                              <2>                 o16 push %1
  9070                              <2>         %elifidni %1, gs
  9071                              <2>                 o16 push %1
  9072                              <2>         %elifidni %1, word cs
  9073                              <2>                 o16 push %1
  9074                              <2>         %elifidni %1, word ds
  9075                              <2>                 o16 push %1
  9076                              <2>         %elifidni %1, word es
  9077                              <2>                 o16 push %1
  9078                              <2>         %elifidni %1, word fs
  9079                              <2>                 o16 push %1
  9080                              <2>         %elifidni %1, word gs
  9081                              <2>                 o16 push %1
  9082                              <2>         %else
  9083 00000A92 66FF35[28000000]    <2>                 push %1
  9084                              <2>         %endif
  9085                              <2> 
  9086                              <2>         %rotate -1
  9087                              <2> 
  9088                              <2> 
  9089                              <2> 
  9090                              <2> 
  9091                              <2> 
  9092                              <2> 
  9093                              <2> 
  9094                              <2>         %ifidni %1, cs
  9095                              <2>                 o16 push %1
  9096                              <2>         %elifidni %1, ds
  9097                              <2>                 o16 push %1
  9098                              <2>         %elifidni %1, es
  9099                              <2>                 o16 push %1
  9100                              <2>         %elifidni %1, fs
  9101                              <2>                 o16 push %1
  9102                              <2>         %elifidni %1, gs
  9103                              <2>                 o16 push %1
  9104                              <2>         %elifidni %1, word cs
  9105                              <2>                 o16 push %1
  9106                              <2>         %elifidni %1, word ds
  9107                              <2>                 o16 push %1
  9108                              <2>         %elifidni %1, word es
  9109                              <2>                 o16 push %1
  9110                              <2>         %elifidni %1, word fs
  9111                              <2>                 o16 push %1
  9112                              <2>         %elifidni %1, word gs
  9113                              <2>                 o16 push %1
  9114                              <2>         %else
  9115 00000A99 66FF7512            <2>                 push %1
  9116                              <2>         %endif
  9117                              <2> 
  9118                              <2>         %rotate -1
  9119                              <2> 
  9120                              <2> 
  9121                              <2> 
  9122                              <2> 
  9123                              <2> 
  9124                              <2> 
  9125                              <2> 
  9126                              <2>         %ifidni %1, cs
  9127                              <2>                 o16 push %1
  9128                              <2>         %elifidni %1, ds
  9129                              <2>                 o16 push %1
  9130                              <2>         %elifidni %1, es
  9131                              <2>                 o16 push %1
  9132                              <2>         %elifidni %1, fs
  9133                              <2>                 o16 push %1
  9134                              <2>         %elifidni %1, gs
  9135                              <2>                 o16 push %1
  9136                              <2>         %elifidni %1, word cs
  9137                              <2>                 o16 push %1
  9138                              <2>         %elifidni %1, word ds
  9139                              <2>                 o16 push %1
  9140                              <2>         %elifidni %1, word es
  9141                              <2>                 o16 push %1
  9142                              <2>         %elifidni %1, word fs
  9143                              <2>                 o16 push %1
  9144                              <2>         %elifidni %1, word gs
  9145                              <2>                 o16 push %1
  9146                              <2>         %else
  9147 00000A9D 66FF7510            <2>                 push %1
  9148                              <2>         %endif
  9149                              <2> 
  9150                              <2>         %rotate -1
  9151                              <2> 
  9152                              <2> 
  9153                              <2> 
  9154                              <2> 
  9155                              <2> 
  9156                              <2> 
  9157                              <2> 
  9158                              <2>         %ifidni %1, cs
  9159                              <2>                 o16 push %1
  9160                              <2>         %elifidni %1, ds
  9161                              <2>                 o16 push %1
  9162                              <2>         %elifidni %1, es
  9163                              <2>                 o16 push %1
  9164                              <2>         %elifidni %1, fs
  9165                              <2>                 o16 push %1
  9166                              <2>         %elifidni %1, gs
  9167                              <2>                 o16 push %1
  9168                              <2>         %elifidni %1, word cs
  9169                              <2>                 o16 push %1
  9170                              <2>         %elifidni %1, word ds
  9171                              <2>                 o16 push %1
  9172                              <2>         %elifidni %1, word es
  9173                              <2>                 o16 push %1
  9174                              <2>         %elifidni %1, word fs
  9175                              <2>                 o16 push %1
  9176                              <2>         %elifidni %1, word gs
  9177                              <2>                 o16 push %1
  9178                              <2>         %else
  9179 00000AA1 FF7508              <2>                 push %1
  9180                              <2>         %endif
  9181                              <2> 
  9182                              <2>         %rotate -1
  9183 00000AA4 E85EF7FFFF          <1> call %1
  9184                              <1> %if (%0!=1)
  9185 00000AA9 83C40C              <1>         add esp, byte %1_arglen
  9186                              <1> %endif
  9187                                  
  9188 00000AAC 0F6EC8                   movd mm1, eax				; mm1 = [00][00][AR][GB] of left pixel
  9189 00000AAF 0FEFD2                   pxor mm2, mm2				; mm2 = [00][00][00][00]
  9190 00000AB2 0F60CA                   punpcklbw mm1, mm2			; mm1 = [0A][0R][0G][0B]
  9191 00000AB5 0F71F101                 psllw mm1, 1				; Each component of left pixel multiplied by 2
  9192 00000AB9 0FDDC1                   paddusw mm0, mm1			; mm0 = center + left
  9193 00000ABC 66FF05[28000000]         inc word [_x]
  9194                                  
  9195                                  
  9196                                  
  9197                                  
  9198                                  
  9199                                  
  9200 00000AC3 66FF05[28000000]         inc word [_x]
  9201                                   invoke _GetPixel, dword [ebp + .SrcOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [_x], word [_y]
  9202                              <1> %rotate -1
  9203                              <1> 
  9204                              <1> %rep (%0-1)
  9205                              <1> 
  9206                              <1> 
  9207                              <1> 
  9208                              <1> 
  9209                              <1> 
  9210                              <1> 
  9211                              <1> 
  9212                              <1>         %ifidni %1, cs
  9213                              <1>                 o16 push %1
  9214                              <1>         %elifidni %1, ds
  9215                              <1>                 o16 push %1
  9216                              <1>         %elifidni %1, es
  9217                              <1>                 o16 push %1
  9218                              <1>         %elifidni %1, fs
  9219                              <1>                 o16 push %1
  9220                              <1>         %elifidni %1, gs
  9221                              <1>                 o16 push %1
  9222                              <1>         %elifidni %1, word cs
  9223                              <1>                 o16 push %1
  9224                              <1>         %elifidni %1, word ds
  9225                              <1>                 o16 push %1
  9226                              <1>         %elifidni %1, word es
  9227                              <1>                 o16 push %1
  9228                              <1>         %elifidni %1, word fs
  9229                              <1>                 o16 push %1
  9230                              <1>         %elifidni %1, word gs
  9231                              <1>                 o16 push %1
  9232                              <1>         %else
  9233                              <1>                 push %1
  9234                              <1>         %endif
  9235                              <1> 
  9236                              <1>         %rotate -1
  9237                              <1> %endrep
  9238                              <2> 
  9239                              <2> 
  9240                              <2> 
  9241                              <2> 
  9242                              <2> 
  9243                              <2> 
  9244                              <2> 
  9245                              <2>         %ifidni %1, cs
  9246                              <2>                 o16 push %1
  9247                              <2>         %elifidni %1, ds
  9248                              <2>                 o16 push %1
  9249                              <2>         %elifidni %1, es
  9250                              <2>                 o16 push %1
  9251                              <2>         %elifidni %1, fs
  9252                              <2>                 o16 push %1
  9253                              <2>         %elifidni %1, gs
  9254                              <2>                 o16 push %1
  9255                              <2>         %elifidni %1, word cs
  9256                              <2>                 o16 push %1
  9257                              <2>         %elifidni %1, word ds
  9258                              <2>                 o16 push %1
  9259                              <2>         %elifidni %1, word es
  9260                              <2>                 o16 push %1
  9261                              <2>         %elifidni %1, word fs
  9262                              <2>                 o16 push %1
  9263                              <2>         %elifidni %1, word gs
  9264                              <2>                 o16 push %1
  9265                              <2>         %else
  9266 00000ACA 66FF35[2A000000]    <2>                 push %1
  9267                              <2>         %endif
  9268                              <2> 
  9269                              <2>         %rotate -1
  9270                              <2> 
  9271                              <2> 
  9272                              <2> 
  9273                              <2> 
  9274                              <2> 
  9275                              <2> 
  9276                              <2> 
  9277                              <2>         %ifidni %1, cs
  9278                              <2>                 o16 push %1
  9279                              <2>         %elifidni %1, ds
  9280                              <2>                 o16 push %1
  9281                              <2>         %elifidni %1, es
  9282                              <2>                 o16 push %1
  9283                              <2>         %elifidni %1, fs
  9284                              <2>                 o16 push %1
  9285                              <2>         %elifidni %1, gs
  9286                              <2>                 o16 push %1
  9287                              <2>         %elifidni %1, word cs
  9288                              <2>                 o16 push %1
  9289                              <2>         %elifidni %1, word ds
  9290                              <2>                 o16 push %1
  9291                              <2>         %elifidni %1, word es
  9292                              <2>                 o16 push %1
  9293                              <2>         %elifidni %1, word fs
  9294                              <2>                 o16 push %1
  9295                              <2>         %elifidni %1, word gs
  9296                              <2>                 o16 push %1
  9297                              <2>         %else
  9298 00000AD1 66FF35[28000000]    <2>                 push %1
  9299                              <2>         %endif
  9300                              <2> 
  9301                              <2>         %rotate -1
  9302                              <2> 
  9303                              <2> 
  9304                              <2> 
  9305                              <2> 
  9306                              <2> 
  9307                              <2> 
  9308                              <2> 
  9309                              <2>         %ifidni %1, cs
  9310                              <2>                 o16 push %1
  9311                              <2>         %elifidni %1, ds
  9312                              <2>                 o16 push %1
  9313                              <2>         %elifidni %1, es
  9314                              <2>                 o16 push %1
  9315                              <2>         %elifidni %1, fs
  9316                              <2>                 o16 push %1
  9317                              <2>         %elifidni %1, gs
  9318                              <2>                 o16 push %1
  9319                              <2>         %elifidni %1, word cs
  9320                              <2>                 o16 push %1
  9321                              <2>         %elifidni %1, word ds
  9322                              <2>                 o16 push %1
  9323                              <2>         %elifidni %1, word es
  9324                              <2>                 o16 push %1
  9325                              <2>         %elifidni %1, word fs
  9326                              <2>                 o16 push %1
  9327                              <2>         %elifidni %1, word gs
  9328                              <2>                 o16 push %1
  9329                              <2>         %else
  9330 00000AD8 66FF7512            <2>                 push %1
  9331                              <2>         %endif
  9332                              <2> 
  9333                              <2>         %rotate -1
  9334                              <2> 
  9335                              <2> 
  9336                              <2> 
  9337                              <2> 
  9338                              <2> 
  9339                              <2> 
  9340                              <2> 
  9341                              <2>         %ifidni %1, cs
  9342                              <2>                 o16 push %1
  9343                              <2>         %elifidni %1, ds
  9344                              <2>                 o16 push %1
  9345                              <2>         %elifidni %1, es
  9346                              <2>                 o16 push %1
  9347                              <2>         %elifidni %1, fs
  9348                              <2>                 o16 push %1
  9349                              <2>         %elifidni %1, gs
  9350                              <2>                 o16 push %1
  9351                              <2>         %elifidni %1, word cs
  9352                              <2>                 o16 push %1
  9353                              <2>         %elifidni %1, word ds
  9354                              <2>                 o16 push %1
  9355                              <2>         %elifidni %1, word es
  9356                              <2>                 o16 push %1
  9357                              <2>         %elifidni %1, word fs
  9358                              <2>                 o16 push %1
  9359                              <2>         %elifidni %1, word gs
  9360                              <2>                 o16 push %1
  9361                              <2>         %else
  9362 00000ADC 66FF7510            <2>                 push %1
  9363                              <2>         %endif
  9364                              <2> 
  9365                              <2>         %rotate -1
  9366                              <2> 
  9367                              <2> 
  9368                              <2> 
  9369                              <2> 
  9370                              <2> 
  9371                              <2> 
  9372                              <2> 
  9373                              <2>         %ifidni %1, cs
  9374                              <2>                 o16 push %1
  9375                              <2>         %elifidni %1, ds
  9376                              <2>                 o16 push %1
  9377                              <2>         %elifidni %1, es
  9378                              <2>                 o16 push %1
  9379                              <2>         %elifidni %1, fs
  9380                              <2>                 o16 push %1
  9381                              <2>         %elifidni %1, gs
  9382                              <2>                 o16 push %1
  9383                              <2>         %elifidni %1, word cs
  9384                              <2>                 o16 push %1
  9385                              <2>         %elifidni %1, word ds
  9386                              <2>                 o16 push %1
  9387                              <2>         %elifidni %1, word es
  9388                              <2>                 o16 push %1
  9389                              <2>         %elifidni %1, word fs
  9390                              <2>                 o16 push %1
  9391                              <2>         %elifidni %1, word gs
  9392                              <2>                 o16 push %1
  9393                              <2>         %else
  9394 00000AE0 FF7508              <2>                 push %1
  9395                              <2>         %endif
  9396                              <2> 
  9397                              <2>         %rotate -1
  9398 00000AE3 E81FF7FFFF          <1> call %1
  9399                              <1> %if (%0!=1)
  9400 00000AE8 83C40C              <1>         add esp, byte %1_arglen
  9401                              <1> %endif
  9402                                  
  9403 00000AEB 0F6EC8                   movd mm1, eax
  9404 00000AEE 0F60CA                   punpcklbw mm1, mm2
  9405 00000AF1 0F71F101                 psllw mm1, 1
  9406 00000AF5 0FDDC1                   paddusw mm0, mm1			; mm0 = center + left + right
  9407 00000AF8 66FF0D[28000000]         dec word [_x]
  9408                                  
  9409                                  
  9410                                  
  9411                                  
  9412                                  
  9413                                   
  9414                                   
  9415 00000AFF 66FF0D[28000000]         dec word [_x]
  9416 00000B06 66FF0D[2A000000]         dec word [_y]
  9417                                   invoke _GetPixel, dword [ebp + .SrcOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [_x], word [_y]
  9418                              <1> %rotate -1
  9419                              <1> 
  9420                              <1> %rep (%0-1)
  9421                              <1> 
  9422                              <1> 
  9423                              <1> 
  9424                              <1> 
  9425                              <1> 
  9426                              <1> 
  9427                              <1> 
  9428                              <1>         %ifidni %1, cs
  9429                              <1>                 o16 push %1
  9430                              <1>         %elifidni %1, ds
  9431                              <1>                 o16 push %1
  9432                              <1>         %elifidni %1, es
  9433                              <1>                 o16 push %1
  9434                              <1>         %elifidni %1, fs
  9435                              <1>                 o16 push %1
  9436                              <1>         %elifidni %1, gs
  9437                              <1>                 o16 push %1
  9438                              <1>         %elifidni %1, word cs
  9439                              <1>                 o16 push %1
  9440                              <1>         %elifidni %1, word ds
  9441                              <1>                 o16 push %1
  9442                              <1>         %elifidni %1, word es
  9443                              <1>                 o16 push %1
  9444                              <1>         %elifidni %1, word fs
  9445                              <1>                 o16 push %1
  9446                              <1>         %elifidni %1, word gs
  9447                              <1>                 o16 push %1
  9448                              <1>         %else
  9449                              <1>                 push %1
  9450                              <1>         %endif
  9451                              <1> 
  9452                              <1>         %rotate -1
  9453                              <1> %endrep
  9454                              <2> 
  9455                              <2> 
  9456                              <2> 
  9457                              <2> 
  9458                              <2> 
  9459                              <2> 
  9460                              <2> 
  9461                              <2>         %ifidni %1, cs
  9462                              <2>                 o16 push %1
  9463                              <2>         %elifidni %1, ds
  9464                              <2>                 o16 push %1
  9465                              <2>         %elifidni %1, es
  9466                              <2>                 o16 push %1
  9467                              <2>         %elifidni %1, fs
  9468                              <2>                 o16 push %1
  9469                              <2>         %elifidni %1, gs
  9470                              <2>                 o16 push %1
  9471                              <2>         %elifidni %1, word cs
  9472                              <2>                 o16 push %1
  9473                              <2>         %elifidni %1, word ds
  9474                              <2>                 o16 push %1
  9475                              <2>         %elifidni %1, word es
  9476                              <2>                 o16 push %1
  9477                              <2>         %elifidni %1, word fs
  9478                              <2>                 o16 push %1
  9479                              <2>         %elifidni %1, word gs
  9480                              <2>                 o16 push %1
  9481                              <2>         %else
  9482 00000B0D 66FF35[2A000000]    <2>                 push %1
  9483                              <2>         %endif
  9484                              <2> 
  9485                              <2>         %rotate -1
  9486                              <2> 
  9487                              <2> 
  9488                              <2> 
  9489                              <2> 
  9490                              <2> 
  9491                              <2> 
  9492                              <2> 
  9493                              <2>         %ifidni %1, cs
  9494                              <2>                 o16 push %1
  9495                              <2>         %elifidni %1, ds
  9496                              <2>                 o16 push %1
  9497                              <2>         %elifidni %1, es
  9498                              <2>                 o16 push %1
  9499                              <2>         %elifidni %1, fs
  9500                              <2>                 o16 push %1
  9501                              <2>         %elifidni %1, gs
  9502                              <2>                 o16 push %1
  9503                              <2>         %elifidni %1, word cs
  9504                              <2>                 o16 push %1
  9505                              <2>         %elifidni %1, word ds
  9506                              <2>                 o16 push %1
  9507                              <2>         %elifidni %1, word es
  9508                              <2>                 o16 push %1
  9509                              <2>         %elifidni %1, word fs
  9510                              <2>                 o16 push %1
  9511                              <2>         %elifidni %1, word gs
  9512                              <2>                 o16 push %1
  9513                              <2>         %else
  9514 00000B14 66FF35[28000000]    <2>                 push %1
  9515                              <2>         %endif
  9516                              <2> 
  9517                              <2>         %rotate -1
  9518                              <2> 
  9519                              <2> 
  9520                              <2> 
  9521                              <2> 
  9522                              <2> 
  9523                              <2> 
  9524                              <2> 
  9525                              <2>         %ifidni %1, cs
  9526                              <2>                 o16 push %1
  9527                              <2>         %elifidni %1, ds
  9528                              <2>                 o16 push %1
  9529                              <2>         %elifidni %1, es
  9530                              <2>                 o16 push %1
  9531                              <2>         %elifidni %1, fs
  9532                              <2>                 o16 push %1
  9533                              <2>         %elifidni %1, gs
  9534                              <2>                 o16 push %1
  9535                              <2>         %elifidni %1, word cs
  9536                              <2>                 o16 push %1
  9537                              <2>         %elifidni %1, word ds
  9538                              <2>                 o16 push %1
  9539                              <2>         %elifidni %1, word es
  9540                              <2>                 o16 push %1
  9541                              <2>         %elifidni %1, word fs
  9542                              <2>                 o16 push %1
  9543                              <2>         %elifidni %1, word gs
  9544                              <2>                 o16 push %1
  9545                              <2>         %else
  9546 00000B1B 66FF7512            <2>                 push %1
  9547                              <2>         %endif
  9548                              <2> 
  9549                              <2>         %rotate -1
  9550                              <2> 
  9551                              <2> 
  9552                              <2> 
  9553                              <2> 
  9554                              <2> 
  9555                              <2> 
  9556                              <2> 
  9557                              <2>         %ifidni %1, cs
  9558                              <2>                 o16 push %1
  9559                              <2>         %elifidni %1, ds
  9560                              <2>                 o16 push %1
  9561                              <2>         %elifidni %1, es
  9562                              <2>                 o16 push %1
  9563                              <2>         %elifidni %1, fs
  9564                              <2>                 o16 push %1
  9565                              <2>         %elifidni %1, gs
  9566                              <2>                 o16 push %1
  9567                              <2>         %elifidni %1, word cs
  9568                              <2>                 o16 push %1
  9569                              <2>         %elifidni %1, word ds
  9570                              <2>                 o16 push %1
  9571                              <2>         %elifidni %1, word es
  9572                              <2>                 o16 push %1
  9573                              <2>         %elifidni %1, word fs
  9574                              <2>                 o16 push %1
  9575                              <2>         %elifidni %1, word gs
  9576                              <2>                 o16 push %1
  9577                              <2>         %else
  9578 00000B1F 66FF7510            <2>                 push %1
  9579                              <2>         %endif
  9580                              <2> 
  9581                              <2>         %rotate -1
  9582                              <2> 
  9583                              <2> 
  9584                              <2> 
  9585                              <2> 
  9586                              <2> 
  9587                              <2> 
  9588                              <2> 
  9589                              <2>         %ifidni %1, cs
  9590                              <2>                 o16 push %1
  9591                              <2>         %elifidni %1, ds
  9592                              <2>                 o16 push %1
  9593                              <2>         %elifidni %1, es
  9594                              <2>                 o16 push %1
  9595                              <2>         %elifidni %1, fs
  9596                              <2>                 o16 push %1
  9597                              <2>         %elifidni %1, gs
  9598                              <2>                 o16 push %1
  9599                              <2>         %elifidni %1, word cs
  9600                              <2>                 o16 push %1
  9601                              <2>         %elifidni %1, word ds
  9602                              <2>                 o16 push %1
  9603                              <2>         %elifidni %1, word es
  9604                              <2>                 o16 push %1
  9605                              <2>         %elifidni %1, word fs
  9606                              <2>                 o16 push %1
  9607                              <2>         %elifidni %1, word gs
  9608                              <2>                 o16 push %1
  9609                              <2>         %else
  9610 00000B23 FF7508              <2>                 push %1
  9611                              <2>         %endif
  9612                              <2> 
  9613                              <2>         %rotate -1
  9614 00000B26 E8DCF6FFFF          <1> call %1
  9615                              <1> %if (%0!=1)
  9616 00000B2B 83C40C              <1>         add esp, byte %1_arglen
  9617                              <1> %endif
  9618                                  
  9619 00000B2E 0F6EC8                   movd mm1, eax
  9620 00000B31 0F60CA                   punpcklbw mm1, mm2
  9621 00000B34 0FDDC1                   paddusw mm0, mm1			; mm0 = center + left + right + UL
  9622 00000B37 66FF05[28000000]         inc word [_x]
  9623                                  
  9624                                  
  9625                                  
  9626                                  
  9627                                  
  9628                                  
  9629                                  
  9630                                   invoke _GetPixel, dword [ebp + .SrcOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [_x], word [_y]
  9631                              <1> %rotate -1
  9632                              <1> 
  9633                              <1> %rep (%0-1)
  9634                              <1> 
  9635                              <1> 
  9636                              <1> 
  9637                              <1> 
  9638                              <1> 
  9639                              <1> 
  9640                              <1> 
  9641                              <1>         %ifidni %1, cs
  9642                              <1>                 o16 push %1
  9643                              <1>         %elifidni %1, ds
  9644                              <1>                 o16 push %1
  9645                              <1>         %elifidni %1, es
  9646                              <1>                 o16 push %1
  9647                              <1>         %elifidni %1, fs
  9648                              <1>                 o16 push %1
  9649                              <1>         %elifidni %1, gs
  9650                              <1>                 o16 push %1
  9651                              <1>         %elifidni %1, word cs
  9652                              <1>                 o16 push %1
  9653                              <1>         %elifidni %1, word ds
  9654                              <1>                 o16 push %1
  9655                              <1>         %elifidni %1, word es
  9656                              <1>                 o16 push %1
  9657                              <1>         %elifidni %1, word fs
  9658                              <1>                 o16 push %1
  9659                              <1>         %elifidni %1, word gs
  9660                              <1>                 o16 push %1
  9661                              <1>         %else
  9662                              <1>                 push %1
  9663                              <1>         %endif
  9664                              <1> 
  9665                              <1>         %rotate -1
  9666                              <1> %endrep
  9667                              <2> 
  9668                              <2> 
  9669                              <2> 
  9670                              <2> 
  9671                              <2> 
  9672                              <2> 
  9673                              <2> 
  9674                              <2>         %ifidni %1, cs
  9675                              <2>                 o16 push %1
  9676                              <2>         %elifidni %1, ds
  9677                              <2>                 o16 push %1
  9678                              <2>         %elifidni %1, es
  9679                              <2>                 o16 push %1
  9680                              <2>         %elifidni %1, fs
  9681                              <2>                 o16 push %1
  9682                              <2>         %elifidni %1, gs
  9683                              <2>                 o16 push %1
  9684                              <2>         %elifidni %1, word cs
  9685                              <2>                 o16 push %1
  9686                              <2>         %elifidni %1, word ds
  9687                              <2>                 o16 push %1
  9688                              <2>         %elifidni %1, word es
  9689                              <2>                 o16 push %1
  9690                              <2>         %elifidni %1, word fs
  9691                              <2>                 o16 push %1
  9692                              <2>         %elifidni %1, word gs
  9693                              <2>                 o16 push %1
  9694                              <2>         %else
  9695 00000B3E 66FF35[2A000000]    <2>                 push %1
  9696                              <2>         %endif
  9697                              <2> 
  9698                              <2>         %rotate -1
  9699                              <2> 
  9700                              <2> 
  9701                              <2> 
  9702                              <2> 
  9703                              <2> 
  9704                              <2> 
  9705                              <2> 
  9706                              <2>         %ifidni %1, cs
  9707                              <2>                 o16 push %1
  9708                              <2>         %elifidni %1, ds
  9709                              <2>                 o16 push %1
  9710                              <2>         %elifidni %1, es
  9711                              <2>                 o16 push %1
  9712                              <2>         %elifidni %1, fs
  9713                              <2>                 o16 push %1
  9714                              <2>         %elifidni %1, gs
  9715                              <2>                 o16 push %1
  9716                              <2>         %elifidni %1, word cs
  9717                              <2>                 o16 push %1
  9718                              <2>         %elifidni %1, word ds
  9719                              <2>                 o16 push %1
  9720                              <2>         %elifidni %1, word es
  9721                              <2>                 o16 push %1
  9722                              <2>         %elifidni %1, word fs
  9723                              <2>                 o16 push %1
  9724                              <2>         %elifidni %1, word gs
  9725                              <2>                 o16 push %1
  9726                              <2>         %else
  9727 00000B45 66FF35[28000000]    <2>                 push %1
  9728                              <2>         %endif
  9729                              <2> 
  9730                              <2>         %rotate -1
  9731                              <2> 
  9732                              <2> 
  9733                              <2> 
  9734                              <2> 
  9735                              <2> 
  9736                              <2> 
  9737                              <2> 
  9738                              <2>         %ifidni %1, cs
  9739                              <2>                 o16 push %1
  9740                              <2>         %elifidni %1, ds
  9741                              <2>                 o16 push %1
  9742                              <2>         %elifidni %1, es
  9743                              <2>                 o16 push %1
  9744                              <2>         %elifidni %1, fs
  9745                              <2>                 o16 push %1
  9746                              <2>         %elifidni %1, gs
  9747                              <2>                 o16 push %1
  9748                              <2>         %elifidni %1, word cs
  9749                              <2>                 o16 push %1
  9750                              <2>         %elifidni %1, word ds
  9751                              <2>                 o16 push %1
  9752                              <2>         %elifidni %1, word es
  9753                              <2>                 o16 push %1
  9754                              <2>         %elifidni %1, word fs
  9755                              <2>                 o16 push %1
  9756                              <2>         %elifidni %1, word gs
  9757                              <2>                 o16 push %1
  9758                              <2>         %else
  9759 00000B4C 66FF7512            <2>                 push %1
  9760                              <2>         %endif
  9761                              <2> 
  9762                              <2>         %rotate -1
  9763                              <2> 
  9764                              <2> 
  9765                              <2> 
  9766                              <2> 
  9767                              <2> 
  9768                              <2> 
  9769                              <2> 
  9770                              <2>         %ifidni %1, cs
  9771                              <2>                 o16 push %1
  9772                              <2>         %elifidni %1, ds
  9773                              <2>                 o16 push %1
  9774                              <2>         %elifidni %1, es
  9775                              <2>                 o16 push %1
  9776                              <2>         %elifidni %1, fs
  9777                              <2>                 o16 push %1
  9778                              <2>         %elifidni %1, gs
  9779                              <2>                 o16 push %1
  9780                              <2>         %elifidni %1, word cs
  9781                              <2>                 o16 push %1
  9782                              <2>         %elifidni %1, word ds
  9783                              <2>                 o16 push %1
  9784                              <2>         %elifidni %1, word es
  9785                              <2>                 o16 push %1
  9786                              <2>         %elifidni %1, word fs
  9787                              <2>                 o16 push %1
  9788                              <2>         %elifidni %1, word gs
  9789                              <2>                 o16 push %1
  9790                              <2>         %else
  9791 00000B50 66FF7510            <2>                 push %1
  9792                              <2>         %endif
  9793                              <2> 
  9794                              <2>         %rotate -1
  9795                              <2> 
  9796                              <2> 
  9797                              <2> 
  9798                              <2> 
  9799                              <2> 
  9800                              <2> 
  9801                              <2> 
  9802                              <2>         %ifidni %1, cs
  9803                              <2>                 o16 push %1
  9804                              <2>         %elifidni %1, ds
  9805                              <2>                 o16 push %1
  9806                              <2>         %elifidni %1, es
  9807                              <2>                 o16 push %1
  9808                              <2>         %elifidni %1, fs
  9809                              <2>                 o16 push %1
  9810                              <2>         %elifidni %1, gs
  9811                              <2>                 o16 push %1
  9812                              <2>         %elifidni %1, word cs
  9813                              <2>                 o16 push %1
  9814                              <2>         %elifidni %1, word ds
  9815                              <2>                 o16 push %1
  9816                              <2>         %elifidni %1, word es
  9817                              <2>                 o16 push %1
  9818                              <2>         %elifidni %1, word fs
  9819                              <2>                 o16 push %1
  9820                              <2>         %elifidni %1, word gs
  9821                              <2>                 o16 push %1
  9822                              <2>         %else
  9823 00000B54 FF7508              <2>                 push %1
  9824                              <2>         %endif
  9825                              <2> 
  9826                              <2>         %rotate -1
  9827 00000B57 E8ABF6FFFF          <1> call %1
  9828                              <1> %if (%0!=1)
  9829 00000B5C 83C40C              <1>         add esp, byte %1_arglen
  9830                              <1> %endif
  9831                                  
  9832 00000B5F 0F6EC8                   movd mm1, eax
  9833 00000B62 0F60CA                   punpcklbw mm1, mm2
  9834 00000B65 0F71F101                 psllw mm1, 1
  9835 00000B69 0FDDC1                   paddusw mm0, mm1			; mm0 = center + left + right + UL + top
  9836                                  
  9837                                   
  9838                                  
  9839                                  
  9840                                  
  9841                                  
  9842                                  
  9843 00000B6C 66FF05[28000000]         inc word [_x]
  9844                                   invoke _GetPixel, dword [ebp + .SrcOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [_x], word [_y]
  9845                              <1> %rotate -1
  9846                              <1> 
  9847                              <1> %rep (%0-1)
  9848                              <1> 
  9849                              <1> 
  9850                              <1> 
  9851                              <1> 
  9852                              <1> 
  9853                              <1> 
  9854                              <1> 
  9855                              <1>         %ifidni %1, cs
  9856                              <1>                 o16 push %1
  9857                              <1>         %elifidni %1, ds
  9858                              <1>                 o16 push %1
  9859                              <1>         %elifidni %1, es
  9860                              <1>                 o16 push %1
  9861                              <1>         %elifidni %1, fs
  9862                              <1>                 o16 push %1
  9863                              <1>         %elifidni %1, gs
  9864                              <1>                 o16 push %1
  9865                              <1>         %elifidni %1, word cs
  9866                              <1>                 o16 push %1
  9867                              <1>         %elifidni %1, word ds
  9868                              <1>                 o16 push %1
  9869                              <1>         %elifidni %1, word es
  9870                              <1>                 o16 push %1
  9871                              <1>         %elifidni %1, word fs
  9872                              <1>                 o16 push %1
  9873                              <1>         %elifidni %1, word gs
  9874                              <1>                 o16 push %1
  9875                              <1>         %else
  9876                              <1>                 push %1
  9877                              <1>         %endif
  9878                              <1> 
  9879                              <1>         %rotate -1
  9880                              <1> %endrep
  9881                              <2> 
  9882                              <2> 
  9883                              <2> 
  9884                              <2> 
  9885                              <2> 
  9886                              <2> 
  9887                              <2> 
  9888                              <2>         %ifidni %1, cs
  9889                              <2>                 o16 push %1
  9890                              <2>         %elifidni %1, ds
  9891                              <2>                 o16 push %1
  9892                              <2>         %elifidni %1, es
  9893                              <2>                 o16 push %1
  9894                              <2>         %elifidni %1, fs
  9895                              <2>                 o16 push %1
  9896                              <2>         %elifidni %1, gs
  9897                              <2>                 o16 push %1
  9898                              <2>         %elifidni %1, word cs
  9899                              <2>                 o16 push %1
  9900                              <2>         %elifidni %1, word ds
  9901                              <2>                 o16 push %1
  9902                              <2>         %elifidni %1, word es
  9903                              <2>                 o16 push %1
  9904                              <2>         %elifidni %1, word fs
  9905                              <2>                 o16 push %1
  9906                              <2>         %elifidni %1, word gs
  9907                              <2>                 o16 push %1
  9908                              <2>         %else
  9909 00000B73 66FF35[2A000000]    <2>                 push %1
  9910                              <2>         %endif
  9911                              <2> 
  9912                              <2>         %rotate -1
  9913                              <2> 
  9914                              <2> 
  9915                              <2> 
  9916                              <2> 
  9917                              <2> 
  9918                              <2> 
  9919                              <2> 
  9920                              <2>         %ifidni %1, cs
  9921                              <2>                 o16 push %1
  9922                              <2>         %elifidni %1, ds
  9923                              <2>                 o16 push %1
  9924                              <2>         %elifidni %1, es
  9925                              <2>                 o16 push %1
  9926                              <2>         %elifidni %1, fs
  9927                              <2>                 o16 push %1
  9928                              <2>         %elifidni %1, gs
  9929                              <2>                 o16 push %1
  9930                              <2>         %elifidni %1, word cs
  9931                              <2>                 o16 push %1
  9932                              <2>         %elifidni %1, word ds
  9933                              <2>                 o16 push %1
  9934                              <2>         %elifidni %1, word es
  9935                              <2>                 o16 push %1
  9936                              <2>         %elifidni %1, word fs
  9937                              <2>                 o16 push %1
  9938                              <2>         %elifidni %1, word gs
  9939                              <2>                 o16 push %1
  9940                              <2>         %else
  9941 00000B7A 66FF35[28000000]    <2>                 push %1
  9942                              <2>         %endif
  9943                              <2> 
  9944                              <2>         %rotate -1
  9945                              <2> 
  9946                              <2> 
  9947                              <2> 
  9948                              <2> 
  9949                              <2> 
  9950                              <2> 
  9951                              <2> 
  9952                              <2>         %ifidni %1, cs
  9953                              <2>                 o16 push %1
  9954                              <2>         %elifidni %1, ds
  9955                              <2>                 o16 push %1
  9956                              <2>         %elifidni %1, es
  9957                              <2>                 o16 push %1
  9958                              <2>         %elifidni %1, fs
  9959                              <2>                 o16 push %1
  9960                              <2>         %elifidni %1, gs
  9961                              <2>                 o16 push %1
  9962                              <2>         %elifidni %1, word cs
  9963                              <2>                 o16 push %1
  9964                              <2>         %elifidni %1, word ds
  9965                              <2>                 o16 push %1
  9966                              <2>         %elifidni %1, word es
  9967                              <2>                 o16 push %1
  9968                              <2>         %elifidni %1, word fs
  9969                              <2>                 o16 push %1
  9970                              <2>         %elifidni %1, word gs
  9971                              <2>                 o16 push %1
  9972                              <2>         %else
  9973 00000B81 66FF7512            <2>                 push %1
  9974                              <2>         %endif
  9975                              <2> 
  9976                              <2>         %rotate -1
  9977                              <2> 
  9978                              <2> 
  9979                              <2> 
  9980                              <2> 
  9981                              <2> 
  9982                              <2> 
  9983                              <2> 
  9984                              <2>         %ifidni %1, cs
  9985                              <2>                 o16 push %1
  9986                              <2>         %elifidni %1, ds
  9987                              <2>                 o16 push %1
  9988                              <2>         %elifidni %1, es
  9989                              <2>                 o16 push %1
  9990                              <2>         %elifidni %1, fs
  9991                              <2>                 o16 push %1
  9992                              <2>         %elifidni %1, gs
  9993                              <2>                 o16 push %1
  9994                              <2>         %elifidni %1, word cs
  9995                              <2>                 o16 push %1
  9996                              <2>         %elifidni %1, word ds
  9997                              <2>                 o16 push %1
  9998                              <2>         %elifidni %1, word es
  9999                              <2>                 o16 push %1
 10000                              <2>         %elifidni %1, word fs
 10001                              <2>                 o16 push %1
 10002                              <2>         %elifidni %1, word gs
 10003                              <2>                 o16 push %1
 10004                              <2>         %else
 10005 00000B85 66FF7510            <2>                 push %1
 10006                              <2>         %endif
 10007                              <2> 
 10008                              <2>         %rotate -1
 10009                              <2> 
 10010                              <2> 
 10011                              <2> 
 10012                              <2> 
 10013                              <2> 
 10014                              <2> 
 10015                              <2> 
 10016                              <2>         %ifidni %1, cs
 10017                              <2>                 o16 push %1
 10018                              <2>         %elifidni %1, ds
 10019                              <2>                 o16 push %1
 10020                              <2>         %elifidni %1, es
 10021                              <2>                 o16 push %1
 10022                              <2>         %elifidni %1, fs
 10023                              <2>                 o16 push %1
 10024                              <2>         %elifidni %1, gs
 10025                              <2>                 o16 push %1
 10026                              <2>         %elifidni %1, word cs
 10027                              <2>                 o16 push %1
 10028                              <2>         %elifidni %1, word ds
 10029                              <2>                 o16 push %1
 10030                              <2>         %elifidni %1, word es
 10031                              <2>                 o16 push %1
 10032                              <2>         %elifidni %1, word fs
 10033                              <2>                 o16 push %1
 10034                              <2>         %elifidni %1, word gs
 10035                              <2>                 o16 push %1
 10036                              <2>         %else
 10037 00000B89 FF7508              <2>                 push %1
 10038                              <2>         %endif
 10039                              <2> 
 10040                              <2>         %rotate -1
 10041 00000B8C E876F6FFFF          <1> call %1
 10042                              <1> %if (%0!=1)
 10043 00000B91 83C40C              <1>         add esp, byte %1_arglen
 10044                              <1> %endif
 10045                                  
 10046 00000B94 0F6EC8                   movd mm1, eax
 10047 00000B97 0F60CA                   punpcklbw mm1, mm2
 10048 00000B9A 0FDDC1                   paddusw mm0, mm1			; mm0 = center + left + right + UL + top + UR
 10049 00000B9D 66FF0D[28000000]         dec word [_x]
 10050 00000BA4 66FF05[2A000000]         inc word [_y]
 10051                                  
 10052                                  
 10053                                  
 10054                                  
 10055                                  
 10056                                  
 10057                                  
 10058                                  
 10059 00000BAB 66FF0D[28000000]         dec word [_x]
 10060 00000BB2 66FF05[2A000000]         inc word [_y]
 10061                                   invoke _GetPixel, dword [ebp + .SrcOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [_x], word [_y]
 10062                              <1> %rotate -1
 10063                              <1> 
 10064                              <1> %rep (%0-1)
 10065                              <1> 
 10066                              <1> 
 10067                              <1> 
 10068                              <1> 
 10069                              <1> 
 10070                              <1> 
 10071                              <1> 
 10072                              <1>         %ifidni %1, cs
 10073                              <1>                 o16 push %1
 10074                              <1>         %elifidni %1, ds
 10075                              <1>                 o16 push %1
 10076                              <1>         %elifidni %1, es
 10077                              <1>                 o16 push %1
 10078                              <1>         %elifidni %1, fs
 10079                              <1>                 o16 push %1
 10080                              <1>         %elifidni %1, gs
 10081                              <1>                 o16 push %1
 10082                              <1>         %elifidni %1, word cs
 10083                              <1>                 o16 push %1
 10084                              <1>         %elifidni %1, word ds
 10085                              <1>                 o16 push %1
 10086                              <1>         %elifidni %1, word es
 10087                              <1>                 o16 push %1
 10088                              <1>         %elifidni %1, word fs
 10089                              <1>                 o16 push %1
 10090                              <1>         %elifidni %1, word gs
 10091                              <1>                 o16 push %1
 10092                              <1>         %else
 10093                              <1>                 push %1
 10094                              <1>         %endif
 10095                              <1> 
 10096                              <1>         %rotate -1
 10097                              <1> %endrep
 10098                              <2> 
 10099                              <2> 
 10100                              <2> 
 10101                              <2> 
 10102                              <2> 
 10103                              <2> 
 10104                              <2> 
 10105                              <2>         %ifidni %1, cs
 10106                              <2>                 o16 push %1
 10107                              <2>         %elifidni %1, ds
 10108                              <2>                 o16 push %1
 10109                              <2>         %elifidni %1, es
 10110                              <2>                 o16 push %1
 10111                              <2>         %elifidni %1, fs
 10112                              <2>                 o16 push %1
 10113                              <2>         %elifidni %1, gs
 10114                              <2>                 o16 push %1
 10115                              <2>         %elifidni %1, word cs
 10116                              <2>                 o16 push %1
 10117                              <2>         %elifidni %1, word ds
 10118                              <2>                 o16 push %1
 10119                              <2>         %elifidni %1, word es
 10120                              <2>                 o16 push %1
 10121                              <2>         %elifidni %1, word fs
 10122                              <2>                 o16 push %1
 10123                              <2>         %elifidni %1, word gs
 10124                              <2>                 o16 push %1
 10125                              <2>         %else
 10126 00000BB9 66FF35[2A000000]    <2>                 push %1
 10127                              <2>         %endif
 10128                              <2> 
 10129                              <2>         %rotate -1
 10130                              <2> 
 10131                              <2> 
 10132                              <2> 
 10133                              <2> 
 10134                              <2> 
 10135                              <2> 
 10136                              <2> 
 10137                              <2>         %ifidni %1, cs
 10138                              <2>                 o16 push %1
 10139                              <2>         %elifidni %1, ds
 10140                              <2>                 o16 push %1
 10141                              <2>         %elifidni %1, es
 10142                              <2>                 o16 push %1
 10143                              <2>         %elifidni %1, fs
 10144                              <2>                 o16 push %1
 10145                              <2>         %elifidni %1, gs
 10146                              <2>                 o16 push %1
 10147                              <2>         %elifidni %1, word cs
 10148                              <2>                 o16 push %1
 10149                              <2>         %elifidni %1, word ds
 10150                              <2>                 o16 push %1
 10151                              <2>         %elifidni %1, word es
 10152                              <2>                 o16 push %1
 10153                              <2>         %elifidni %1, word fs
 10154                              <2>                 o16 push %1
 10155                              <2>         %elifidni %1, word gs
 10156                              <2>                 o16 push %1
 10157                              <2>         %else
 10158 00000BC0 66FF35[28000000]    <2>                 push %1
 10159                              <2>         %endif
 10160                              <2> 
 10161                              <2>         %rotate -1
 10162                              <2> 
 10163                              <2> 
 10164                              <2> 
 10165                              <2> 
 10166                              <2> 
 10167                              <2> 
 10168                              <2> 
 10169                              <2>         %ifidni %1, cs
 10170                              <2>                 o16 push %1
 10171                              <2>         %elifidni %1, ds
 10172                              <2>                 o16 push %1
 10173                              <2>         %elifidni %1, es
 10174                              <2>                 o16 push %1
 10175                              <2>         %elifidni %1, fs
 10176                              <2>                 o16 push %1
 10177                              <2>         %elifidni %1, gs
 10178                              <2>                 o16 push %1
 10179                              <2>         %elifidni %1, word cs
 10180                              <2>                 o16 push %1
 10181                              <2>         %elifidni %1, word ds
 10182                              <2>                 o16 push %1
 10183                              <2>         %elifidni %1, word es
 10184                              <2>                 o16 push %1
 10185                              <2>         %elifidni %1, word fs
 10186                              <2>                 o16 push %1
 10187                              <2>         %elifidni %1, word gs
 10188                              <2>                 o16 push %1
 10189                              <2>         %else
 10190 00000BC7 66FF7512            <2>                 push %1
 10191                              <2>         %endif
 10192                              <2> 
 10193                              <2>         %rotate -1
 10194                              <2> 
 10195                              <2> 
 10196                              <2> 
 10197                              <2> 
 10198                              <2> 
 10199                              <2> 
 10200                              <2> 
 10201                              <2>         %ifidni %1, cs
 10202                              <2>                 o16 push %1
 10203                              <2>         %elifidni %1, ds
 10204                              <2>                 o16 push %1
 10205                              <2>         %elifidni %1, es
 10206                              <2>                 o16 push %1
 10207                              <2>         %elifidni %1, fs
 10208                              <2>                 o16 push %1
 10209                              <2>         %elifidni %1, gs
 10210                              <2>                 o16 push %1
 10211                              <2>         %elifidni %1, word cs
 10212                              <2>                 o16 push %1
 10213                              <2>         %elifidni %1, word ds
 10214                              <2>                 o16 push %1
 10215                              <2>         %elifidni %1, word es
 10216                              <2>                 o16 push %1
 10217                              <2>         %elifidni %1, word fs
 10218                              <2>                 o16 push %1
 10219                              <2>         %elifidni %1, word gs
 10220                              <2>                 o16 push %1
 10221                              <2>         %else
 10222 00000BCB 66FF7510            <2>                 push %1
 10223                              <2>         %endif
 10224                              <2> 
 10225                              <2>         %rotate -1
 10226                              <2> 
 10227                              <2> 
 10228                              <2> 
 10229                              <2> 
 10230                              <2> 
 10231                              <2> 
 10232                              <2> 
 10233                              <2>         %ifidni %1, cs
 10234                              <2>                 o16 push %1
 10235                              <2>         %elifidni %1, ds
 10236                              <2>                 o16 push %1
 10237                              <2>         %elifidni %1, es
 10238                              <2>                 o16 push %1
 10239                              <2>         %elifidni %1, fs
 10240                              <2>                 o16 push %1
 10241                              <2>         %elifidni %1, gs
 10242                              <2>                 o16 push %1
 10243                              <2>         %elifidni %1, word cs
 10244                              <2>                 o16 push %1
 10245                              <2>         %elifidni %1, word ds
 10246                              <2>                 o16 push %1
 10247                              <2>         %elifidni %1, word es
 10248                              <2>                 o16 push %1
 10249                              <2>         %elifidni %1, word fs
 10250                              <2>                 o16 push %1
 10251                              <2>         %elifidni %1, word gs
 10252                              <2>                 o16 push %1
 10253                              <2>         %else
 10254 00000BCF FF7508              <2>                 push %1
 10255                              <2>         %endif
 10256                              <2> 
 10257                              <2>         %rotate -1
 10258 00000BD2 E830F6FFFF          <1> call %1
 10259                              <1> %if (%0!=1)
 10260 00000BD7 83C40C              <1>         add esp, byte %1_arglen
 10261                              <1> %endif
 10262 00000BDA 668B5D12                 mov	bx, word [ebp+.DestHeight]
 10263 00000BDE 66391D[2A000000]         cmp	word [_y], bx
 10264 00000BE5 7502                     jne	.LLPixel
 10265 00000BE7 31C0                     xor	eax, eax			; If we are at bottom row, ignore LL pixel
 10266                                  
 10267                                   .LLPixel:
 10268 00000BE9 0F6EC8                   movd mm1, eax
 10269 00000BEC 0F60CA                   punpcklbw mm1, mm2
 10270 00000BEF 0FDDC1                   paddusw mm0, mm1			; mm0 = center + left + right + UL + top + UR + LL
 10271 00000BF2 66FF05[28000000]         inc word [_x]
 10272                                  
 10273                                  
 10274                                  
 10275                                  
 10276                                  
 10277                                  
 10278                                  
 10279                                  
 10280                                   invoke _GetPixel, dword [ebp + .SrcOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [_x], word [_y]
 10281                              <1> %rotate -1
 10282                              <1> 
 10283                              <1> %rep (%0-1)
 10284                              <1> 
 10285                              <1> 
 10286                              <1> 
 10287                              <1> 
 10288                              <1> 
 10289                              <1> 
 10290                              <1> 
 10291                              <1>         %ifidni %1, cs
 10292                              <1>                 o16 push %1
 10293                              <1>         %elifidni %1, ds
 10294                              <1>                 o16 push %1
 10295                              <1>         %elifidni %1, es
 10296                              <1>                 o16 push %1
 10297                              <1>         %elifidni %1, fs
 10298                              <1>                 o16 push %1
 10299                              <1>         %elifidni %1, gs
 10300                              <1>                 o16 push %1
 10301                              <1>         %elifidni %1, word cs
 10302                              <1>                 o16 push %1
 10303                              <1>         %elifidni %1, word ds
 10304                              <1>                 o16 push %1
 10305                              <1>         %elifidni %1, word es
 10306                              <1>                 o16 push %1
 10307                              <1>         %elifidni %1, word fs
 10308                              <1>                 o16 push %1
 10309                              <1>         %elifidni %1, word gs
 10310                              <1>                 o16 push %1
 10311                              <1>         %else
 10312                              <1>                 push %1
 10313                              <1>         %endif
 10314                              <1> 
 10315                              <1>         %rotate -1
 10316                              <1> %endrep
 10317                              <2> 
 10318                              <2> 
 10319                              <2> 
 10320                              <2> 
 10321                              <2> 
 10322                              <2> 
 10323                              <2> 
 10324                              <2>         %ifidni %1, cs
 10325                              <2>                 o16 push %1
 10326                              <2>         %elifidni %1, ds
 10327                              <2>                 o16 push %1
 10328                              <2>         %elifidni %1, es
 10329                              <2>                 o16 push %1
 10330                              <2>         %elifidni %1, fs
 10331                              <2>                 o16 push %1
 10332                              <2>         %elifidni %1, gs
 10333                              <2>                 o16 push %1
 10334                              <2>         %elifidni %1, word cs
 10335                              <2>                 o16 push %1
 10336                              <2>         %elifidni %1, word ds
 10337                              <2>                 o16 push %1
 10338                              <2>         %elifidni %1, word es
 10339                              <2>                 o16 push %1
 10340                              <2>         %elifidni %1, word fs
 10341                              <2>                 o16 push %1
 10342                              <2>         %elifidni %1, word gs
 10343                              <2>                 o16 push %1
 10344                              <2>         %else
 10345 00000BF9 66FF35[2A000000]    <2>                 push %1
 10346                              <2>         %endif
 10347                              <2> 
 10348                              <2>         %rotate -1
 10349                              <2> 
 10350                              <2> 
 10351                              <2> 
 10352                              <2> 
 10353                              <2> 
 10354                              <2> 
 10355                              <2> 
 10356                              <2>         %ifidni %1, cs
 10357                              <2>                 o16 push %1
 10358                              <2>         %elifidni %1, ds
 10359                              <2>                 o16 push %1
 10360                              <2>         %elifidni %1, es
 10361                              <2>                 o16 push %1
 10362                              <2>         %elifidni %1, fs
 10363                              <2>                 o16 push %1
 10364                              <2>         %elifidni %1, gs
 10365                              <2>                 o16 push %1
 10366                              <2>         %elifidni %1, word cs
 10367                              <2>                 o16 push %1
 10368                              <2>         %elifidni %1, word ds
 10369                              <2>                 o16 push %1
 10370                              <2>         %elifidni %1, word es
 10371                              <2>                 o16 push %1
 10372                              <2>         %elifidni %1, word fs
 10373                              <2>                 o16 push %1
 10374                              <2>         %elifidni %1, word gs
 10375                              <2>                 o16 push %1
 10376                              <2>         %else
 10377 00000C00 66FF35[28000000]    <2>                 push %1
 10378                              <2>         %endif
 10379                              <2> 
 10380                              <2>         %rotate -1
 10381                              <2> 
 10382                              <2> 
 10383                              <2> 
 10384                              <2> 
 10385                              <2> 
 10386                              <2> 
 10387                              <2> 
 10388                              <2>         %ifidni %1, cs
 10389                              <2>                 o16 push %1
 10390                              <2>         %elifidni %1, ds
 10391                              <2>                 o16 push %1
 10392                              <2>         %elifidni %1, es
 10393                              <2>                 o16 push %1
 10394                              <2>         %elifidni %1, fs
 10395                              <2>                 o16 push %1
 10396                              <2>         %elifidni %1, gs
 10397                              <2>                 o16 push %1
 10398                              <2>         %elifidni %1, word cs
 10399                              <2>                 o16 push %1
 10400                              <2>         %elifidni %1, word ds
 10401                              <2>                 o16 push %1
 10402                              <2>         %elifidni %1, word es
 10403                              <2>                 o16 push %1
 10404                              <2>         %elifidni %1, word fs
 10405                              <2>                 o16 push %1
 10406                              <2>         %elifidni %1, word gs
 10407                              <2>                 o16 push %1
 10408                              <2>         %else
 10409 00000C07 66FF7512            <2>                 push %1
 10410                              <2>         %endif
 10411                              <2> 
 10412                              <2>         %rotate -1
 10413                              <2> 
 10414                              <2> 
 10415                              <2> 
 10416                              <2> 
 10417                              <2> 
 10418                              <2> 
 10419                              <2> 
 10420                              <2>         %ifidni %1, cs
 10421                              <2>                 o16 push %1
 10422                              <2>         %elifidni %1, ds
 10423                              <2>                 o16 push %1
 10424                              <2>         %elifidni %1, es
 10425                              <2>                 o16 push %1
 10426                              <2>         %elifidni %1, fs
 10427                              <2>                 o16 push %1
 10428                              <2>         %elifidni %1, gs
 10429                              <2>                 o16 push %1
 10430                              <2>         %elifidni %1, word cs
 10431                              <2>                 o16 push %1
 10432                              <2>         %elifidni %1, word ds
 10433                              <2>                 o16 push %1
 10434                              <2>         %elifidni %1, word es
 10435                              <2>                 o16 push %1
 10436                              <2>         %elifidni %1, word fs
 10437                              <2>                 o16 push %1
 10438                              <2>         %elifidni %1, word gs
 10439                              <2>                 o16 push %1
 10440                              <2>         %else
 10441 00000C0B 66FF7510            <2>                 push %1
 10442                              <2>         %endif
 10443                              <2> 
 10444                              <2>         %rotate -1
 10445                              <2> 
 10446                              <2> 
 10447                              <2> 
 10448                              <2> 
 10449                              <2> 
 10450                              <2> 
 10451                              <2> 
 10452                              <2>         %ifidni %1, cs
 10453                              <2>                 o16 push %1
 10454                              <2>         %elifidni %1, ds
 10455                              <2>                 o16 push %1
 10456                              <2>         %elifidni %1, es
 10457                              <2>                 o16 push %1
 10458                              <2>         %elifidni %1, fs
 10459                              <2>                 o16 push %1
 10460                              <2>         %elifidni %1, gs
 10461                              <2>                 o16 push %1
 10462                              <2>         %elifidni %1, word cs
 10463                              <2>                 o16 push %1
 10464                              <2>         %elifidni %1, word ds
 10465                              <2>                 o16 push %1
 10466                              <2>         %elifidni %1, word es
 10467                              <2>                 o16 push %1
 10468                              <2>         %elifidni %1, word fs
 10469                              <2>                 o16 push %1
 10470                              <2>         %elifidni %1, word gs
 10471                              <2>                 o16 push %1
 10472                              <2>         %else
 10473 00000C0F FF7508              <2>                 push %1
 10474                              <2>         %endif
 10475                              <2> 
 10476                              <2>         %rotate -1
 10477 00000C12 E8F0F5FFFF          <1> call %1
 10478                              <1> %if (%0!=1)
 10479 00000C17 83C40C              <1>         add esp, byte %1_arglen
 10480                              <1> %endif
 10481 00000C1A 668B5D12                 mov bx, word [ebp+.DestHeight]
 10482 00000C1E 66391D[2A000000]         cmp word [_y], bx
 10483 00000C25 7502                     jne .BotPixel
 10484 00000C27 31C0                     xor eax, eax				; If we are at bottom row, ignore bottom pixel
 10485                                  
 10486                                   .BotPixel:
 10487 00000C29 0F6EC8                   movd mm1, eax
 10488 00000C2C 0F60CA                   punpcklbw mm1, mm2
 10489 00000C2F 0F71F101                 psllw mm1, 1
 10490 00000C33 0FDDC1                   paddusw mm0, mm1			; mm0 = center + left + right + UL + top + UR + LL + bottom
 10491                                  
 10492                                  
 10493                                  
 10494                                  
 10495                                  
 10496                                  
 10497                                  
 10498                                  
 10499 00000C36 66FF05[28000000]         inc word [_x]
 10500                                   invoke _GetPixel, dword [ebp + .SrcOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [_x], word [_y]
 10501                              <1> %rotate -1
 10502                              <1> 
 10503                              <1> %rep (%0-1)
 10504                              <1> 
 10505                              <1> 
 10506                              <1> 
 10507                              <1> 
 10508                              <1> 
 10509                              <1> 
 10510                              <1> 
 10511                              <1>         %ifidni %1, cs
 10512                              <1>                 o16 push %1
 10513                              <1>         %elifidni %1, ds
 10514                              <1>                 o16 push %1
 10515                              <1>         %elifidni %1, es
 10516                              <1>                 o16 push %1
 10517                              <1>         %elifidni %1, fs
 10518                              <1>                 o16 push %1
 10519                              <1>         %elifidni %1, gs
 10520                              <1>                 o16 push %1
 10521                              <1>         %elifidni %1, word cs
 10522                              <1>                 o16 push %1
 10523                              <1>         %elifidni %1, word ds
 10524                              <1>                 o16 push %1
 10525                              <1>         %elifidni %1, word es
 10526                              <1>                 o16 push %1
 10527                              <1>         %elifidni %1, word fs
 10528                              <1>                 o16 push %1
 10529                              <1>         %elifidni %1, word gs
 10530                              <1>                 o16 push %1
 10531                              <1>         %else
 10532                              <1>                 push %1
 10533                              <1>         %endif
 10534                              <1> 
 10535                              <1>         %rotate -1
 10536                              <1> %endrep
 10537                              <2> 
 10538                              <2> 
 10539                              <2> 
 10540                              <2> 
 10541                              <2> 
 10542                              <2> 
 10543                              <2> 
 10544                              <2>         %ifidni %1, cs
 10545                              <2>                 o16 push %1
 10546                              <2>         %elifidni %1, ds
 10547                              <2>                 o16 push %1
 10548                              <2>         %elifidni %1, es
 10549                              <2>                 o16 push %1
 10550                              <2>         %elifidni %1, fs
 10551                              <2>                 o16 push %1
 10552                              <2>         %elifidni %1, gs
 10553                              <2>                 o16 push %1
 10554                              <2>         %elifidni %1, word cs
 10555                              <2>                 o16 push %1
 10556                              <2>         %elifidni %1, word ds
 10557                              <2>                 o16 push %1
 10558                              <2>         %elifidni %1, word es
 10559                              <2>                 o16 push %1
 10560                              <2>         %elifidni %1, word fs
 10561                              <2>                 o16 push %1
 10562                              <2>         %elifidni %1, word gs
 10563                              <2>                 o16 push %1
 10564                              <2>         %else
 10565 00000C3D 66FF35[2A000000]    <2>                 push %1
 10566                              <2>         %endif
 10567                              <2> 
 10568                              <2>         %rotate -1
 10569                              <2> 
 10570                              <2> 
 10571                              <2> 
 10572                              <2> 
 10573                              <2> 
 10574                              <2> 
 10575                              <2> 
 10576                              <2>         %ifidni %1, cs
 10577                              <2>                 o16 push %1
 10578                              <2>         %elifidni %1, ds
 10579                              <2>                 o16 push %1
 10580                              <2>         %elifidni %1, es
 10581                              <2>                 o16 push %1
 10582                              <2>         %elifidni %1, fs
 10583                              <2>                 o16 push %1
 10584                              <2>         %elifidni %1, gs
 10585                              <2>                 o16 push %1
 10586                              <2>         %elifidni %1, word cs
 10587                              <2>                 o16 push %1
 10588                              <2>         %elifidni %1, word ds
 10589                              <2>                 o16 push %1
 10590                              <2>         %elifidni %1, word es
 10591                              <2>                 o16 push %1
 10592                              <2>         %elifidni %1, word fs
 10593                              <2>                 o16 push %1
 10594                              <2>         %elifidni %1, word gs
 10595                              <2>                 o16 push %1
 10596                              <2>         %else
 10597 00000C44 66FF35[28000000]    <2>                 push %1
 10598                              <2>         %endif
 10599                              <2> 
 10600                              <2>         %rotate -1
 10601                              <2> 
 10602                              <2> 
 10603                              <2> 
 10604                              <2> 
 10605                              <2> 
 10606                              <2> 
 10607                              <2> 
 10608                              <2>         %ifidni %1, cs
 10609                              <2>                 o16 push %1
 10610                              <2>         %elifidni %1, ds
 10611                              <2>                 o16 push %1
 10612                              <2>         %elifidni %1, es
 10613                              <2>                 o16 push %1
 10614                              <2>         %elifidni %1, fs
 10615                              <2>                 o16 push %1
 10616                              <2>         %elifidni %1, gs
 10617                              <2>                 o16 push %1
 10618                              <2>         %elifidni %1, word cs
 10619                              <2>                 o16 push %1
 10620                              <2>         %elifidni %1, word ds
 10621                              <2>                 o16 push %1
 10622                              <2>         %elifidni %1, word es
 10623                              <2>                 o16 push %1
 10624                              <2>         %elifidni %1, word fs
 10625                              <2>                 o16 push %1
 10626                              <2>         %elifidni %1, word gs
 10627                              <2>                 o16 push %1
 10628                              <2>         %else
 10629 00000C4B 66FF7512            <2>                 push %1
 10630                              <2>         %endif
 10631                              <2> 
 10632                              <2>         %rotate -1
 10633                              <2> 
 10634                              <2> 
 10635                              <2> 
 10636                              <2> 
 10637                              <2> 
 10638                              <2> 
 10639                              <2> 
 10640                              <2>         %ifidni %1, cs
 10641                              <2>                 o16 push %1
 10642                              <2>         %elifidni %1, ds
 10643                              <2>                 o16 push %1
 10644                              <2>         %elifidni %1, es
 10645                              <2>                 o16 push %1
 10646                              <2>         %elifidni %1, fs
 10647                              <2>                 o16 push %1
 10648                              <2>         %elifidni %1, gs
 10649                              <2>                 o16 push %1
 10650                              <2>         %elifidni %1, word cs
 10651                              <2>                 o16 push %1
 10652                              <2>         %elifidni %1, word ds
 10653                              <2>                 o16 push %1
 10654                              <2>         %elifidni %1, word es
 10655                              <2>                 o16 push %1
 10656                              <2>         %elifidni %1, word fs
 10657                              <2>                 o16 push %1
 10658                              <2>         %elifidni %1, word gs
 10659                              <2>                 o16 push %1
 10660                              <2>         %else
 10661 00000C4F 66FF7510            <2>                 push %1
 10662                              <2>         %endif
 10663                              <2> 
 10664                              <2>         %rotate -1
 10665                              <2> 
 10666                              <2> 
 10667                              <2> 
 10668                              <2> 
 10669                              <2> 
 10670                              <2> 
 10671                              <2> 
 10672                              <2>         %ifidni %1, cs
 10673                              <2>                 o16 push %1
 10674                              <2>         %elifidni %1, ds
 10675                              <2>                 o16 push %1
 10676                              <2>         %elifidni %1, es
 10677                              <2>                 o16 push %1
 10678                              <2>         %elifidni %1, fs
 10679                              <2>                 o16 push %1
 10680                              <2>         %elifidni %1, gs
 10681                              <2>                 o16 push %1
 10682                              <2>         %elifidni %1, word cs
 10683                              <2>                 o16 push %1
 10684                              <2>         %elifidni %1, word ds
 10685                              <2>                 o16 push %1
 10686                              <2>         %elifidni %1, word es
 10687                              <2>                 o16 push %1
 10688                              <2>         %elifidni %1, word fs
 10689                              <2>                 o16 push %1
 10690                              <2>         %elifidni %1, word gs
 10691                              <2>                 o16 push %1
 10692                              <2>         %else
 10693 00000C53 FF7508              <2>                 push %1
 10694                              <2>         %endif
 10695                              <2> 
 10696                              <2>         %rotate -1
 10697 00000C56 E8ACF5FFFF          <1> call %1
 10698                              <1> %if (%0!=1)
 10699 00000C5B 83C40C              <1>         add esp, byte %1_arglen
 10700                              <1> %endif
 10701 00000C5E 668B5D12                 mov bx, word [ebp+.DestHeight]
 10702 00000C62 66391D[2A000000]         cmp word [_y], bx
 10703 00000C69 7502                     jne .LRPixel
 10704 00000C6B 31C0                     xor eax, eax				; If we are at bottom row, ignore LR pixel
 10705                                  
 10706                                   .LRPixel:
 10707 00000C6D 0F6EC8                   movd mm1, eax
 10708 00000C70 0F60CA                   punpcklbw mm1, mm2
 10709 00000C73 0FDDC1                   paddusw mm0, mm1			; mm0 = (center + left + right) + (UL + top + UR) + (LL + bottom + LR)
 10710 00000C76 66FF0D[2A000000]         dec word [_y]
 10711                                  
 10712                                  
 10713                                  
 10714                                  
 10715 00000C7D 0F71D004                 psrlw mm0, 4				; mm0 = ((center + left + right) + (UL + top + UR) + (LL + bottom + LR))/16
 10716 00000C81 0F67C2                   packuswb mm0, mm2			; mm0 = blurred pixel [00][00][AR][GB]
 10717 00000C84 0F7E07                   movd dword [edi], mm0			; write pixel to memory
 10718                                  
 10719                                  
 10720                                  
 10721                                   ;-------------
 10722                                   .InvalidPoint:
 10723                                   ;-------------
 10724 00000C87 81C704000000                add edi, 4				; point to next pixel
 10725 00000C8D 81C604000000                add esi, 4
 10726                                  
 10727 00000C93 668B4510                    mov	ax, word [ebp + .DestWidth]
 10728 00000C97 663905[28000000]            cmp	word [_x], ax
 10729 00000C9E 7510                        jne	.NotEndofRow
 10730 00000CA0 66C705[28000000]00-         mov	word [_x], 0
 10731 00000CA8 00                 
 10732 00000CA9 66FF05[2A000000]            inc	word [_y]
 10733                                  
 10734                                  
 10735                                  
 10736                                   ;------------
 10737                                   .NotEndofRow:
 10738                                   ;------------
 10739 00000CB0 49                          dec ecx
 10740 00000CB1 0F858DFDFFFF                jnz near .RowLoop
 10741                                  
 10742                                  
 10743 00000CB7 61                          popad
 10744 00000CB8 0F77                        emms
 10745                                      ret
 10746                              <1> %ifnctx proc
 10747                              <1> 	ret	%1
 10748                              <1> %else
 10749 00000CBA 89EC                <1> 	mov	esp, ebp
 10750 00000CBC 5D                  <1> 	pop	ebp
 10751 00000CBD C3                  <1> 	ret	%1
 10752                              <1> %endif
 10753                                  
 10754                                  
 10755                                  endproc
 10756                              <1> %ifnctx proc
 10757                              <1> %error Mismatched `endproc'/`proc'
 10758                              <1> %else
 10759                              <1> 
 10760                              <1> 
 10761                              <1> %ifdef LEGACY_ENDPROC
 10762                              <1>         ret
 10763                              <1> %endif
 10764                              <1> 
 10765                              <1> 
 10766                              <1> 
 10767                              <1> 
 10768                              <1> 
 10769                              <1> 
 10770                              <1> 
 10771                              <1> 
 10772                              <1> 
 10773                              <1> %pop
 10774                              <1> %endif
 10775                                  _BlurBuffer_arglen	EQU	12
 10776                                  
 10777                                  
 10778                                  
 10779                                  
 10780                                  
 10781                                  
 10782                                  
 10783                                  
 10784                                  ;-------------------------------------------------------------------------;
 10785                                  ; FloodFill()								  ;
 10786                                  ;									  ;
 10787                                  ;   void _CopyBuffer(dword DestOff, word DestWidth, word DestHeight,	  ;
 10788                                  ;                     word X, word Y, dword .Color, dword ComposeFlag)	  ;
 10789                                  ;									  ;
 10790                                  ;   Inputs: DestOff= offset of an image buffer in memory		  ;
 10791                                  ;           DestWidth = width of destination buffer			  ;
 10792                                  ;	    DestHeight = height of destination buffer			  ;
 10793                                  ;	    X = x coordinate of point in the region			  ;
 10794                                  ;	    Y = y coordinate of point in the region			  ;
 10795                                  ;	    Color = new color for region				  ;
 10796                                  ;	    ComposeFlag = flag to determine whether or not to alpha	  ;
 10797                                  ;	               compose the current color of the region with Color ;
 10798                                  ;									  ;
 10799                                  ;   Outputs: Region filled with color Color in buffer			  ;
 10800                                  ;									  ;
 10801                                  ;   Calls: _PointInBox, _GetPixel, _DrawPixel				  ;
 10802                                  ;									  ;
 10803                                  ;   Returns: none							  ;
 10804                                  ;									  ;
 10805                                  ;   Purpose: Performs a flood fill operation on a region in the buffer	  ;
 10806                                  ;	     pointed to by DestOff					  ;
 10807                                  ;									  ;
 10808                                  ;-------------------------------------------------------------------------;
 10809                                  proc _FloodFill
 10810                              <1> %push proc
 10811                              <1>           global %1
 10812 00000CBE 55                  <1> %1:       push  ebp
 10813 00000CBF 89E5                <1>           mov   ebp, esp
 10814                              <1> %assign %$arg 8
 10815                              <1> 
 10816                              <1> %define %$procname %1
 10817                                  .DestOff	arg	4
 10818                              <1> .DestOff       equ %$arg
 10819                              <1> 
 10820                              <1> 
 10821                              <1> %assign %$arg %1+%$arg
 10822                                  .DestWidth	arg	2
 10823                              <1> .DestWidth       equ %$arg
 10824                              <1> 
 10825                              <1> 
 10826                              <1> %assign %$arg %1+%$arg
 10827                                  .DestHeight	arg	2
 10828                              <1> .DestHeight       equ %$arg
 10829                              <1> 
 10830                              <1> 
 10831                              <1> %assign %$arg %1+%$arg
 10832                                  .X		arg	2
 10833                              <1> .X       equ %$arg
 10834                              <1> 
 10835                              <1> 
 10836                              <1> %assign %$arg %1+%$arg
 10837                                  .Y		arg	2
 10838                              <1> .Y       equ %$arg
 10839                              <1> 
 10840                              <1> 
 10841                              <1> %assign %$arg %1+%$arg
 10842                                  .Color		arg	4
 10843                              <1> .Color       equ %$arg
 10844                              <1> 
 10845                              <1> 
 10846                              <1> %assign %$arg %1+%$arg
 10847                                  .ComposeFlag	arg	4
 10848                              <1> .ComposeFlag       equ %$arg
 10849                              <1> 
 10850                              <1> 
 10851                              <1> %assign %$arg %1+%$arg
 10852                                  
 10853                                  ;invoke	_libFloodFill, dword [ebp+.DestOff], word [ebp+.DestWidth], word [ebp+.DestHeight], word [ebp+.X], word [ebp+.Y], dword [ebp+.Color], dword [ebp+.ComposeFlag]
 10854                                  ;ret
 10855                                  
 10856                                  
 10857                                  
 10858 00000CC1 60                       pushad
 10859                                  
 10860                                  
 10861 00000CC2 A1[46000000]             mov eax, dword[_PointQueue]
 10862 00000CC7 A3[4A000000]             mov dword [_QueueHead], eax			; Initialize _QueueHead to front of Queue
 10863 00000CCC A3[4E000000]             mov dword [_QueueTail], eax			; Initialize _QueueTail to front of Queue
 10864                                  
 10865                                  
 10866                                  
 10867                                  
 10868                                  
 10869                                  
 10870 00000CD1 66FF4D0E                 dec word [ebp + .DestHeight]			; Temporarily change DestWidth, DestHeight for PointInBox
 10871 00000CD5 66FF4D0C                 dec word [ebp + .DestWidth]
 10872                                   invoke _PointInBox, word [ebp + .X], word [ebp + .Y], word 0, word 0, word [ebp + .DestWidth], word [ebp + .DestHeight]
 10873                              <1> %rotate -1
 10874                              <1> 
 10875                              <1> %rep (%0-1)
 10876                              <1> 
 10877                              <1> 
 10878                              <1> 
 10879                              <1> 
 10880                              <1> 
 10881                              <1> 
 10882                              <1> 
 10883                              <1>         %ifidni %1, cs
 10884                              <1>                 o16 push %1
 10885                              <1>         %elifidni %1, ds
 10886                              <1>                 o16 push %1
 10887                              <1>         %elifidni %1, es
 10888                              <1>                 o16 push %1
 10889                              <1>         %elifidni %1, fs
 10890                              <1>                 o16 push %1
 10891                              <1>         %elifidni %1, gs
 10892                              <1>                 o16 push %1
 10893                              <1>         %elifidni %1, word cs
 10894                              <1>                 o16 push %1
 10895                              <1>         %elifidni %1, word ds
 10896                              <1>                 o16 push %1
 10897                              <1>         %elifidni %1, word es
 10898                              <1>                 o16 push %1
 10899                              <1>         %elifidni %1, word fs
 10900                              <1>                 o16 push %1
 10901                              <1>         %elifidni %1, word gs
 10902                              <1>                 o16 push %1
 10903                              <1>         %else
 10904                              <1>                 push %1
 10905                              <1>         %endif
 10906                              <1> 
 10907                              <1>         %rotate -1
 10908                              <1> %endrep
 10909                              <2> 
 10910                              <2> 
 10911                              <2> 
 10912                              <2> 
 10913                              <2> 
 10914                              <2> 
 10915                              <2> 
 10916                              <2>         %ifidni %1, cs
 10917                              <2>                 o16 push %1
 10918                              <2>         %elifidni %1, ds
 10919                              <2>                 o16 push %1
 10920                              <2>         %elifidni %1, es
 10921                              <2>                 o16 push %1
 10922                              <2>         %elifidni %1, fs
 10923                              <2>                 o16 push %1
 10924                              <2>         %elifidni %1, gs
 10925                              <2>                 o16 push %1
 10926                              <2>         %elifidni %1, word cs
 10927                              <2>                 o16 push %1
 10928                              <2>         %elifidni %1, word ds
 10929                              <2>                 o16 push %1
 10930                              <2>         %elifidni %1, word es
 10931                              <2>                 o16 push %1
 10932                              <2>         %elifidni %1, word fs
 10933                              <2>                 o16 push %1
 10934                              <2>         %elifidni %1, word gs
 10935                              <2>                 o16 push %1
 10936                              <2>         %else
 10937 00000CD9 66FF750E            <2>                 push %1
 10938                              <2>         %endif
 10939                              <2> 
 10940                              <2>         %rotate -1
 10941                              <2> 
 10942                              <2> 
 10943                              <2> 
 10944                              <2> 
 10945                              <2> 
 10946                              <2> 
 10947                              <2> 
 10948                              <2>         %ifidni %1, cs
 10949                              <2>                 o16 push %1
 10950                              <2>         %elifidni %1, ds
 10951                              <2>                 o16 push %1
 10952                              <2>         %elifidni %1, es
 10953                              <2>                 o16 push %1
 10954                              <2>         %elifidni %1, fs
 10955                              <2>                 o16 push %1
 10956                              <2>         %elifidni %1, gs
 10957                              <2>                 o16 push %1
 10958                              <2>         %elifidni %1, word cs
 10959                              <2>                 o16 push %1
 10960                              <2>         %elifidni %1, word ds
 10961                              <2>                 o16 push %1
 10962                              <2>         %elifidni %1, word es
 10963                              <2>                 o16 push %1
 10964                              <2>         %elifidni %1, word fs
 10965                              <2>                 o16 push %1
 10966                              <2>         %elifidni %1, word gs
 10967                              <2>                 o16 push %1
 10968                              <2>         %else
 10969 00000CDD 66FF750C            <2>                 push %1
 10970                              <2>         %endif
 10971                              <2> 
 10972                              <2>         %rotate -1
 10973                              <2> 
 10974                              <2> 
 10975                              <2> 
 10976                              <2> 
 10977                              <2> 
 10978                              <2> 
 10979                              <2> 
 10980                              <2>         %ifidni %1, cs
 10981                              <2>                 o16 push %1
 10982                              <2>         %elifidni %1, ds
 10983                              <2>                 o16 push %1
 10984                              <2>         %elifidni %1, es
 10985                              <2>                 o16 push %1
 10986                              <2>         %elifidni %1, fs
 10987                              <2>                 o16 push %1
 10988                              <2>         %elifidni %1, gs
 10989                              <2>                 o16 push %1
 10990                              <2>         %elifidni %1, word cs
 10991                              <2>                 o16 push %1
 10992                              <2>         %elifidni %1, word ds
 10993                              <2>                 o16 push %1
 10994                              <2>         %elifidni %1, word es
 10995                              <2>                 o16 push %1
 10996                              <2>         %elifidni %1, word fs
 10997                              <2>                 o16 push %1
 10998                              <2>         %elifidni %1, word gs
 10999                              <2>                 o16 push %1
 11000                              <2>         %else
 11001 00000CE1 66680000            <2>                 push %1
 11002                              <2>         %endif
 11003                              <2> 
 11004                              <2>         %rotate -1
 11005                              <2> 
 11006                              <2> 
 11007                              <2> 
 11008                              <2> 
 11009                              <2> 
 11010                              <2> 
 11011                              <2> 
 11012                              <2>         %ifidni %1, cs
 11013                              <2>                 o16 push %1
 11014                              <2>         %elifidni %1, ds
 11015                              <2>                 o16 push %1
 11016                              <2>         %elifidni %1, es
 11017                              <2>                 o16 push %1
 11018                              <2>         %elifidni %1, fs
 11019                              <2>                 o16 push %1
 11020                              <2>         %elifidni %1, gs
 11021                              <2>                 o16 push %1
 11022                              <2>         %elifidni %1, word cs
 11023                              <2>                 o16 push %1
 11024                              <2>         %elifidni %1, word ds
 11025                              <2>                 o16 push %1
 11026                              <2>         %elifidni %1, word es
 11027                              <2>                 o16 push %1
 11028                              <2>         %elifidni %1, word fs
 11029                              <2>                 o16 push %1
 11030                              <2>         %elifidni %1, word gs
 11031                              <2>                 o16 push %1
 11032                              <2>         %else
 11033 00000CE5 66680000            <2>                 push %1
 11034                              <2>         %endif
 11035                              <2> 
 11036                              <2>         %rotate -1
 11037                              <2> 
 11038                              <2> 
 11039                              <2> 
 11040                              <2> 
 11041                              <2> 
 11042                              <2> 
 11043                              <2> 
 11044                              <2>         %ifidni %1, cs
 11045                              <2>                 o16 push %1
 11046                              <2>         %elifidni %1, ds
 11047                              <2>                 o16 push %1
 11048                              <2>         %elifidni %1, es
 11049                              <2>                 o16 push %1
 11050                              <2>         %elifidni %1, fs
 11051                              <2>                 o16 push %1
 11052                              <2>         %elifidni %1, gs
 11053                              <2>                 o16 push %1
 11054                              <2>         %elifidni %1, word cs
 11055                              <2>                 o16 push %1
 11056                              <2>         %elifidni %1, word ds
 11057                              <2>                 o16 push %1
 11058                              <2>         %elifidni %1, word es
 11059                              <2>                 o16 push %1
 11060                              <2>         %elifidni %1, word fs
 11061                              <2>                 o16 push %1
 11062                              <2>         %elifidni %1, word gs
 11063                              <2>                 o16 push %1
 11064                              <2>         %else
 11065 00000CE9 66FF7512            <2>                 push %1
 11066                              <2>         %endif
 11067                              <2> 
 11068                              <2>         %rotate -1
 11069                              <2> 
 11070                              <2> 
 11071                              <2> 
 11072                              <2> 
 11073                              <2> 
 11074                              <2> 
 11075                              <2> 
 11076                              <2>         %ifidni %1, cs
 11077                              <2>                 o16 push %1
 11078                              <2>         %elifidni %1, ds
 11079                              <2>                 o16 push %1
 11080                              <2>         %elifidni %1, es
 11081                              <2>                 o16 push %1
 11082                              <2>         %elifidni %1, fs
 11083                              <2>                 o16 push %1
 11084                              <2>         %elifidni %1, gs
 11085                              <2>                 o16 push %1
 11086                              <2>         %elifidni %1, word cs
 11087                              <2>                 o16 push %1
 11088                              <2>         %elifidni %1, word ds
 11089                              <2>                 o16 push %1
 11090                              <2>         %elifidni %1, word es
 11091                              <2>                 o16 push %1
 11092                              <2>         %elifidni %1, word fs
 11093                              <2>                 o16 push %1
 11094                              <2>         %elifidni %1, word gs
 11095                              <2>                 o16 push %1
 11096                              <2>         %else
 11097 00000CED 66FF7510            <2>                 push %1
 11098                              <2>         %endif
 11099                              <2> 
 11100                              <2>         %rotate -1
 11101 00000CF1 E8CFF4FFFF          <1> call %1
 11102                              <1> %if (%0!=1)
 11103 00000CF6 83C40C              <1>         add esp, byte %1_arglen
 11104                              <1> %endif
 11105 00000CF9 66FF450C                 inc word [ebp + .DestWidth]
 11106 00000CFD 66FF450E                 inc word [ebp + .DestHeight]
 11107                                  
 11108                                  
 11109                                  
 11110 00000D01 6685C0                   test ax, ax
 11111 00000D04 0F8470020000             jz near .End
 11112                                  
 11113                                  
 11114                                  
 11115 00000D0A 8B1D[4E000000]           mov ebx, dword [_QueueTail]		; Enqueue(x,y)
 11116 00000D10 668B5510                 mov dx, word [ebp + .X]		; Place (x,y) at location of [_QueueTail],
 11117 00000D14 668913                   mov word [ebx], dx			; then add 4 to [_QueueTail]
 11118 00000D17 668B5512                 mov dx, word[ebp + .Y]
 11119 00000D1B 66895302                 mov word [ebx + 2], dx
 11120 00000D1F 8105[4E000000]0400-      add dword [_QueueTail], 4
 11121 00000D27 0000               
 11122                                  
 11123                                  
 11124                                  
 11125                                  
 11126                                   invoke _GetPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], word [ebp + .X], word [ebp + .Y]
 11127                              <1> %rotate -1
 11128                              <1> 
 11129                              <1> %rep (%0-1)
 11130                              <1> 
 11131                              <1> 
 11132                              <1> 
 11133                              <1> 
 11134                              <1> 
 11135                              <1> 
 11136                              <1> 
 11137                              <1>         %ifidni %1, cs
 11138                              <1>                 o16 push %1
 11139                              <1>         %elifidni %1, ds
 11140                              <1>                 o16 push %1
 11141                              <1>         %elifidni %1, es
 11142                              <1>                 o16 push %1
 11143                              <1>         %elifidni %1, fs
 11144                              <1>                 o16 push %1
 11145                              <1>         %elifidni %1, gs
 11146                              <1>                 o16 push %1
 11147                              <1>         %elifidni %1, word cs
 11148                              <1>                 o16 push %1
 11149                              <1>         %elifidni %1, word ds
 11150                              <1>                 o16 push %1
 11151                              <1>         %elifidni %1, word es
 11152                              <1>                 o16 push %1
 11153                              <1>         %elifidni %1, word fs
 11154                              <1>                 o16 push %1
 11155                              <1>         %elifidni %1, word gs
 11156                              <1>                 o16 push %1
 11157                              <1>         %else
 11158                              <1>                 push %1
 11159                              <1>         %endif
 11160                              <1> 
 11161                              <1>         %rotate -1
 11162                              <1> %endrep
 11163                              <2> 
 11164                              <2> 
 11165                              <2> 
 11166                              <2> 
 11167                              <2> 
 11168                              <2> 
 11169                              <2> 
 11170                              <2>         %ifidni %1, cs
 11171                              <2>                 o16 push %1
 11172                              <2>         %elifidni %1, ds
 11173                              <2>                 o16 push %1
 11174                              <2>         %elifidni %1, es
 11175                              <2>                 o16 push %1
 11176                              <2>         %elifidni %1, fs
 11177                              <2>                 o16 push %1
 11178                              <2>         %elifidni %1, gs
 11179                              <2>                 o16 push %1
 11180                              <2>         %elifidni %1, word cs
 11181                              <2>                 o16 push %1
 11182                              <2>         %elifidni %1, word ds
 11183                              <2>                 o16 push %1
 11184                              <2>         %elifidni %1, word es
 11185                              <2>                 o16 push %1
 11186                              <2>         %elifidni %1, word fs
 11187                              <2>                 o16 push %1
 11188                              <2>         %elifidni %1, word gs
 11189                              <2>                 o16 push %1
 11190                              <2>         %else
 11191 00000D29 66FF7512            <2>                 push %1
 11192                              <2>         %endif
 11193                              <2> 
 11194                              <2>         %rotate -1
 11195                              <2> 
 11196                              <2> 
 11197                              <2> 
 11198                              <2> 
 11199                              <2> 
 11200                              <2> 
 11201                              <2> 
 11202                              <2>         %ifidni %1, cs
 11203                              <2>                 o16 push %1
 11204                              <2>         %elifidni %1, ds
 11205                              <2>                 o16 push %1
 11206                              <2>         %elifidni %1, es
 11207                              <2>                 o16 push %1
 11208                              <2>         %elifidni %1, fs
 11209                              <2>                 o16 push %1
 11210                              <2>         %elifidni %1, gs
 11211                              <2>                 o16 push %1
 11212                              <2>         %elifidni %1, word cs
 11213                              <2>                 o16 push %1
 11214                              <2>         %elifidni %1, word ds
 11215                              <2>                 o16 push %1
 11216                              <2>         %elifidni %1, word es
 11217                              <2>                 o16 push %1
 11218                              <2>         %elifidni %1, word fs
 11219                              <2>                 o16 push %1
 11220                              <2>         %elifidni %1, word gs
 11221                              <2>                 o16 push %1
 11222                              <2>         %else
 11223 00000D2D 66FF7510            <2>                 push %1
 11224                              <2>         %endif
 11225                              <2> 
 11226                              <2>         %rotate -1
 11227                              <2> 
 11228                              <2> 
 11229                              <2> 
 11230                              <2> 
 11231                              <2> 
 11232                              <2> 
 11233                              <2> 
 11234                              <2>         %ifidni %1, cs
 11235                              <2>                 o16 push %1
 11236                              <2>         %elifidni %1, ds
 11237                              <2>                 o16 push %1
 11238                              <2>         %elifidni %1, es
 11239                              <2>                 o16 push %1
 11240                              <2>         %elifidni %1, fs
 11241                              <2>                 o16 push %1
 11242                              <2>         %elifidni %1, gs
 11243                              <2>                 o16 push %1
 11244                              <2>         %elifidni %1, word cs
 11245                              <2>                 o16 push %1
 11246                              <2>         %elifidni %1, word ds
 11247                              <2>                 o16 push %1
 11248                              <2>         %elifidni %1, word es
 11249                              <2>                 o16 push %1
 11250                              <2>         %elifidni %1, word fs
 11251                              <2>                 o16 push %1
 11252                              <2>         %elifidni %1, word gs
 11253                              <2>                 o16 push %1
 11254                              <2>         %else
 11255 00000D31 66FF750E            <2>                 push %1
 11256                              <2>         %endif
 11257                              <2> 
 11258                              <2>         %rotate -1
 11259                              <2> 
 11260                              <2> 
 11261                              <2> 
 11262                              <2> 
 11263                              <2> 
 11264                              <2> 
 11265                              <2> 
 11266                              <2>         %ifidni %1, cs
 11267                              <2>                 o16 push %1
 11268                              <2>         %elifidni %1, ds
 11269                              <2>                 o16 push %1
 11270                              <2>         %elifidni %1, es
 11271                              <2>                 o16 push %1
 11272                              <2>         %elifidni %1, fs
 11273                              <2>                 o16 push %1
 11274                              <2>         %elifidni %1, gs
 11275                              <2>                 o16 push %1
 11276                              <2>         %elifidni %1, word cs
 11277                              <2>                 o16 push %1
 11278                              <2>         %elifidni %1, word ds
 11279                              <2>                 o16 push %1
 11280                              <2>         %elifidni %1, word es
 11281                              <2>                 o16 push %1
 11282                              <2>         %elifidni %1, word fs
 11283                              <2>                 o16 push %1
 11284                              <2>         %elifidni %1, word gs
 11285                              <2>                 o16 push %1
 11286                              <2>         %else
 11287 00000D35 66FF750C            <2>                 push %1
 11288                              <2>         %endif
 11289                              <2> 
 11290                              <2>         %rotate -1
 11291                              <2> 
 11292                              <2> 
 11293                              <2> 
 11294                              <2> 
 11295                              <2> 
 11296                              <2> 
 11297                              <2> 
 11298                              <2>         %ifidni %1, cs
 11299                              <2>                 o16 push %1
 11300                              <2>         %elifidni %1, ds
 11301                              <2>                 o16 push %1
 11302                              <2>         %elifidni %1, es
 11303                              <2>                 o16 push %1
 11304                              <2>         %elifidni %1, fs
 11305                              <2>                 o16 push %1
 11306                              <2>         %elifidni %1, gs
 11307                              <2>                 o16 push %1
 11308                              <2>         %elifidni %1, word cs
 11309                              <2>                 o16 push %1
 11310                              <2>         %elifidni %1, word ds
 11311                              <2>                 o16 push %1
 11312                              <2>         %elifidni %1, word es
 11313                              <2>                 o16 push %1
 11314                              <2>         %elifidni %1, word fs
 11315                              <2>                 o16 push %1
 11316                              <2>         %elifidni %1, word gs
 11317                              <2>                 o16 push %1
 11318                              <2>         %else
 11319 00000D39 FF7508              <2>                 push %1
 11320                              <2>         %endif
 11321                              <2> 
 11322                              <2>         %rotate -1
 11323 00000D3C E8C6F4FFFF          <1> call %1
 11324                              <1> %if (%0!=1)
 11325 00000D41 83C40C              <1>         add esp, byte %1_arglen
 11326                              <1> %endif
 11327 00000D44 89C2                     mov edx, eax				; edx = OldColor
 11328                                  
 11329 00000D46 817D1800000000           cmp dword [ebp + .ComposeFlag], 0	; If ComposeFlag is set, update the value of the new color
 11330 00000D4D 0F8446000000             je near .PixelLoop			; by alpha composing onto the current color
 11331                                  
 11332                                  
 11333                                  
 11334                                  
 11335                                  
 11336                                   ;--------- Begin Alpha Compose the Two Colors ---------;
 11337                                  
 11338 00000D53 0F6E4514                 movd mm0, dword [ebp + .Color]
 11339 00000D57 0F6ECA                   movd mm1, edx
 11340                                  
 11341 00000D5A 0FEFDB                   pxor mm3, mm3
 11342                                  
 11343 00000D5D 0F60C3                   punpcklbw mm0, mm3			; Unpack (bytes to words) the source pixel into an MMX register
 11344 00000D60 0F6FD0                   movq mm2, mm0				; Copy out the source alpha byte into the four words of another MMX register
 11345 00000D63 0F69D2                   punpckhwd mm2, mm2			; mm2 = [0A][0A][0R][0R] 
 11346 00000D66 0F6AD2                   punpckhdq mm2, mm2			; mm2 = [0A][0A][0A][0A]
 11347 00000D69 0FD5C2                   pmullw mm0, mm2			; Multiply the two previously mentioned MMX registers together
 11348                                  	
 11349 00000D6C 0FFD05[09020000]         paddw mm0, qword [_RoundingFactor]	; Add the rounding factor to the previous result to round the upcoming division
 11350 00000D73 0F71D008                 psrlw mm0, 8				; Shift each word right to divide by 256, thus fitting into a byte per channel (this calculates a * A)
 11351                                  	
 11352 00000D77 0F60CB                   punpcklbw mm1, mm3			; Unpack (bytes to words) the destination pixel into an MMX register
 11353 00000D7A 0FFDC1                   paddw mm0, mm1				; Add the results of the previous two steps (this calculates a * A + B)
 11354 00000D7D 0FD5CA                   pmullw mm1, mm2			; Multiply the destination pixel by the source alpha
 11355 00000D80 0FFD0D[09020000]         paddw mm1, qword [_RoundingFactor]	; Add the rounding factor to the previous result to round the upcoming division
 11356 00000D87 0F71D108                 psrlw mm1, 8				; Shift each word right to divide by 256, thus fitting into a byte per channel (this calculates a * B)
 11357 00000D8B 0FF9C1                   psubw mm0, mm1				; Subtract the value of step 10 from the value of step 7, giving you (a * A) + B - (a * B)
 11358                                  
 11359 00000D8E 0F67C3                   packuswb mm0, mm3			; Pack (words to bytes) the two alpha-composed pixels back together with proper saturation in the correct order
 11360 00000D91 0F7EC0                   movd eax, mm0
 11361 00000D94 0F77                     emms
 11362 00000D96 894514                   mov dword [ebp + .Color], eax		; Write the composed pixels back to memory
 11363                                  
 11364                                   ;--------- End Alpha Compose the Two Colors  ---------;
 11365                                  
 11366                                  
 11367                                  
 11368                                  
 11369                                  
 11370                                  
 11371                                   ;----------
 11372                                   .PixelLoop:				; while (QueueHead < QueueTail)
 11373                                   ;----------
 11374 00000D99 8B0D[4A000000]              mov ecx, [_QueueHead]
 11375 00000D9F 3B0D[4E000000]              cmp ecx, [_QueueTail]
 11376 00000DA5 0F83CF010000                jnb near .End
 11377                                  	
 11378 00000DAB 8B1D[4A000000]              mov ebx, dword [_QueueHead]		; Point = Dequeue()
 11379 00000DB1 668B33                      mov si, word [ebx]			; si = Point.X
 11380 00000DB4 668B7B02                    mov di, word [ebx + 2]		; di = Point.Y
 11381 00000DB8 8105[4A000000]0400-         add dword [_QueueHead], 4		; To dequeue, read point at [_QueueHead], then add 4 to [_QueueHead]
 11382 00000DC0 0000               
 11383                                  
 11384 00000DC2 66FF4D0C                    dec word [ebp + .DestWidth]
 11385 00000DC6 66FF4D0E                    dec word [ebp + .DestHeight]
 11386                                      invoke _PointInBox, si, di, word 0, word 0, word [ebp + .DestWidth], word[ebp + .DestHeight]
 11387                              <1> %rotate -1
 11388                              <1> 
 11389                              <1> %rep (%0-1)
 11390                              <1> 
 11391                              <1> 
 11392                              <1> 
 11393                              <1> 
 11394                              <1> 
 11395                              <1> 
 11396                              <1> 
 11397                              <1>         %ifidni %1, cs
 11398                              <1>                 o16 push %1
 11399                              <1>         %elifidni %1, ds
 11400                              <1>                 o16 push %1
 11401                              <1>         %elifidni %1, es
 11402                              <1>                 o16 push %1
 11403                              <1>         %elifidni %1, fs
 11404                              <1>                 o16 push %1
 11405                              <1>         %elifidni %1, gs
 11406                              <1>                 o16 push %1
 11407                              <1>         %elifidni %1, word cs
 11408                              <1>                 o16 push %1
 11409                              <1>         %elifidni %1, word ds
 11410                              <1>                 o16 push %1
 11411                              <1>         %elifidni %1, word es
 11412                              <1>                 o16 push %1
 11413                              <1>         %elifidni %1, word fs
 11414                              <1>                 o16 push %1
 11415                              <1>         %elifidni %1, word gs
 11416                              <1>                 o16 push %1
 11417                              <1>         %else
 11418                              <1>                 push %1
 11419                              <1>         %endif
 11420                              <1> 
 11421                              <1>         %rotate -1
 11422                              <1> %endrep
 11423                              <2> 
 11424                              <2> 
 11425                              <2> 
 11426                              <2> 
 11427                              <2> 
 11428                              <2> 
 11429                              <2> 
 11430                              <2>         %ifidni %1, cs
 11431                              <2>                 o16 push %1
 11432                              <2>         %elifidni %1, ds
 11433                              <2>                 o16 push %1
 11434                              <2>         %elifidni %1, es
 11435                              <2>                 o16 push %1
 11436                              <2>         %elifidni %1, fs
 11437                              <2>                 o16 push %1
 11438                              <2>         %elifidni %1, gs
 11439                              <2>                 o16 push %1
 11440                              <2>         %elifidni %1, word cs
 11441                              <2>                 o16 push %1
 11442                              <2>         %elifidni %1, word ds
 11443                              <2>                 o16 push %1
 11444                              <2>         %elifidni %1, word es
 11445                              <2>                 o16 push %1
 11446                              <2>         %elifidni %1, word fs
 11447                              <2>                 o16 push %1
 11448                              <2>         %elifidni %1, word gs
 11449                              <2>                 o16 push %1
 11450                              <2>         %else
 11451 00000DCA 66FF750E            <2>                 push %1
 11452                              <2>         %endif
 11453                              <2> 
 11454                              <2>         %rotate -1
 11455                              <2> 
 11456                              <2> 
 11457                              <2> 
 11458                              <2> 
 11459                              <2> 
 11460                              <2> 
 11461                              <2> 
 11462                              <2>         %ifidni %1, cs
 11463                              <2>                 o16 push %1
 11464                              <2>         %elifidni %1, ds
 11465                              <2>                 o16 push %1
 11466                              <2>         %elifidni %1, es
 11467                              <2>                 o16 push %1
 11468                              <2>         %elifidni %1, fs
 11469                              <2>                 o16 push %1
 11470                              <2>         %elifidni %1, gs
 11471                              <2>                 o16 push %1
 11472                              <2>         %elifidni %1, word cs
 11473                              <2>                 o16 push %1
 11474                              <2>         %elifidni %1, word ds
 11475                              <2>                 o16 push %1
 11476                              <2>         %elifidni %1, word es
 11477                              <2>                 o16 push %1
 11478                              <2>         %elifidni %1, word fs
 11479                              <2>                 o16 push %1
 11480                              <2>         %elifidni %1, word gs
 11481                              <2>                 o16 push %1
 11482                              <2>         %else
 11483 00000DCE 66FF750C            <2>                 push %1
 11484                              <2>         %endif
 11485                              <2> 
 11486                              <2>         %rotate -1
 11487                              <2> 
 11488                              <2> 
 11489                              <2> 
 11490                              <2> 
 11491                              <2> 
 11492                              <2> 
 11493                              <2> 
 11494                              <2>         %ifidni %1, cs
 11495                              <2>                 o16 push %1
 11496                              <2>         %elifidni %1, ds
 11497                              <2>                 o16 push %1
 11498                              <2>         %elifidni %1, es
 11499                              <2>                 o16 push %1
 11500                              <2>         %elifidni %1, fs
 11501                              <2>                 o16 push %1
 11502                              <2>         %elifidni %1, gs
 11503                              <2>                 o16 push %1
 11504                              <2>         %elifidni %1, word cs
 11505                              <2>                 o16 push %1
 11506                              <2>         %elifidni %1, word ds
 11507                              <2>                 o16 push %1
 11508                              <2>         %elifidni %1, word es
 11509                              <2>                 o16 push %1
 11510                              <2>         %elifidni %1, word fs
 11511                              <2>                 o16 push %1
 11512                              <2>         %elifidni %1, word gs
 11513                              <2>                 o16 push %1
 11514                              <2>         %else
 11515 00000DD2 66680000            <2>                 push %1
 11516                              <2>         %endif
 11517                              <2> 
 11518                              <2>         %rotate -1
 11519                              <2> 
 11520                              <2> 
 11521                              <2> 
 11522                              <2> 
 11523                              <2> 
 11524                              <2> 
 11525                              <2> 
 11526                              <2>         %ifidni %1, cs
 11527                              <2>                 o16 push %1
 11528                              <2>         %elifidni %1, ds
 11529                              <2>                 o16 push %1
 11530                              <2>         %elifidni %1, es
 11531                              <2>                 o16 push %1
 11532                              <2>         %elifidni %1, fs
 11533                              <2>                 o16 push %1
 11534                              <2>         %elifidni %1, gs
 11535                              <2>                 o16 push %1
 11536                              <2>         %elifidni %1, word cs
 11537                              <2>                 o16 push %1
 11538                              <2>         %elifidni %1, word ds
 11539                              <2>                 o16 push %1
 11540                              <2>         %elifidni %1, word es
 11541                              <2>                 o16 push %1
 11542                              <2>         %elifidni %1, word fs
 11543                              <2>                 o16 push %1
 11544                              <2>         %elifidni %1, word gs
 11545                              <2>                 o16 push %1
 11546                              <2>         %else
 11547 00000DD6 66680000            <2>                 push %1
 11548                              <2>         %endif
 11549                              <2> 
 11550                              <2>         %rotate -1
 11551                              <2> 
 11552                              <2> 
 11553                              <2> 
 11554                              <2> 
 11555                              <2> 
 11556                              <2> 
 11557                              <2> 
 11558                              <2>         %ifidni %1, cs
 11559                              <2>                 o16 push %1
 11560                              <2>         %elifidni %1, ds
 11561                              <2>                 o16 push %1
 11562                              <2>         %elifidni %1, es
 11563                              <2>                 o16 push %1
 11564                              <2>         %elifidni %1, fs
 11565                              <2>                 o16 push %1
 11566                              <2>         %elifidni %1, gs
 11567                              <2>                 o16 push %1
 11568                              <2>         %elifidni %1, word cs
 11569                              <2>                 o16 push %1
 11570                              <2>         %elifidni %1, word ds
 11571                              <2>                 o16 push %1
 11572                              <2>         %elifidni %1, word es
 11573                              <2>                 o16 push %1
 11574                              <2>         %elifidni %1, word fs
 11575                              <2>                 o16 push %1
 11576                              <2>         %elifidni %1, word gs
 11577                              <2>                 o16 push %1
 11578                              <2>         %else
 11579 00000DDA 6657                <2>                 push %1
 11580                              <2>         %endif
 11581                              <2> 
 11582                              <2>         %rotate -1
 11583                              <2> 
 11584                              <2> 
 11585                              <2> 
 11586                              <2> 
 11587                              <2> 
 11588                              <2> 
 11589                              <2> 
 11590                              <2>         %ifidni %1, cs
 11591                              <2>                 o16 push %1
 11592                              <2>         %elifidni %1, ds
 11593                              <2>                 o16 push %1
 11594                              <2>         %elifidni %1, es
 11595                              <2>                 o16 push %1
 11596                              <2>         %elifidni %1, fs
 11597                              <2>                 o16 push %1
 11598                              <2>         %elifidni %1, gs
 11599                              <2>                 o16 push %1
 11600                              <2>         %elifidni %1, word cs
 11601                              <2>                 o16 push %1
 11602                              <2>         %elifidni %1, word ds
 11603                              <2>                 o16 push %1
 11604                              <2>         %elifidni %1, word es
 11605                              <2>                 o16 push %1
 11606                              <2>         %elifidni %1, word fs
 11607                              <2>                 o16 push %1
 11608                              <2>         %elifidni %1, word gs
 11609                              <2>                 o16 push %1
 11610                              <2>         %else
 11611 00000DDC 6656                <2>                 push %1
 11612                              <2>         %endif
 11613                              <2> 
 11614                              <2>         %rotate -1
 11615 00000DDE E8E2F3FFFF          <1> call %1
 11616                              <1> %if (%0!=1)
 11617 00000DE3 83C40C              <1>         add esp, byte %1_arglen
 11618                              <1> %endif
 11619 00000DE6 66FF450C                    inc word [ebp + .DestWidth]
 11620 00000DEA 66FF450E                    inc word [ebp + .DestHeight]
 11621                                  
 11622 00000DEE 85C0                        test eax, eax			; Check if invalid point
 11623 00000DF0 0F84A3FFFFFF                jz near .PixelLoop
 11624                                  
 11625                                  
 11626                                  
 11627                                  
 11628                                      invoke _GetPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], si, di
 11629                              <1> %rotate -1
 11630                              <1> 
 11631                              <1> %rep (%0-1)
 11632                              <1> 
 11633                              <1> 
 11634                              <1> 
 11635                              <1> 
 11636                              <1> 
 11637                              <1> 
 11638                              <1> 
 11639                              <1>         %ifidni %1, cs
 11640                              <1>                 o16 push %1
 11641                              <1>         %elifidni %1, ds
 11642                              <1>                 o16 push %1
 11643                              <1>         %elifidni %1, es
 11644                              <1>                 o16 push %1
 11645                              <1>         %elifidni %1, fs
 11646                              <1>                 o16 push %1
 11647                              <1>         %elifidni %1, gs
 11648                              <1>                 o16 push %1
 11649                              <1>         %elifidni %1, word cs
 11650                              <1>                 o16 push %1
 11651                              <1>         %elifidni %1, word ds
 11652                              <1>                 o16 push %1
 11653                              <1>         %elifidni %1, word es
 11654                              <1>                 o16 push %1
 11655                              <1>         %elifidni %1, word fs
 11656                              <1>                 o16 push %1
 11657                              <1>         %elifidni %1, word gs
 11658                              <1>                 o16 push %1
 11659                              <1>         %else
 11660                              <1>                 push %1
 11661                              <1>         %endif
 11662                              <1> 
 11663                              <1>         %rotate -1
 11664                              <1> %endrep
 11665                              <2> 
 11666                              <2> 
 11667                              <2> 
 11668                              <2> 
 11669                              <2> 
 11670                              <2> 
 11671                              <2> 
 11672                              <2>         %ifidni %1, cs
 11673                              <2>                 o16 push %1
 11674                              <2>         %elifidni %1, ds
 11675                              <2>                 o16 push %1
 11676                              <2>         %elifidni %1, es
 11677                              <2>                 o16 push %1
 11678                              <2>         %elifidni %1, fs
 11679                              <2>                 o16 push %1
 11680                              <2>         %elifidni %1, gs
 11681                              <2>                 o16 push %1
 11682                              <2>         %elifidni %1, word cs
 11683                              <2>                 o16 push %1
 11684                              <2>         %elifidni %1, word ds
 11685                              <2>                 o16 push %1
 11686                              <2>         %elifidni %1, word es
 11687                              <2>                 o16 push %1
 11688                              <2>         %elifidni %1, word fs
 11689                              <2>                 o16 push %1
 11690                              <2>         %elifidni %1, word gs
 11691                              <2>                 o16 push %1
 11692                              <2>         %else
 11693 00000DF6 6657                <2>                 push %1
 11694                              <2>         %endif
 11695                              <2> 
 11696                              <2>         %rotate -1
 11697                              <2> 
 11698                              <2> 
 11699                              <2> 
 11700                              <2> 
 11701                              <2> 
 11702                              <2> 
 11703                              <2> 
 11704                              <2>         %ifidni %1, cs
 11705                              <2>                 o16 push %1
 11706                              <2>         %elifidni %1, ds
 11707                              <2>                 o16 push %1
 11708                              <2>         %elifidni %1, es
 11709                              <2>                 o16 push %1
 11710                              <2>         %elifidni %1, fs
 11711                              <2>                 o16 push %1
 11712                              <2>         %elifidni %1, gs
 11713                              <2>                 o16 push %1
 11714                              <2>         %elifidni %1, word cs
 11715                              <2>                 o16 push %1
 11716                              <2>         %elifidni %1, word ds
 11717                              <2>                 o16 push %1
 11718                              <2>         %elifidni %1, word es
 11719                              <2>                 o16 push %1
 11720                              <2>         %elifidni %1, word fs
 11721                              <2>                 o16 push %1
 11722                              <2>         %elifidni %1, word gs
 11723                              <2>                 o16 push %1
 11724                              <2>         %else
 11725 00000DF8 6656                <2>                 push %1
 11726                              <2>         %endif
 11727                              <2> 
 11728                              <2>         %rotate -1
 11729                              <2> 
 11730                              <2> 
 11731                              <2> 
 11732                              <2> 
 11733                              <2> 
 11734                              <2> 
 11735                              <2> 
 11736                              <2>         %ifidni %1, cs
 11737                              <2>                 o16 push %1
 11738                              <2>         %elifidni %1, ds
 11739                              <2>                 o16 push %1
 11740                              <2>         %elifidni %1, es
 11741                              <2>                 o16 push %1
 11742                              <2>         %elifidni %1, fs
 11743                              <2>                 o16 push %1
 11744                              <2>         %elifidni %1, gs
 11745                              <2>                 o16 push %1
 11746                              <2>         %elifidni %1, word cs
 11747                              <2>                 o16 push %1
 11748                              <2>         %elifidni %1, word ds
 11749                              <2>                 o16 push %1
 11750                              <2>         %elifidni %1, word es
 11751                              <2>                 o16 push %1
 11752                              <2>         %elifidni %1, word fs
 11753                              <2>                 o16 push %1
 11754                              <2>         %elifidni %1, word gs
 11755                              <2>                 o16 push %1
 11756                              <2>         %else
 11757 00000DFA 66FF750E            <2>                 push %1
 11758                              <2>         %endif
 11759                              <2> 
 11760                              <2>         %rotate -1
 11761                              <2> 
 11762                              <2> 
 11763                              <2> 
 11764                              <2> 
 11765                              <2> 
 11766                              <2> 
 11767                              <2> 
 11768                              <2>         %ifidni %1, cs
 11769                              <2>                 o16 push %1
 11770                              <2>         %elifidni %1, ds
 11771                              <2>                 o16 push %1
 11772                              <2>         %elifidni %1, es
 11773                              <2>                 o16 push %1
 11774                              <2>         %elifidni %1, fs
 11775                              <2>                 o16 push %1
 11776                              <2>         %elifidni %1, gs
 11777                              <2>                 o16 push %1
 11778                              <2>         %elifidni %1, word cs
 11779                              <2>                 o16 push %1
 11780                              <2>         %elifidni %1, word ds
 11781                              <2>                 o16 push %1
 11782                              <2>         %elifidni %1, word es
 11783                              <2>                 o16 push %1
 11784                              <2>         %elifidni %1, word fs
 11785                              <2>                 o16 push %1
 11786                              <2>         %elifidni %1, word gs
 11787                              <2>                 o16 push %1
 11788                              <2>         %else
 11789 00000DFE 66FF750C            <2>                 push %1
 11790                              <2>         %endif
 11791                              <2> 
 11792                              <2>         %rotate -1
 11793                              <2> 
 11794                              <2> 
 11795                              <2> 
 11796                              <2> 
 11797                              <2> 
 11798                              <2> 
 11799                              <2> 
 11800                              <2>         %ifidni %1, cs
 11801                              <2>                 o16 push %1
 11802                              <2>         %elifidni %1, ds
 11803                              <2>                 o16 push %1
 11804                              <2>         %elifidni %1, es
 11805                              <2>                 o16 push %1
 11806                              <2>         %elifidni %1, fs
 11807                              <2>                 o16 push %1
 11808                              <2>         %elifidni %1, gs
 11809                              <2>                 o16 push %1
 11810                              <2>         %elifidni %1, word cs
 11811                              <2>                 o16 push %1
 11812                              <2>         %elifidni %1, word ds
 11813                              <2>                 o16 push %1
 11814                              <2>         %elifidni %1, word es
 11815                              <2>                 o16 push %1
 11816                              <2>         %elifidni %1, word fs
 11817                              <2>                 o16 push %1
 11818                              <2>         %elifidni %1, word gs
 11819                              <2>                 o16 push %1
 11820                              <2>         %else
 11821 00000E02 FF7508              <2>                 push %1
 11822                              <2>         %endif
 11823                              <2> 
 11824                              <2>         %rotate -1
 11825 00000E05 E8FDF3FFFF          <1> call %1
 11826                              <1> %if (%0!=1)
 11827 00000E0A 83C40C              <1>         add esp, byte %1_arglen
 11828                              <1> %endif
 11829 00000E0D 39C2                        cmp edx, eax
 11830 00000E0F 0F8584FFFFFF                jne near .PixelLoop
 11831                                  
 11832 00000E15 3B5514                      cmp edx, dword [ebp+.Color]
 11833 00000E18 0F847BFFFFFF                je near .PixelLoop
 11834                                  	
 11835                                  
 11836                                  
 11837                                      ;--- Do below if GetPixel(Point.x,Point.y) = OldColor  AND  GetPixel(Point.x,Point.y) != Color then ---;
 11838                                  
 11839                                      ; DrawPixel(Point.x,Point.y,Color)
 11840                                      invoke _DrawPixel, dword [ebp + .DestOff], word [ebp + .DestWidth], word [ebp + .DestHeight], si, di, dword [ebp + .Color]
 11841                              <1> %rotate -1
 11842                              <1> 
 11843                              <1> %rep (%0-1)
 11844                              <1> 
 11845                              <1> 
 11846                              <1> 
 11847                              <1> 
 11848                              <1> 
 11849                              <1> 
 11850                              <1> 
 11851                              <1>         %ifidni %1, cs
 11852                              <1>                 o16 push %1
 11853                              <1>         %elifidni %1, ds
 11854                              <1>                 o16 push %1
 11855                              <1>         %elifidni %1, es
 11856                              <1>                 o16 push %1
 11857                              <1>         %elifidni %1, fs
 11858                              <1>                 o16 push %1
 11859                              <1>         %elifidni %1, gs
 11860                              <1>                 o16 push %1
 11861                              <1>         %elifidni %1, word cs
 11862                              <1>                 o16 push %1
 11863                              <1>         %elifidni %1, word ds
 11864                              <1>                 o16 push %1
 11865                              <1>         %elifidni %1, word es
 11866                              <1>                 o16 push %1
 11867                              <1>         %elifidni %1, word fs
 11868                              <1>                 o16 push %1
 11869                              <1>         %elifidni %1, word gs
 11870                              <1>                 o16 push %1
 11871                              <1>         %else
 11872                              <1>                 push %1
 11873                              <1>         %endif
 11874                              <1> 
 11875                              <1>         %rotate -1
 11876                              <1> %endrep
 11877                              <2> 
 11878                              <2> 
 11879                              <2> 
 11880                              <2> 
 11881                              <2> 
 11882                              <2> 
 11883                              <2> 
 11884                              <2>         %ifidni %1, cs
 11885                              <2>                 o16 push %1
 11886                              <2>         %elifidni %1, ds
 11887                              <2>                 o16 push %1
 11888                              <2>         %elifidni %1, es
 11889                              <2>                 o16 push %1
 11890                              <2>         %elifidni %1, fs
 11891                              <2>                 o16 push %1
 11892                              <2>         %elifidni %1, gs
 11893                              <2>                 o16 push %1
 11894                              <2>         %elifidni %1, word cs
 11895                              <2>                 o16 push %1
 11896                              <2>         %elifidni %1, word ds
 11897                              <2>                 o16 push %1
 11898                              <2>         %elifidni %1, word es
 11899                              <2>                 o16 push %1
 11900                              <2>         %elifidni %1, word fs
 11901                              <2>                 o16 push %1
 11902                              <2>         %elifidni %1, word gs
 11903                              <2>                 o16 push %1
 11904                              <2>         %else
 11905 00000E1E FF7514              <2>                 push %1
 11906                              <2>         %endif
 11907                              <2> 
 11908                              <2>         %rotate -1
 11909                              <2> 
 11910                              <2> 
 11911                              <2> 
 11912                              <2> 
 11913                              <2> 
 11914                              <2> 
 11915                              <2> 
 11916                              <2>         %ifidni %1, cs
 11917                              <2>                 o16 push %1
 11918                              <2>         %elifidni %1, ds
 11919                              <2>                 o16 push %1
 11920                              <2>         %elifidni %1, es
 11921                              <2>                 o16 push %1
 11922                              <2>         %elifidni %1, fs
 11923                              <2>                 o16 push %1
 11924                              <2>         %elifidni %1, gs
 11925                              <2>                 o16 push %1
 11926                              <2>         %elifidni %1, word cs
 11927                              <2>                 o16 push %1
 11928                              <2>         %elifidni %1, word ds
 11929                              <2>                 o16 push %1
 11930                              <2>         %elifidni %1, word es
 11931                              <2>                 o16 push %1
 11932                              <2>         %elifidni %1, word fs
 11933                              <2>                 o16 push %1
 11934                              <2>         %elifidni %1, word gs
 11935                              <2>                 o16 push %1
 11936                              <2>         %else
 11937 00000E21 6657                <2>                 push %1
 11938                              <2>         %endif
 11939                              <2> 
 11940                              <2>         %rotate -1
 11941                              <2> 
 11942                              <2> 
 11943                              <2> 
 11944                              <2> 
 11945                              <2> 
 11946                              <2> 
 11947                              <2> 
 11948                              <2>         %ifidni %1, cs
 11949                              <2>                 o16 push %1
 11950                              <2>         %elifidni %1, ds
 11951                              <2>                 o16 push %1
 11952                              <2>         %elifidni %1, es
 11953                              <2>                 o16 push %1
 11954                              <2>         %elifidni %1, fs
 11955                              <2>                 o16 push %1
 11956                              <2>         %elifidni %1, gs
 11957                              <2>                 o16 push %1
 11958                              <2>         %elifidni %1, word cs
 11959                              <2>                 o16 push %1
 11960                              <2>         %elifidni %1, word ds
 11961                              <2>                 o16 push %1
 11962                              <2>         %elifidni %1, word es
 11963                              <2>                 o16 push %1
 11964                              <2>         %elifidni %1, word fs
 11965                              <2>                 o16 push %1
 11966                              <2>         %elifidni %1, word gs
 11967                              <2>                 o16 push %1
 11968                              <2>         %else
 11969 00000E23 6656                <2>                 push %1
 11970                              <2>         %endif
 11971                              <2> 
 11972                              <2>         %rotate -1
 11973                              <2> 
 11974                              <2> 
 11975                              <2> 
 11976                              <2> 
 11977                              <2> 
 11978                              <2> 
 11979                              <2> 
 11980                              <2>         %ifidni %1, cs
 11981                              <2>                 o16 push %1
 11982                              <2>         %elifidni %1, ds
 11983                              <2>                 o16 push %1
 11984                              <2>         %elifidni %1, es
 11985                              <2>                 o16 push %1
 11986                              <2>         %elifidni %1, fs
 11987                              <2>                 o16 push %1
 11988                              <2>         %elifidni %1, gs
 11989                              <2>                 o16 push %1
 11990                              <2>         %elifidni %1, word cs
 11991                              <2>                 o16 push %1
 11992                              <2>         %elifidni %1, word ds
 11993                              <2>                 o16 push %1
 11994                              <2>         %elifidni %1, word es
 11995                              <2>                 o16 push %1
 11996                              <2>         %elifidni %1, word fs
 11997                              <2>                 o16 push %1
 11998                              <2>         %elifidni %1, word gs
 11999                              <2>                 o16 push %1
 12000                              <2>         %else
 12001 00000E25 66FF750E            <2>                 push %1
 12002                              <2>         %endif
 12003                              <2> 
 12004                              <2>         %rotate -1
 12005                              <2> 
 12006                              <2> 
 12007                              <2> 
 12008                              <2> 
 12009                              <2> 
 12010                              <2> 
 12011                              <2> 
 12012                              <2>         %ifidni %1, cs
 12013                              <2>                 o16 push %1
 12014                              <2>         %elifidni %1, ds
 12015                              <2>                 o16 push %1
 12016                              <2>         %elifidni %1, es
 12017                              <2>                 o16 push %1
 12018                              <2>         %elifidni %1, fs
 12019                              <2>                 o16 push %1
 12020                              <2>         %elifidni %1, gs
 12021                              <2>                 o16 push %1
 12022                              <2>         %elifidni %1, word cs
 12023                              <2>                 o16 push %1
 12024                              <2>         %elifidni %1, word ds
 12025                              <2>                 o16 push %1
 12026                              <2>         %elifidni %1, word es
 12027                              <2>                 o16 push %1
 12028                              <2>         %elifidni %1, word fs
 12029                              <2>                 o16 push %1
 12030                              <2>         %elifidni %1, word gs
 12031                              <2>                 o16 push %1
 12032                              <2>         %else
 12033 00000E29 66FF750C            <2>                 push %1
 12034                              <2>         %endif
 12035                              <2> 
 12036                              <2>         %rotate -1
 12037                              <2> 
 12038                              <2> 
 12039                              <2> 
 12040                              <2> 
 12041                              <2> 
 12042                              <2> 
 12043                              <2> 
 12044                              <2>         %ifidni %1, cs
 12045                              <2>                 o16 push %1
 12046                              <2>         %elifidni %1, ds
 12047                              <2>                 o16 push %1
 12048                              <2>         %elifidni %1, es
 12049                              <2>                 o16 push %1
 12050                              <2>         %elifidni %1, fs
 12051                              <2>                 o16 push %1
 12052                              <2>         %elifidni %1, gs
 12053                              <2>                 o16 push %1
 12054                              <2>         %elifidni %1, word cs
 12055                              <2>                 o16 push %1
 12056                              <2>         %elifidni %1, word ds
 12057                              <2>                 o16 push %1
 12058                              <2>         %elifidni %1, word es
 12059                              <2>                 o16 push %1
 12060                              <2>         %elifidni %1, word fs
 12061                              <2>                 o16 push %1
 12062                              <2>         %elifidni %1, word gs
 12063                              <2>                 o16 push %1
 12064                              <2>         %else
 12065 00000E2D FF7508              <2>                 push %1
 12066                              <2>         %endif
 12067                              <2> 
 12068                              <2>         %rotate -1
 12069 00000E30 E821F4FFFF          <1> call %1
 12070                              <1> %if (%0!=1)
 12071 00000E35 83C410              <1>         add esp, byte %1_arglen
 12072                              <1> %endif
 12073                                  	
 12074 00000E38 8B1D[4E000000]              mov	ebx, dword [_QueueTail]
 12075 00000E3E 6646                        inc	si
 12076 00000E40 66FF4D0C                    dec	word [ebp + .DestWidth]
 12077 00000E44 66FF4D0E                    dec	word [ebp + .DestHeight]
 12078                                      invoke _PointInBox, si, di, word 0, word 0, word [ebp + .DestWidth], word [ebp + .DestHeight]
 12079                              <1> %rotate -1
 12080                              <1> 
 12081                              <1> %rep (%0-1)
 12082                              <1> 
 12083                              <1> 
 12084                              <1> 
 12085                              <1> 
 12086                              <1> 
 12087                              <1> 
 12088                              <1> 
 12089                              <1>         %ifidni %1, cs
 12090                              <1>                 o16 push %1
 12091                              <1>         %elifidni %1, ds
 12092                              <1>                 o16 push %1
 12093                              <1>         %elifidni %1, es
 12094                              <1>                 o16 push %1
 12095                              <1>         %elifidni %1, fs
 12096                              <1>                 o16 push %1
 12097                              <1>         %elifidni %1, gs
 12098                              <1>                 o16 push %1
 12099                              <1>         %elifidni %1, word cs
 12100                              <1>                 o16 push %1
 12101                              <1>         %elifidni %1, word ds
 12102                              <1>                 o16 push %1
 12103                              <1>         %elifidni %1, word es
 12104                              <1>                 o16 push %1
 12105                              <1>         %elifidni %1, word fs
 12106                              <1>                 o16 push %1
 12107                              <1>         %elifidni %1, word gs
 12108                              <1>                 o16 push %1
 12109                              <1>         %else
 12110                              <1>                 push %1
 12111                              <1>         %endif
 12112                              <1> 
 12113                              <1>         %rotate -1
 12114                              <1> %endrep
 12115                              <2> 
 12116                              <2> 
 12117                              <2> 
 12118                              <2> 
 12119                              <2> 
 12120                              <2> 
 12121                              <2> 
 12122                              <2>         %ifidni %1, cs
 12123                              <2>                 o16 push %1
 12124                              <2>         %elifidni %1, ds
 12125                              <2>                 o16 push %1
 12126                              <2>         %elifidni %1, es
 12127                              <2>                 o16 push %1
 12128                              <2>         %elifidni %1, fs
 12129                              <2>                 o16 push %1
 12130                              <2>         %elifidni %1, gs
 12131                              <2>                 o16 push %1
 12132                              <2>         %elifidni %1, word cs
 12133                              <2>                 o16 push %1
 12134                              <2>         %elifidni %1, word ds
 12135                              <2>                 o16 push %1
 12136                              <2>         %elifidni %1, word es
 12137                              <2>                 o16 push %1
 12138                              <2>         %elifidni %1, word fs
 12139                              <2>                 o16 push %1
 12140                              <2>         %elifidni %1, word gs
 12141                              <2>                 o16 push %1
 12142                              <2>         %else
 12143 00000E48 66FF750E            <2>                 push %1
 12144                              <2>         %endif
 12145                              <2> 
 12146                              <2>         %rotate -1
 12147                              <2> 
 12148                              <2> 
 12149                              <2> 
 12150                              <2> 
 12151                              <2> 
 12152                              <2> 
 12153                              <2> 
 12154                              <2>         %ifidni %1, cs
 12155                              <2>                 o16 push %1
 12156                              <2>         %elifidni %1, ds
 12157                              <2>                 o16 push %1
 12158                              <2>         %elifidni %1, es
 12159                              <2>                 o16 push %1
 12160                              <2>         %elifidni %1, fs
 12161                              <2>                 o16 push %1
 12162                              <2>         %elifidni %1, gs
 12163                              <2>                 o16 push %1
 12164                              <2>         %elifidni %1, word cs
 12165                              <2>                 o16 push %1
 12166                              <2>         %elifidni %1, word ds
 12167                              <2>                 o16 push %1
 12168                              <2>         %elifidni %1, word es
 12169                              <2>                 o16 push %1
 12170                              <2>         %elifidni %1, word fs
 12171                              <2>                 o16 push %1
 12172                              <2>         %elifidni %1, word gs
 12173                              <2>                 o16 push %1
 12174                              <2>         %else
 12175 00000E4C 66FF750C            <2>                 push %1
 12176                              <2>         %endif
 12177                              <2> 
 12178                              <2>         %rotate -1
 12179                              <2> 
 12180                              <2> 
 12181                              <2> 
 12182                              <2> 
 12183                              <2> 
 12184                              <2> 
 12185                              <2> 
 12186                              <2>         %ifidni %1, cs
 12187                              <2>                 o16 push %1
 12188                              <2>         %elifidni %1, ds
 12189                              <2>                 o16 push %1
 12190                              <2>         %elifidni %1, es
 12191                              <2>                 o16 push %1
 12192                              <2>         %elifidni %1, fs
 12193                              <2>                 o16 push %1
 12194                              <2>         %elifidni %1, gs
 12195                              <2>                 o16 push %1
 12196                              <2>         %elifidni %1, word cs
 12197                              <2>                 o16 push %1
 12198                              <2>         %elifidni %1, word ds
 12199                              <2>                 o16 push %1
 12200                              <2>         %elifidni %1, word es
 12201                              <2>                 o16 push %1
 12202                              <2>         %elifidni %1, word fs
 12203                              <2>                 o16 push %1
 12204                              <2>         %elifidni %1, word gs
 12205                              <2>                 o16 push %1
 12206                              <2>         %else
 12207 00000E50 66680000            <2>                 push %1
 12208                              <2>         %endif
 12209                              <2> 
 12210                              <2>         %rotate -1
 12211                              <2> 
 12212                              <2> 
 12213                              <2> 
 12214                              <2> 
 12215                              <2> 
 12216                              <2> 
 12217                              <2> 
 12218                              <2>         %ifidni %1, cs
 12219                              <2>                 o16 push %1
 12220                              <2>         %elifidni %1, ds
 12221                              <2>                 o16 push %1
 12222                              <2>         %elifidni %1, es
 12223                              <2>                 o16 push %1
 12224                              <2>         %elifidni %1, fs
 12225                              <2>                 o16 push %1
 12226                              <2>         %elifidni %1, gs
 12227                              <2>                 o16 push %1
 12228                              <2>         %elifidni %1, word cs
 12229                              <2>                 o16 push %1
 12230                              <2>         %elifidni %1, word ds
 12231                              <2>                 o16 push %1
 12232                              <2>         %elifidni %1, word es
 12233                              <2>                 o16 push %1
 12234                              <2>         %elifidni %1, word fs
 12235                              <2>                 o16 push %1
 12236                              <2>         %elifidni %1, word gs
 12237                              <2>                 o16 push %1
 12238                              <2>         %else
 12239 00000E54 66680000            <2>                 push %1
 12240                              <2>         %endif
 12241                              <2> 
 12242                              <2>         %rotate -1
 12243                              <2> 
 12244                              <2> 
 12245                              <2> 
 12246                              <2> 
 12247                              <2> 
 12248                              <2> 
 12249                              <2> 
 12250                              <2>         %ifidni %1, cs
 12251                              <2>                 o16 push %1
 12252                              <2>         %elifidni %1, ds
 12253                              <2>                 o16 push %1
 12254                              <2>         %elifidni %1, es
 12255                              <2>                 o16 push %1
 12256                              <2>         %elifidni %1, fs
 12257                              <2>                 o16 push %1
 12258                              <2>         %elifidni %1, gs
 12259                              <2>                 o16 push %1
 12260                              <2>         %elifidni %1, word cs
 12261                              <2>                 o16 push %1
 12262                              <2>         %elifidni %1, word ds
 12263                              <2>                 o16 push %1
 12264                              <2>         %elifidni %1, word es
 12265                              <2>                 o16 push %1
 12266                              <2>         %elifidni %1, word fs
 12267                              <2>                 o16 push %1
 12268                              <2>         %elifidni %1, word gs
 12269                              <2>                 o16 push %1
 12270                              <2>         %else
 12271 00000E58 6657                <2>                 push %1
 12272                              <2>         %endif
 12273                              <2> 
 12274                              <2>         %rotate -1
 12275                              <2> 
 12276                              <2> 
 12277                              <2> 
 12278                              <2> 
 12279                              <2> 
 12280                              <2> 
 12281                              <2> 
 12282                              <2>         %ifidni %1, cs
 12283                              <2>                 o16 push %1
 12284                              <2>         %elifidni %1, ds
 12285                              <2>                 o16 push %1
 12286                              <2>         %elifidni %1, es
 12287                              <2>                 o16 push %1
 12288                              <2>         %elifidni %1, fs
 12289                              <2>                 o16 push %1
 12290                              <2>         %elifidni %1, gs
 12291                              <2>                 o16 push %1
 12292                              <2>         %elifidni %1, word cs
 12293                              <2>                 o16 push %1
 12294                              <2>         %elifidni %1, word ds
 12295                              <2>                 o16 push %1
 12296                              <2>         %elifidni %1, word es
 12297                              <2>                 o16 push %1
 12298                              <2>         %elifidni %1, word fs
 12299                              <2>                 o16 push %1
 12300                              <2>         %elifidni %1, word gs
 12301                              <2>                 o16 push %1
 12302                              <2>         %else
 12303 00000E5A 6656                <2>                 push %1
 12304                              <2>         %endif
 12305                              <2> 
 12306                              <2>         %rotate -1
 12307 00000E5C E864F3FFFF          <1> call %1
 12308                              <1> %if (%0!=1)
 12309 00000E61 83C40C              <1>         add esp, byte %1_arglen
 12310                              <1> %endif
 12311 00000E64 66FF450C                    inc	word [ebp + .DestWidth]
 12312 00000E68 66FF450E                    inc	word [ebp + .DestHeight]
 12313 00000E6C 85C0                        test eax, eax
 12314 00000E6E 0F8411000000                jz near .EnqueueLeft		; If invalid point, don't enqueue it
 12315                                  	
 12316                                      ;Enqueue(Point.x+1,Point.y)		; Right Point
 12317 00000E74 668933                      mov word [ebx], si
 12318 00000E77 66897B02                    mov word [ebx + 2], di
 12319 00000E7B 8105[4E000000]0400-         add dword [_QueueTail], 4
 12320 00000E83 0000               
 12321                                  
 12322                                  
 12323                                  
 12324                                  
 12325                                  
 12326                                      ;------------
 12327                                      .EnqueueLeft:
 12328                                      ;------------
 12329 00000E85 664E                        dec si
 12330 00000E87 664E                        dec si
 12331 00000E89 8B1D[4E000000]              mov ebx, dword [_QueueTail]
 12332 00000E8F 66FF4D0C                    dec word [ebp+.DestWidth]
 12333 00000E93 66FF4D0E                    dec word [ebp+.DestHeight]
 12334                                      invoke _PointInBox, si, di, word 0, word 0, word [ebp + .DestWidth], word [ebp + .DestHeight]
 12335                              <1> %rotate -1
 12336                              <1> 
 12337                              <1> %rep (%0-1)
 12338                              <1> 
 12339                              <1> 
 12340                              <1> 
 12341                              <1> 
 12342                              <1> 
 12343                              <1> 
 12344                              <1> 
 12345                              <1>         %ifidni %1, cs
 12346                              <1>                 o16 push %1
 12347                              <1>         %elifidni %1, ds
 12348                              <1>                 o16 push %1
 12349                              <1>         %elifidni %1, es
 12350                              <1>                 o16 push %1
 12351                              <1>         %elifidni %1, fs
 12352                              <1>                 o16 push %1
 12353                              <1>         %elifidni %1, gs
 12354                              <1>                 o16 push %1
 12355                              <1>         %elifidni %1, word cs
 12356                              <1>                 o16 push %1
 12357                              <1>         %elifidni %1, word ds
 12358                              <1>                 o16 push %1
 12359                              <1>         %elifidni %1, word es
 12360                              <1>                 o16 push %1
 12361                              <1>         %elifidni %1, word fs
 12362                              <1>                 o16 push %1
 12363                              <1>         %elifidni %1, word gs
 12364                              <1>                 o16 push %1
 12365                              <1>         %else
 12366                              <1>                 push %1
 12367                              <1>         %endif
 12368                              <1> 
 12369                              <1>         %rotate -1
 12370                              <1> %endrep
 12371                              <2> 
 12372                              <2> 
 12373                              <2> 
 12374                              <2> 
 12375                              <2> 
 12376                              <2> 
 12377                              <2> 
 12378                              <2>         %ifidni %1, cs
 12379                              <2>                 o16 push %1
 12380                              <2>         %elifidni %1, ds
 12381                              <2>                 o16 push %1
 12382                              <2>         %elifidni %1, es
 12383                              <2>                 o16 push %1
 12384                              <2>         %elifidni %1, fs
 12385                              <2>                 o16 push %1
 12386                              <2>         %elifidni %1, gs
 12387                              <2>                 o16 push %1
 12388                              <2>         %elifidni %1, word cs
 12389                              <2>                 o16 push %1
 12390                              <2>         %elifidni %1, word ds
 12391                              <2>                 o16 push %1
 12392                              <2>         %elifidni %1, word es
 12393                              <2>                 o16 push %1
 12394                              <2>         %elifidni %1, word fs
 12395                              <2>                 o16 push %1
 12396                              <2>         %elifidni %1, word gs
 12397                              <2>                 o16 push %1
 12398                              <2>         %else
 12399 00000E97 66FF750E            <2>                 push %1
 12400                              <2>         %endif
 12401                              <2> 
 12402                              <2>         %rotate -1
 12403                              <2> 
 12404                              <2> 
 12405                              <2> 
 12406                              <2> 
 12407                              <2> 
 12408                              <2> 
 12409                              <2> 
 12410                              <2>         %ifidni %1, cs
 12411                              <2>                 o16 push %1
 12412                              <2>         %elifidni %1, ds
 12413                              <2>                 o16 push %1
 12414                              <2>         %elifidni %1, es
 12415                              <2>                 o16 push %1
 12416                              <2>         %elifidni %1, fs
 12417                              <2>                 o16 push %1
 12418                              <2>         %elifidni %1, gs
 12419                              <2>                 o16 push %1
 12420                              <2>         %elifidni %1, word cs
 12421                              <2>                 o16 push %1
 12422                              <2>         %elifidni %1, word ds
 12423                              <2>                 o16 push %1
 12424                              <2>         %elifidni %1, word es
 12425                              <2>                 o16 push %1
 12426                              <2>         %elifidni %1, word fs
 12427                              <2>                 o16 push %1
 12428                              <2>         %elifidni %1, word gs
 12429                              <2>                 o16 push %1
 12430                              <2>         %else
 12431 00000E9B 66FF750C            <2>                 push %1
 12432                              <2>         %endif
 12433                              <2> 
 12434                              <2>         %rotate -1
 12435                              <2> 
 12436                              <2> 
 12437                              <2> 
 12438                              <2> 
 12439                              <2> 
 12440                              <2> 
 12441                              <2> 
 12442                              <2>         %ifidni %1, cs
 12443                              <2>                 o16 push %1
 12444                              <2>         %elifidni %1, ds
 12445                              <2>                 o16 push %1
 12446                              <2>         %elifidni %1, es
 12447                              <2>                 o16 push %1
 12448                              <2>         %elifidni %1, fs
 12449                              <2>                 o16 push %1
 12450                              <2>         %elifidni %1, gs
 12451                              <2>                 o16 push %1
 12452                              <2>         %elifidni %1, word cs
 12453                              <2>                 o16 push %1
 12454                              <2>         %elifidni %1, word ds
 12455                              <2>                 o16 push %1
 12456                              <2>         %elifidni %1, word es
 12457                              <2>                 o16 push %1
 12458                              <2>         %elifidni %1, word fs
 12459                              <2>                 o16 push %1
 12460                              <2>         %elifidni %1, word gs
 12461                              <2>                 o16 push %1
 12462                              <2>         %else
 12463 00000E9F 66680000            <2>                 push %1
 12464                              <2>         %endif
 12465                              <2> 
 12466                              <2>         %rotate -1
 12467                              <2> 
 12468                              <2> 
 12469                              <2> 
 12470                              <2> 
 12471                              <2> 
 12472                              <2> 
 12473                              <2> 
 12474                              <2>         %ifidni %1, cs
 12475                              <2>                 o16 push %1
 12476                              <2>         %elifidni %1, ds
 12477                              <2>                 o16 push %1
 12478                              <2>         %elifidni %1, es
 12479                              <2>                 o16 push %1
 12480                              <2>         %elifidni %1, fs
 12481                              <2>                 o16 push %1
 12482                              <2>         %elifidni %1, gs
 12483                              <2>                 o16 push %1
 12484                              <2>         %elifidni %1, word cs
 12485                              <2>                 o16 push %1
 12486                              <2>         %elifidni %1, word ds
 12487                              <2>                 o16 push %1
 12488                              <2>         %elifidni %1, word es
 12489                              <2>                 o16 push %1
 12490                              <2>         %elifidni %1, word fs
 12491                              <2>                 o16 push %1
 12492                              <2>         %elifidni %1, word gs
 12493                              <2>                 o16 push %1
 12494                              <2>         %else
 12495 00000EA3 66680000            <2>                 push %1
 12496                              <2>         %endif
 12497                              <2> 
 12498                              <2>         %rotate -1
 12499                              <2> 
 12500                              <2> 
 12501                              <2> 
 12502                              <2> 
 12503                              <2> 
 12504                              <2> 
 12505                              <2> 
 12506                              <2>         %ifidni %1, cs
 12507                              <2>                 o16 push %1
 12508                              <2>         %elifidni %1, ds
 12509                              <2>                 o16 push %1
 12510                              <2>         %elifidni %1, es
 12511                              <2>                 o16 push %1
 12512                              <2>         %elifidni %1, fs
 12513                              <2>                 o16 push %1
 12514                              <2>         %elifidni %1, gs
 12515                              <2>                 o16 push %1
 12516                              <2>         %elifidni %1, word cs
 12517                              <2>                 o16 push %1
 12518                              <2>         %elifidni %1, word ds
 12519                              <2>                 o16 push %1
 12520                              <2>         %elifidni %1, word es
 12521                              <2>                 o16 push %1
 12522                              <2>         %elifidni %1, word fs
 12523                              <2>                 o16 push %1
 12524                              <2>         %elifidni %1, word gs
 12525                              <2>                 o16 push %1
 12526                              <2>         %else
 12527 00000EA7 6657                <2>                 push %1
 12528                              <2>         %endif
 12529                              <2> 
 12530                              <2>         %rotate -1
 12531                              <2> 
 12532                              <2> 
 12533                              <2> 
 12534                              <2> 
 12535                              <2> 
 12536                              <2> 
 12537                              <2> 
 12538                              <2>         %ifidni %1, cs
 12539                              <2>                 o16 push %1
 12540                              <2>         %elifidni %1, ds
 12541                              <2>                 o16 push %1
 12542                              <2>         %elifidni %1, es
 12543                              <2>                 o16 push %1
 12544                              <2>         %elifidni %1, fs
 12545                              <2>                 o16 push %1
 12546                              <2>         %elifidni %1, gs
 12547                              <2>                 o16 push %1
 12548                              <2>         %elifidni %1, word cs
 12549                              <2>                 o16 push %1
 12550                              <2>         %elifidni %1, word ds
 12551                              <2>                 o16 push %1
 12552                              <2>         %elifidni %1, word es
 12553                              <2>                 o16 push %1
 12554                              <2>         %elifidni %1, word fs
 12555                              <2>                 o16 push %1
 12556                              <2>         %elifidni %1, word gs
 12557                              <2>                 o16 push %1
 12558                              <2>         %else
 12559 00000EA9 6656                <2>                 push %1
 12560                              <2>         %endif
 12561                              <2> 
 12562                              <2>         %rotate -1
 12563 00000EAB E815F3FFFF          <1> call %1
 12564                              <1> %if (%0!=1)
 12565 00000EB0 83C40C              <1>         add esp, byte %1_arglen
 12566                              <1> %endif
 12567 00000EB3 66FF450C                    inc word [ebp + .DestWidth]
 12568 00000EB7 66FF450E                    inc word [ebp + .DestHeight]
 12569 00000EBB 85C0                        test eax, eax
 12570 00000EBD 0F8411000000                jz near .EnqueueBottom		; If invalid point, don't enqueue it
 12571                                  
 12572                                      ; Enqueue(Point.x-1,Point.y)	; Left Point
 12573 00000EC3 668933                      mov word [ebx], si
 12574 00000EC6 66897B02                    mov word [ebx + 2], di
 12575 00000ECA 8105[4E000000]0400-         add dword [_QueueTail], 4
 12576 00000ED2 0000               
 12577                                  
 12578                                  
 12579                                  
 12580                                  
 12581                                  
 12582                                  
 12583                                      ;--------------
 12584                                      .EnqueueBottom:
 12585                                      ;--------------
 12586 00000ED4 6646                        inc si
 12587 00000ED6 6647                        inc di
 12588 00000ED8 8B1D[4E000000]              mov ebx, dword [_QueueTail]
 12589 00000EDE 66FF4D0C                    dec word [ebp + .DestWidth]
 12590 00000EE2 66FF4D0E                    dec word [ebp + .DestHeight]
 12591                                      invoke _PointInBox, si, di, word 0, word 0, word [ebp + .DestWidth], word [ebp + .DestHeight]
 12592                              <1> %rotate -1
 12593                              <1> 
 12594                              <1> %rep (%0-1)
 12595                              <1> 
 12596                              <1> 
 12597                              <1> 
 12598                              <1> 
 12599                              <1> 
 12600                              <1> 
 12601                              <1> 
 12602                              <1>         %ifidni %1, cs
 12603                              <1>                 o16 push %1
 12604                              <1>         %elifidni %1, ds
 12605                              <1>                 o16 push %1
 12606                              <1>         %elifidni %1, es
 12607                              <1>                 o16 push %1
 12608                              <1>         %elifidni %1, fs
 12609                              <1>                 o16 push %1
 12610                              <1>         %elifidni %1, gs
 12611                              <1>                 o16 push %1
 12612                              <1>         %elifidni %1, word cs
 12613                              <1>                 o16 push %1
 12614                              <1>         %elifidni %1, word ds
 12615                              <1>                 o16 push %1
 12616                              <1>         %elifidni %1, word es
 12617                              <1>                 o16 push %1
 12618                              <1>         %elifidni %1, word fs
 12619                              <1>                 o16 push %1
 12620                              <1>         %elifidni %1, word gs
 12621                              <1>                 o16 push %1
 12622                              <1>         %else
 12623                              <1>                 push %1
 12624                              <1>         %endif
 12625                              <1> 
 12626                              <1>         %rotate -1
 12627                              <1> %endrep
 12628                              <2> 
 12629                              <2> 
 12630                              <2> 
 12631                              <2> 
 12632                              <2> 
 12633                              <2> 
 12634                              <2> 
 12635                              <2>         %ifidni %1, cs
 12636                              <2>                 o16 push %1
 12637                              <2>         %elifidni %1, ds
 12638                              <2>                 o16 push %1
 12639                              <2>         %elifidni %1, es
 12640                              <2>                 o16 push %1
 12641                              <2>         %elifidni %1, fs
 12642                              <2>                 o16 push %1
 12643                              <2>         %elifidni %1, gs
 12644                              <2>                 o16 push %1
 12645                              <2>         %elifidni %1, word cs
 12646                              <2>                 o16 push %1
 12647                              <2>         %elifidni %1, word ds
 12648                              <2>                 o16 push %1
 12649                              <2>         %elifidni %1, word es
 12650                              <2>                 o16 push %1
 12651                              <2>         %elifidni %1, word fs
 12652                              <2>                 o16 push %1
 12653                              <2>         %elifidni %1, word gs
 12654                              <2>                 o16 push %1
 12655                              <2>         %else
 12656 00000EE6 66FF750E            <2>                 push %1
 12657                              <2>         %endif
 12658                              <2> 
 12659                              <2>         %rotate -1
 12660                              <2> 
 12661                              <2> 
 12662                              <2> 
 12663                              <2> 
 12664                              <2> 
 12665                              <2> 
 12666                              <2> 
 12667                              <2>         %ifidni %1, cs
 12668                              <2>                 o16 push %1
 12669                              <2>         %elifidni %1, ds
 12670                              <2>                 o16 push %1
 12671                              <2>         %elifidni %1, es
 12672                              <2>                 o16 push %1
 12673                              <2>         %elifidni %1, fs
 12674                              <2>                 o16 push %1
 12675                              <2>         %elifidni %1, gs
 12676                              <2>                 o16 push %1
 12677                              <2>         %elifidni %1, word cs
 12678                              <2>                 o16 push %1
 12679                              <2>         %elifidni %1, word ds
 12680                              <2>                 o16 push %1
 12681                              <2>         %elifidni %1, word es
 12682                              <2>                 o16 push %1
 12683                              <2>         %elifidni %1, word fs
 12684                              <2>                 o16 push %1
 12685                              <2>         %elifidni %1, word gs
 12686                              <2>                 o16 push %1
 12687                              <2>         %else
 12688 00000EEA 66FF750C            <2>                 push %1
 12689                              <2>         %endif
 12690                              <2> 
 12691                              <2>         %rotate -1
 12692                              <2> 
 12693                              <2> 
 12694                              <2> 
 12695                              <2> 
 12696                              <2> 
 12697                              <2> 
 12698                              <2> 
 12699                              <2>         %ifidni %1, cs
 12700                              <2>                 o16 push %1
 12701                              <2>         %elifidni %1, ds
 12702                              <2>                 o16 push %1
 12703                              <2>         %elifidni %1, es
 12704                              <2>                 o16 push %1
 12705                              <2>         %elifidni %1, fs
 12706                              <2>                 o16 push %1
 12707                              <2>         %elifidni %1, gs
 12708                              <2>                 o16 push %1
 12709                              <2>         %elifidni %1, word cs
 12710                              <2>                 o16 push %1
 12711                              <2>         %elifidni %1, word ds
 12712                              <2>                 o16 push %1
 12713                              <2>         %elifidni %1, word es
 12714                              <2>                 o16 push %1
 12715                              <2>         %elifidni %1, word fs
 12716                              <2>                 o16 push %1
 12717                              <2>         %elifidni %1, word gs
 12718                              <2>                 o16 push %1
 12719                              <2>         %else
 12720 00000EEE 66680000            <2>                 push %1
 12721                              <2>         %endif
 12722                              <2> 
 12723                              <2>         %rotate -1
 12724                              <2> 
 12725                              <2> 
 12726                              <2> 
 12727                              <2> 
 12728                              <2> 
 12729                              <2> 
 12730                              <2> 
 12731                              <2>         %ifidni %1, cs
 12732                              <2>                 o16 push %1
 12733                              <2>         %elifidni %1, ds
 12734                              <2>                 o16 push %1
 12735                              <2>         %elifidni %1, es
 12736                              <2>                 o16 push %1
 12737                              <2>         %elifidni %1, fs
 12738                              <2>                 o16 push %1
 12739                              <2>         %elifidni %1, gs
 12740                              <2>                 o16 push %1
 12741                              <2>         %elifidni %1, word cs
 12742                              <2>                 o16 push %1
 12743                              <2>         %elifidni %1, word ds
 12744                              <2>                 o16 push %1
 12745                              <2>         %elifidni %1, word es
 12746                              <2>                 o16 push %1
 12747                              <2>         %elifidni %1, word fs
 12748                              <2>                 o16 push %1
 12749                              <2>         %elifidni %1, word gs
 12750                              <2>                 o16 push %1
 12751                              <2>         %else
 12752 00000EF2 66680000            <2>                 push %1
 12753                              <2>         %endif
 12754                              <2> 
 12755                              <2>         %rotate -1
 12756                              <2> 
 12757                              <2> 
 12758                              <2> 
 12759                              <2> 
 12760                              <2> 
 12761                              <2> 
 12762                              <2> 
 12763                              <2>         %ifidni %1, cs
 12764                              <2>                 o16 push %1
 12765                              <2>         %elifidni %1, ds
 12766                              <2>                 o16 push %1
 12767                              <2>         %elifidni %1, es
 12768                              <2>                 o16 push %1
 12769                              <2>         %elifidni %1, fs
 12770                              <2>                 o16 push %1
 12771                              <2>         %elifidni %1, gs
 12772                              <2>                 o16 push %1
 12773                              <2>         %elifidni %1, word cs
 12774                              <2>                 o16 push %1
 12775                              <2>         %elifidni %1, word ds
 12776                              <2>                 o16 push %1
 12777                              <2>         %elifidni %1, word es
 12778                              <2>                 o16 push %1
 12779                              <2>         %elifidni %1, word fs
 12780                              <2>                 o16 push %1
 12781                              <2>         %elifidni %1, word gs
 12782                              <2>                 o16 push %1
 12783                              <2>         %else
 12784 00000EF6 6657                <2>                 push %1
 12785                              <2>         %endif
 12786                              <2> 
 12787                              <2>         %rotate -1
 12788                              <2> 
 12789                              <2> 
 12790                              <2> 
 12791                              <2> 
 12792                              <2> 
 12793                              <2> 
 12794                              <2> 
 12795                              <2>         %ifidni %1, cs
 12796                              <2>                 o16 push %1
 12797                              <2>         %elifidni %1, ds
 12798                              <2>                 o16 push %1
 12799                              <2>         %elifidni %1, es
 12800                              <2>                 o16 push %1
 12801                              <2>         %elifidni %1, fs
 12802                              <2>                 o16 push %1
 12803                              <2>         %elifidni %1, gs
 12804                              <2>                 o16 push %1
 12805                              <2>         %elifidni %1, word cs
 12806                              <2>                 o16 push %1
 12807                              <2>         %elifidni %1, word ds
 12808                              <2>                 o16 push %1
 12809                              <2>         %elifidni %1, word es
 12810                              <2>                 o16 push %1
 12811                              <2>         %elifidni %1, word fs
 12812                              <2>                 o16 push %1
 12813                              <2>         %elifidni %1, word gs
 12814                              <2>                 o16 push %1
 12815                              <2>         %else
 12816 00000EF8 6656                <2>                 push %1
 12817                              <2>         %endif
 12818                              <2> 
 12819                              <2>         %rotate -1
 12820 00000EFA E8C6F2FFFF          <1> call %1
 12821                              <1> %if (%0!=1)
 12822 00000EFF 83C40C              <1>         add esp, byte %1_arglen
 12823                              <1> %endif
 12824 00000F02 66FF450C                    inc word [ebp+.DestWidth]
 12825 00000F06 66FF450E                    inc word [ebp+.DestHeight]
 12826 00000F0A 85C0                        test eax, eax
 12827 00000F0C 0F8411000000                jz near .EnqueueTop			; If invalid point, don't enqueue it
 12828                                  
 12829                                      ; Enqueue(Point.x,Point.y+1)	; Bottom Point
 12830 00000F12 668933                      mov word [ebx], si
 12831 00000F15 66897B02                    mov word [ebx + 2], di
 12832 00000F19 8105[4E000000]0400-         add dword [_QueueTail], 4
 12833 00000F21 0000               
 12834                                  
 12835                                  
 12836                                  
 12837                                  
 12838                                      ;-----------
 12839                                      .EnqueueTop:
 12840                                      ;-----------
 12841 00000F23 6681EF0200                  sub di, 2
 12842 00000F28 8B1D[4E000000]              mov ebx, dword [_QueueTail]
 12843 00000F2E 66FF4D0C                    dec word [ebp+.DestWidth]
 12844 00000F32 66FF4D0E                    dec word [ebp+.DestHeight]
 12845                                      invoke _PointInBox, si, di, word 0, word 0, word [ebp + .DestWidth], word [ebp + .DestHeight]
 12846                              <1> %rotate -1
 12847                              <1> 
 12848                              <1> %rep (%0-1)
 12849                              <1> 
 12850                              <1> 
 12851                              <1> 
 12852                              <1> 
 12853                              <1> 
 12854                              <1> 
 12855                              <1> 
 12856                              <1>         %ifidni %1, cs
 12857                              <1>                 o16 push %1
 12858                              <1>         %elifidni %1, ds
 12859                              <1>                 o16 push %1
 12860                              <1>         %elifidni %1, es
 12861                              <1>                 o16 push %1
 12862                              <1>         %elifidni %1, fs
 12863                              <1>                 o16 push %1
 12864                              <1>         %elifidni %1, gs
 12865                              <1>                 o16 push %1
 12866                              <1>         %elifidni %1, word cs
 12867                              <1>                 o16 push %1
 12868                              <1>         %elifidni %1, word ds
 12869                              <1>                 o16 push %1
 12870                              <1>         %elifidni %1, word es
 12871                              <1>                 o16 push %1
 12872                              <1>         %elifidni %1, word fs
 12873                              <1>                 o16 push %1
 12874                              <1>         %elifidni %1, word gs
 12875                              <1>                 o16 push %1
 12876                              <1>         %else
 12877                              <1>                 push %1
 12878                              <1>         %endif
 12879                              <1> 
 12880                              <1>         %rotate -1
 12881                              <1> %endrep
 12882                              <2> 
 12883                              <2> 
 12884                              <2> 
 12885                              <2> 
 12886                              <2> 
 12887                              <2> 
 12888                              <2> 
 12889                              <2>         %ifidni %1, cs
 12890                              <2>                 o16 push %1
 12891                              <2>         %elifidni %1, ds
 12892                              <2>                 o16 push %1
 12893                              <2>         %elifidni %1, es
 12894                              <2>                 o16 push %1
 12895                              <2>         %elifidni %1, fs
 12896                              <2>                 o16 push %1
 12897                              <2>         %elifidni %1, gs
 12898                              <2>                 o16 push %1
 12899                              <2>         %elifidni %1, word cs
 12900                              <2>                 o16 push %1
 12901                              <2>         %elifidni %1, word ds
 12902                              <2>                 o16 push %1
 12903                              <2>         %elifidni %1, word es
 12904                              <2>                 o16 push %1
 12905                              <2>         %elifidni %1, word fs
 12906                              <2>                 o16 push %1
 12907                              <2>         %elifidni %1, word gs
 12908                              <2>                 o16 push %1
 12909                              <2>         %else
 12910 00000F36 66FF750E            <2>                 push %1
 12911                              <2>         %endif
 12912                              <2> 
 12913                              <2>         %rotate -1
 12914                              <2> 
 12915                              <2> 
 12916                              <2> 
 12917                              <2> 
 12918                              <2> 
 12919                              <2> 
 12920                              <2> 
 12921                              <2>         %ifidni %1, cs
 12922                              <2>                 o16 push %1
 12923                              <2>         %elifidni %1, ds
 12924                              <2>                 o16 push %1
 12925                              <2>         %elifidni %1, es
 12926                              <2>                 o16 push %1
 12927                              <2>         %elifidni %1, fs
 12928                              <2>                 o16 push %1
 12929                              <2>         %elifidni %1, gs
 12930                              <2>                 o16 push %1
 12931                              <2>         %elifidni %1, word cs
 12932                              <2>                 o16 push %1
 12933                              <2>         %elifidni %1, word ds
 12934                              <2>                 o16 push %1
 12935                              <2>         %elifidni %1, word es
 12936                              <2>                 o16 push %1
 12937                              <2>         %elifidni %1, word fs
 12938                              <2>                 o16 push %1
 12939                              <2>         %elifidni %1, word gs
 12940                              <2>                 o16 push %1
 12941                              <2>         %else
 12942 00000F3A 66FF750C            <2>                 push %1
 12943                              <2>         %endif
 12944                              <2> 
 12945                              <2>         %rotate -1
 12946                              <2> 
 12947                              <2> 
 12948                              <2> 
 12949                              <2> 
 12950                              <2> 
 12951                              <2> 
 12952                              <2> 
 12953                              <2>         %ifidni %1, cs
 12954                              <2>                 o16 push %1
 12955                              <2>         %elifidni %1, ds
 12956                              <2>                 o16 push %1
 12957                              <2>         %elifidni %1, es
 12958                              <2>                 o16 push %1
 12959                              <2>         %elifidni %1, fs
 12960                              <2>                 o16 push %1
 12961                              <2>         %elifidni %1, gs
 12962                              <2>                 o16 push %1
 12963                              <2>         %elifidni %1, word cs
 12964                              <2>                 o16 push %1
 12965                              <2>         %elifidni %1, word ds
 12966                              <2>                 o16 push %1
 12967                              <2>         %elifidni %1, word es
 12968                              <2>                 o16 push %1
 12969                              <2>         %elifidni %1, word fs
 12970                              <2>                 o16 push %1
 12971                              <2>         %elifidni %1, word gs
 12972                              <2>                 o16 push %1
 12973                              <2>         %else
 12974 00000F3E 66680000            <2>                 push %1
 12975                              <2>         %endif
 12976                              <2> 
 12977                              <2>         %rotate -1
 12978                              <2> 
 12979                              <2> 
 12980                              <2> 
 12981                              <2> 
 12982                              <2> 
 12983                              <2> 
 12984                              <2> 
 12985                              <2>         %ifidni %1, cs
 12986                              <2>                 o16 push %1
 12987                              <2>         %elifidni %1, ds
 12988                              <2>                 o16 push %1
 12989                              <2>         %elifidni %1, es
 12990                              <2>                 o16 push %1
 12991                              <2>         %elifidni %1, fs
 12992                              <2>                 o16 push %1
 12993                              <2>         %elifidni %1, gs
 12994                              <2>                 o16 push %1
 12995                              <2>         %elifidni %1, word cs
 12996                              <2>                 o16 push %1
 12997                              <2>         %elifidni %1, word ds
 12998                              <2>                 o16 push %1
 12999                              <2>         %elifidni %1, word es
 13000                              <2>                 o16 push %1
 13001                              <2>         %elifidni %1, word fs
 13002                              <2>                 o16 push %1
 13003                              <2>         %elifidni %1, word gs
 13004                              <2>                 o16 push %1
 13005                              <2>         %else
 13006 00000F42 66680000            <2>                 push %1
 13007                              <2>         %endif
 13008                              <2> 
 13009                              <2>         %rotate -1
 13010                              <2> 
 13011                              <2> 
 13012                              <2> 
 13013                              <2> 
 13014                              <2> 
 13015                              <2> 
 13016                              <2> 
 13017                              <2>         %ifidni %1, cs
 13018                              <2>                 o16 push %1
 13019                              <2>         %elifidni %1, ds
 13020                              <2>                 o16 push %1
 13021                              <2>         %elifidni %1, es
 13022                              <2>                 o16 push %1
 13023                              <2>         %elifidni %1, fs
 13024                              <2>                 o16 push %1
 13025                              <2>         %elifidni %1, gs
 13026                              <2>                 o16 push %1
 13027                              <2>         %elifidni %1, word cs
 13028                              <2>                 o16 push %1
 13029                              <2>         %elifidni %1, word ds
 13030                              <2>                 o16 push %1
 13031                              <2>         %elifidni %1, word es
 13032                              <2>                 o16 push %1
 13033                              <2>         %elifidni %1, word fs
 13034                              <2>                 o16 push %1
 13035                              <2>         %elifidni %1, word gs
 13036                              <2>                 o16 push %1
 13037                              <2>         %else
 13038 00000F46 6657                <2>                 push %1
 13039                              <2>         %endif
 13040                              <2> 
 13041                              <2>         %rotate -1
 13042                              <2> 
 13043                              <2> 
 13044                              <2> 
 13045                              <2> 
 13046                              <2> 
 13047                              <2> 
 13048                              <2> 
 13049                              <2>         %ifidni %1, cs
 13050                              <2>                 o16 push %1
 13051                              <2>         %elifidni %1, ds
 13052                              <2>                 o16 push %1
 13053                              <2>         %elifidni %1, es
 13054                              <2>                 o16 push %1
 13055                              <2>         %elifidni %1, fs
 13056                              <2>                 o16 push %1
 13057                              <2>         %elifidni %1, gs
 13058                              <2>                 o16 push %1
 13059                              <2>         %elifidni %1, word cs
 13060                              <2>                 o16 push %1
 13061                              <2>         %elifidni %1, word ds
 13062                              <2>                 o16 push %1
 13063                              <2>         %elifidni %1, word es
 13064                              <2>                 o16 push %1
 13065                              <2>         %elifidni %1, word fs
 13066                              <2>                 o16 push %1
 13067                              <2>         %elifidni %1, word gs
 13068                              <2>                 o16 push %1
 13069                              <2>         %else
 13070 00000F48 6656                <2>                 push %1
 13071                              <2>         %endif
 13072                              <2> 
 13073                              <2>         %rotate -1
 13074 00000F4A E876F2FFFF          <1> call %1
 13075                              <1> %if (%0!=1)
 13076 00000F4F 83C40C              <1>         add esp, byte %1_arglen
 13077                              <1> %endif
 13078 00000F52 66FF450C                    inc word [ebp+.DestWidth]
 13079 00000F56 66FF450E                    inc word [ebp+.DestHeight]
 13080 00000F5A 85C0                        test eax, eax
 13081 00000F5C 0F8411000000                jz near .NextPoint			; If invalid point, don't enqueue it
 13082                                  
 13083                                      ; Enqueue(Point.x,Point.y-1)	; Top Point
 13084 00000F62 668933                      mov word [ebx], si
 13085 00000F65 66897B02                    mov word [ebx + 2], di
 13086 00000F69 8105[4E000000]0400-         add dword [_QueueTail], 4
 13087 00000F71 0000               
 13088                                  
 13089                                  
 13090                                      ;----------
 13091                                      .NextPoint:
 13092                                      ;----------
 13093 00000F73 6647                           inc di
 13094 00000F75 E91FFEFFFF                     jmp .PixelLoop
 13095                                  
 13096                                  
 13097                                      ;----
 13098                                      .End:
 13099                                      ;----
 13100 00000F7A 61                             popad
 13101                                         ret
 13102                              <1> %ifnctx proc
 13103                              <1> 	ret	%1
 13104                              <1> %else
 13105 00000F7B 89EC                <1> 	mov	esp, ebp
 13106 00000F7D 5D                  <1> 	pop	ebp
 13107 00000F7E C3                  <1> 	ret	%1
 13108                              <1> %endif
 13109                                  
 13110                                  
 13111                                  endproc
 13112                              <1> %ifnctx proc
 13113                              <1> %error Mismatched `endproc'/`proc'
 13114                              <1> %else
 13115                              <1> 
 13116                              <1> 
 13117                              <1> %ifdef LEGACY_ENDPROC
 13118                              <1>         ret
 13119                              <1> %endif
 13120                              <1> 
 13121                              <1> 
 13122                              <1> 
 13123                              <1> 
 13124                              <1> 
 13125                              <1> 
 13126                              <1> 
 13127                              <1> 
 13128                              <1> 
 13129                              <1> %pop
 13130                              <1> %endif
 13131                                  _FloodFill_arglen	EQU	20
 13132                                  
 13133                                  
 13134                                  
 13135                                  
 13136                                  
 13137                                  
 13138                                  ;-------------------------------------------------------------------------;
 13139                                  ; InstallKeyboard()							  ;
 13140                                  ;									  ;
 13141                                  ;   dword _InstallKeyboard(void)					  ;
 13142                                  ;									  ;
 13143                                  ;   Inputs: none							  ;
 13144                                  ;									  ;
 13145                                  ;   Outputs: none							  ;
 13146                                  ;									  ;
 13147                                  ;   Calls: _LockArea							  ;
 13148                                  ;									  ;
 13149                                  ;   Returns: 1 on error, 0 otherwise					  ;
 13150                                  ;									  ;
 13151                                  ;   Purpose: Installs the keyboard ISR					  ;
 13152                                  ;									  ;
 13153                                  ;-------------------------------------------------------------------------;
 13154                                  _InstallKeyboard
 13155                                  
 13156                                  
 13157                                  
 13158                                   ; int Install_Int(int num, unsigned int Handler_Address)
 13159 00000F7F 0FB605[02000000]         movzx eax, byte [_kbINT]
 13160                                   invoke _Install_Int, dword eax, dword _KeyboardISR
 13161                              <1> %rotate -1
 13162                              <1> 
 13163                              <1> %rep (%0-1)
 13164                              <1> 
 13165                              <1> 
 13166                              <1> 
 13167                              <1> 
 13168                              <1> 
 13169                              <1> 
 13170                              <1> 
 13171                              <1>         %ifidni %1, cs
 13172                              <1>                 o16 push %1
 13173                              <1>         %elifidni %1, ds
 13174                              <1>                 o16 push %1
 13175                              <1>         %elifidni %1, es
 13176                              <1>                 o16 push %1
 13177                              <1>         %elifidni %1, fs
 13178                              <1>                 o16 push %1
 13179                              <1>         %elifidni %1, gs
 13180                              <1>                 o16 push %1
 13181                              <1>         %elifidni %1, word cs
 13182                              <1>                 o16 push %1
 13183                              <1>         %elifidni %1, word ds
 13184                              <1>                 o16 push %1
 13185                              <1>         %elifidni %1, word es
 13186                              <1>                 o16 push %1
 13187                              <1>         %elifidni %1, word fs
 13188                              <1>                 o16 push %1
 13189                              <1>         %elifidni %1, word gs
 13190                              <1>                 o16 push %1
 13191                              <1>         %else
 13192                              <1>                 push %1
 13193                              <1>         %endif
 13194                              <1> 
 13195                              <1>         %rotate -1
 13196                              <1> %endrep
 13197                              <2> 
 13198                              <2> 
 13199                              <2> 
 13200                              <2> 
 13201                              <2> 
 13202                              <2> 
 13203                              <2> 
 13204                              <2>         %ifidni %1, cs
 13205                              <2>                 o16 push %1
 13206                              <2>         %elifidni %1, ds
 13207                              <2>                 o16 push %1
 13208                              <2>         %elifidni %1, es
 13209                              <2>                 o16 push %1
 13210                              <2>         %elifidni %1, fs
 13211                              <2>                 o16 push %1
 13212                              <2>         %elifidni %1, gs
 13213                              <2>                 o16 push %1
 13214                              <2>         %elifidni %1, word cs
 13215                              <2>                 o16 push %1
 13216                              <2>         %elifidni %1, word ds
 13217                              <2>                 o16 push %1
 13218                              <2>         %elifidni %1, word es
 13219                              <2>                 o16 push %1
 13220                              <2>         %elifidni %1, word fs
 13221                              <2>                 o16 push %1
 13222                              <2>         %elifidni %1, word gs
 13223                              <2>                 o16 push %1
 13224                              <2>         %else
 13225 00000F86 68[FA0F0000]        <2>                 push %1
 13226                              <2>         %endif
 13227                              <2> 
 13228                              <2>         %rotate -1
 13229                              <2> 
 13230                              <2> 
 13231                              <2> 
 13232                              <2> 
 13233                              <2> 
 13234                              <2> 
 13235                              <2> 
 13236                              <2>         %ifidni %1, cs
 13237                              <2>                 o16 push %1
 13238                              <2>         %elifidni %1, ds
 13239                              <2>                 o16 push %1
 13240                              <2>         %elifidni %1, es
 13241                              <2>                 o16 push %1
 13242                              <2>         %elifidni %1, fs
 13243                              <2>                 o16 push %1
 13244                              <2>         %elifidni %1, gs
 13245                              <2>                 o16 push %1
 13246                              <2>         %elifidni %1, word cs
 13247                              <2>                 o16 push %1
 13248                              <2>         %elifidni %1, word ds
 13249                              <2>                 o16 push %1
 13250                              <2>         %elifidni %1, word es
 13251                              <2>                 o16 push %1
 13252                              <2>         %elifidni %1, word fs
 13253                              <2>                 o16 push %1
 13254                              <2>         %elifidni %1, word gs
 13255                              <2>                 o16 push %1
 13256                              <2>         %else
 13257 00000F8B 50                  <2>                 push %1
 13258                              <2>         %endif
 13259                              <2> 
 13260                              <2>         %rotate -1
 13261 00000F8C E8(00000000)        <1> call %1
 13262                              <1> %if (%0!=1)
 13263 00000F91 83C408              <1>         add esp, byte %1_arglen
 13264                              <1> %endif
 13265 00000F94 85C0                     test eax, eax					; Library function in pmodelib
 13266 00000F96 7549                     jnz .Error					; Returns -1 on error
 13267                                  
 13268                                  
 13269                                  
 13270                                   ; Lock variables the interrupt with access (_KeyboardISR function)
 13271                                   ; bool LockArea(short Selector, unsigned int Offset, unsigned int Length)
 13272                                   invoke _LockArea, cs, dword _KeyboardISR, dword _KeyboardISR_end-_KeyboardISR
 13273                              <1> %rotate -1
 13274                              <1> 
 13275                              <1> %rep (%0-1)
 13276                              <1> 
 13277                              <1> 
 13278                              <1> 
 13279                              <1> 
 13280                              <1> 
 13281                              <1> 
 13282                              <1> 
 13283                              <1>         %ifidni %1, cs
 13284                              <1>                 o16 push %1
 13285                              <1>         %elifidni %1, ds
 13286                              <1>                 o16 push %1
 13287                              <1>         %elifidni %1, es
 13288                              <1>                 o16 push %1
 13289                              <1>         %elifidni %1, fs
 13290                              <1>                 o16 push %1
 13291                              <1>         %elifidni %1, gs
 13292                              <1>                 o16 push %1
 13293                              <1>         %elifidni %1, word cs
 13294                              <1>                 o16 push %1
 13295                              <1>         %elifidni %1, word ds
 13296                              <1>                 o16 push %1
 13297                              <1>         %elifidni %1, word es
 13298                              <1>                 o16 push %1
 13299                              <1>         %elifidni %1, word fs
 13300                              <1>                 o16 push %1
 13301                              <1>         %elifidni %1, word gs
 13302                              <1>                 o16 push %1
 13303                              <1>         %else
 13304                              <1>                 push %1
 13305                              <1>         %endif
 13306                              <1> 
 13307                              <1>         %rotate -1
 13308                              <1> %endrep
 13309                              <2> 
 13310                              <2> 
 13311                              <2> 
 13312                              <2> 
 13313                              <2> 
 13314                              <2> 
 13315                              <2> 
 13316                              <2>         %ifidni %1, cs
 13317                              <2>                 o16 push %1
 13318                              <2>         %elifidni %1, ds
 13319                              <2>                 o16 push %1
 13320                              <2>         %elifidni %1, es
 13321                              <2>                 o16 push %1
 13322                              <2>         %elifidni %1, fs
 13323                              <2>                 o16 push %1
 13324                              <2>         %elifidni %1, gs
 13325                              <2>                 o16 push %1
 13326                              <2>         %elifidni %1, word cs
 13327                              <2>                 o16 push %1
 13328                              <2>         %elifidni %1, word ds
 13329                              <2>                 o16 push %1
 13330                              <2>         %elifidni %1, word es
 13331                              <2>                 o16 push %1
 13332                              <2>         %elifidni %1, word fs
 13333                              <2>                 o16 push %1
 13334                              <2>         %elifidni %1, word gs
 13335                              <2>                 o16 push %1
 13336                              <2>         %else
 13337 00000F98 68D3000000          <2>                 push %1
 13338                              <2>         %endif
 13339                              <2> 
 13340                              <2>         %rotate -1
 13341                              <2> 
 13342                              <2> 
 13343                              <2> 
 13344                              <2> 
 13345                              <2> 
 13346                              <2> 
 13347                              <2> 
 13348                              <2>         %ifidni %1, cs
 13349                              <2>                 o16 push %1
 13350                              <2>         %elifidni %1, ds
 13351                              <2>                 o16 push %1
 13352                              <2>         %elifidni %1, es
 13353                              <2>                 o16 push %1
 13354                              <2>         %elifidni %1, fs
 13355                              <2>                 o16 push %1
 13356                              <2>         %elifidni %1, gs
 13357                              <2>                 o16 push %1
 13358                              <2>         %elifidni %1, word cs
 13359                              <2>                 o16 push %1
 13360                              <2>         %elifidni %1, word ds
 13361                              <2>                 o16 push %1
 13362                              <2>         %elifidni %1, word es
 13363                              <2>                 o16 push %1
 13364                              <2>         %elifidni %1, word fs
 13365                              <2>                 o16 push %1
 13366                              <2>         %elifidni %1, word gs
 13367                              <2>                 o16 push %1
 13368                              <2>         %else
 13369 00000F9D 68[FA0F0000]        <2>                 push %1
 13370                              <2>         %endif
 13371                              <2> 
 13372                              <2>         %rotate -1
 13373                              <2> 
 13374                              <2> 
 13375                              <2> 
 13376                              <2> 
 13377                              <2> 
 13378                              <2> 
 13379                              <2> 
 13380                              <2>         %ifidni %1, cs
 13381 00000FA2 660E                <2>                 o16 push %1
 13382                              <2>         %elifidni %1, ds
 13383                              <2>                 o16 push %1
 13384                              <2>         %elifidni %1, es
 13385                              <2>                 o16 push %1
 13386                              <2>         %elifidni %1, fs
 13387                              <2>                 o16 push %1
 13388                              <2>         %elifidni %1, gs
 13389                              <2>                 o16 push %1
 13390                              <2>         %elifidni %1, word cs
 13391                              <2>                 o16 push %1
 13392                              <2>         %elifidni %1, word ds
 13393                              <2>                 o16 push %1
 13394                              <2>         %elifidni %1, word es
 13395                              <2>                 o16 push %1
 13396                              <2>         %elifidni %1, word fs
 13397                              <2>                 o16 push %1
 13398                              <2>         %elifidni %1, word gs
 13399                              <2>                 o16 push %1
 13400                              <2>         %else
 13401                              <2>                 push %1
 13402                              <2>         %endif
 13403                              <2> 
 13404                              <2>         %rotate -1
 13405 00000FA4 E8(00000000)        <1> call %1
 13406                              <1> %if (%0!=1)
 13407 00000FA9 83C40A              <1>         add esp, byte %1_arglen
 13408                              <1> %endif
 13409 00000FAC 85C0                     test eax, eax
 13410 00000FAE 7531                     jnz .Error
 13411                                  
 13412                                  
 13413                                   ; Lock variables the interrupt with access (_MPFlags)
 13414                                   ; bool LockArea(short Selector, unsigned int Offset, unsigned int Length)
 13415                                   invoke _LockArea, ds, dword _MPFlags, dword 1
 13416                              <1> %rotate -1
 13417                              <1> 
 13418                              <1> %rep (%0-1)
 13419                              <1> 
 13420                              <1> 
 13421                              <1> 
 13422                              <1> 
 13423                              <1> 
 13424                              <1> 
 13425                              <1> 
 13426                              <1>         %ifidni %1, cs
 13427                              <1>                 o16 push %1
 13428                              <1>         %elifidni %1, ds
 13429                              <1>                 o16 push %1
 13430                              <1>         %elifidni %1, es
 13431                              <1>                 o16 push %1
 13432                              <1>         %elifidni %1, fs
 13433                              <1>                 o16 push %1
 13434                              <1>         %elifidni %1, gs
 13435                              <1>                 o16 push %1
 13436                              <1>         %elifidni %1, word cs
 13437                              <1>                 o16 push %1
 13438                              <1>         %elifidni %1, word ds
 13439                              <1>                 o16 push %1
 13440                              <1>         %elifidni %1, word es
 13441                              <1>                 o16 push %1
 13442                              <1>         %elifidni %1, word fs
 13443                              <1>                 o16 push %1
 13444                              <1>         %elifidni %1, word gs
 13445                              <1>                 o16 push %1
 13446                              <1>         %else
 13447                              <1>                 push %1
 13448                              <1>         %endif
 13449                              <1> 
 13450                              <1>         %rotate -1
 13451                              <1> %endrep
 13452                              <2> 
 13453                              <2> 
 13454                              <2> 
 13455                              <2> 
 13456                              <2> 
 13457                              <2> 
 13458                              <2> 
 13459                              <2>         %ifidni %1, cs
 13460                              <2>                 o16 push %1
 13461                              <2>         %elifidni %1, ds
 13462                              <2>                 o16 push %1
 13463                              <2>         %elifidni %1, es
 13464                              <2>                 o16 push %1
 13465                              <2>         %elifidni %1, fs
 13466                              <2>                 o16 push %1
 13467                              <2>         %elifidni %1, gs
 13468                              <2>                 o16 push %1
 13469                              <2>         %elifidni %1, word cs
 13470                              <2>                 o16 push %1
 13471                              <2>         %elifidni %1, word ds
 13472                              <2>                 o16 push %1
 13473                              <2>         %elifidni %1, word es
 13474                              <2>                 o16 push %1
 13475                              <2>         %elifidni %1, word fs
 13476                              <2>                 o16 push %1
 13477                              <2>         %elifidni %1, word gs
 13478                              <2>                 o16 push %1
 13479                              <2>         %else
 13480 00000FB0 6801000000          <2>                 push %1
 13481                              <2>         %endif
 13482                              <2> 
 13483                              <2>         %rotate -1
 13484                              <2> 
 13485                              <2> 
 13486                              <2> 
 13487                              <2> 
 13488                              <2> 
 13489                              <2> 
 13490                              <2> 
 13491                              <2>         %ifidni %1, cs
 13492                              <2>                 o16 push %1
 13493                              <2>         %elifidni %1, ds
 13494                              <2>                 o16 push %1
 13495                              <2>         %elifidni %1, es
 13496                              <2>                 o16 push %1
 13497                              <2>         %elifidni %1, fs
 13498                              <2>                 o16 push %1
 13499                              <2>         %elifidni %1, gs
 13500                              <2>                 o16 push %1
 13501                              <2>         %elifidni %1, word cs
 13502                              <2>                 o16 push %1
 13503                              <2>         %elifidni %1, word ds
 13504                              <2>                 o16 push %1
 13505                              <2>         %elifidni %1, word es
 13506                              <2>                 o16 push %1
 13507                              <2>         %elifidni %1, word fs
 13508                              <2>                 o16 push %1
 13509                              <2>         %elifidni %1, word gs
 13510                              <2>                 o16 push %1
 13511                              <2>         %else
 13512 00000FB5 68[26000000]        <2>                 push %1
 13513                              <2>         %endif
 13514                              <2> 
 13515                              <2>         %rotate -1
 13516                              <2> 
 13517                              <2> 
 13518                              <2> 
 13519                              <2> 
 13520                              <2> 
 13521                              <2> 
 13522                              <2> 
 13523                              <2>         %ifidni %1, cs
 13524                              <2>                 o16 push %1
 13525                              <2>         %elifidni %1, ds
 13526 00000FBA 661E                <2>                 o16 push %1
 13527                              <2>         %elifidni %1, es
 13528                              <2>                 o16 push %1
 13529                              <2>         %elifidni %1, fs
 13530                              <2>                 o16 push %1
 13531                              <2>         %elifidni %1, gs
 13532                              <2>                 o16 push %1
 13533                              <2>         %elifidni %1, word cs
 13534                              <2>                 o16 push %1
 13535                              <2>         %elifidni %1, word ds
 13536                              <2>                 o16 push %1
 13537                              <2>         %elifidni %1, word es
 13538                              <2>                 o16 push %1
 13539                              <2>         %elifidni %1, word fs
 13540                              <2>                 o16 push %1
 13541                              <2>         %elifidni %1, word gs
 13542                              <2>                 o16 push %1
 13543                              <2>         %else
 13544                              <2>                 push %1
 13545                              <2>         %endif
 13546                              <2> 
 13547                              <2>         %rotate -1
 13548 00000FBC E8(00000000)        <1> call %1
 13549                              <1> %if (%0!=1)
 13550 00000FC1 83C40A              <1>         add esp, byte %1_arglen
 13551                              <1> %endif
 13552 00000FC4 85C0                     test eax, eax
 13553 00000FC6 7519                     jnz .Error
 13554                                  
 13555                                  
 13556                                   ; Lock variables the interrupt with access (_key)
 13557                                   ; bool LockArea(short Selector, unsigned int Offset, unsigned int Length)
 13558                                   invoke _LockArea, ds, dword _key, dword 1
 13559                              <1> %rotate -1
 13560                              <1> 
 13561                              <1> %rep (%0-1)
 13562                              <1> 
 13563                              <1> 
 13564                              <1> 
 13565                              <1> 
 13566                              <1> 
 13567                              <1> 
 13568                              <1> 
 13569                              <1>         %ifidni %1, cs
 13570                              <1>                 o16 push %1
 13571                              <1>         %elifidni %1, ds
 13572                              <1>                 o16 push %1
 13573                              <1>         %elifidni %1, es
 13574                              <1>                 o16 push %1
 13575                              <1>         %elifidni %1, fs
 13576                              <1>                 o16 push %1
 13577                              <1>         %elifidni %1, gs
 13578                              <1>                 o16 push %1
 13579                              <1>         %elifidni %1, word cs
 13580                              <1>                 o16 push %1
 13581                              <1>         %elifidni %1, word ds
 13582                              <1>                 o16 push %1
 13583                              <1>         %elifidni %1, word es
 13584                              <1>                 o16 push %1
 13585                              <1>         %elifidni %1, word fs
 13586                              <1>                 o16 push %1
 13587                              <1>         %elifidni %1, word gs
 13588                              <1>                 o16 push %1
 13589                              <1>         %else
 13590                              <1>                 push %1
 13591                              <1>         %endif
 13592                              <1> 
 13593                              <1>         %rotate -1
 13594                              <1> %endrep
 13595                              <2> 
 13596                              <2> 
 13597                              <2> 
 13598                              <2> 
 13599                              <2> 
 13600                              <2> 
 13601                              <2> 
 13602                              <2>         %ifidni %1, cs
 13603                              <2>                 o16 push %1
 13604                              <2>         %elifidni %1, ds
 13605                              <2>                 o16 push %1
 13606                              <2>         %elifidni %1, es
 13607                              <2>                 o16 push %1
 13608                              <2>         %elifidni %1, fs
 13609                              <2>                 o16 push %1
 13610                              <2>         %elifidni %1, gs
 13611                              <2>                 o16 push %1
 13612                              <2>         %elifidni %1, word cs
 13613                              <2>                 o16 push %1
 13614                              <2>         %elifidni %1, word ds
 13615                              <2>                 o16 push %1
 13616                              <2>         %elifidni %1, word es
 13617                              <2>                 o16 push %1
 13618                              <2>         %elifidni %1, word fs
 13619                              <2>                 o16 push %1
 13620                              <2>         %elifidni %1, word gs
 13621                              <2>                 o16 push %1
 13622                              <2>         %else
 13623 00000FC8 6801000000          <2>                 push %1
 13624                              <2>         %endif
 13625                              <2> 
 13626                              <2>         %rotate -1
 13627                              <2> 
 13628                              <2> 
 13629                              <2> 
 13630                              <2> 
 13631                              <2> 
 13632                              <2> 
 13633                              <2> 
 13634                              <2>         %ifidni %1, cs
 13635                              <2>                 o16 push %1
 13636                              <2>         %elifidni %1, ds
 13637                              <2>                 o16 push %1
 13638                              <2>         %elifidni %1, es
 13639                              <2>                 o16 push %1
 13640                              <2>         %elifidni %1, fs
 13641                              <2>                 o16 push %1
 13642                              <2>         %elifidni %1, gs
 13643                              <2>                 o16 push %1
 13644                              <2>         %elifidni %1, word cs
 13645                              <2>                 o16 push %1
 13646                              <2>         %elifidni %1, word ds
 13647                              <2>                 o16 push %1
 13648                              <2>         %elifidni %1, word es
 13649                              <2>                 o16 push %1
 13650                              <2>         %elifidni %1, word fs
 13651                              <2>                 o16 push %1
 13652                              <2>         %elifidni %1, word gs
 13653                              <2>                 o16 push %1
 13654                              <2>         %else
 13655 00000FCD 68[52000000]        <2>                 push %1
 13656                              <2>         %endif
 13657                              <2> 
 13658                              <2>         %rotate -1
 13659                              <2> 
 13660                              <2> 
 13661                              <2> 
 13662                              <2> 
 13663                              <2> 
 13664                              <2> 
 13665                              <2> 
 13666                              <2>         %ifidni %1, cs
 13667                              <2>                 o16 push %1
 13668                              <2>         %elifidni %1, ds
 13669 00000FD2 661E                <2>                 o16 push %1
 13670                              <2>         %elifidni %1, es
 13671                              <2>                 o16 push %1
 13672                              <2>         %elifidni %1, fs
 13673                              <2>                 o16 push %1
 13674                              <2>         %elifidni %1, gs
 13675                              <2>                 o16 push %1
 13676                              <2>         %elifidni %1, word cs
 13677                              <2>                 o16 push %1
 13678                              <2>         %elifidni %1, word ds
 13679                              <2>                 o16 push %1
 13680                              <2>         %elifidni %1, word es
 13681                              <2>                 o16 push %1
 13682                              <2>         %elifidni %1, word fs
 13683                              <2>                 o16 push %1
 13684                              <2>         %elifidni %1, word gs
 13685                              <2>                 o16 push %1
 13686                              <2>         %else
 13687                              <2>                 push %1
 13688                              <2>         %endif
 13689                              <2> 
 13690                              <2>         %rotate -1
 13691 00000FD4 E8(00000000)        <1> call %1
 13692                              <1> %if (%0!=1)
 13693 00000FD9 83C40A              <1>         add esp, byte %1_arglen
 13694                              <1> %endif
 13695 00000FDC 85C0                     test eax, eax
 13696 00000FDE 7501                     jnz .Error
 13697                                   ret
 13698                              <1> %ifnctx proc
 13699 00000FE0 C3                  <1> 	ret	%1
 13700                              <1> %else
 13701                              <1> 	mov	esp, ebp
 13702                              <1> 	pop	ebp
 13703                              <1> 	ret	%1
 13704                              <1> %endif
 13705                                  
 13706                                  
 13707                                  
 13708                                   ;------
 13709                                   .Error:
 13710                                   ;------
 13711 00000FE1 B801000000                  mov eax, 1
 13712                                      ret
 13713                              <1> %ifnctx proc
 13714 00000FE6 C3                  <1> 	ret	%1
 13715                              <1> %else
 13716                              <1> 	mov	esp, ebp
 13717                              <1> 	pop	ebp
 13718                              <1> 	ret	%1
 13719                              <1> %endif
 13720                                  
 13721                                  
 13722                                  
 13723                                  
 13724                                  
 13725                                  
 13726                                  
 13727                                  ;-------------------------------------------------------------------------;
 13728                                  ; RemoveKeyboard()							  ;
 13729                                  ;									  ;
 13730                                  ;   void _RemoveKeyboard(void)						  ;
 13731                                  ;									  ;
 13732                                  ;   Inputs: none							  ;
 13733                                  ;									  ;
 13734                                  ;   Outputs: none							  ;
 13735                                  ;									  ;
 13736                                  ;   Calls: _Remove_Int							  ;
 13737                                  ;									  ;
 13738                                  ;   Returns: none							  ;
 13739                                  ;									  ;
 13740                                  ;   Purpose: Uninstalls the keyboard ISR				  ;
 13741                                  ;									  ;
 13742                                  ;-------------------------------------------------------------------------;
 13743                                  _RemoveKeyboard
 13744                                  
 13745 00000FE7 52                       push edx
 13746 00000FE8 0FB615[02000000]         movzx edx, byte [_kbINT]
 13747                                   invoke _Remove_Int, edx        ; Library function in pmodelib
 13748                              <1> %rotate -1
 13749                              <1> 
 13750                              <1> %rep (%0-1)
 13751                              <1> 
 13752                              <1> 
 13753                              <1> 
 13754                              <1> 
 13755                              <1> 
 13756                              <1> 
 13757                              <1> 
 13758                              <1>         %ifidni %1, cs
 13759                              <1>                 o16 push %1
 13760                              <1>         %elifidni %1, ds
 13761                              <1>                 o16 push %1
 13762                              <1>         %elifidni %1, es
 13763                              <1>                 o16 push %1
 13764                              <1>         %elifidni %1, fs
 13765                              <1>                 o16 push %1
 13766                              <1>         %elifidni %1, gs
 13767                              <1>                 o16 push %1
 13768                              <1>         %elifidni %1, word cs
 13769                              <1>                 o16 push %1
 13770                              <1>         %elifidni %1, word ds
 13771                              <1>                 o16 push %1
 13772                              <1>         %elifidni %1, word es
 13773                              <1>                 o16 push %1
 13774                              <1>         %elifidni %1, word fs
 13775                              <1>                 o16 push %1
 13776                              <1>         %elifidni %1, word gs
 13777                              <1>                 o16 push %1
 13778                              <1>         %else
 13779                              <1>                 push %1
 13780                              <1>         %endif
 13781                              <1> 
 13782                              <1>         %rotate -1
 13783                              <1> %endrep
 13784                              <2> 
 13785                              <2> 
 13786                              <2> 
 13787                              <2> 
 13788                              <2> 
 13789                              <2> 
 13790                              <2> 
 13791                              <2>         %ifidni %1, cs
 13792                              <2>                 o16 push %1
 13793                              <2>         %elifidni %1, ds
 13794                              <2>                 o16 push %1
 13795                              <2>         %elifidni %1, es
 13796                              <2>                 o16 push %1
 13797                              <2>         %elifidni %1, fs
 13798                              <2>                 o16 push %1
 13799                              <2>         %elifidni %1, gs
 13800                              <2>                 o16 push %1
 13801                              <2>         %elifidni %1, word cs
 13802                              <2>                 o16 push %1
 13803                              <2>         %elifidni %1, word ds
 13804                              <2>                 o16 push %1
 13805                              <2>         %elifidni %1, word es
 13806                              <2>                 o16 push %1
 13807                              <2>         %elifidni %1, word fs
 13808                              <2>                 o16 push %1
 13809                              <2>         %elifidni %1, word gs
 13810                              <2>                 o16 push %1
 13811                              <2>         %else
 13812 00000FEF 52                  <2>                 push %1
 13813                              <2>         %endif
 13814                              <2> 
 13815                              <2>         %rotate -1
 13816 00000FF0 E8(00000000)        <1> call %1
 13817                              <1> %if (%0!=1)
 13818 00000FF5 83C404              <1>         add esp, byte %1_arglen
 13819                              <1> %endif
 13820 00000FF8 5A                       pop edx			; Keyboard uses Interrupt [_kbINT]
 13821                                   ret
 13822                              <1> %ifnctx proc
 13823 00000FF9 C3                  <1> 	ret	%1
 13824                              <1> %else
 13825                              <1> 	mov	esp, ebp
 13826                              <1> 	pop	ebp
 13827                              <1> 	ret	%1
 13828                              <1> %endif
 13829                                  
 13830                                  
 13831                                  
 13832                                  
 13833                                  
 13834                                  
 13835                                  ;-------------------------------------------------------------------------;
 13836                                  ; KeyboardISR()								  ;
 13837                                  ;									  ;
 13838                                  ;   void _RemoveKeyboard(void)						  ;
 13839                                  ;									  ;
 13840                                  ;   Inputs: Keypress waiting at port [_kbPort], [_kbIRQ]		  ;
 13841                                  ;									  ;
 13842                                  ;   Outputs: [_key], [_MPFlags]						  ;
 13843                                  ;									  ;
 13844                                  ;   Calls: none								  ;
 13845                                  ;									  ;
 13846                                  ;   Returns: none							  ;
 13847                                  ;									  ;
 13848                                  ;   Purpose: Handles keyboard input from the user			  ;
 13849                                  ;									  ;
 13850                                  ;-------------------------------------------------------------------------;
 13851                                  _KeyboardISR
 13852                                  ;call	_libKeyboardISR	
 13853                                  ;ret
 13854                                  
 13855                                  
 13856 00000FFA 6650                     push ax
 13857 00000FFC 53                       push ebx
 13858 00000FFD 6651                     push cx
 13859 00000FFF 6652                     push dx
 13860                                  
 13861                                  
 13862                                  
 13863 00001001 668B15[04000000]         mov dx, word [_kbPort]
 13864 00001008 EC                       in al, dx					; al = scancode
 13865                                  
 13866 00001009 3C01                     cmp al, ESC					; Check for ESC scancode
 13867 0000100B 0F850C000000             jne near .NoQuit
 13868 00001011 800D[26000000]01         or byte [_MPFlags], 01h			; Set bit0 to exit program
 13869 00001018 E9A8000000               jmp near .Quit
 13870                                  
 13871                                  
 13872                                  
 13873                                   ;-------
 13874                                   .NoQuit:
 13875                                   ;-------
 13876 0000101D 8025[26000000]FE            and byte [_MPFlags], 11111110b		; Clear bit0 cause we ain't quittin
 13877 00001024 3C80                        cmp al, 80h					; Check for key press or release
 13878 00001026 0F8367000000                jnb near .KeyRelease
 13879                                  
 13880                                  
 13881                                   ;-------
 13882                                   ;LSHIFT:
 13883                                   ;-------
 13884 0000102C 3C2A                        cmp al, LSHIFT
 13885 0000102E 750C                        jne .Rshift
 13886 00001030 800D[26000000]10            or byte [_MPFlags], 00010000b		; Left shift key status set
 13887 00001037 E976000000                  jmp near .End
 13888                                  
 13889                                  
 13890                                   ;-------
 13891                                   .Rshift:
 13892                                   ;-------
 13893 0000103C 3C36                        cmp al, RSHIFT
 13894 0000103E 750C                        jne .OtherChar
 13895 00001040 800D[26000000]08            or byte [_MPFlags], 00001000b		; Right shift key status set
 13896 00001047 E966000000                  jmp near .End
 13897                                  
 13898                                  
 13899                                   ;----------
 13900                                   .OtherChar:
 13901                                   ;----------
 13902 0000104C 8A15[26000000]              mov dl, byte [_MPFlags]
 13903 00001052 80E218                      and dl, 00011000b				; Clear all status bits but shift status bits
 13904 00001055 84D2                        test dl, dl					; If shift status set, then shift is pressed down
 13905 00001057 0F851B000000                jnz near .Uppercase
 13906                                  
 13907                                  
 13908 0000105D 0FB6D8                      movzx ebx, al				; Otherwise, just get normal lowercase character
 13909 00001060 8A8B[A1000000]              mov cl, byte [_QwertyNames + ebx]
 13910 00001066 880D[52000000]              mov byte [_key], cl
 13911 0000106C 800D[26000000]20            or byte [_MPFlags], 00100000b		; Set "Key other than shift was pressed" status bit
 13912 00001073 E93A000000                  jmp near .End
 13913                                  
 13914                                  
 13915                                   ;----------
 13916                                   .Uppercase:
 13917                                   ;----------
 13918 00001078 0FB6D8                      movzx ebx, al				; Since shift is pressed, get uppercase character
 13919 0000107B 8A8B[F6000000]              mov cl, byte [_QwertyShift + ebx]
 13920 00001081 880D[52000000]              mov byte [_key], cl
 13921 00001087 800D[26000000]20            or byte [_MPFlags], 00100000b		; Set "Key other than shift was pressed" status bit
 13922 0000108E E91F000000                  jmp near .End
 13923                                  
 13924                                  
 13925                                  
 13926                                   ;-----------
 13927                                   .KeyRelease:
 13928                                   ;-----------
 13929 00001093 3CAA                        cmp al, 170
 13930 00001095 750C                        jne .KeyRelease2
 13931 00001097 8025[26000000]EF            and byte [_MPFlags], 11101111b		; Released LSHIFT
 13932 0000109E E90F000000                  jmp near .End
 13933                                  
 13934                                  
 13935                                  
 13936                                   ;------------
 13937                                   .KeyRelease2:
 13938                                   ;------------
 13939 000010A3 3CB6                        cmp al, 182
 13940 000010A5 0F8507000000                jne near .End
 13941 000010AB 8025[26000000]F7            and byte [_MPFlags], 11110111b		; Released RSHIFT
 13942                                  
 13943                                  
 13944                                  
 13945                                   ;----
 13946                                   .End:
 13947                                   ;----
 13948 000010B2 B020                        mov al, 20h
 13949 000010B4 E620                        out 20h, al				; Send an end-of-interrupt signal
 13950 000010B6 803D[03000000]08            cmp byte [_kbIRQ], 8
 13951 000010BD 0F8C02000000                jl near .Quit
 13952 000010C3 E6A0                        out 0A0h, al			; ACK with the slave PIC if IRQ > 7
 13953                                  
 13954                                  
 13955                                   ;-----
 13956                                   .Quit:
 13957                                   ;-----
 13958 000010C5 665A                        pop dx
 13959 000010C7 6659                        pop cx
 13960 000010C9 5B                          pop ebx
 13961 000010CA 6658                        pop ax
 13962                                      ret
 13963                              <1> %ifnctx proc
 13964 000010CC C3                  <1> 	ret	%1
 13965                              <1> %else
 13966                              <1> 	mov	esp, ebp
 13967                              <1> 	pop	ebp
 13968                              <1> 	ret	%1
 13969                              <1> %endif
 13970                                  
 13971                                  _KeyboardISR_end
 13972                                  
 13973                                  
 13974                                  
 13975                                  
 13976                                  
 13977                                  
 13978                                  
 13979                                  ;-------------------------------------------------------------------------;
 13980                                  ; InstallMouse()							  ;
 13981                                  ;									  ;
 13982                                  ;   dword _InstallMouse(void)						  ;
 13983                                  ;									  ;
 13984                                  ;   Inputs: none							  ;
 13985                                  ;									  ;
 13986                                  ;   Outputs: [_MouseSeg], [_MouseOff]					  ;
 13987                                  ;									  ;
 13988                                  ;   Calls: _LockArea, _Get_RMCB, DPMI_Int				  ;
 13989                                  ;									  ;
 13990                                  ;   Returns: 1 on error, 0 otherwise					  ;
 13991                                  ;									  ;
 13992                                  ;   Purpose: Installs the mouse callback				  ;
 13993                                  ;									  ;
 13994                                  ;-------------------------------------------------------------------------;
 13995                                  _InstallMouse
 13996                                  ;call	_libInstallMouse
 13997                                  ;ret
 13998                                  	
 13999                                  
 14000                                  
 14001                                  
 14002 000010CD 53                       push ebx
 14003 000010CE 6651                     push cx
 14004 000010D0 6652                     push dx
 14005                                  
 14006                                   ; Lock variables the callback will access (MouseCallback routine, MouseX, MouseY, MPFlags)
 14007                                   invoke _LockArea, word cs, dword _MouseCallback, dword _MouseCallback_end-_MouseCallback
 14008                              <1> %rotate -1
 14009                              <1> 
 14010                              <1> %rep (%0-1)
 14011                              <1> 
 14012                              <1> 
 14013                              <1> 
 14014                              <1> 
 14015                              <1> 
 14016                              <1> 
 14017                              <1> 
 14018                              <1>         %ifidni %1, cs
 14019                              <1>                 o16 push %1
 14020                              <1>         %elifidni %1, ds
 14021                              <1>                 o16 push %1
 14022                              <1>         %elifidni %1, es
 14023                              <1>                 o16 push %1
 14024                              <1>         %elifidni %1, fs
 14025                              <1>                 o16 push %1
 14026                              <1>         %elifidni %1, gs
 14027                              <1>                 o16 push %1
 14028                              <1>         %elifidni %1, word cs
 14029                              <1>                 o16 push %1
 14030                              <1>         %elifidni %1, word ds
 14031                              <1>                 o16 push %1
 14032                              <1>         %elifidni %1, word es
 14033                              <1>                 o16 push %1
 14034                              <1>         %elifidni %1, word fs
 14035                              <1>                 o16 push %1
 14036                              <1>         %elifidni %1, word gs
 14037                              <1>                 o16 push %1
 14038                              <1>         %else
 14039                              <1>                 push %1
 14040                              <1>         %endif
 14041                              <1> 
 14042                              <1>         %rotate -1
 14043                              <1> %endrep
 14044                              <2> 
 14045                              <2> 
 14046                              <2> 
 14047                              <2> 
 14048                              <2> 
 14049                              <2> 
 14050                              <2> 
 14051                              <2>         %ifidni %1, cs
 14052                              <2>                 o16 push %1
 14053                              <2>         %elifidni %1, ds
 14054                              <2>                 o16 push %1
 14055                              <2>         %elifidni %1, es
 14056                              <2>                 o16 push %1
 14057                              <2>         %elifidni %1, fs
 14058                              <2>                 o16 push %1
 14059                              <2>         %elifidni %1, gs
 14060                              <2>                 o16 push %1
 14061                              <2>         %elifidni %1, word cs
 14062                              <2>                 o16 push %1
 14063                              <2>         %elifidni %1, word ds
 14064                              <2>                 o16 push %1
 14065                              <2>         %elifidni %1, word es
 14066                              <2>                 o16 push %1
 14067                              <2>         %elifidni %1, word fs
 14068                              <2>                 o16 push %1
 14069                              <2>         %elifidni %1, word gs
 14070                              <2>                 o16 push %1
 14071                              <2>         %else
 14072 000010D2 686C000000          <2>                 push %1
 14073                              <2>         %endif
 14074                              <2> 
 14075                              <2>         %rotate -1
 14076                              <2> 
 14077                              <2> 
 14078                              <2> 
 14079                              <2> 
 14080                              <2> 
 14081                              <2> 
 14082                              <2> 
 14083                              <2>         %ifidni %1, cs
 14084                              <2>                 o16 push %1
 14085                              <2>         %elifidni %1, ds
 14086                              <2>                 o16 push %1
 14087                              <2>         %elifidni %1, es
 14088                              <2>                 o16 push %1
 14089                              <2>         %elifidni %1, fs
 14090                              <2>                 o16 push %1
 14091                              <2>         %elifidni %1, gs
 14092                              <2>                 o16 push %1
 14093                              <2>         %elifidni %1, word cs
 14094                              <2>                 o16 push %1
 14095                              <2>         %elifidni %1, word ds
 14096                              <2>                 o16 push %1
 14097                              <2>         %elifidni %1, word es
 14098                              <2>                 o16 push %1
 14099                              <2>         %elifidni %1, word fs
 14100                              <2>                 o16 push %1
 14101                              <2>         %elifidni %1, word gs
 14102                              <2>                 o16 push %1
 14103                              <2>         %else
 14104 000010D7 68[00120000]        <2>                 push %1
 14105                              <2>         %endif
 14106                              <2> 
 14107                              <2>         %rotate -1
 14108                              <2> 
 14109                              <2> 
 14110                              <2> 
 14111                              <2> 
 14112                              <2> 
 14113                              <2> 
 14114                              <2> 
 14115                              <2>         %ifidni %1, cs
 14116                              <2>                 o16 push %1
 14117                              <2>         %elifidni %1, ds
 14118                              <2>                 o16 push %1
 14119                              <2>         %elifidni %1, es
 14120                              <2>                 o16 push %1
 14121                              <2>         %elifidni %1, fs
 14122                              <2>                 o16 push %1
 14123                              <2>         %elifidni %1, gs
 14124                              <2>                 o16 push %1
 14125                              <2>         %elifidni %1, word cs
 14126 000010DC 660E                <2>                 o16 push %1
 14127                              <2>         %elifidni %1, word ds
 14128                              <2>                 o16 push %1
 14129                              <2>         %elifidni %1, word es
 14130                              <2>                 o16 push %1
 14131                              <2>         %elifidni %1, word fs
 14132                              <2>                 o16 push %1
 14133                              <2>         %elifidni %1, word gs
 14134                              <2>                 o16 push %1
 14135                              <2>         %else
 14136                              <2>                 push %1
 14137                              <2>         %endif
 14138                              <2> 
 14139                              <2>         %rotate -1
 14140 000010DE E8(00000000)        <1> call %1
 14141                              <1> %if (%0!=1)
 14142 000010E3 83C40A              <1>         add esp, byte %1_arglen
 14143                              <1> %endif
 14144 000010E6 85C0                     test eax, eax
 14145 000010E8 0F85B5000000             jnz near .Error
 14146                                  
 14147                                   invoke _LockArea, word ds, dword _MouseX, dword 2
 14148                              <1> %rotate -1
 14149                              <1> 
 14150                              <1> %rep (%0-1)
 14151                              <1> 
 14152                              <1> 
 14153                              <1> 
 14154                              <1> 
 14155                              <1> 
 14156                              <1> 
 14157                              <1> 
 14158                              <1>         %ifidni %1, cs
 14159                              <1>                 o16 push %1
 14160                              <1>         %elifidni %1, ds
 14161                              <1>                 o16 push %1
 14162                              <1>         %elifidni %1, es
 14163                              <1>                 o16 push %1
 14164                              <1>         %elifidni %1, fs
 14165                              <1>                 o16 push %1
 14166                              <1>         %elifidni %1, gs
 14167                              <1>                 o16 push %1
 14168                              <1>         %elifidni %1, word cs
 14169                              <1>                 o16 push %1
 14170                              <1>         %elifidni %1, word ds
 14171                              <1>                 o16 push %1
 14172                              <1>         %elifidni %1, word es
 14173                              <1>                 o16 push %1
 14174                              <1>         %elifidni %1, word fs
 14175                              <1>                 o16 push %1
 14176                              <1>         %elifidni %1, word gs
 14177                              <1>                 o16 push %1
 14178                              <1>         %else
 14179                              <1>                 push %1
 14180                              <1>         %endif
 14181                              <1> 
 14182                              <1>         %rotate -1
 14183                              <1> %endrep
 14184                              <2> 
 14185                              <2> 
 14186                              <2> 
 14187                              <2> 
 14188                              <2> 
 14189                              <2> 
 14190                              <2> 
 14191                              <2>         %ifidni %1, cs
 14192                              <2>                 o16 push %1
 14193                              <2>         %elifidni %1, ds
 14194                              <2>                 o16 push %1
 14195                              <2>         %elifidni %1, es
 14196                              <2>                 o16 push %1
 14197                              <2>         %elifidni %1, fs
 14198                              <2>                 o16 push %1
 14199                              <2>         %elifidni %1, gs
 14200                              <2>                 o16 push %1
 14201                              <2>         %elifidni %1, word cs
 14202                              <2>                 o16 push %1
 14203                              <2>         %elifidni %1, word ds
 14204                              <2>                 o16 push %1
 14205                              <2>         %elifidni %1, word es
 14206                              <2>                 o16 push %1
 14207                              <2>         %elifidni %1, word fs
 14208                              <2>                 o16 push %1
 14209                              <2>         %elifidni %1, word gs
 14210                              <2>                 o16 push %1
 14211                              <2>         %else
 14212 000010EE 6802000000          <2>                 push %1
 14213                              <2>         %endif
 14214                              <2> 
 14215                              <2>         %rotate -1
 14216                              <2> 
 14217                              <2> 
 14218                              <2> 
 14219                              <2> 
 14220                              <2> 
 14221                              <2> 
 14222                              <2> 
 14223                              <2>         %ifidni %1, cs
 14224                              <2>                 o16 push %1
 14225                              <2>         %elifidni %1, ds
 14226                              <2>                 o16 push %1
 14227                              <2>         %elifidni %1, es
 14228                              <2>                 o16 push %1
 14229                              <2>         %elifidni %1, fs
 14230                              <2>                 o16 push %1
 14231                              <2>         %elifidni %1, gs
 14232                              <2>                 o16 push %1
 14233                              <2>         %elifidni %1, word cs
 14234                              <2>                 o16 push %1
 14235                              <2>         %elifidni %1, word ds
 14236                              <2>                 o16 push %1
 14237                              <2>         %elifidni %1, word es
 14238                              <2>                 o16 push %1
 14239                              <2>         %elifidni %1, word fs
 14240                              <2>                 o16 push %1
 14241                              <2>         %elifidni %1, word gs
 14242                              <2>                 o16 push %1
 14243                              <2>         %else
 14244 000010F3 68[0A000000]        <2>                 push %1
 14245                              <2>         %endif
 14246                              <2> 
 14247                              <2>         %rotate -1
 14248                              <2> 
 14249                              <2> 
 14250                              <2> 
 14251                              <2> 
 14252                              <2> 
 14253                              <2> 
 14254                              <2> 
 14255                              <2>         %ifidni %1, cs
 14256                              <2>                 o16 push %1
 14257                              <2>         %elifidni %1, ds
 14258                              <2>                 o16 push %1
 14259                              <2>         %elifidni %1, es
 14260                              <2>                 o16 push %1
 14261                              <2>         %elifidni %1, fs
 14262                              <2>                 o16 push %1
 14263                              <2>         %elifidni %1, gs
 14264                              <2>                 o16 push %1
 14265                              <2>         %elifidni %1, word cs
 14266                              <2>                 o16 push %1
 14267                              <2>         %elifidni %1, word ds
 14268 000010F8 661E                <2>                 o16 push %1
 14269                              <2>         %elifidni %1, word es
 14270                              <2>                 o16 push %1
 14271                              <2>         %elifidni %1, word fs
 14272                              <2>                 o16 push %1
 14273                              <2>         %elifidni %1, word gs
 14274                              <2>                 o16 push %1
 14275                              <2>         %else
 14276                              <2>                 push %1
 14277                              <2>         %endif
 14278                              <2> 
 14279                              <2>         %rotate -1
 14280 000010FA E8(00000000)        <1> call %1
 14281                              <1> %if (%0!=1)
 14282 000010FF 83C40A              <1>         add esp, byte %1_arglen
 14283                              <1> %endif
 14284 00001102 85C0                     test eax, eax
 14285 00001104 0F8599000000             jnz near .Error
 14286                                  
 14287                                  
 14288                                   invoke _LockArea, word ds, dword _MouseY, dword 2
 14289                              <1> %rotate -1
 14290                              <1> 
 14291                              <1> %rep (%0-1)
 14292                              <1> 
 14293                              <1> 
 14294                              <1> 
 14295                              <1> 
 14296                              <1> 
 14297                              <1> 
 14298                              <1> 
 14299                              <1>         %ifidni %1, cs
 14300                              <1>                 o16 push %1
 14301                              <1>         %elifidni %1, ds
 14302                              <1>                 o16 push %1
 14303                              <1>         %elifidni %1, es
 14304                              <1>                 o16 push %1
 14305                              <1>         %elifidni %1, fs
 14306                              <1>                 o16 push %1
 14307                              <1>         %elifidni %1, gs
 14308                              <1>                 o16 push %1
 14309                              <1>         %elifidni %1, word cs
 14310                              <1>                 o16 push %1
 14311                              <1>         %elifidni %1, word ds
 14312                              <1>                 o16 push %1
 14313                              <1>         %elifidni %1, word es
 14314                              <1>                 o16 push %1
 14315                              <1>         %elifidni %1, word fs
 14316                              <1>                 o16 push %1
 14317                              <1>         %elifidni %1, word gs
 14318                              <1>                 o16 push %1
 14319                              <1>         %else
 14320                              <1>                 push %1
 14321                              <1>         %endif
 14322                              <1> 
 14323                              <1>         %rotate -1
 14324                              <1> %endrep
 14325                              <2> 
 14326                              <2> 
 14327                              <2> 
 14328                              <2> 
 14329                              <2> 
 14330                              <2> 
 14331                              <2> 
 14332                              <2>         %ifidni %1, cs
 14333                              <2>                 o16 push %1
 14334                              <2>         %elifidni %1, ds
 14335                              <2>                 o16 push %1
 14336                              <2>         %elifidni %1, es
 14337                              <2>                 o16 push %1
 14338                              <2>         %elifidni %1, fs
 14339                              <2>                 o16 push %1
 14340                              <2>         %elifidni %1, gs
 14341                              <2>                 o16 push %1
 14342                              <2>         %elifidni %1, word cs
 14343                              <2>                 o16 push %1
 14344                              <2>         %elifidni %1, word ds
 14345                              <2>                 o16 push %1
 14346                              <2>         %elifidni %1, word es
 14347                              <2>                 o16 push %1
 14348                              <2>         %elifidni %1, word fs
 14349                              <2>                 o16 push %1
 14350                              <2>         %elifidni %1, word gs
 14351                              <2>                 o16 push %1
 14352                              <2>         %else
 14353 0000110A 6802000000          <2>                 push %1
 14354                              <2>         %endif
 14355                              <2> 
 14356                              <2>         %rotate -1
 14357                              <2> 
 14358                              <2> 
 14359                              <2> 
 14360                              <2> 
 14361                              <2> 
 14362                              <2> 
 14363                              <2> 
 14364                              <2>         %ifidni %1, cs
 14365                              <2>                 o16 push %1
 14366                              <2>         %elifidni %1, ds
 14367                              <2>                 o16 push %1
 14368                              <2>         %elifidni %1, es
 14369                              <2>                 o16 push %1
 14370                              <2>         %elifidni %1, fs
 14371                              <2>                 o16 push %1
 14372                              <2>         %elifidni %1, gs
 14373                              <2>                 o16 push %1
 14374                              <2>         %elifidni %1, word cs
 14375                              <2>                 o16 push %1
 14376                              <2>         %elifidni %1, word ds
 14377                              <2>                 o16 push %1
 14378                              <2>         %elifidni %1, word es
 14379                              <2>                 o16 push %1
 14380                              <2>         %elifidni %1, word fs
 14381                              <2>                 o16 push %1
 14382                              <2>         %elifidni %1, word gs
 14383                              <2>                 o16 push %1
 14384                              <2>         %else
 14385 0000110F 68[0C000000]        <2>                 push %1
 14386                              <2>         %endif
 14387                              <2> 
 14388                              <2>         %rotate -1
 14389                              <2> 
 14390                              <2> 
 14391                              <2> 
 14392                              <2> 
 14393                              <2> 
 14394                              <2> 
 14395                              <2> 
 14396                              <2>         %ifidni %1, cs
 14397                              <2>                 o16 push %1
 14398                              <2>         %elifidni %1, ds
 14399                              <2>                 o16 push %1
 14400                              <2>         %elifidni %1, es
 14401                              <2>                 o16 push %1
 14402                              <2>         %elifidni %1, fs
 14403                              <2>                 o16 push %1
 14404                              <2>         %elifidni %1, gs
 14405                              <2>                 o16 push %1
 14406                              <2>         %elifidni %1, word cs
 14407                              <2>                 o16 push %1
 14408                              <2>         %elifidni %1, word ds
 14409 00001114 661E                <2>                 o16 push %1
 14410                              <2>         %elifidni %1, word es
 14411                              <2>                 o16 push %1
 14412                              <2>         %elifidni %1, word fs
 14413                              <2>                 o16 push %1
 14414                              <2>         %elifidni %1, word gs
 14415                              <2>                 o16 push %1
 14416                              <2>         %else
 14417                              <2>                 push %1
 14418                              <2>         %endif
 14419                              <2> 
 14420                              <2>         %rotate -1
 14421 00001116 E8(00000000)        <1> call %1
 14422                              <1> %if (%0!=1)
 14423 0000111B 83C40A              <1>         add esp, byte %1_arglen
 14424                              <1> %endif
 14425 0000111E 85C0                     test eax, eax
 14426 00001120 0F857D000000             jnz near .Error
 14427                                  
 14428                                  
 14429                                   invoke _LockArea, word ds, dword _MPFlags, dword 1
 14430                              <1> %rotate -1
 14431                              <1> 
 14432                              <1> %rep (%0-1)
 14433                              <1> 
 14434                              <1> 
 14435                              <1> 
 14436                              <1> 
 14437                              <1> 
 14438                              <1> 
 14439                              <1> 
 14440                              <1>         %ifidni %1, cs
 14441                              <1>                 o16 push %1
 14442                              <1>         %elifidni %1, ds
 14443                              <1>                 o16 push %1
 14444                              <1>         %elifidni %1, es
 14445                              <1>                 o16 push %1
 14446                              <1>         %elifidni %1, fs
 14447                              <1>                 o16 push %1
 14448                              <1>         %elifidni %1, gs
 14449                              <1>                 o16 push %1
 14450                              <1>         %elifidni %1, word cs
 14451                              <1>                 o16 push %1
 14452                              <1>         %elifidni %1, word ds
 14453                              <1>                 o16 push %1
 14454                              <1>         %elifidni %1, word es
 14455                              <1>                 o16 push %1
 14456                              <1>         %elifidni %1, word fs
 14457                              <1>                 o16 push %1
 14458                              <1>         %elifidni %1, word gs
 14459                              <1>                 o16 push %1
 14460                              <1>         %else
 14461                              <1>                 push %1
 14462                              <1>         %endif
 14463                              <1> 
 14464                              <1>         %rotate -1
 14465                              <1> %endrep
 14466                              <2> 
 14467                              <2> 
 14468                              <2> 
 14469                              <2> 
 14470                              <2> 
 14471                              <2> 
 14472                              <2> 
 14473                              <2>         %ifidni %1, cs
 14474                              <2>                 o16 push %1
 14475                              <2>         %elifidni %1, ds
 14476                              <2>                 o16 push %1
 14477                              <2>         %elifidni %1, es
 14478                              <2>                 o16 push %1
 14479                              <2>         %elifidni %1, fs
 14480                              <2>                 o16 push %1
 14481                              <2>         %elifidni %1, gs
 14482                              <2>                 o16 push %1
 14483                              <2>         %elifidni %1, word cs
 14484                              <2>                 o16 push %1
 14485                              <2>         %elifidni %1, word ds
 14486                              <2>                 o16 push %1
 14487                              <2>         %elifidni %1, word es
 14488                              <2>                 o16 push %1
 14489                              <2>         %elifidni %1, word fs
 14490                              <2>                 o16 push %1
 14491                              <2>         %elifidni %1, word gs
 14492                              <2>                 o16 push %1
 14493                              <2>         %else
 14494 00001126 6801000000          <2>                 push %1
 14495                              <2>         %endif
 14496                              <2> 
 14497                              <2>         %rotate -1
 14498                              <2> 
 14499                              <2> 
 14500                              <2> 
 14501                              <2> 
 14502                              <2> 
 14503                              <2> 
 14504                              <2> 
 14505                              <2>         %ifidni %1, cs
 14506                              <2>                 o16 push %1
 14507                              <2>         %elifidni %1, ds
 14508                              <2>                 o16 push %1
 14509                              <2>         %elifidni %1, es
 14510                              <2>                 o16 push %1
 14511                              <2>         %elifidni %1, fs
 14512                              <2>                 o16 push %1
 14513                              <2>         %elifidni %1, gs
 14514                              <2>                 o16 push %1
 14515                              <2>         %elifidni %1, word cs
 14516                              <2>                 o16 push %1
 14517                              <2>         %elifidni %1, word ds
 14518                              <2>                 o16 push %1
 14519                              <2>         %elifidni %1, word es
 14520                              <2>                 o16 push %1
 14521                              <2>         %elifidni %1, word fs
 14522                              <2>                 o16 push %1
 14523                              <2>         %elifidni %1, word gs
 14524                              <2>                 o16 push %1
 14525                              <2>         %else
 14526 0000112B 68[26000000]        <2>                 push %1
 14527                              <2>         %endif
 14528                              <2> 
 14529                              <2>         %rotate -1
 14530                              <2> 
 14531                              <2> 
 14532                              <2> 
 14533                              <2> 
 14534                              <2> 
 14535                              <2> 
 14536                              <2> 
 14537                              <2>         %ifidni %1, cs
 14538                              <2>                 o16 push %1
 14539                              <2>         %elifidni %1, ds
 14540                              <2>                 o16 push %1
 14541                              <2>         %elifidni %1, es
 14542                              <2>                 o16 push %1
 14543                              <2>         %elifidni %1, fs
 14544                              <2>                 o16 push %1
 14545                              <2>         %elifidni %1, gs
 14546                              <2>                 o16 push %1
 14547                              <2>         %elifidni %1, word cs
 14548                              <2>                 o16 push %1
 14549                              <2>         %elifidni %1, word ds
 14550 00001130 661E                <2>                 o16 push %1
 14551                              <2>         %elifidni %1, word es
 14552                              <2>                 o16 push %1
 14553                              <2>         %elifidni %1, word fs
 14554                              <2>                 o16 push %1
 14555                              <2>         %elifidni %1, word gs
 14556                              <2>                 o16 push %1
 14557                              <2>         %else
 14558                              <2>                 push %1
 14559                              <2>         %endif
 14560                              <2> 
 14561                              <2>         %rotate -1
 14562 00001132 E8(00000000)        <1> call %1
 14563                              <1> %if (%0!=1)
 14564 00001137 83C40A              <1>         add esp, byte %1_arglen
 14565                              <1> %endif
 14566 0000113A 85C0                     test eax, eax
 14567 0000113C 0F8561000000             jnz near .Error
 14568                                  	
 14569                                  
 14570                                  
 14571                                  
 14572                                   invoke _Get_RMCB, dword _MouseSeg, dword _MouseOff, dword _MouseCallback, dword 1
 14573                              <1> %rotate -1
 14574                              <1> 
 14575                              <1> %rep (%0-1)
 14576                              <1> 
 14577                              <1> 
 14578                              <1> 
 14579                              <1> 
 14580                              <1> 
 14581                              <1> 
 14582                              <1> 
 14583                              <1>         %ifidni %1, cs
 14584                              <1>                 o16 push %1
 14585                              <1>         %elifidni %1, ds
 14586                              <1>                 o16 push %1
 14587                              <1>         %elifidni %1, es
 14588                              <1>                 o16 push %1
 14589                              <1>         %elifidni %1, fs
 14590                              <1>                 o16 push %1
 14591                              <1>         %elifidni %1, gs
 14592                              <1>                 o16 push %1
 14593                              <1>         %elifidni %1, word cs
 14594                              <1>                 o16 push %1
 14595                              <1>         %elifidni %1, word ds
 14596                              <1>                 o16 push %1
 14597                              <1>         %elifidni %1, word es
 14598                              <1>                 o16 push %1
 14599                              <1>         %elifidni %1, word fs
 14600                              <1>                 o16 push %1
 14601                              <1>         %elifidni %1, word gs
 14602                              <1>                 o16 push %1
 14603                              <1>         %else
 14604                              <1>                 push %1
 14605                              <1>         %endif
 14606                              <1> 
 14607                              <1>         %rotate -1
 14608                              <1> %endrep
 14609                              <2> 
 14610                              <2> 
 14611                              <2> 
 14612                              <2> 
 14613                              <2> 
 14614                              <2> 
 14615                              <2> 
 14616                              <2>         %ifidni %1, cs
 14617                              <2>                 o16 push %1
 14618                              <2>         %elifidni %1, ds
 14619                              <2>                 o16 push %1
 14620                              <2>         %elifidni %1, es
 14621                              <2>                 o16 push %1
 14622                              <2>         %elifidni %1, fs
 14623                              <2>                 o16 push %1
 14624                              <2>         %elifidni %1, gs
 14625                              <2>                 o16 push %1
 14626                              <2>         %elifidni %1, word cs
 14627                              <2>                 o16 push %1
 14628                              <2>         %elifidni %1, word ds
 14629                              <2>                 o16 push %1
 14630                              <2>         %elifidni %1, word es
 14631                              <2>                 o16 push %1
 14632                              <2>         %elifidni %1, word fs
 14633                              <2>                 o16 push %1
 14634                              <2>         %elifidni %1, word gs
 14635                              <2>                 o16 push %1
 14636                              <2>         %else
 14637 00001142 6801000000          <2>                 push %1
 14638                              <2>         %endif
 14639                              <2> 
 14640                              <2>         %rotate -1
 14641                              <2> 
 14642                              <2> 
 14643                              <2> 
 14644                              <2> 
 14645                              <2> 
 14646                              <2> 
 14647                              <2> 
 14648                              <2>         %ifidni %1, cs
 14649                              <2>                 o16 push %1
 14650                              <2>         %elifidni %1, ds
 14651                              <2>                 o16 push %1
 14652                              <2>         %elifidni %1, es
 14653                              <2>                 o16 push %1
 14654                              <2>         %elifidni %1, fs
 14655                              <2>                 o16 push %1
 14656                              <2>         %elifidni %1, gs
 14657                              <2>                 o16 push %1
 14658                              <2>         %elifidni %1, word cs
 14659                              <2>                 o16 push %1
 14660                              <2>         %elifidni %1, word ds
 14661                              <2>                 o16 push %1
 14662                              <2>         %elifidni %1, word es
 14663                              <2>                 o16 push %1
 14664                              <2>         %elifidni %1, word fs
 14665                              <2>                 o16 push %1
 14666                              <2>         %elifidni %1, word gs
 14667                              <2>                 o16 push %1
 14668                              <2>         %else
 14669 00001147 68[00120000]        <2>                 push %1
 14670                              <2>         %endif
 14671                              <2> 
 14672                              <2>         %rotate -1
 14673                              <2> 
 14674                              <2> 
 14675                              <2> 
 14676                              <2> 
 14677                              <2> 
 14678                              <2> 
 14679                              <2> 
 14680                              <2>         %ifidni %1, cs
 14681                              <2>                 o16 push %1
 14682                              <2>         %elifidni %1, ds
 14683                              <2>                 o16 push %1
 14684                              <2>         %elifidni %1, es
 14685                              <2>                 o16 push %1
 14686                              <2>         %elifidni %1, fs
 14687                              <2>                 o16 push %1
 14688                              <2>         %elifidni %1, gs
 14689                              <2>                 o16 push %1
 14690                              <2>         %elifidni %1, word cs
 14691                              <2>                 o16 push %1
 14692                              <2>         %elifidni %1, word ds
 14693                              <2>                 o16 push %1
 14694                              <2>         %elifidni %1, word es
 14695                              <2>                 o16 push %1
 14696                              <2>         %elifidni %1, word fs
 14697                              <2>                 o16 push %1
 14698                              <2>         %elifidni %1, word gs
 14699                              <2>                 o16 push %1
 14700                              <2>         %else
 14701 0000114C 68[08000000]        <2>                 push %1
 14702                              <2>         %endif
 14703                              <2> 
 14704                              <2>         %rotate -1
 14705                              <2> 
 14706                              <2> 
 14707                              <2> 
 14708                              <2> 
 14709                              <2> 
 14710                              <2> 
 14711                              <2> 
 14712                              <2>         %ifidni %1, cs
 14713                              <2>                 o16 push %1
 14714                              <2>         %elifidni %1, ds
 14715                              <2>                 o16 push %1
 14716                              <2>         %elifidni %1, es
 14717                              <2>                 o16 push %1
 14718                              <2>         %elifidni %1, fs
 14719                              <2>                 o16 push %1
 14720                              <2>         %elifidni %1, gs
 14721                              <2>                 o16 push %1
 14722                              <2>         %elifidni %1, word cs
 14723                              <2>                 o16 push %1
 14724                              <2>         %elifidni %1, word ds
 14725                              <2>                 o16 push %1
 14726                              <2>         %elifidni %1, word es
 14727                              <2>                 o16 push %1
 14728                              <2>         %elifidni %1, word fs
 14729                              <2>                 o16 push %1
 14730                              <2>         %elifidni %1, word gs
 14731                              <2>                 o16 push %1
 14732                              <2>         %else
 14733 00001151 68[06000000]        <2>                 push %1
 14734                              <2>         %endif
 14735                              <2> 
 14736                              <2>         %rotate -1
 14737 00001156 E8(00000000)        <1> call %1
 14738                              <1> %if (%0!=1)
 14739 0000115B 83C410              <1>         add esp, byte %1_arglen
 14740                              <1> %endif
 14741 0000115E 85C0                     test eax, eax
 14742 00001160 0F853D000000             jnz near .Error
 14743                                  
 14744                                  
 14745                                  
 14746 00001166 66C705[00000000]0C-      mov word [DPMI_EAX], 0Ch
 14747 0000116E 00                 
 14748 0000116F 66C705[00000000]07-      mov word [DPMI_ECX], 07h
 14749 00001177 00                 
 14750                                  
 14751                                  
 14752 00001178 66A1[06000000]           mov ax, word [_MouseSeg]
 14753 0000117E 66A3[00000000]           mov word [DPMI_ES], ax
 14754 00001184 66A1[08000000]           mov ax, word [_MouseOff]
 14755 0000118A 66A3[00000000]           mov word [DPMI_EDX], ax
 14756                                  
 14757 00001190 66BB3300                 mov bx, 33h
 14758 00001194 E8(00000000)             call DPMI_Int			; DPMI_Int sets carryflag if error occured
 14759 00001199 7208                     jc .Error
 14760                                  
 14761                                  
 14762 0000119B 665A                     pop dx
 14763 0000119D 6659                     pop cx
 14764 0000119F 5B                       pop ebx
 14765 000011A0 31C0                     xor eax, eax
 14766                                   ret
 14767                              <1> %ifnctx proc
 14768 000011A2 C3                  <1> 	ret	%1
 14769                              <1> %else
 14770                              <1> 	mov	esp, ebp
 14771                              <1> 	pop	ebp
 14772                              <1> 	ret	%1
 14773                              <1> %endif
 14774                                  
 14775                                  
 14776                                   ;------
 14777                                   .Error:
 14778                                   ;------
 14779 000011A3 665A                        pop dx
 14780 000011A5 6659                        pop cx
 14781 000011A7 5B                          pop ebx
 14782 000011A8 B801000000                  mov eax, 1
 14783                                      ret
 14784                              <1> %ifnctx proc
 14785 000011AD C3                  <1> 	ret	%1
 14786                              <1> %else
 14787                              <1> 	mov	esp, ebp
 14788                              <1> 	pop	ebp
 14789                              <1> 	ret	%1
 14790                              <1> %endif
 14791                                  
 14792                                  
 14793                                  
 14794                                  
 14795                                  
 14796                                  
 14797                                  ;-------------------------------------------------------------------------;
 14798                                  ; RemoveMouse()								  ;
 14799                                  ;									  ;
 14800                                  ;   void _RemoveMouse(void)						  ;
 14801                                  ;									  ;
 14802                                  ;   Inputs: [_MouseSeg], [_MouseOff]					  ;
 14803                                  ;									  ;
 14804                                  ;   Outputs: none							  ;
 14805                                  ;									  ;
 14806                                  ;   Calls: _Free_RMCB, DPMI_Int						  ;
 14807                                  ;									  ;
 14808                                  ;   Returns: none							  ;
 14809                                  ;									  ;
 14810                                  ;   Purpose: Removes the mouse callback					  ;
 14811                                  ;									  ;
 14812                                  ;-------------------------------------------------------------------------;
 14813                                  _RemoveMouse
 14814                                          ;call	_libRemoveMouse
 14815                                          ;ret
 14816                                  
 14817                                  
 14818                                  
 14819 000011AE 6650                     push ax
 14820 000011B0 6653                     push bx
 14821 000011B2 6651                     push cx
 14822 000011B4 6652                     push dx
 14823                                  
 14824 000011B6 C705[00000000]0C00-      mov dword [DPMI_EAX], 0Ch
 14825 000011BE 0000               
 14826 000011C0 C705[00000000]0000-      mov dword [DPMI_ECX], 0
 14827 000011C8 0000               
 14828 000011CA C705[00000000]0000-      mov dword [DPMI_ES], 0
 14829 000011D2 0000               
 14830 000011D4 C705[00000000]0000-      mov dword [DPMI_EDX], 0
 14831 000011DC 0000               
 14832                                  
 14833 000011DE 66BB3300                 mov bx, 33h
 14834 000011E2 E8(00000000)             call DPMI_Int
 14835                                  
 14836                                   invoke _Free_RMCB, word 0, word 0
 14837                              <1> %rotate -1
 14838                              <1> 
 14839                              <1> %rep (%0-1)
 14840                              <1> 
 14841                              <1> 
 14842                              <1> 
 14843                              <1> 
 14844                              <1> 
 14845                              <1> 
 14846                              <1> 
 14847                              <1>         %ifidni %1, cs
 14848                              <1>                 o16 push %1
 14849                              <1>         %elifidni %1, ds
 14850                              <1>                 o16 push %1
 14851                              <1>         %elifidni %1, es
 14852                              <1>                 o16 push %1
 14853                              <1>         %elifidni %1, fs
 14854                              <1>                 o16 push %1
 14855                              <1>         %elifidni %1, gs
 14856                              <1>                 o16 push %1
 14857                              <1>         %elifidni %1, word cs
 14858                              <1>                 o16 push %1
 14859                              <1>         %elifidni %1, word ds
 14860                              <1>                 o16 push %1
 14861                              <1>         %elifidni %1, word es
 14862                              <1>                 o16 push %1
 14863                              <1>         %elifidni %1, word fs
 14864                              <1>                 o16 push %1
 14865                              <1>         %elifidni %1, word gs
 14866                              <1>                 o16 push %1
 14867                              <1>         %else
 14868                              <1>                 push %1
 14869                              <1>         %endif
 14870                              <1> 
 14871                              <1>         %rotate -1
 14872                              <1> %endrep
 14873                              <2> 
 14874                              <2> 
 14875                              <2> 
 14876                              <2> 
 14877                              <2> 
 14878                              <2> 
 14879                              <2> 
 14880                              <2>         %ifidni %1, cs
 14881                              <2>                 o16 push %1
 14882                              <2>         %elifidni %1, ds
 14883                              <2>                 o16 push %1
 14884                              <2>         %elifidni %1, es
 14885                              <2>                 o16 push %1
 14886                              <2>         %elifidni %1, fs
 14887                              <2>                 o16 push %1
 14888                              <2>         %elifidni %1, gs
 14889                              <2>                 o16 push %1
 14890                              <2>         %elifidni %1, word cs
 14891                              <2>                 o16 push %1
 14892                              <2>         %elifidni %1, word ds
 14893                              <2>                 o16 push %1
 14894                              <2>         %elifidni %1, word es
 14895                              <2>                 o16 push %1
 14896                              <2>         %elifidni %1, word fs
 14897                              <2>                 o16 push %1
 14898                              <2>         %elifidni %1, word gs
 14899                              <2>                 o16 push %1
 14900                              <2>         %else
 14901 000011E7 66680000            <2>                 push %1
 14902                              <2>         %endif
 14903                              <2> 
 14904                              <2>         %rotate -1
 14905                              <2> 
 14906                              <2> 
 14907                              <2> 
 14908                              <2> 
 14909                              <2> 
 14910                              <2> 
 14911                              <2> 
 14912                              <2>         %ifidni %1, cs
 14913                              <2>                 o16 push %1
 14914                              <2>         %elifidni %1, ds
 14915                              <2>                 o16 push %1
 14916                              <2>         %elifidni %1, es
 14917                              <2>                 o16 push %1
 14918                              <2>         %elifidni %1, fs
 14919                              <2>                 o16 push %1
 14920                              <2>         %elifidni %1, gs
 14921                              <2>                 o16 push %1
 14922                              <2>         %elifidni %1, word cs
 14923                              <2>                 o16 push %1
 14924                              <2>         %elifidni %1, word ds
 14925                              <2>                 o16 push %1
 14926                              <2>         %elifidni %1, word es
 14927                              <2>                 o16 push %1
 14928                              <2>         %elifidni %1, word fs
 14929                              <2>                 o16 push %1
 14930                              <2>         %elifidni %1, word gs
 14931                              <2>                 o16 push %1
 14932                              <2>         %else
 14933 000011EB 66680000            <2>                 push %1
 14934                              <2>         %endif
 14935                              <2> 
 14936                              <2>         %rotate -1
 14937 000011EF E8(00000000)        <1> call %1
 14938                              <1> %if (%0!=1)
 14939 000011F4 83C404              <1>         add esp, byte %1_arglen
 14940                              <1> %endif
 14941                                  
 14942 000011F7 665A                     pop dx
 14943 000011F9 6659                     pop cx
 14944 000011FB 665B                     pop bx
 14945 000011FD 6658                     pop ax
 14946                                   ret
 14947                              <1> %ifnctx proc
 14948 000011FF C3                  <1> 	ret	%1
 14949                              <1> %else
 14950                              <1> 	mov	esp, ebp
 14951                              <1> 	pop	ebp
 14952                              <1> 	ret	%1
 14953                              <1> %endif
 14954                                  
 14955                                  
 14956                                  
 14957                                  
 14958                                  ;-------------------------------------------------------------------------;
 14959                                  ; MouseCallback()							  ;
 14960                                  ;									  ;
 14961                                  ;   void _MouseCallback(dword DPMIRegsPtr)				  ;
 14962                                  ;									  ;
 14963                                  ;   Inputs: DPMIRegsPtr = pointer to DPMI register structure		  ;
 14964                                  ;	    [_MouseX], [_MouseY], [_MPFlags]				  ;
 14965                                  ;									  ;
 14966                                  ;   Outputs: [_MouseX], [_MouseY], [_MPFlags]				  ;
 14967                                  ;									  ;
 14968                                  ;   Calls: none								  ;
 14969                                  ;									  ;
 14970                                  ;   Returns: none							  ;
 14971                                  ;									  ;
 14972                                  ;   Purpose: Handles mouse input from the user				  ;
 14973                                  ;									  ;
 14974                                  ;-------------------------------------------------------------------------;
 14975                                  proc _MouseCallback
 14976                              <1> %push proc
 14977                              <1>           global %1
 14978 00001200 55                  <1> %1:       push  ebp
 14979 00001201 89E5                <1>           mov   ebp, esp
 14980                              <1> %assign %$arg 8
 14981                              <1> 
 14982                              <1> %define %$procname %1
 14983                                  .DPMIRegsPtr   arg     4
 14984                              <1> .DPMIRegsPtr       equ %$arg
 14985                              <1> 
 14986                              <1> 
 14987                              <1> %assign %$arg %1+%$arg
 14988                                  ;invoke	_libMouseCallback, dword [ebp+.DPMIRegsPtr]
 14989                                  ;ret
 14990                                  
 14991 00001203 60                       pushad
 14992                                  
 14993 00001204 8B7508                   mov esi, dword [ebp + .DPMIRegsPtr]
 14994 00001207 268B5E10                 mov ebx, dword [es:esi+DPMI_EBX_off]
 14995 0000120B 268B4E18                 mov ecx, dword [es:esi+DPMI_ECX_off]
 14996 0000120F 268B5614                 mov edx, dword [es:esi+DPMI_EDX_off]
 14997                                  
 14998                                  
 14999 00001213 80E301                   and bl, 00000001b
 15000 00001216 80FB01                   cmp bl, 1
 15001 00001219 0F8413000000             je near .LeftPressed
 15002                                  
 15003                                  
 15004 0000121F A0[26000000]             mov al, byte [_MPFlags]
 15005 00001224 2402                     and al, 00000010b
 15006 00001226 8025[26000000]FD         and byte [_MPFlags], 11111101b		; Clear Bit 2 in [_MPFlags]		
 15007 0000122D E90E000000               jmp near .CheckStatusChange
 15008                                  
 15009                                  
 15010                                  
 15011                                   ;------------
 15012                                   .LeftPressed:
 15013                                   ;------------
 15014 00001232 A0[26000000]                mov al, byte [_MPFlags]
 15015 00001237 2402                        and al, 00000010b
 15016 00001239 800D[26000000]02            or byte [_MPFlags], 00000010b	; Set Bit 2 in [_MPFlags]
 15017                                  
 15018                                  
 15019                                   ;------------------
 15020                                   .CheckStatusChange:
 15021                                   ;------------------
 15022 00001240 D0E8                        shr al, 1
 15023 00001242 38D8                        cmp al, bl
 15024 00001244 750C                        jne .StatusChange
 15025 00001246 8025[26000000]FB            and byte [_MPFlags], 11111011b
 15026 0000124D E907000000                  jmp near .UpdateXY
 15027                                  
 15028                                  
 15029                                   ;-------------
 15030                                   .StatusChange:
 15031                                   ;-------------
 15032 00001252 800D[26000000]04            or byte [_MPFlags], 00000100b	; Change in LMB status
 15033                                  
 15034                                  
 15035                                   ;---------
 15036                                   .UpdateXY:
 15037                                   ;---------
 15038 00001259 66890D[0A000000]            mov word [_MouseX], cx		; Update values of [_MouseX] and [_MouseY]
 15039 00001260 668915[0C000000]            mov word [_MouseY], dx		; when mouse is moved
 15040                                  
 15041 00001267 61                          popad
 15042                                      ret
 15043                              <1> %ifnctx proc
 15044                              <1> 	ret	%1
 15045                              <1> %else
 15046 00001268 89EC                <1> 	mov	esp, ebp
 15047 0000126A 5D                  <1> 	pop	ebp
 15048 0000126B C3                  <1> 	ret	%1
 15049                              <1> %endif
 15050                                  
 15051                                  
 15052                                  endproc
 15053                              <1> %ifnctx proc
 15054                              <1> %error Mismatched `endproc'/`proc'
 15055                              <1> %else
 15056                              <1> 
 15057                              <1> 
 15058                              <1> %ifdef LEGACY_ENDPROC
 15059                              <1>         ret
 15060                              <1> %endif
 15061                              <1> 
 15062                              <1> 
 15063                              <1> 
 15064                              <1> 
 15065                              <1> 
 15066                              <1> 
 15067                              <1> 
 15068                              <1> 
 15069                              <1> 
 15070                              <1> %pop
 15071                              <1> %endif
 15072                                  _MouseCallback_end
 15073                                  _MouseCallback_arglen	EQU	4
